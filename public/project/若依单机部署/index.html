<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='若依单机部署\n1 将ruoyi.tar.bz2、ry_20240601.sql、ruoyi-admin.jar、mysql-5.7.40.tar.bz2拖进来 MySQL部署脚本（mysql-5.7.40)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 #!/bin/bash # ========================================== # 步骤 1: 清理旧环境 (Clean up) # ========================================== echo "正在停止数据库服务并清理旧环境..." systemctl stop mysqld systemctl stop mysql systemctl stop mariadb # 强制杀掉可能卡住的进程 pkill -9 mysqld pkill -9 mysqld_safe # 卸载相关包 yum remove -y mysql-community-* yum remove -y mysql* MySQL* yum remove -y mariadb* # 删除旧的数据和配置文件 # 注意：这会清空 /data/mysql 下的所有数据，请确保已备份 rm -rf /data/mysql rm -rf /var/lib/mysql rm -rf /etc/my.cnf* rm -rf /var/log/mysqld.log echo "环境清理完成。" # ========================================== # 步骤 2: 安装软件 (Install) # ========================================== echo "开始安装 MySQL..." # 检查安装包是否存在 (防止脚本报错) if [ ! -f "mysql-5.7.40.tar.bz2" ]; then echo "错误: 当前目录下未找到 mysql-5.7.40.tar.bz2 文件！" exit 1 fi tar xvf mysql-5.7.40.tar.bz2 yum localinstall -y mysql-5.7.40/* # ========================================== # 步骤 3: 写入配置文件 (Configuration) # ========================================== echo "正在写入配置文件..." cp -ar /etc/my.cnf{,.backup} 2>/dev/null # --- 以下内容为你指定的配置，未做任何改动 --- cat > /etc/my.cnf << EOF [mysql] #定义MySQL监听端口 port=3306 #定义MySQL监听IP地址 bind-address=0.0.0.0 [mysqld] #定义MySQL字符集 character_set_server=utf8 init_connect=&#39;SET NAMES utf8&#39; #定义程序用户 user = mysql #定义sock路径 socket=/var/lib/mysql/mysql.sock #定义MySQLdata路径 datadir=/data/mysql/data #定义MySQL最大链接 max_connections = 2000 #relay-log的结构和binlog非常相似，只不过他多了一个master.info和relay-log.info的文件。 #master.info记录了上一次读取到master同步过来的binlog的位置，以及连接master和启动复制必须的所有信息。 #relay-log.info记录了文件复制的进度，下一个事件从什么位置开始，由sql线程负责更新。 relay-log=/data/mysql/data/relay-log #binlog的主要作用是记录数据库中表的更改，它只记录改变数据的sql log-bin=/data/mysql/data/mysql-bin #定义最大binlog大小 max_binlog_size = 500M #为每个session分配内存，事务中用于二进制日志缓存存储，默认32K，提高bin_log的效率 binlog_cache_size = 128K #定义无需主从同步的数据库，多个数据库需要重复设置于bin-do-db相反。 binlog-ignore-db = mysql #MySQL-binlog保存时间 expire_logs_days = 7 #定义binlog格式 binlog_format="ROW" #server-id集群标识不能重复 server-id=1 #跳过外部锁定用于多进程条件下为MyISAM数据表进行锁定 skip-external-locking #禁用dns解析，此处如果禁用授权仅可授权ip skip-name-resolve #不添加log-slave-updates参数，从库从主库复制的数据不会写入log-bin日志文件里 #开启log-slave-updates参数后，从库从主库复制的数据会写入log-bin日志文件里，数据量过大会导致主从同步变慢 #log-slave-updates=1 #从服务器可能会遇到执行BINLOG中的SQL出错的情况lave-skip-errors的作用就是用来定义复制过程中从服务器可以自动跳过的错误号，当复制过程中遇到定义的错误号 slave-skip-errors=1 #配置文件会限制server接受的数据包的大小。如果写入大数据时，因为默认的配置太小，插入和更新操作会因为 max_allowed_packet 参数限制，而导致失败。 max_allowed_packet = 100M #忽略表明大小写 lower_case_table_names=1 #开启慢查询日志 slow_query_log=on #定义慢查询日志路径 slow_query_log_file=/data/mysql/logs/slow_query_log.log #定义慢查询日志触发时间 long_query_time=2 #是否只支持软连接=0表示不开启 symbolic-links=0 #MySQL-errorlog路径 log-error=/data/mysql/logs/mysql.err #定义MySQL-SQLmodule sql_mode=STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION #单个host链接错误次数等于max_connect_errors(默认10) max_connect_errors = 100 ###innodb优化参数 #默认8M可根据项目实际情况调整 innodb_buffer_pool_size=128M #限制Innodb能打开的表的数据。根据库内表数量进行调整。默认300 innodb_open_files=800 [mysqld_safe] #定义pid文件路径 pid-file=/var/run/mysqld/mysqld.pid #error-log路径 log-error=/data/mysql/logs/mysql.err EOF # --- 配置写入结束 --- # ========================================== # 步骤 4: 目录初始化与权限 (Directory & Init) # ========================================== echo "正在配置目录和权限..." # 创建数据目录和日志目录 mkdir -pv /data/mysql/{data,logs} # 【重要修复】创建 Socket 目录 # 配置文件里写了 socket=/var/lib/mysql/mysql.sock，如果不创建此目录，启动会报错 mkdir -pv /var/lib/mysql # 修改权限 chown -R mysql:mysql /data/mysql/ chown -R mysql:mysql /var/lib/mysql/ # 确保必要的 SELinux 工具已安装 (防止 semanage 命令未找到) if ! command -v semanage &> /dev/null; then echo "正在安装 policycoreutils-python 以支持 SELinux 管理..." yum install -y policycoreutils-python || yum install -y policycoreutils-python-utils fi # ========================================== # 步骤 5: 数据库初始化 (Initialize DB) # ========================================== echo "正在初始化数据库 (这可能需要几秒钟)..." # 【关键修复】手动执行初始化 # 使用 --initialize 会生成随机密码，记录在 log-error 文件中 mysqld --initialize --user=mysql --datadir=/data/mysql/data if [ $? -ne 0 ]; then echo "错误: 数据库初始化失败！请检查 /data/mysql/logs/mysql.err" exit 1 fi # ========================================== # 步骤 6: 启动与 SELinux (Startup) # ========================================== echo "正在处理 SELinux 并启动服务..." # 先临时关闭 SELinux 以确保服务能顺利启动 setenforce 0 # 设置 SELinux 上下文 (如果开启了 SELinux) semanage fcontext -a -t mysqld_db_t "/data/mysql(/.*)?" 2>/dev/null restorecon -Rv /data/mysql # 启动服务 systemctl start mysqld systemctl enable mysqld # 恢复 SELinux (可选，如果不想恢复可注释掉) # setenforce 1 # ========================================== # 步骤 7: 结果验证 (Verification) # ========================================== echo "----------------------------------------------------" # 检查服务状态 if systemctl is-active --quiet mysqld; then echo "✅ MySQL 启动成功！" echo "数据库文件路径: /data/mysql/data" echo "Socket 文件路径: /var/lib/mysql/mysql.sock" # 提取临时密码 echo "----------------------------------------------------" echo "正在获取 root 初始密码..." temp_password=$(grep &#39;temporary password&#39; /data/mysql/logs/mysql.err | awk &#39;{print $NF}&#39;) if [ -n "$temp_password" ]; then echo "Root 初始密码: $temp_password" else echo "未找到临时密码，请手动查看日志: cat /data/mysql/logs/mysql.err" fi echo "----------------------------------------------------" echo "请使用以下命令登录并修改密码：" echo "mysql -uroot -p -S /var/lib/mysql/mysql.sock" else echo "❌ MySQL 启动失败。" echo "请查看详细日志: cat /data/mysql/logs/mysql.err" systemctl status mysqld -l fi 1 2 3 4 5 6 7 8 9 10 11 ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123123&#39;; FLUSH PRIVILEGES; create database ruoyi_demo character set utf8; CREATE USER &#39;ruoyi_demo&#39;@&#39;%&#39; IDENTIFIED BY &#39;123123&#39;; GRANT ALL PRIVILEGES ON ruoyi_demo.* TO &#39;ruoyi_demo&#39;@&#39;%&#39;; FLUSH PRIVILEGES; use ruoyi_demo; source /root/ry_20240601.sql; exit 1 systemctl stop firewalld && systemctl disable firewalld 第一步：修改配置文件 若依项目打包在 Docker 镜像里之前，必须把数据库连接信息写死在配置文件里。一旦配置文件修改，必须重新构建镜像。\n'><title>若依单机部署</title><link rel=canonical href=http://localhost:1313/project/%E8%8B%A5%E4%BE%9D%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="若依单机部署"><meta property='og:description' content='若依单机部署\n1 将ruoyi.tar.bz2、ry_20240601.sql、ruoyi-admin.jar、mysql-5.7.40.tar.bz2拖进来 MySQL部署脚本（mysql-5.7.40)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 #!/bin/bash # ========================================== # 步骤 1: 清理旧环境 (Clean up) # ========================================== echo "正在停止数据库服务并清理旧环境..." systemctl stop mysqld systemctl stop mysql systemctl stop mariadb # 强制杀掉可能卡住的进程 pkill -9 mysqld pkill -9 mysqld_safe # 卸载相关包 yum remove -y mysql-community-* yum remove -y mysql* MySQL* yum remove -y mariadb* # 删除旧的数据和配置文件 # 注意：这会清空 /data/mysql 下的所有数据，请确保已备份 rm -rf /data/mysql rm -rf /var/lib/mysql rm -rf /etc/my.cnf* rm -rf /var/log/mysqld.log echo "环境清理完成。" # ========================================== # 步骤 2: 安装软件 (Install) # ========================================== echo "开始安装 MySQL..." # 检查安装包是否存在 (防止脚本报错) if [ ! -f "mysql-5.7.40.tar.bz2" ]; then echo "错误: 当前目录下未找到 mysql-5.7.40.tar.bz2 文件！" exit 1 fi tar xvf mysql-5.7.40.tar.bz2 yum localinstall -y mysql-5.7.40/* # ========================================== # 步骤 3: 写入配置文件 (Configuration) # ========================================== echo "正在写入配置文件..." cp -ar /etc/my.cnf{,.backup} 2>/dev/null # --- 以下内容为你指定的配置，未做任何改动 --- cat > /etc/my.cnf << EOF [mysql] #定义MySQL监听端口 port=3306 #定义MySQL监听IP地址 bind-address=0.0.0.0 [mysqld] #定义MySQL字符集 character_set_server=utf8 init_connect=&#39;SET NAMES utf8&#39; #定义程序用户 user = mysql #定义sock路径 socket=/var/lib/mysql/mysql.sock #定义MySQLdata路径 datadir=/data/mysql/data #定义MySQL最大链接 max_connections = 2000 #relay-log的结构和binlog非常相似，只不过他多了一个master.info和relay-log.info的文件。 #master.info记录了上一次读取到master同步过来的binlog的位置，以及连接master和启动复制必须的所有信息。 #relay-log.info记录了文件复制的进度，下一个事件从什么位置开始，由sql线程负责更新。 relay-log=/data/mysql/data/relay-log #binlog的主要作用是记录数据库中表的更改，它只记录改变数据的sql log-bin=/data/mysql/data/mysql-bin #定义最大binlog大小 max_binlog_size = 500M #为每个session分配内存，事务中用于二进制日志缓存存储，默认32K，提高bin_log的效率 binlog_cache_size = 128K #定义无需主从同步的数据库，多个数据库需要重复设置于bin-do-db相反。 binlog-ignore-db = mysql #MySQL-binlog保存时间 expire_logs_days = 7 #定义binlog格式 binlog_format="ROW" #server-id集群标识不能重复 server-id=1 #跳过外部锁定用于多进程条件下为MyISAM数据表进行锁定 skip-external-locking #禁用dns解析，此处如果禁用授权仅可授权ip skip-name-resolve #不添加log-slave-updates参数，从库从主库复制的数据不会写入log-bin日志文件里 #开启log-slave-updates参数后，从库从主库复制的数据会写入log-bin日志文件里，数据量过大会导致主从同步变慢 #log-slave-updates=1 #从服务器可能会遇到执行BINLOG中的SQL出错的情况lave-skip-errors的作用就是用来定义复制过程中从服务器可以自动跳过的错误号，当复制过程中遇到定义的错误号 slave-skip-errors=1 #配置文件会限制server接受的数据包的大小。如果写入大数据时，因为默认的配置太小，插入和更新操作会因为 max_allowed_packet 参数限制，而导致失败。 max_allowed_packet = 100M #忽略表明大小写 lower_case_table_names=1 #开启慢查询日志 slow_query_log=on #定义慢查询日志路径 slow_query_log_file=/data/mysql/logs/slow_query_log.log #定义慢查询日志触发时间 long_query_time=2 #是否只支持软连接=0表示不开启 symbolic-links=0 #MySQL-errorlog路径 log-error=/data/mysql/logs/mysql.err #定义MySQL-SQLmodule sql_mode=STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION #单个host链接错误次数等于max_connect_errors(默认10) max_connect_errors = 100 ###innodb优化参数 #默认8M可根据项目实际情况调整 innodb_buffer_pool_size=128M #限制Innodb能打开的表的数据。根据库内表数量进行调整。默认300 innodb_open_files=800 [mysqld_safe] #定义pid文件路径 pid-file=/var/run/mysqld/mysqld.pid #error-log路径 log-error=/data/mysql/logs/mysql.err EOF # --- 配置写入结束 --- # ========================================== # 步骤 4: 目录初始化与权限 (Directory & Init) # ========================================== echo "正在配置目录和权限..." # 创建数据目录和日志目录 mkdir -pv /data/mysql/{data,logs} # 【重要修复】创建 Socket 目录 # 配置文件里写了 socket=/var/lib/mysql/mysql.sock，如果不创建此目录，启动会报错 mkdir -pv /var/lib/mysql # 修改权限 chown -R mysql:mysql /data/mysql/ chown -R mysql:mysql /var/lib/mysql/ # 确保必要的 SELinux 工具已安装 (防止 semanage 命令未找到) if ! command -v semanage &> /dev/null; then echo "正在安装 policycoreutils-python 以支持 SELinux 管理..." yum install -y policycoreutils-python || yum install -y policycoreutils-python-utils fi # ========================================== # 步骤 5: 数据库初始化 (Initialize DB) # ========================================== echo "正在初始化数据库 (这可能需要几秒钟)..." # 【关键修复】手动执行初始化 # 使用 --initialize 会生成随机密码，记录在 log-error 文件中 mysqld --initialize --user=mysql --datadir=/data/mysql/data if [ $? -ne 0 ]; then echo "错误: 数据库初始化失败！请检查 /data/mysql/logs/mysql.err" exit 1 fi # ========================================== # 步骤 6: 启动与 SELinux (Startup) # ========================================== echo "正在处理 SELinux 并启动服务..." # 先临时关闭 SELinux 以确保服务能顺利启动 setenforce 0 # 设置 SELinux 上下文 (如果开启了 SELinux) semanage fcontext -a -t mysqld_db_t "/data/mysql(/.*)?" 2>/dev/null restorecon -Rv /data/mysql # 启动服务 systemctl start mysqld systemctl enable mysqld # 恢复 SELinux (可选，如果不想恢复可注释掉) # setenforce 1 # ========================================== # 步骤 7: 结果验证 (Verification) # ========================================== echo "----------------------------------------------------" # 检查服务状态 if systemctl is-active --quiet mysqld; then echo "✅ MySQL 启动成功！" echo "数据库文件路径: /data/mysql/data" echo "Socket 文件路径: /var/lib/mysql/mysql.sock" # 提取临时密码 echo "----------------------------------------------------" echo "正在获取 root 初始密码..." temp_password=$(grep &#39;temporary password&#39; /data/mysql/logs/mysql.err | awk &#39;{print $NF}&#39;) if [ -n "$temp_password" ]; then echo "Root 初始密码: $temp_password" else echo "未找到临时密码，请手动查看日志: cat /data/mysql/logs/mysql.err" fi echo "----------------------------------------------------" echo "请使用以下命令登录并修改密码：" echo "mysql -uroot -p -S /var/lib/mysql/mysql.sock" else echo "❌ MySQL 启动失败。" echo "请查看详细日志: cat /data/mysql/logs/mysql.err" systemctl status mysqld -l fi 1 2 3 4 5 6 7 8 9 10 11 ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123123&#39;; FLUSH PRIVILEGES; create database ruoyi_demo character set utf8; CREATE USER &#39;ruoyi_demo&#39;@&#39;%&#39; IDENTIFIED BY &#39;123123&#39;; GRANT ALL PRIVILEGES ON ruoyi_demo.* TO &#39;ruoyi_demo&#39;@&#39;%&#39;; FLUSH PRIVILEGES; use ruoyi_demo; source /root/ry_20240601.sql; exit 1 systemctl stop firewalld && systemctl disable firewalld 第一步：修改配置文件 若依项目打包在 Docker 镜像里之前，必须把数据库连接信息写死在配置文件里。一旦配置文件修改，必须重新构建镜像。\n'><meta property='og:url' content='http://localhost:1313/project/%E8%8B%A5%E4%BE%9D%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Project'><meta property='article:published_time' content='2025-12-08T00:00:00+00:00'><meta property='article:modified_time' content='2025-12-08T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="若依单机部署"><meta name=twitter:description content='若依单机部署\n1 将ruoyi.tar.bz2、ry_20240601.sql、ruoyi-admin.jar、mysql-5.7.40.tar.bz2拖进来 MySQL部署脚本（mysql-5.7.40)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 #!/bin/bash # ========================================== # 步骤 1: 清理旧环境 (Clean up) # ========================================== echo "正在停止数据库服务并清理旧环境..." systemctl stop mysqld systemctl stop mysql systemctl stop mariadb # 强制杀掉可能卡住的进程 pkill -9 mysqld pkill -9 mysqld_safe # 卸载相关包 yum remove -y mysql-community-* yum remove -y mysql* MySQL* yum remove -y mariadb* # 删除旧的数据和配置文件 # 注意：这会清空 /data/mysql 下的所有数据，请确保已备份 rm -rf /data/mysql rm -rf /var/lib/mysql rm -rf /etc/my.cnf* rm -rf /var/log/mysqld.log echo "环境清理完成。" # ========================================== # 步骤 2: 安装软件 (Install) # ========================================== echo "开始安装 MySQL..." # 检查安装包是否存在 (防止脚本报错) if [ ! -f "mysql-5.7.40.tar.bz2" ]; then echo "错误: 当前目录下未找到 mysql-5.7.40.tar.bz2 文件！" exit 1 fi tar xvf mysql-5.7.40.tar.bz2 yum localinstall -y mysql-5.7.40/* # ========================================== # 步骤 3: 写入配置文件 (Configuration) # ========================================== echo "正在写入配置文件..." cp -ar /etc/my.cnf{,.backup} 2>/dev/null # --- 以下内容为你指定的配置，未做任何改动 --- cat > /etc/my.cnf << EOF [mysql] #定义MySQL监听端口 port=3306 #定义MySQL监听IP地址 bind-address=0.0.0.0 [mysqld] #定义MySQL字符集 character_set_server=utf8 init_connect=&#39;SET NAMES utf8&#39; #定义程序用户 user = mysql #定义sock路径 socket=/var/lib/mysql/mysql.sock #定义MySQLdata路径 datadir=/data/mysql/data #定义MySQL最大链接 max_connections = 2000 #relay-log的结构和binlog非常相似，只不过他多了一个master.info和relay-log.info的文件。 #master.info记录了上一次读取到master同步过来的binlog的位置，以及连接master和启动复制必须的所有信息。 #relay-log.info记录了文件复制的进度，下一个事件从什么位置开始，由sql线程负责更新。 relay-log=/data/mysql/data/relay-log #binlog的主要作用是记录数据库中表的更改，它只记录改变数据的sql log-bin=/data/mysql/data/mysql-bin #定义最大binlog大小 max_binlog_size = 500M #为每个session分配内存，事务中用于二进制日志缓存存储，默认32K，提高bin_log的效率 binlog_cache_size = 128K #定义无需主从同步的数据库，多个数据库需要重复设置于bin-do-db相反。 binlog-ignore-db = mysql #MySQL-binlog保存时间 expire_logs_days = 7 #定义binlog格式 binlog_format="ROW" #server-id集群标识不能重复 server-id=1 #跳过外部锁定用于多进程条件下为MyISAM数据表进行锁定 skip-external-locking #禁用dns解析，此处如果禁用授权仅可授权ip skip-name-resolve #不添加log-slave-updates参数，从库从主库复制的数据不会写入log-bin日志文件里 #开启log-slave-updates参数后，从库从主库复制的数据会写入log-bin日志文件里，数据量过大会导致主从同步变慢 #log-slave-updates=1 #从服务器可能会遇到执行BINLOG中的SQL出错的情况lave-skip-errors的作用就是用来定义复制过程中从服务器可以自动跳过的错误号，当复制过程中遇到定义的错误号 slave-skip-errors=1 #配置文件会限制server接受的数据包的大小。如果写入大数据时，因为默认的配置太小，插入和更新操作会因为 max_allowed_packet 参数限制，而导致失败。 max_allowed_packet = 100M #忽略表明大小写 lower_case_table_names=1 #开启慢查询日志 slow_query_log=on #定义慢查询日志路径 slow_query_log_file=/data/mysql/logs/slow_query_log.log #定义慢查询日志触发时间 long_query_time=2 #是否只支持软连接=0表示不开启 symbolic-links=0 #MySQL-errorlog路径 log-error=/data/mysql/logs/mysql.err #定义MySQL-SQLmodule sql_mode=STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION #单个host链接错误次数等于max_connect_errors(默认10) max_connect_errors = 100 ###innodb优化参数 #默认8M可根据项目实际情况调整 innodb_buffer_pool_size=128M #限制Innodb能打开的表的数据。根据库内表数量进行调整。默认300 innodb_open_files=800 [mysqld_safe] #定义pid文件路径 pid-file=/var/run/mysqld/mysqld.pid #error-log路径 log-error=/data/mysql/logs/mysql.err EOF # --- 配置写入结束 --- # ========================================== # 步骤 4: 目录初始化与权限 (Directory & Init) # ========================================== echo "正在配置目录和权限..." # 创建数据目录和日志目录 mkdir -pv /data/mysql/{data,logs} # 【重要修复】创建 Socket 目录 # 配置文件里写了 socket=/var/lib/mysql/mysql.sock，如果不创建此目录，启动会报错 mkdir -pv /var/lib/mysql # 修改权限 chown -R mysql:mysql /data/mysql/ chown -R mysql:mysql /var/lib/mysql/ # 确保必要的 SELinux 工具已安装 (防止 semanage 命令未找到) if ! command -v semanage &> /dev/null; then echo "正在安装 policycoreutils-python 以支持 SELinux 管理..." yum install -y policycoreutils-python || yum install -y policycoreutils-python-utils fi # ========================================== # 步骤 5: 数据库初始化 (Initialize DB) # ========================================== echo "正在初始化数据库 (这可能需要几秒钟)..." # 【关键修复】手动执行初始化 # 使用 --initialize 会生成随机密码，记录在 log-error 文件中 mysqld --initialize --user=mysql --datadir=/data/mysql/data if [ $? -ne 0 ]; then echo "错误: 数据库初始化失败！请检查 /data/mysql/logs/mysql.err" exit 1 fi # ========================================== # 步骤 6: 启动与 SELinux (Startup) # ========================================== echo "正在处理 SELinux 并启动服务..." # 先临时关闭 SELinux 以确保服务能顺利启动 setenforce 0 # 设置 SELinux 上下文 (如果开启了 SELinux) semanage fcontext -a -t mysqld_db_t "/data/mysql(/.*)?" 2>/dev/null restorecon -Rv /data/mysql # 启动服务 systemctl start mysqld systemctl enable mysqld # 恢复 SELinux (可选，如果不想恢复可注释掉) # setenforce 1 # ========================================== # 步骤 7: 结果验证 (Verification) # ========================================== echo "----------------------------------------------------" # 检查服务状态 if systemctl is-active --quiet mysqld; then echo "✅ MySQL 启动成功！" echo "数据库文件路径: /data/mysql/data" echo "Socket 文件路径: /var/lib/mysql/mysql.sock" # 提取临时密码 echo "----------------------------------------------------" echo "正在获取 root 初始密码..." temp_password=$(grep &#39;temporary password&#39; /data/mysql/logs/mysql.err | awk &#39;{print $NF}&#39;) if [ -n "$temp_password" ]; then echo "Root 初始密码: $temp_password" else echo "未找到临时密码，请手动查看日志: cat /data/mysql/logs/mysql.err" fi echo "----------------------------------------------------" echo "请使用以下命令登录并修改密码：" echo "mysql -uroot -p -S /var/lib/mysql/mysql.sock" else echo "❌ MySQL 启动失败。" echo "请查看详细日志: cat /data/mysql/logs/mysql.err" systemctl status mysqld -l fi 1 2 3 4 5 6 7 8 9 10 11 ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123123&#39;; FLUSH PRIVILEGES; create database ruoyi_demo character set utf8; CREATE USER &#39;ruoyi_demo&#39;@&#39;%&#39; IDENTIFIED BY &#39;123123&#39;; GRANT ALL PRIVILEGES ON ruoyi_demo.* TO &#39;ruoyi_demo&#39;@&#39;%&#39;; FLUSH PRIVILEGES; use ruoyi_demo; source /root/ry_20240601.sql; exit 1 systemctl stop firewalld && systemctl disable firewalld 第一步：修改配置文件 若依项目打包在 Docker 镜像里之前，必须把数据库连接信息写死在配置文件里。一旦配置文件修改，必须重新构建镜像。\n'><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/kali/><span>kali</span></a></li><li><a href=/ubuntu/><span>ubuntu</span></a></li><li><a href=/utility/><span>Utility</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#第一步修改配置文件>第一步：修改配置文件</a></li><li><a href=#第二步清理旧环境非常重要>第二步：清理旧环境（非常重要）</a></li><li><a href=#第三步重新构建镜像>第三步：重新构建镜像</a></li><li><a href=#第四步启动容器核心修正点>第四步：启动容器（核心修正点）</a></li><li><a href=#第五步最终验证>第五步：最终验证</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/project/%E8%8B%A5%E4%BE%9D%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2/>若依单机部署</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-12-08</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 7 分钟</time></div></footer></div></header><section class=article-content><p>若依单机部署</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>将ruoyi.tar.bz2、ry_20240601.sql、ruoyi-admin.jar、mysql-5.7.40.tar.bz2拖进来
</span></span></code></pre></td></tr></table></div></div><p>MySQL部署脚本（mysql-5.7.40)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># 步骤 1: 清理旧环境 (Clean up)</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;正在停止数据库服务并清理旧环境...&#34;</span>
</span></span><span class=line><span class=cl>systemctl stop mysqld
</span></span><span class=line><span class=cl>systemctl stop mysql
</span></span><span class=line><span class=cl>systemctl stop mariadb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 强制杀掉可能卡住的进程</span>
</span></span><span class=line><span class=cl>pkill -9 mysqld
</span></span><span class=line><span class=cl>pkill -9 mysqld_safe
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 卸载相关包</span>
</span></span><span class=line><span class=cl>yum remove -y mysql-community-*
</span></span><span class=line><span class=cl>yum remove -y mysql* MySQL*
</span></span><span class=line><span class=cl>yum remove -y mariadb*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 删除旧的数据和配置文件</span>
</span></span><span class=line><span class=cl><span class=c1># 注意：这会清空 /data/mysql 下的所有数据，请确保已备份</span>
</span></span><span class=line><span class=cl>rm -rf /data/mysql
</span></span><span class=line><span class=cl>rm -rf /var/lib/mysql
</span></span><span class=line><span class=cl>rm -rf /etc/my.cnf*
</span></span><span class=line><span class=cl>rm -rf /var/log/mysqld.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;环境清理完成。&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># 步骤 2: 安装软件 (Install)</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;开始安装 MySQL...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查安装包是否存在 (防止脚本报错)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> ! -f <span class=s2>&#34;mysql-5.7.40.tar.bz2&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;错误: 当前目录下未找到 mysql-5.7.40.tar.bz2 文件！&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>tar xvf mysql-5.7.40.tar.bz2
</span></span><span class=line><span class=cl>yum localinstall -y mysql-5.7.40/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># 步骤 3: 写入配置文件 (Configuration)</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;正在写入配置文件...&#34;</span>
</span></span><span class=line><span class=cl>cp -ar /etc/my.cnf<span class=o>{</span>,.backup<span class=o>}</span> 2&gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 以下内容为你指定的配置，未做任何改动 ---</span>
</span></span><span class=line><span class=cl>cat &gt; /etc/my.cnf <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>[mysql]
</span></span></span><span class=line><span class=cl><span class=s>#定义MySQL监听端口
</span></span></span><span class=line><span class=cl><span class=s>port=3306
</span></span></span><span class=line><span class=cl><span class=s>#定义MySQL监听IP地址
</span></span></span><span class=line><span class=cl><span class=s>bind-address=0.0.0.0
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[mysqld]
</span></span></span><span class=line><span class=cl><span class=s>#定义MySQL字符集
</span></span></span><span class=line><span class=cl><span class=s>character_set_server=utf8
</span></span></span><span class=line><span class=cl><span class=s>init_connect=&#39;SET NAMES utf8&#39;
</span></span></span><span class=line><span class=cl><span class=s>#定义程序用户
</span></span></span><span class=line><span class=cl><span class=s>user = mysql
</span></span></span><span class=line><span class=cl><span class=s>#定义sock路径
</span></span></span><span class=line><span class=cl><span class=s>socket=/var/lib/mysql/mysql.sock
</span></span></span><span class=line><span class=cl><span class=s>#定义MySQLdata路径
</span></span></span><span class=line><span class=cl><span class=s>datadir=/data/mysql/data
</span></span></span><span class=line><span class=cl><span class=s>#定义MySQL最大链接
</span></span></span><span class=line><span class=cl><span class=s>max_connections = 2000
</span></span></span><span class=line><span class=cl><span class=s>#relay-log的结构和binlog非常相似，只不过他多了一个master.info和relay-log.info的文件。
</span></span></span><span class=line><span class=cl><span class=s>#master.info记录了上一次读取到master同步过来的binlog的位置，以及连接master和启动复制必须的所有信息。
</span></span></span><span class=line><span class=cl><span class=s>#relay-log.info记录了文件复制的进度，下一个事件从什么位置开始，由sql线程负责更新。
</span></span></span><span class=line><span class=cl><span class=s>relay-log=/data/mysql/data/relay-log
</span></span></span><span class=line><span class=cl><span class=s>#binlog的主要作用是记录数据库中表的更改，它只记录改变数据的sql
</span></span></span><span class=line><span class=cl><span class=s>log-bin=/data/mysql/data/mysql-bin
</span></span></span><span class=line><span class=cl><span class=s>#定义最大binlog大小
</span></span></span><span class=line><span class=cl><span class=s>max_binlog_size = 500M
</span></span></span><span class=line><span class=cl><span class=s>#为每个session分配内存，事务中用于二进制日志缓存存储，默认32K，提高bin_log的效率
</span></span></span><span class=line><span class=cl><span class=s>binlog_cache_size = 128K
</span></span></span><span class=line><span class=cl><span class=s>#定义无需主从同步的数据库，多个数据库需要重复设置于bin-do-db相反。
</span></span></span><span class=line><span class=cl><span class=s>binlog-ignore-db = mysql
</span></span></span><span class=line><span class=cl><span class=s>#MySQL-binlog保存时间
</span></span></span><span class=line><span class=cl><span class=s>expire_logs_days = 7
</span></span></span><span class=line><span class=cl><span class=s>#定义binlog格式
</span></span></span><span class=line><span class=cl><span class=s>binlog_format=&#34;ROW&#34;
</span></span></span><span class=line><span class=cl><span class=s>#server-id集群标识不能重复
</span></span></span><span class=line><span class=cl><span class=s>server-id=1
</span></span></span><span class=line><span class=cl><span class=s>#跳过外部锁定用于多进程条件下为MyISAM数据表进行锁定
</span></span></span><span class=line><span class=cl><span class=s>skip-external-locking
</span></span></span><span class=line><span class=cl><span class=s>#禁用dns解析，此处如果禁用授权仅可授权ip
</span></span></span><span class=line><span class=cl><span class=s>skip-name-resolve 
</span></span></span><span class=line><span class=cl><span class=s>#不添加log-slave-updates参数，从库从主库复制的数据不会写入log-bin日志文件里
</span></span></span><span class=line><span class=cl><span class=s>#开启log-slave-updates参数后，从库从主库复制的数据会写入log-bin日志文件里，数据量过大会导致主从同步变慢
</span></span></span><span class=line><span class=cl><span class=s>#log-slave-updates=1 
</span></span></span><span class=line><span class=cl><span class=s>#从服务器可能会遇到执行BINLOG中的SQL出错的情况lave-skip-errors的作用就是用来定义复制过程中从服务器可以自动跳过的错误号，当复制过程中遇到定义的错误号
</span></span></span><span class=line><span class=cl><span class=s>slave-skip-errors=1 
</span></span></span><span class=line><span class=cl><span class=s>#配置文件会限制server接受的数据包的大小。如果写入大数据时，因为默认的配置太小，插入和更新操作会因为 max_allowed_packet 参数限制，而导致失败。
</span></span></span><span class=line><span class=cl><span class=s>max_allowed_packet = 100M 
</span></span></span><span class=line><span class=cl><span class=s>#忽略表明大小写
</span></span></span><span class=line><span class=cl><span class=s>lower_case_table_names=1
</span></span></span><span class=line><span class=cl><span class=s>#开启慢查询日志
</span></span></span><span class=line><span class=cl><span class=s>slow_query_log=on 
</span></span></span><span class=line><span class=cl><span class=s>#定义慢查询日志路径
</span></span></span><span class=line><span class=cl><span class=s>slow_query_log_file=/data/mysql/logs/slow_query_log.log
</span></span></span><span class=line><span class=cl><span class=s>#定义慢查询日志触发时间
</span></span></span><span class=line><span class=cl><span class=s>long_query_time=2
</span></span></span><span class=line><span class=cl><span class=s>#是否只支持软连接=0表示不开启
</span></span></span><span class=line><span class=cl><span class=s>symbolic-links=0
</span></span></span><span class=line><span class=cl><span class=s>#MySQL-errorlog路径
</span></span></span><span class=line><span class=cl><span class=s>log-error=/data/mysql/logs/mysql.err
</span></span></span><span class=line><span class=cl><span class=s>#定义MySQL-SQLmodule
</span></span></span><span class=line><span class=cl><span class=s>sql_mode=STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
</span></span></span><span class=line><span class=cl><span class=s>#单个host链接错误次数等于max_connect_errors(默认10)
</span></span></span><span class=line><span class=cl><span class=s>max_connect_errors = 100
</span></span></span><span class=line><span class=cl><span class=s>###innodb优化参数
</span></span></span><span class=line><span class=cl><span class=s>#默认8M可根据项目实际情况调整
</span></span></span><span class=line><span class=cl><span class=s>innodb_buffer_pool_size=128M
</span></span></span><span class=line><span class=cl><span class=s>#限制Innodb能打开的表的数据。根据库内表数量进行调整。默认300
</span></span></span><span class=line><span class=cl><span class=s>innodb_open_files=800
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[mysqld_safe] 
</span></span></span><span class=line><span class=cl><span class=s>#定义pid文件路径
</span></span></span><span class=line><span class=cl><span class=s>pid-file=/var/run/mysqld/mysqld.pid
</span></span></span><span class=line><span class=cl><span class=s>#error-log路径
</span></span></span><span class=line><span class=cl><span class=s>log-error=/data/mysql/logs/mysql.err
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=c1># --- 配置写入结束 ---</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># 步骤 4: 目录初始化与权限 (Directory &amp; Init)</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;正在配置目录和权限...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建数据目录和日志目录</span>
</span></span><span class=line><span class=cl>mkdir -pv /data/mysql/<span class=o>{</span>data,logs<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 【重要修复】创建 Socket 目录</span>
</span></span><span class=line><span class=cl><span class=c1># 配置文件里写了 socket=/var/lib/mysql/mysql.sock，如果不创建此目录，启动会报错</span>
</span></span><span class=line><span class=cl>mkdir -pv /var/lib/mysql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改权限</span>
</span></span><span class=line><span class=cl>chown -R mysql:mysql /data/mysql/
</span></span><span class=line><span class=cl>chown -R mysql:mysql /var/lib/mysql/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 确保必要的 SELinux 工具已安装 (防止 semanage 命令未找到)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> ! <span class=nb>command</span> -v semanage <span class=p>&amp;</span>&gt; /dev/null<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;正在安装 policycoreutils-python 以支持 SELinux 管理...&#34;</span>
</span></span><span class=line><span class=cl>    yum install -y policycoreutils-python <span class=o>||</span> yum install -y policycoreutils-python-utils
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># 步骤 5: 数据库初始化 (Initialize DB)</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;正在初始化数据库 (这可能需要几秒钟)...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 【关键修复】手动执行初始化</span>
</span></span><span class=line><span class=cl><span class=c1># 使用 --initialize 会生成随机密码，记录在 log-error 文件中</span>
</span></span><span class=line><span class=cl>mysqld --initialize --user<span class=o>=</span>mysql --datadir<span class=o>=</span>/data/mysql/data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;错误: 数据库初始化失败！请检查 /data/mysql/logs/mysql.err&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># 步骤 6: 启动与 SELinux (Startup)</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;正在处理 SELinux 并启动服务...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 先临时关闭 SELinux 以确保服务能顺利启动</span>
</span></span><span class=line><span class=cl>setenforce <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置 SELinux 上下文 (如果开启了 SELinux)</span>
</span></span><span class=line><span class=cl>semanage fcontext -a -t mysqld_db_t <span class=s2>&#34;/data/mysql(/.*)?&#34;</span> 2&gt;/dev/null
</span></span><span class=line><span class=cl>restorecon -Rv /data/mysql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启动服务</span>
</span></span><span class=line><span class=cl>systemctl start mysqld
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> mysqld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 恢复 SELinux (可选，如果不想恢复可注释掉)</span>
</span></span><span class=line><span class=cl><span class=c1># setenforce 1 </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># 步骤 7: 结果验证 (Verification)</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;----------------------------------------------------&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 检查服务状态</span>
</span></span><span class=line><span class=cl><span class=k>if</span> systemctl is-active --quiet mysqld<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;✅ MySQL 启动成功！&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;数据库文件路径: /data/mysql/data&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Socket 文件路径: /var/lib/mysql/mysql.sock&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 提取临时密码</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;----------------------------------------------------&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;正在获取 root 初始密码...&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>temp_password</span><span class=o>=</span><span class=k>$(</span>grep <span class=s1>&#39;temporary password&#39;</span> /data/mysql/logs/mysql.err <span class=p>|</span> awk <span class=s1>&#39;{print $NF}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$temp_password</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Root 初始密码: </span><span class=nv>$temp_password</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;未找到临时密码，请手动查看日志: cat /data/mysql/logs/mysql.err&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;----------------------------------------------------&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;请使用以下命令登录并修改密码：&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;mysql -uroot -p -S /var/lib/mysql/mysql.sock&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;❌ MySQL 启动失败。&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;请查看详细日志: cat /data/mysql/logs/mysql.err&#34;</span>
</span></span><span class=line><span class=cl>    systemctl status mysqld -l
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ALTER USER <span class=s1>&#39;root&#39;</span>@<span class=s1>&#39;localhost&#39;</span> IDENTIFIED BY <span class=s1>&#39;123123&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>FLUSH PRIVILEGES<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>create database ruoyi_demo character <span class=nb>set</span> utf8<span class=p>;</span>
</span></span><span class=line><span class=cl>CREATE USER <span class=s1>&#39;ruoyi_demo&#39;</span>@<span class=s1>&#39;%&#39;</span> IDENTIFIED BY <span class=s1>&#39;123123&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>GRANT ALL PRIVILEGES ON ruoyi_demo.* TO <span class=s1>&#39;ruoyi_demo&#39;</span>@<span class=s1>&#39;%&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>FLUSH PRIVILEGES<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>use ruoyi_demo<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> /root/ry_20240601.sql<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl stop firewalld <span class=o>&amp;&amp;</span> systemctl disable firewalld
</span></span></code></pre></td></tr></table></div></div><h3 id=第一步修改配置文件>第一步：修改配置文件</h3><p>若依项目打包在 Docker 镜像里之前，必须把数据库连接信息写死在配置文件里。<strong>一旦配置文件修改，必须重新构建镜像。</strong></p><ol><li><p><strong>进入目录</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd /ruoyi_demo/Dockerfile/project/
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>编辑配置文件</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vi application-druid.yml
</span></span></code></pre></td></tr></table></div></div><p><em>(注：如果这里没有 druid 文件，就编辑 <code>application.yml</code>，根据你之前的 ls 记录，是有这个文件的)</em></p></li><li><p>核对关键信息（按 i 编辑）：</p><p>确保 url、username、password 三项完全匹配你刚才设置的 MySQL 信息。</p><p>YAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>spring:
</span></span><span class=line><span class=cl>  datasource:
</span></span><span class=line><span class=cl>    druid:
</span></span><span class=line><span class=cl>      master:
</span></span><span class=line><span class=cl>        # 1. 确保 IP 是本机 192.168.200.104
</span></span><span class=line><span class=cl>        # 2. 确保数据库名是 ruoyi_demo (或者 ry_20240601，看你导入时的名字)
</span></span><span class=line><span class=cl>        url: jdbc:mysql://192.168.200.104:3306/ruoyi_demo?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;serverTimezone=GMT%2B8
</span></span><span class=line><span class=cl>        # 3. 用户名（你刚才创建并授权成功的用户）
</span></span><span class=line><span class=cl>        username: ruoyi_demo
</span></span><span class=line><span class=cl>        # 4. 密码（你刚才设置的密码）
</span></span><span class=line><span class=cl>        password: 你的密码
</span></span></code></pre></td></tr></table></div></div><p>修改无误后，按 <code>Esc</code>，输入 <code>:wq</code> 保存退出。</p></li></ol><hr><h3 id=第二步清理旧环境非常重要>第二步：清理旧环境（非常重要）</h3><p>为了防止旧的配置或错误的容器干扰，我们需要先“打扫战场”。</p><ol><li><p><strong>停止并删除旧容器</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker stop ruoyi-admin
</span></span><span class=line><span class=cl>docker rm ruoyi-admin
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>删除旧镜像</strong>（确保刚才修改的配置文件能生效）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker rmi ruoyi-admin
</span></span></code></pre></td></tr></table></div></div></li></ol><hr><h3 id=第三步重新构建镜像>第三步：重新构建镜像</h3><ol><li><p><strong>回到 Dockerfile 所在目录</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd /ruoyi_demo/Dockerfile/
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>执行构建命令</strong>（注意最后有个点）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker build -t ruoyi-admin .
</span></span></code></pre></td></tr></table></div></div><p><em>等待出现 <code>Successfully tagged ruoyi-admin:latest</code> 即为成功。</em></p></li></ol><hr><h3 id=第四步启动容器核心修正点>第四步：启动容器（核心修正点）</h3><p>根据刚才的日志 <code>ProtocolHandler ["http-nio-80"]</code>，我们确定若依内部端口是 <strong>80</strong>，我们要把它映射到外部的 <strong>8080</strong>。</p><ol><li><p><strong>执行启动命令</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -d --name ruoyi-admin -p 8080:80 ruoyi-admin
</span></span></code></pre></td></tr></table></div></div><ul><li><code>-d</code>: 后台运行</li><li><code>-p 8080:80</code>: <strong>这是最关键的一步</strong>。左边 8080 是你浏览器访问的端口，右边 80 是容器内部若依的端口。</li></ul></li></ol><hr><h3 id=第五步最终验证>第五步：最终验证</h3><ol><li><p><strong>查看日志</strong>（可选）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker logs -f ruoyi-admin
</span></span></code></pre></td></tr></table></div></div><p>看到大的字符画 <code>RuoYi</code> 和 <code>Started RuoYiApplication</code> 说明启动成功。按 <code>Ctrl+C</code> 退出日志查看。</p></li><li><p>浏览器访问：</p><p>打开浏览器输入：</p><p>http://192.168.200.104:8080</p></li></ol><p>你应该能看到若依的登录页面了！如有验证码显示不出来，通常是数据库连不上，请检查第一步的密码。</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/utility/ansible/><div class=article-details><h2 class=article-title>Ansible</h2></div></a></article><article><a href=/utility/jenkins/><div class=article-details><h2 class=article-title>Jenkins</h2></div></a></article><article><a href=/utility/nfs/><div class=article-details><h2 class=article-title>NFS</h2></div></a></article><article><a href=/utility/prometheus-/><div class=article-details><h2 class=article-title>Prometheus</h2></div></a></article><article><a href=/utility/tomcat/><div class=article-details><h2 class=article-title>Tomcat</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>