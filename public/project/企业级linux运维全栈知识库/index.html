<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="企业级 Linux 运维全栈技术（上） 文档版本 v2.0 (终极修订版) 发布日期 2025-12-04 适用环境 CentOS 7.9 / Rocky Linux 9 / Ubuntu 22.04 主要修订 修正过时命令、适配 MySQL 8.0/K8s 1.25+、补充底层原理 作者 企业级 Linux 运维架构师 目录 Linux 系统内核与存储管理 基础原理：文件系统、LVM、Load Average 生产实践：分区标准、LVM 管理、内核调优 网络技术：内核栈与防火墙 基础原理：TCP状态机、Netfilter 框架 生产实践：现代化网络命令、防火墙策略 Web 架构：Nginx 高级应用 基础原理：IO多路复用、负载均衡算法 生产实践：高并发配置、健康检查方案 数据库运维：MySQL 8.0 体系 基础原理：InnoDB 架构、ACID、MVCC 生产实践：配置文件优化、XtraBackup 8.0 备份 云原生架构：Docker 与 Kubernetes 基础原理：Namespace/Cgroup、CRI/CNI/CSI 标准 生产实践：Containerd 配置、K8s 故障排查 SOP 自动化运维与脚本编程 基础原理：Shell 执行机制、信号处理 生产实践：健壮性编程规范 1. Linux 系统内核与存储管理 1.1 核心基础知识点 (Knowledge Focus) Inode 与 Block： Block：文件系统中存储数据的最小单元（通常 4KB）。大文件占用多个 Block。 Inode：索引节点，存储文件的元数据（权限、所有者、时间戳、Block 位置等）。文件名实际上存储在目录的 Block 中，而非 Inode 中。 运维启示：磁盘空间未满但无法写入文件，通常是 Inode 耗尽（大量小文件导致）。 LVM (Logical Volume Manager)： 通过将物理硬盘（PV）抽象为卷组（VG），再从卷组划分逻辑卷（LV）。 核心优势：支持在线动态扩容，无需停机。 Load Average (平均负载)： 指单位时间内处于可运行状态（Running）和不可中断状态（Uninterruptible sleep, 通常是 IO 等待）的进程平均数。 误区：Load 高不一定是 CPU 忙，也可能是磁盘 I/O 阻塞。 1.2 生产环境初始化标准流程 1.2.1 磁盘分区与 LVM 配置（修正版） 适用场景：大于 2TB 的数据盘，使用 GPT 分区表\n"><title>运维全栈技术</title><link rel=canonical href=http://localhost:1313/project/%E4%BC%81%E4%B8%9A%E7%BA%A7linux%E8%BF%90%E7%BB%B4%E5%85%A8%E6%A0%88%E7%9F%A5%E8%AF%86%E5%BA%93/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="运维全栈技术"><meta property='og:description' content="企业级 Linux 运维全栈技术（上） 文档版本 v2.0 (终极修订版) 发布日期 2025-12-04 适用环境 CentOS 7.9 / Rocky Linux 9 / Ubuntu 22.04 主要修订 修正过时命令、适配 MySQL 8.0/K8s 1.25+、补充底层原理 作者 企业级 Linux 运维架构师 目录 Linux 系统内核与存储管理 基础原理：文件系统、LVM、Load Average 生产实践：分区标准、LVM 管理、内核调优 网络技术：内核栈与防火墙 基础原理：TCP状态机、Netfilter 框架 生产实践：现代化网络命令、防火墙策略 Web 架构：Nginx 高级应用 基础原理：IO多路复用、负载均衡算法 生产实践：高并发配置、健康检查方案 数据库运维：MySQL 8.0 体系 基础原理：InnoDB 架构、ACID、MVCC 生产实践：配置文件优化、XtraBackup 8.0 备份 云原生架构：Docker 与 Kubernetes 基础原理：Namespace/Cgroup、CRI/CNI/CSI 标准 生产实践：Containerd 配置、K8s 故障排查 SOP 自动化运维与脚本编程 基础原理：Shell 执行机制、信号处理 生产实践：健壮性编程规范 1. Linux 系统内核与存储管理 1.1 核心基础知识点 (Knowledge Focus) Inode 与 Block： Block：文件系统中存储数据的最小单元（通常 4KB）。大文件占用多个 Block。 Inode：索引节点，存储文件的元数据（权限、所有者、时间戳、Block 位置等）。文件名实际上存储在目录的 Block 中，而非 Inode 中。 运维启示：磁盘空间未满但无法写入文件，通常是 Inode 耗尽（大量小文件导致）。 LVM (Logical Volume Manager)： 通过将物理硬盘（PV）抽象为卷组（VG），再从卷组划分逻辑卷（LV）。 核心优势：支持在线动态扩容，无需停机。 Load Average (平均负载)： 指单位时间内处于可运行状态（Running）和不可中断状态（Uninterruptible sleep, 通常是 IO 等待）的进程平均数。 误区：Load 高不一定是 CPU 忙，也可能是磁盘 I/O 阻塞。 1.2 生产环境初始化标准流程 1.2.1 磁盘分区与 LVM 配置（修正版） 适用场景：大于 2TB 的数据盘，使用 GPT 分区表\n"><meta property='og:url' content='http://localhost:1313/project/%E4%BC%81%E4%B8%9A%E7%BA%A7linux%E8%BF%90%E7%BB%B4%E5%85%A8%E6%A0%88%E7%9F%A5%E8%AF%86%E5%BA%93/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Project'><meta property='article:published_time' content='2025-12-04T00:00:00+00:00'><meta property='article:modified_time' content='2025-12-04T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="运维全栈技术"><meta name=twitter:description content="企业级 Linux 运维全栈技术（上） 文档版本 v2.0 (终极修订版) 发布日期 2025-12-04 适用环境 CentOS 7.9 / Rocky Linux 9 / Ubuntu 22.04 主要修订 修正过时命令、适配 MySQL 8.0/K8s 1.25+、补充底层原理 作者 企业级 Linux 运维架构师 目录 Linux 系统内核与存储管理 基础原理：文件系统、LVM、Load Average 生产实践：分区标准、LVM 管理、内核调优 网络技术：内核栈与防火墙 基础原理：TCP状态机、Netfilter 框架 生产实践：现代化网络命令、防火墙策略 Web 架构：Nginx 高级应用 基础原理：IO多路复用、负载均衡算法 生产实践：高并发配置、健康检查方案 数据库运维：MySQL 8.0 体系 基础原理：InnoDB 架构、ACID、MVCC 生产实践：配置文件优化、XtraBackup 8.0 备份 云原生架构：Docker 与 Kubernetes 基础原理：Namespace/Cgroup、CRI/CNI/CSI 标准 生产实践：Containerd 配置、K8s 故障排查 SOP 自动化运维与脚本编程 基础原理：Shell 执行机制、信号处理 生产实践：健壮性编程规范 1. Linux 系统内核与存储管理 1.1 核心基础知识点 (Knowledge Focus) Inode 与 Block： Block：文件系统中存储数据的最小单元（通常 4KB）。大文件占用多个 Block。 Inode：索引节点，存储文件的元数据（权限、所有者、时间戳、Block 位置等）。文件名实际上存储在目录的 Block 中，而非 Inode 中。 运维启示：磁盘空间未满但无法写入文件，通常是 Inode 耗尽（大量小文件导致）。 LVM (Logical Volume Manager)： 通过将物理硬盘（PV）抽象为卷组（VG），再从卷组划分逻辑卷（LV）。 核心优势：支持在线动态扩容，无需停机。 Load Average (平均负载)： 指单位时间内处于可运行状态（Running）和不可中断状态（Uninterruptible sleep, 通常是 IO 等待）的进程平均数。 误区：Load 高不一定是 CPU 忙，也可能是磁盘 I/O 阻塞。 1.2 生产环境初始化标准流程 1.2.1 磁盘分区与 LVM 配置（修正版） 适用场景：大于 2TB 的数据盘，使用 GPT 分区表\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#目录>目录</a></li><li><a href=#1-linux-系统内核与存储管理>1. Linux 系统内核与存储管理</a><ol><li><a href=#11-核心基础知识点-knowledge-focus>1.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#12-生产环境初始化标准流程>1.2 生产环境初始化标准流程</a><ol><li><a href=#121-磁盘分区与-lvm-配置修正版>1.2.1 磁盘分区与 LVM 配置（修正版）</a></li><li><a href=#122-系统内核参数调优>1.2.2 系统内核参数调优</a></li></ol></li></ol></li><li><a href=#2-网络技术内核栈与防火墙>2. 网络技术：内核栈与防火墙</a><ol><li><a href=#21-核心基础知识点-knowledge-focus>2.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#22-现代化网络命令集-iproute2>2.2 现代化网络命令集 (iproute2)</a></li><li><a href=#23-生产级防火墙配置-firewalld-方案>2.3 生产级防火墙配置 (Firewalld 方案)</a></li></ol></li><li><a href=#3-web-架构nginx-高级应用>3. Web 架构：Nginx 高级应用</a><ol><li><a href=#31-核心基础知识点-knowledge-focus>3.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#32-nginx-生产配置与修正>3.2 Nginx 生产配置与修正</a><ol><li><a href=#321-性能与并发优化>3.2.1 性能与并发优化</a></li><li><a href=#322-upstream-健康检查重要修正>3.2.2 Upstream 健康检查（重要修正）</a></li></ol></li></ol></li><li><a href=#4-数据库运维mysql-80-体系>4. 数据库运维：MySQL 8.0 体系</a><ol><li><a href=#41-核心基础知识点-knowledge-focus>4.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#42-mysql-80-生产实践>4.2 MySQL 8.0 生产实践</a><ol><li><a href=#421-配置文件-mycnf-关键变更>4.2.1 配置文件 (my.cnf) 关键变更</a></li><li><a href=#422-物理备份xtrabackup-80-修正版>4.2.2 物理备份：XtraBackup 8.0 (修正版)</a></li></ol></li></ol></li><li><a href=#5-云原生架构docker-与-kubernetes>5. 云原生架构：Docker 与 Kubernetes</a><ol><li><a href=#51-核心基础知识点-knowledge-focus>5.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#52-kubernetes-v125-生产实践>5.2 Kubernetes (v1.25+) 生产实践</a><ol><li><a href=#521-运行时迁移containerd-配置>5.2.1 运行时迁移：Containerd 配置</a></li><li><a href=#522-k8s-常见故障排查-sop-整合版>5.2.2 K8s 常见故障排查 SOP (整合版)</a></li></ol></li></ol></li><li><a href=#6-自动化运维与脚本编程>6. 自动化运维与脚本编程</a><ol><li><a href=#61-核心基础知识点-knowledge-focus>6.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#62-健壮性-shell-脚本规范>6.2 健壮性 Shell 脚本规范</a></li></ol></li></ol><ol><li><a href=#1-devops-与-cicd-流水线架构>1. DevOps 与 CI/CD 流水线架构</a><ol><li><a href=#11-核心基础知识点-knowledge-focus-1>1.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#12-生产级流水线标准配置>1.2 生产级流水线标准配置</a><ol><li><a href=#121-镜像标准化与瘦身策略>1.2.1 镜像标准化与瘦身策略</a></li><li><a href=#122-jenkinsfile-流水线脚本模板>1.2.2 Jenkinsfile 流水线脚本模板</a></li></ol></li></ol></li><li><a href=#2-全栈监控体系zabbix--prometheus>2. 全栈监控体系：Zabbix + Prometheus</a><ol><li><a href=#21-核心基础知识点-knowledge-focus-1>2.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#cite_start22-zabbix-50-企业级部署标准-cite-51>[cite_start]2.2 Zabbix 5.0 企业级部署标准 [cite: 51]</a></li><li><a href=#cite_start23-prometheus--grafana-云原生监控-cite-43>[cite_start]2.3 Prometheus + Grafana 云原生监控 [cite: 43]</a></li></ol></li><li><a href=#3-python-自动化运维开发>3. Python 自动化运维开发</a><ol><li><a href=#31-核心基础知识点-knowledge-focus-1>3.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#32-实战mysql-慢查询自动优化工具>3.2 实战：MySQL 慢查询自动优化工具</a></li></ol></li><li><a href=#4-安全合规等保-20-三级整改>4. 安全合规：等保 2.0 三级整改</a><ol><li><a href=#41-核心基础知识点-knowledge-focus-1>4.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#cite_start42-生产级安全加固标准-ansible-实现-cite-60>[cite_start]4.2 生产级安全加固标准 (Ansible 实现) [cite: 60]</a></li></ol></li><li><a href=#5-kubernetes-存储与有状态应用>5. Kubernetes 存储与有状态应用</a><ol><li><a href=#51-核心基础知识点-knowledge-focus-1>5.1 核心基础知识点 (Knowledge Focus)</a></li><li><a href=#52-生产级-mysql-on-k8s-配置范例>5.2 生产级 MySQL on K8s 配置范例</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/project/%E4%BC%81%E4%B8%9A%E7%BA%A7linux%E8%BF%90%E7%BB%B4%E5%85%A8%E6%A0%88%E7%9F%A5%E8%AF%86%E5%BA%93/>运维全栈技术</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-12-04</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 14 分钟</time></div></footer></div></header><section class=article-content><h1 id=企业级-linux-运维全栈技术上>企业级 Linux 运维全栈技术（上）</h1><div class=table-wrapper><table><thead><tr><th style=text-align:left>文档版本</th><th style=text-align:left>v2.0 (终极修订版)</th></tr></thead><tbody><tr><td style=text-align:left><strong>发布日期</strong></td><td style=text-align:left>2025-12-04</td></tr><tr><td style=text-align:left><strong>适用环境</strong></td><td style=text-align:left>CentOS 7.9 / Rocky Linux 9 / Ubuntu 22.04</td></tr><tr><td style=text-align:left><strong>主要修订</strong></td><td style=text-align:left>修正过时命令、适配 MySQL 8.0/K8s 1.25+、补充底层原理</td></tr><tr><td style=text-align:left><strong>作者</strong></td><td style=text-align:left>企业级 Linux 运维架构师</td></tr></tbody></table></div><hr><h2 id=目录>目录</h2><ol><li><strong>Linux 系统内核与存储管理</strong><ul><li>基础原理：文件系统、LVM、Load Average</li><li>生产实践：分区标准、LVM 管理、内核调优</li></ul></li><li><strong>网络技术：内核栈与防火墙</strong><ul><li>基础原理：TCP状态机、Netfilter 框架</li><li>生产实践：现代化网络命令、防火墙策略</li></ul></li><li><strong>Web 架构：Nginx 高级应用</strong><ul><li>基础原理：IO多路复用、负载均衡算法</li><li>生产实践：高并发配置、健康检查方案</li></ul></li><li><strong>数据库运维：MySQL 8.0 体系</strong><ul><li>基础原理：InnoDB 架构、ACID、MVCC</li><li>生产实践：配置文件优化、XtraBackup 8.0 备份</li></ul></li><li><strong>云原生架构：Docker 与 Kubernetes</strong><ul><li>基础原理：Namespace/Cgroup、CRI/CNI/CSI 标准</li><li>生产实践：Containerd 配置、K8s 故障排查 SOP</li></ul></li><li><strong>自动化运维与脚本编程</strong><ul><li>基础原理：Shell 执行机制、信号处理</li><li>生产实践：健壮性编程规范</li></ul></li></ol><hr><h2 id=1-linux-系统内核与存储管理>1. Linux 系统内核与存储管理</h2><h3 id=11-核心基础知识点-knowledge-focus>1.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>Inode 与 Block</strong>：<ul><li><strong>Block</strong>：文件系统中存储数据的最小单元（通常 4KB）。大文件占用多个 Block。</li><li><strong>Inode</strong>：索引节点，存储文件的元数据（权限、所有者、时间戳、Block 位置等）。文件名实际上存储在目录的 Block 中，而非 Inode 中。</li><li><em>运维启示</em>：磁盘空间未满但无法写入文件，通常是 Inode 耗尽（大量小文件导致）。</li></ul></li><li><strong>LVM (Logical Volume Manager)</strong>：<ul><li>通过将物理硬盘（PV）抽象为卷组（VG），再从卷组划分逻辑卷（LV）。</li><li><em>核心优势</em>：支持在线动态扩容，无需停机。</li></ul></li><li><strong>Load Average (平均负载)</strong>：<ul><li>指单位时间内处于<strong>可运行状态</strong>（Running）和<strong>不可中断状态</strong>（Uninterruptible sleep, 通常是 IO 等待）的进程平均数。</li><li><em>误区</em>：Load 高不一定是 CPU 忙，也可能是磁盘 I/O 阻塞。</li></ul></li></ul><h3 id=12-生产环境初始化标准流程>1.2 生产环境初始化标准流程</h3><h4 id=121-磁盘分区与-lvm-配置修正版>1.2.1 磁盘分区与 LVM 配置（修正版）</h4><p><em>适用场景：大于 2TB 的数据盘，使用 GPT 分区表</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 创建 PV 和 VG</span>
</span></span><span class=line><span class=cl><span class=c1># 使用 parted 处理 GPT 分区 (fdisk 不支持 &gt;2TB)</span>
</span></span><span class=line><span class=cl>parted /dev/sdb mklabel gpt
</span></span><span class=line><span class=cl>parted /dev/sdb mkpart primary 0% 100%
</span></span><span class=line><span class=cl>parted /dev/sdb <span class=nb>set</span> <span class=m>1</span> lvm on
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pvcreate /dev/sdb1
</span></span><span class=line><span class=cl>vgcreate vg_data /dev/sdb1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 创建逻辑卷 (LV)</span>
</span></span><span class=line><span class=cl><span class=c1># 修正：不建议初次分配所有空间，预留 20% 给快照或紧急扩容</span>
</span></span><span class=line><span class=cl>lvcreate -L 800G -n lv_mysql vg_data
</span></span><span class=line><span class=cl>lvcreate -L 200G -n lv_redis vg_data
</span></span><span class=line><span class=cl>lvcreate -L 500G -n lv_logs vg_data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 格式化与挂载</span>
</span></span><span class=line><span class=cl><span class=c1># 修正：CentOS 7/8 推荐 XFS (格式化快、支持大文件)</span>
</span></span><span class=line><span class=cl>mkfs.xfs /dev/vg_data/lv_mysql
</span></span><span class=line><span class=cl>mkfs.xfs /dev/vg_data/lv_redis
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. /etc/fstab 挂载参数优化</span>
</span></span><span class=line><span class=cl><span class=c1># noatime: 读取文件不更新 access time，减少 IO</span>
</span></span><span class=line><span class=cl><span class=c1># nodiratime: 不更新目录 access time</span>
</span></span><span class=line><span class=cl>/dev/mapper/vg_data-lv_mysql  /data/mysql   xfs  defaults,noatime,nodiratime,inode64 <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=122-系统内核参数调优>1.2.2 系统内核参数调优</h4><p><em>文件：/etc/sysctl.d/99-production.conf</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># --- 内存管理 ---</span>
</span></span><span class=line><span class=cl><span class=c1># 尽量少用 Swap，但设为 1 防止 OOM 立即杀进程 (0 在某些内核版本有 Bug)</span>
</span></span><span class=line><span class=cl><span class=na>vm.swappiness</span> <span class=o>=</span> <span class=s>1</span>
</span></span><span class=line><span class=cl><span class=c1># 允许分配超过物理内存 (Redis RDB 或 Java 应用必备)</span>
</span></span><span class=line><span class=cl><span class=na>vm.overcommit_memory</span> <span class=o>=</span> <span class=s>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 网络栈 (防 SYN Flood 与 高并发) ---</span>
</span></span><span class=line><span class=cl><span class=c1># 全连接队列长度 (Socket Listen 队列)</span>
</span></span><span class=line><span class=cl><span class=na>net.core.somaxconn</span> <span class=o>=</span> <span class=s>65535</span>
</span></span><span class=line><span class=cl><span class=c1># 半连接队列长度 (SYN 队列)</span>
</span></span><span class=line><span class=cl><span class=na>net.ipv4.tcp_max_syn_backlog</span> <span class=o>=</span> <span class=s>65535</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- TCP 连接复用 ---</span>
</span></span><span class=line><span class=cl><span class=c1># 允许将 TIME_WAIT socket 用于新的 TCP 连接</span>
</span></span><span class=line><span class=cl><span class=na>net.ipv4.tcp_tw_reuse</span> <span class=o>=</span> <span class=s>1</span>
</span></span><span class=line><span class=cl><span class=c1># 警告：必须关闭 tcp_tw_recycle，在 NAT 环境下会导致连接失败</span>
</span></span><span class=line><span class=cl><span class=na>net.ipv4.tcp_tw_recycle</span> <span class=o>=</span> <span class=s>0</span>
</span></span><span class=line><span class=cl><span class=c1># 缩短 FIN 等待时间</span>
</span></span><span class=line><span class=cl><span class=na>net.ipv4.tcp_fin_timeout</span> <span class=o>=</span> <span class=s>15</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 端口范围 ---</span>
</span></span><span class=line><span class=cl><span class=na>net.ipv4.ip_local_port_range</span> <span class=o>=</span> <span class=s>1024 65535</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-网络技术内核栈与防火墙>2. 网络技术：内核栈与防火墙</h2><h3 id=21-核心基础知识点-knowledge-focus>2.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>TCP 三次握手与四次挥手</strong>：<ul><li><strong>握手</strong>：SYN -> SYN+ACK -> ACK。建立连接。</li><li><strong>挥手</strong>：FIN -> ACK -> FIN -> ACK。断开连接。</li><li><em>运维重点</em>：大量的 <code>SYN_RECV</code> 意味着遭受 SYN Flood 攻击；大量的 <code>TIME_WAIT</code> 意味着高并发短连接且未开启连接复用。</li></ul></li><li><strong>Netfilter 框架</strong>：<ul><li>Linux 内核的网络包过滤框架。iptables、nftables、firewalld 都是基于 Netfilter 的用户态工具。</li><li><strong>四表五链</strong>：Filter 表（过滤）、NAT 表（转发）。PREROUTING -> INPUT -> FORWARD -> OUTPUT -> POSTROUTING。</li></ul></li><li><strong>OSI 七层模型</strong>：<ul><li>L4 (传输层)：TCP/UDP，负载均衡（LVS/Haproxy TCP模式）。</li><li>L7 (应用层)：HTTP/FTP，负载均衡（Nginx/Haproxy HTTP模式）。</li></ul></li></ul><h3 id=22-现代化网络命令集-iproute2>2.2 现代化网络命令集 (iproute2)</h3><p><em>修正：废弃 <code>net-tools</code> (ifconfig/netstat)，使用 <code>iproute2</code></em></p><div class=table-wrapper><table><thead><tr><th style=text-align:left>需求</th><th style=text-align:left>旧命令 (Deprecated)</th><th style=text-align:left><strong>新命令 (Recommended)</strong></th><th style=text-align:left>优势原理</th></tr></thead><tbody><tr><td style=text-align:left><strong>查看 IP</strong></td><td style=text-align:left><code>ifconfig</code></td><td style=text-align:left><code>ip addr show</code></td><td style=text-align:left>显示辅助 IP 和链路状态</td></tr><tr><td style=text-align:left><strong>查看路由</strong></td><td style=text-align:left><code>route -n</code></td><td style=text-align:left><code>ip route</code></td><td style=text-align:left>支持策略路由表</td></tr><tr><td style=text-align:left><strong>查看端口</strong></td><td style=text-align:left><code>netstat -tulnp</code></td><td style=text-align:left><code>ss -tulnp</code></td><td style=text-align:left>直接读取内核 sock_diag，不遍历 /proc，高并发下极快</td></tr><tr><td style=text-align:left><strong>网络统计</strong></td><td style=text-align:left><code>netstat -s</code></td><td style=text-align:left><code>nstat</code></td><td style=text-align:left>统计计数器更准确</td></tr><tr><td style=text-align:left><strong>ARP 表</strong></td><td style=text-align:left><code>arp -n</code></td><td style=text-align:left><code>ip neigh</code></td><td style=text-align:left>统一管理邻居表</td></tr></tbody></table></div><h3 id=23-生产级防火墙配置-firewalld-方案>2.3 生产级防火墙配置 (Firewalld 方案)</h3><p><em>CentOS 7+ 标准化方案，底层操作 nftables</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 默认区域设置</span>
</span></span><span class=line><span class=cl>firewall-cmd --set-default-zone<span class=o>=</span>public
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 开放 SSH 运维端口 (非 22)</span>
</span></span><span class=line><span class=cl>firewall-cmd --permanent --add-port<span class=o>=</span>22888/tcp
</span></span><span class=line><span class=cl>firewall-cmd --permanent --remove-service<span class=o>=</span>ssh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 开放 Web 服务</span>
</span></span><span class=line><span class=cl>firewall-cmd --permanent --add-service<span class=o>=</span>http
</span></span><span class=line><span class=cl>firewall-cmd --permanent --add-service<span class=o>=</span>https
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 信任内部网段 (如数据库访问)</span>
</span></span><span class=line><span class=cl><span class=c1># 允许 192.168.10.0/24 网段的所有访问</span>
</span></span><span class=line><span class=cl>firewall-cmd --permanent --add-rich-rule<span class=o>=</span><span class=s1>&#39;rule family=&#34;ipv4&#34; source address=&#34;192.168.10.0/24&#34; accept&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 生效配置</span>
</span></span><span class=line><span class=cl>firewall-cmd --reload
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=3-web-架构nginx-高级应用>3. Web 架构：Nginx 高级应用</h2><h3 id=31-核心基础知识点-knowledge-focus>3.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>IO 多路复用 (IO Multiplexing)</strong>：<ul><li><strong>Select/Poll</strong>：轮询所有连接，效率随连接数增加而下降。</li><li><strong>Epoll</strong> (Linux)：事件驱动。只处理活跃的连接，无轮询开销。Nginx 高性能的核心。</li></ul></li><li><strong>正向代理 vs 反向代理</strong>：<ul><li><strong>正向代理</strong>：代理<strong>客户端</strong>上网（如 VPN）。服务端不知道真实客户端是谁。</li><li><strong>反向代理</strong>：代理<strong>服务端</strong>接收请求（如 Nginx）。客户端不知道真实服务端是谁。</li></ul></li><li><strong>负载均衡算法</strong>：<ul><li>Round Robin (轮询)、Weight (加权)、IP Hash (会话保持)、Least Conn (最少连接)。</li></ul></li></ul><h3 id=32-nginx-生产配置与修正>3.2 Nginx 生产配置与修正</h3><h4 id=321-性能与并发优化>3.2.1 性能与并发优化</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>user</span> <span class=s>nginx</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># 自动匹配 CPU 核心数，减少进程切换
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>worker_processes</span> <span class=s>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># 绑定 CPU 亲和性
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>worker_cpu_affinity</span> <span class=s>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件句柄限制 (需配合 ulimit -n)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>worker_rlimit_nofile</span> <span class=mi>65535</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>events</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># Linux 必选 epoll
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>use</span> <span class=s>epoll</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 单个 Worker 最大连接
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>worker_connections</span> <span class=mi>65535</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 收到新连接通知时，尽可能多地接受连接
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>multi_accept</span> <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=322-upstream-健康检查重要修正>3.2.2 Upstream 健康检查（重要修正）</h4><p><em>误区纠正：开源版 Nginx 不支持 <code>check</code> 参数，需使用 Tengine 或被动检查。</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>http</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>upstream</span> <span class=s>backend_server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># 负载均衡算法：最少连接数 (适合长连接服务)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>least_conn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 生产级被动检查配置：
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1># 30秒内失败 3 次，则暂停分发请求 30 秒
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>server</span> <span class=n>192.168.1.101</span><span class=p>:</span><span class=mi>8080</span> <span class=s>weight=5</span> <span class=s>max_fails=3</span> <span class=s>fail_timeout=30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>server</span> <span class=n>192.168.1.102</span><span class=p>:</span><span class=mi>8080</span> <span class=s>weight=5</span> <span class=s>max_fails=3</span> <span class=s>fail_timeout=30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Keepalive 连接池 (对后端保持长连接，减少握手消耗)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>keepalive</span> <span class=mi>300</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kn>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>location</span> <span class=s>/api/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kn>proxy_pass</span> <span class=s>http://backend_server</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=c1># 必须配置，否则 keepalive 不生效
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=4-数据库运维mysql-80-体系>4. 数据库运维：MySQL 8.0 体系</h2><h3 id=41-核心基础知识点-knowledge-focus>4.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>InnoDB 架构</strong>：<ul><li><strong>Buffer Pool</strong>：内存缓冲区，缓存数据页和索引页。性能关键。</li><li><strong>Redo Log</strong> (重做日志)：保证事务的<strong>持久性</strong> (Durability)。Crash 恢复使用。</li><li><strong>Undo Log</strong> (回滚日志)：保证事务的<strong>原子性</strong> (Atomicity) 和 MVCC。</li></ul></li><li><strong>ACID 特性</strong>：<ul><li>Atomicity (原子性)、Consistency (一致性)、Isolation (隔离性)、Durability (持久性)。</li></ul></li><li><strong>隔离级别</strong>：<ul><li>Read Committed (RC)：防止脏读。</li><li>Repeatable Read (RR)：默认级别，防止不可重复读，配合 Next-Key Lock 防止幻读。</li></ul></li><li><strong>GTID (Global Transaction ID)</strong>：<ul><li>全局事务 ID，彻底解决了主从同步中断后寻找 Binlog 位点的难题。</li></ul></li></ul><h3 id=42-mysql-80-生产实践>4.2 MySQL 8.0 生产实践</h3><h4 id=421-配置文件-mycnf-关键变更>4.2.1 配置文件 (my.cnf) 关键变更</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[mysqld]</span>
</span></span><span class=line><span class=cl><span class=c1># 8.0 默认认证插件改为 caching_sha2_password，旧客户端可能连不上</span>
</span></span><span class=line><span class=cl><span class=c1># 兼容配置：</span>
</span></span><span class=line><span class=cl><span class=na>default_authentication_plugin</span> <span class=o>=</span> <span class=s>mysql_native_password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Binlog 设置</span>
</span></span><span class=line><span class=cl><span class=na>log_bin</span> <span class=o>=</span> <span class=s>mysql-bin</span>
</span></span><span class=line><span class=cl><span class=na>binlog_format</span> <span class=o>=</span> <span class=s>ROW</span>
</span></span><span class=line><span class=cl><span class=c1># 8.0 新参数，单位秒 (此处为7天)，取代 expire_logs_days</span>
</span></span><span class=line><span class=cl><span class=na>binlog_expire_logs_seconds</span> <span class=o>=</span> <span class=s>604800</span>
</span></span><span class=line><span class=cl><span class=na>server_id</span> <span class=o>=</span> <span class=s>101</span>
</span></span><span class=line><span class=cl><span class=na>gtid_mode</span> <span class=o>=</span> <span class=s>ON</span>
</span></span><span class=line><span class=cl><span class=na>enforce_gtid_consistency</span> <span class=o>=</span> <span class=s>ON</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># InnoDB 优化</span>
</span></span><span class=line><span class=cl><span class=c1># 物理内存的 70-80%</span>
</span></span><span class=line><span class=cl><span class=na>innodb_buffer_pool_size</span> <span class=o>=</span> <span class=s>12G</span>
</span></span><span class=line><span class=cl><span class=c1># 刷盘策略：1=最安全(每次提交刷盘)，2=高性能(每秒刷盘，宕机丢1秒)</span>
</span></span><span class=line><span class=cl><span class=na>innodb_flush_log_at_trx_commit</span> <span class=o>=</span> <span class=s>1</span>
</span></span><span class=line><span class=cl><span class=c1># Redo Log 刷盘方式，Linux 下推荐 O_DIRECT 绕过文件系统缓存</span>
</span></span><span class=line><span class=cl><span class=na>innodb_flush_method</span> <span class=o>=</span> <span class=s>O_DIRECT</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=422-物理备份xtrabackup-80-修正版>4.2.2 物理备份：XtraBackup 8.0 (修正版)</h4><p><em>注意：MySQL 8.0 必须使用 Percona XtraBackup 8.0，且移除了 <code>innobackupex</code> 命令。</em></p><p><strong>全量备份脚本片段</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 定义变量</span>
</span></span><span class=line><span class=cl><span class=nv>BACKUP_ROOT</span><span class=o>=</span><span class=s2>&#34;/data/backup&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date +%Y%m%d_%H%M%S<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>TARGET_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>BACKUP_ROOT</span><span class=si>}</span><span class=s2>/full_</span><span class=si>${</span><span class=nv>TIMESTAMP</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行备份 (使用 xtrabackup 命令)</span>
</span></span><span class=line><span class=cl><span class=c1># --no-lock 参数在 8.0 中已变更行为，工具会自动处理锁，通常不需要手动加</span>
</span></span><span class=line><span class=cl>xtrabackup --backup <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --user<span class=o>=</span>backup_ops <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --password<span class=o>=</span><span class=s1>&#39;ComplexPassword123!&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --target-dir<span class=o>=</span><span class=si>${</span><span class=nv>TARGET_DIR</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --datadir<span class=o>=</span>/data/mysql/data <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --compress --parallel<span class=o>=</span><span class=m>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 备份预处理 (Prepare) - 恢复前必须执行，也可在恢复时执行</span>
</span></span><span class=line><span class=cl><span class=c1># xtrabackup --prepare --target-dir=${TARGET_DIR}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=5-云原生架构docker-与-kubernetes>5. 云原生架构：Docker 与 Kubernetes</h2><h3 id=51-核心基础知识点-knowledge-focus>5.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>容器底层原理</strong>：<ul><li><strong>Namespace (命名空间)</strong>：实现资源<strong>隔离</strong>（PID, Network, Mount, User, UTS, IPC）。</li><li><strong>Cgroups (控制组)</strong>：实现资源<strong>限制</strong>（CPU 核数, 内存大小）。</li><li><strong>UnionFS (联合文件系统)</strong>：实现镜像分层（Overlay2）。</li></ul></li><li><strong>K8s 标准接口</strong>：<ul><li><strong>CRI</strong> (Container Runtime Interface)：容器运行时接口（连接 Containerd/CRI-O）。</li><li><strong>CNI</strong> (Container Network Interface)：网络接口（连接 Calico/Flannel）。</li><li><strong>CSI</strong> (Container Storage Interface)：存储接口（连接 Ceph/NFS/EBS）。</li></ul></li><li><strong>Pod 概念</strong>：<ul><li>K8s 最小调度单元。同一个 Pod 内的容器共享 Network Namespace (同一个 IP) 和存储卷。</li></ul></li></ul><h3 id=52-kubernetes-v125-生产实践>5.2 Kubernetes (v1.25+) 生产实践</h3><h4 id=521-运行时迁移containerd-配置>5.2.1 运行时迁移：Containerd 配置</h4><p><em>修正：K8s 1.24+ 移除了 Dockershim，必须配置 Containerd。</em></p><p>文件：<code>/etc/containerd/config.toml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>containerd</span><span class=p>.</span><span class=nx>runtimes</span><span class=p>.</span><span class=nx>runc</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=c># 关键配置：必须使用 systemd 作为 cgroup 驱动，否则 kubelet 启动失败</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>containerd</span><span class=p>.</span><span class=nx>runtimes</span><span class=p>.</span><span class=nx>runc</span><span class=p>.</span><span class=nx>options</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>SystemdCgroup</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=c># 替换为国内镜像源 (阿里云/腾讯云)，解决 pause 镜像拉取失败问题</span>
</span></span><span class=line><span class=cl>  <span class=nx>sandbox_image</span> <span class=p>=</span> <span class=s2>&#34;registry.aliyuncs.com/google_containers/pause:3.9&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=522-k8s-常见故障排查-sop-整合版>5.2.2 K8s 常见故障排查 SOP (整合版)</h4><p><strong>场景 1：Pod 状态 <code>CrashLoopBackOff</code></strong></p><ul><li><strong>原理</strong>：容器进程启动后退出，或健康检查失败。</li><li><strong>排查</strong>：<ol><li><code>kubectl logs &lt;pod> --previous</code>：查看上一次崩溃前的日志（关键）。</li><li><code>kubectl describe pod &lt;pod></code>：查看 Liveness Probe 是否失败，或 OOMKilled（Exit Code 137）。</li></ol></li></ul><p><strong>场景 2：Pod 状态 <code>Pending</code></strong></p><ul><li><strong>原理</strong>：调度失败。</li><li><strong>排查</strong>：<ol><li><code>kubectl describe pod &lt;pod></code>：查看 Events。</li><li><strong>资源不足</strong>：CPU/Mem 请求超过节点可分配值。</li><li><strong>污点 (Taint)</strong>：节点有污点，Pod 无对应容忍度 (Toleration)。</li><li><strong>亲和性 (Affinity)</strong>：NodeAffinity 规则不满足。</li></ol></li></ul><p><strong>场景 3：Service 无法访问 (Connection Refused)</strong></p><ul><li><strong>排查</strong>：<ol><li><code>kubectl get endpoints &lt;svc-name></code>：<strong>最关键一步</strong>。如果 endpoints 为空，说明 Selector 没匹配到 Pod，或者 Pod 未通过 Readiness Probe（未就绪）。</li><li>检查 Pod 应用是否监听了 <code>0.0.0.0</code> 而非 <code>127.0.0.1</code>。</li></ol></li></ul><hr><h2 id=6-自动化运维与脚本编程>6. 自动化运维与脚本编程</h2><h3 id=61-核心基础知识点-knowledge-focus>6.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>Shell 执行过程</strong>：<ul><li>解析器读取脚本 -> 变量替换/通配符扩展 -> 执行命令。</li><li><strong>Subshell (子 shell)</strong>：<code>()</code> 或 管道符 <code>|</code> 会启动子 Shell，子 Shell 中的变量修改不会影响父 Shell。</li></ul></li><li><strong>标准输入输出</strong>：<ul><li>0: stdin, 1: stdout, 2: stderr。</li><li><code>2>&amp;1</code>：将错误输出重定向到标准输出。</li></ul></li><li><strong>信号 (Signal)</strong>：<ul><li><code>kill -15 (SIGTERM)</code>：请求进程优雅退出（程序可以捕获并清理）。</li><li><code>kill -9 (SIGKILL)</code>：强制杀死，不可捕获，可能导致数据损坏。</li></ul></li></ul><h3 id=62-健壮性-shell-脚本规范>6.2 健壮性 Shell 脚本规范</h3><p><em>修正：增加严格模式和日志函数</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl><span class=c1># Description: 生产级自动化脚本模板</span>
</span></span><span class=line><span class=cl><span class=c1># Author: DevOps Team</span>
</span></span><span class=line><span class=cl><span class=c1># ==========================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 严格模式 (Safety First) ---</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -o errexit   <span class=c1># 遇到任何错误立即退出 (等同 set -e)</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -o nounset   <span class=c1># 使用未定义变量时报错 (等同 set -u)</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -o pipefail  <span class=c1># 管道中只要有一个命令失败，整个管道视为失败</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 全局变量 ---</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;/var/log/ops_script.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>DATE_TAG</span><span class=o>=</span><span class=k>$(</span>date +%Y-%m-%d<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 日志函数 ---</span>
</span></span><span class=line><span class=cl>log_info<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[INFO] </span><span class=k>$(</span>date <span class=s1>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class=k>)</span><span class=s2> </span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=p>|</span> tee -a <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>log_error<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[ERROR] </span><span class=k>$(</span>date <span class=s1>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class=k>)</span><span class=s2> </span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=p>|</span> tee -a <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 错误捕获与清理 ---</span>
</span></span><span class=line><span class=cl>cleanup<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 脚本退出时（无论成功失败）都会执行</span>
</span></span><span class=line><span class=cl>    rm -f /tmp/script.lock
</span></span><span class=line><span class=cl>    log_info <span class=s2>&#34;Script finished or interrupted. Cleanup done.&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=nb>trap</span> cleanup EXIT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- 主逻辑 ---</span>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log_info <span class=s2>&#34;Starting backup process...&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 检查 root 权限</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$EUID</span> -ne <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>       log_error <span class=s2>&#34;This script must be run as root&#34;</span>
</span></span><span class=line><span class=cl>       <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 业务逻辑...</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=企业级-linux-运维全栈技术下>企业级 Linux 运维全栈技术（下）</h1><p><strong>Enterprise Linux Operations & Architecture Whitepaper</strong></p><div class=table-wrapper><table><thead><tr><th style=text-align:left>文档版本</th><th style=text-align:left>v2.1 (基于实战增强版)</th></tr></thead><tbody><tr><td style=text-align:left><strong>新增模块</strong></td><td style=text-align:left>DevOps流水线、Zabbix监控标准、等保2.0合规、Python运维开发</td></tr><tr><td style=text-align:left><strong>技术栈补充</strong></td><td style=text-align:left>Jenkins/GitLab CI, OpenVAS, Python, StatefulSet, Harbor</td></tr><tr><td style=text-align:left><strong>参考项目</strong></td><td style=text-align:left>核心业务容器化改造、等保三级整改、全栈监控平台</td></tr></tbody></table></div><hr><h2 id=1-devops-与-cicd-流水线架构>1. DevOps 与 CI/CD 流水线架构</h2><p>[cite_start]<em>(基于简历项目一：核心业务系统 Kubernetes 容器化改造 [cite: 38, 42])</em></p><h3 id=11-核心基础知识点-knowledge-focus-1>1.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>CI/CD (持续集成/持续交付)</strong>：<ul><li><strong>CI (Continuous Integration)</strong>：代码提交后自动触发构建和测试，尽早发现错误。</li><li><strong>CD (Continuous Delivery/Deployment)</strong>：自动将代码部署到生产环境。</li></ul></li><li><strong>流水线 (Pipeline)</strong>：<ul><li>定义了从代码提交到上线的全过程：<code>Code -> Build -> Test -> Release -> Deploy</code>。</li></ul></li><li><strong>镜像分层构建</strong>：<ul><li>利用 Docker 缓存机制加速构建，利用多阶段构建（Multi-stage builds）减小镜像体积。</li></ul></li></ul><h3 id=12-生产级流水线标准配置>1.2 生产级流水线标准配置</h3><p>[cite_start]<strong>技术栈</strong>：Jenkins + GitLab CI + Harbor [cite: 42, 45]</p><h4 id=121-镜像标准化与瘦身策略>1.2.1 镜像标准化与瘦身策略</h4><p>[cite_start]简历中提到将镜像体积从 800MB 压缩至 250MB [cite: 41]，标准 Dockerfile 优化规范如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># 阶段一：构建环境 (Build Stage)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=w> </span><span class=s>maven:3.8-jdk-11</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> pom.xml .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mvn dependency:go-offline  <span class=c1># 缓存依赖</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> src ./src<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mvn package -DskipTests<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 阶段二：运行时环境 (Runtime Stage)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 选用轻量级基础镜像 (如 Alpine 或 Distroless)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=w> </span><span class=s>openjdk:11-jre-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 仅复制构建产物，丢弃编译工具和源码</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /app/target/app.jar /app/app.jar<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 设置时区与非 root 用户运行 (安全合规)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    useradd -m -u <span class=m>1000</span> appuser<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=w> </span><span class=s>1000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;java&#34;</span><span class=p>,</span> <span class=s2>&#34;-jar&#34;</span><span class=p>,</span> <span class=s2>&#34;app.jar&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=122-jenkinsfile-流水线脚本模板>1.2.2 Jenkinsfile 流水线脚本模板</h4><p>[cite_start]实现代码提交到 K8s 滚动发布的全流程自动化 [cite: 42]：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>pipeline</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>agent</span> <span class=n>any</span>
</span></span><span class=line><span class=cl>    <span class=n>environment</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>HARBOR_REGISTRY</span> <span class=o>=</span> <span class=s2>&#34;registry.example.com&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>IMAGE_NAME</span> <span class=o>=</span> <span class=s2>&#34;project/backend&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>TAG</span> <span class=o>=</span> <span class=s2>&#34;${env.BUILD_NUMBER}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>stages</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Checkout&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>steps</span> <span class=o>{</span> <span class=n>checkout</span> <span class=n>scm</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Build &amp; Push&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>steps</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span> <span class=s2>&#34;docker build -t ${HARBOR_REGISTRY}/${IMAGE_NAME}:${TAG} .&#34;</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 需在 Jenkins 配置好 Harbor 的凭证
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>withCredentials</span><span class=o>([</span><span class=n>usernamePassword</span><span class=o>(</span><span class=nl>credentialsId:</span> <span class=s1>&#39;harbor-auth&#39;</span><span class=o>,</span> <span class=nl>usernameVariable:</span> <span class=s1>&#39;USER&#39;</span><span class=o>,</span> <span class=nl>passwordVariable:</span> <span class=s1>&#39;PASS&#39;</span><span class=o>)])</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>sh</span> <span class=s2>&#34;docker login ${HARBOR_REGISTRY} -u $USER -p $PASS&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=n>sh</span> <span class=s2>&#34;docker push ${HARBOR_REGISTRY}/${IMAGE_NAME}:${TAG}&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Deploy to K8s&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>steps</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 使用 sed 替换 K8s yaml 中的镜像版本并应用
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>sh</span> <span class=s2>&#34;sed -i &#39;s|IMAGE_TAG|${TAG}|g&#39; k8s/deployment.yaml&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span> <span class=s2>&#34;kubectl apply -f k8s/deployment.yaml&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-全栈监控体系zabbix--prometheus>2. 全栈监控体系：Zabbix + Prometheus</h2><p>[cite_start]<em>(基于简历项目二：全栈监控与自动化运维平台建设项目 [cite: 47, 51])</em></p><h3 id=21-核心基础知识点-knowledge-focus-1>2.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>监控分层</strong>：<ul><li>[cite_start]<strong>基础设施层</strong>：CPU、内存、磁盘 I/O、网络流量（top, vmstat, iostat）[cite: 19]。</li><li>[cite_start]<strong>中间件层</strong>：Nginx 连接数、MySQL 慢查询/QPS、Redis 命中率 [cite: 51]。</li><li><strong>业务层</strong>：接口响应时间、错误率、订单量。</li></ul></li><li><strong>推拉模型</strong>：<ul><li><strong>Zabbix (Push/Pull)</strong>：适合物理机、虚拟机等静态资产监控，报警功能强大。</li><li><strong>Prometheus (Pull)</strong>：适合 K8s 等动态云原生环境，基于时序数据库 TSDB。</li></ul></li></ul><h3 id=cite_start22-zabbix-50-企业级部署标准-cite-51>[cite_start]2.2 Zabbix 5.0 企业级部署标准 [cite: 51]</h3><p><strong>适用场景</strong>：300+ Linux 服务器及传统中间件监控。</p><ol><li><strong>分级告警策略配置</strong>：<ul><li><strong>P0 (严重)</strong>：服务宕机、端口不通。 -> 电话/短信通知。</li><li><strong>P1 (警告)</strong>：CPU > 90%，磁盘使用率 > 85%。 -> 邮件/钉钉通知。</li><li><strong>P2 (信息)</strong>：系统重启、配置变更。 -> 仅记录日志。</li></ul></li><li><strong>自定义监控脚本 (UserParameter)</strong>：<ul><li><em>案例：监控 TCP 连接状态</em></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /etc/zabbix/zabbix_agentd.d/tcp_status.conf</span>
</span></span><span class=line><span class=cl><span class=nv>UserParameter</span><span class=o>=</span>tcp.status<span class=o>[</span>*<span class=o>]</span>,/usr/bin/netstat -an <span class=p>|</span> grep -c <span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=c1># 使用: zabbix_get -s IP -k tcp.status[ESTABLISHED]</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=cite_start23-prometheus--grafana-云原生监控-cite-43>[cite_start]2.3 Prometheus + Grafana 云原生监控 [cite: 43]</h3><p><strong>适用场景</strong>：K8s 集群节点、Pod、容器资源监控。</p><ul><li><strong>架构</strong>：Node Exporter (节点监控) + Kube-state-metrics (K8s 对象状态) + cAdvisor (容器资源)。</li><li><strong>关键告警规则 (PromQL)</strong>：<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 节点内存不足告警</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>NodeMemoryUsageHigh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes &gt; 0.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>5m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>warning</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><hr><h2 id=3-python-自动化运维开发>3. Python 自动化运维开发</h2><p>[cite_start]<em>(基于简历项目二及专业能力：Python 工具开发 [cite: 53, 54])</em></p><h3 id=31-核心基础知识点-knowledge-focus-1>3.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>Python 在运维中的优势</strong>：<ul><li>相比 Shell，Python 更适合处理复杂的逻辑、数据分析（如日志分析）、API 调用和数据库操作。</li></ul></li><li><strong>常用库</strong>：<ul><li><code>os</code>, <code>sys</code>, <code>subprocess</code> (系统交互)</li><li><code>pymysql</code> (数据库操作)</li><li><code>requests</code> (API 调用)</li></ul></li></ul><h3 id=32-实战mysql-慢查询自动优化工具>3.2 实战：MySQL 慢查询自动优化工具</h3><p>[cite_start]简历中提到“自研 MySQL 慢查询自动优化工具，将慢查询率降低 70%” [cite: 54]。</p><p><strong>工具实现逻辑范例</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pymysql</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 配置数据库连接</span>
</span></span><span class=line><span class=cl><span class=n>db_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=s1>&#39;192.168.1.100&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=s1>&#39;monitor&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;password&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;db&#39;</span><span class=p>:</span> <span class=s1>&#39;information_schema&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_slow_queries</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>pymysql</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=o>**</span><span class=n>db_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 1. 查询执行时间超过 2秒 的 TOP 10 SQL</span>
</span></span><span class=line><span class=cl>    <span class=n>sql</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    SELECT sql_text, query_time, rows_examined 
</span></span></span><span class=line><span class=cl><span class=s2>    FROM slow_log 
</span></span></span><span class=line><span class=cl><span class=s2>    WHERE query_time &gt; &#39;00:00:02&#39; 
</span></span></span><span class=line><span class=cl><span class=s2>    ORDER BY query_time DESC LIMIT 10;
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>sql</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>sql_text</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1># 2. 简单的 EXPLAIN 分析逻辑 (模拟)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;select *&#34;</span> <span class=ow>in</span> <span class=n>sql_text</span><span class=o>.</span><span class=n>lower</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[优化建议] 避免全字段查询: </span><span class=si>{</span><span class=n>sql_text</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>row</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>10000</span><span class=p>:</span> <span class=c1># rows_examined</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[优化建议] 扫描行数过多(</span><span class=si>{</span><span class=n>row</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=si>}</span><span class=s2>)，建议添加索引: </span><span class=si>{</span><span class=n>sql_text</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_slow_queries</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=4-安全合规等保-20-三级整改>4. 安全合规：等保 2.0 三级整改</h2><p>[cite_start]<em>(基于简历项目三：等保 2.0 三级安全合规整改项目 [cite: 57, 59])</em></p><h3 id=41-核心基础知识点-knowledge-focus-1>4.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>等保 2.0 (MLPS 2.0)</strong>：中国网络安全等级保护制度。三级系统要求较高，涉及物理、网络、主机、应用、数据五个层面。</li><li>[cite_start]<strong>OpenVAS</strong>：开源漏洞扫描器，用于发现系统漏洞（如未打补丁的内核、弱密码服务） [cite: 24, 63]。</li><li><strong>基线检查 (Baseline)</strong>：系统最小化安全配置标准（如密码复杂度、SSH 配置、文件权限）。</li></ul><h3 id=cite_start42-生产级安全加固标准-ansible-实现-cite-60>[cite_start]4.2 生产级安全加固标准 (Ansible 实现) [cite: 60]</h3><p>通过 Ansible 批量执行加固脚本，满足合规要求。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># secure_baseline.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>等保三级主机加固</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 1. 密码复杂度策略 (pam_pwquality)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>设置密码复杂度</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>lineinfile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/security/pwquality.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>regexp</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;^minlen&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;minlen = 12&#39;</span><span class=w> </span><span class=c># 最小长度12位</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 2. SSH 安全配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>禁止 root 远程登录</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>lineinfile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/ssh/sshd_config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>regexp</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;^PermitRootLogin&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;PermitRootLogin no&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class=l>restart sshd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 3. 设置会话超时 (防挂机)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>设置 TMOUT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>lineinfile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/profile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;export TMOUT=300&#39;</span><span class=w> </span><span class=c># 5分钟无操作自动登出</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>handlers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>restart sshd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sshd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>restarted</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=5-kubernetes-存储与有状态应用>5. Kubernetes 存储与有状态应用</h2><p>[cite_start]<em>(基于简历项目一：StatefulSet 与 PV/PVC 应用 [cite: 41])</em></p><h3 id=51-核心基础知识点-knowledge-focus-1>5.1 核心基础知识点 (Knowledge Focus)</h3><ul><li><strong>StatefulSet</strong>：<ul><li>用于管理<strong>有状态</strong>应用（如 MySQL, Redis）。</li><li>特点：稳定的网络标识（Pod名固定 <code>mysql-0</code>, <code>mysql-1</code>）、有序部署、稳定的持久化存储。</li></ul></li><li><strong>PV (PersistentVolume) 与 PVC (Claim)</strong>：<ul><li><strong>PV</strong>：集群中的存储资源（由管理员创建，连接 NFS/Ceph）。</li><li><strong>PVC</strong>：用户对存储的申请（Pod 绑定 PVC，PVC 绑定 PV）。</li><li><strong>StorageClass</strong>：实现 PV 的动态供给。</li></ul></li></ul><h3 id=52-生产级-mysql-on-k8s-配置范例>5.2 生产级 MySQL on K8s 配置范例</h3><p>[cite_start]简历中提到使用 PV/PVC 动态供应持久化存储 [cite: 41]。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;mysql&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:8.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 关键：volumeClaimTemplates (自动创建 PVC)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumeClaimTemplates</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>accessModes</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;managed-nfs-storage&#34;</span><span class=w> </span><span class=c># 需提前配置 StorageClass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>10Gi</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/mysql/mysql-sql%E8%AF%AD%E5%8F%A5/><div class=article-details><h2 class=article-title>MySQL SQL语句</h2></div></a></article><article><a href=/k8s/kubernetes%E5%85%A8%E6%A0%88%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/><div class=article-details><h2 class=article-title>Kubernetes全栈知识体系</h2></div></a></article><article><a href=/linux/vmware-ubuntu/><div class=article-details><h2 class=article-title>Ubuntu</h2></div></a></article><article><a href=/project/%E9%A1%B9%E7%9B%AE04centos%E9%83%A8%E7%BD%B2mha/><div class=article-details><h2 class=article-title>centos部署MHA</h2></div></a></article><article><a href=/docker/docker%E6%BA%90/><div class=article-details><h2 class=article-title>docker源</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>