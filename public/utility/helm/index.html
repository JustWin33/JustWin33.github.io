<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="在 DevOps 和云基础设施的背景下，Helm 是 Kubernetes 的标准包管理器。\n你可以把它想象成 Ubuntu 上的 apt、CentOS 上的 yum 或 macOS 上的 Homebrew——但它是专门用于将应用程序部署到 Kubernetes 集群上的。\n"><title>helm</title><link rel=canonical href=http://localhost:1313/utility/helm/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="helm"><meta property='og:description' content="在 DevOps 和云基础设施的背景下，Helm 是 Kubernetes 的标准包管理器。\n你可以把它想象成 Ubuntu 上的 apt、CentOS 上的 yum 或 macOS 上的 Homebrew——但它是专门用于将应用程序部署到 Kubernetes 集群上的。\n"><meta property='og:url' content='http://localhost:1313/utility/helm/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Utility'><meta property='article:published_time' content='2025-12-14T00:00:00+00:00'><meta property='article:modified_time' content='2025-12-14T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="helm"><meta name=twitter:description content="在 DevOps 和云基础设施的背景下，Helm 是 Kubernetes 的标准包管理器。\n你可以把它想象成 Ubuntu 上的 apt、CentOS 上的 yum 或 macOS 上的 Homebrew——但它是专门用于将应用程序部署到 Kubernetes 集群上的。\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/kali/><span>kali</span></a></li><li><a href=/ubuntu/><span>ubuntu</span></a></li><li><a href=/utility/><span>Utility</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#1-核心概念-core-concepts>1. 核心概念 (Core Concepts)</a></li><li><a href=#2-为什么使用-helm>2. 为什么使用 Helm？</a></li><li><a href=#3-chart-的文件结构>3. Chart 的文件结构</a></li><li><a href=#4-基本命令速查表>4. 基本命令速查表</a></li><li><a href=#1-windows-用户-推荐>1. Windows 用户 (推荐)</a></li><li><a href=#2-macos-用户>2. macOS 用户</a></li><li><a href=#3-linux-用户>3. Linux 用户</a></li><li><a href=#4-验证安装>4. 验证安装</a></li><li><a href=#重要提示你需要-kubectl>重要提示：你需要 kubectl</a></li><li><a href=#第一步添加应用商店添加仓库>第一步：添加“应用商店”（添加仓库）</a></li><li><a href=#第二步更新缓存>第二步：更新缓存</a></li><li><a href=#第三步搜索软件可选>第三步：搜索软件（可选）</a></li><li><a href=#第四步正式安装>第四步：正式安装！</a></li><li><a href=#第五步验证安装>第五步：验证安装</a></li><li><a href=#第六步清理卸载>第六步：清理（卸载）</a></li><li><a href=#方法一快速修改使用---set>方法一：快速修改（使用 <code>--set</code>）</a></li><li><a href=#方法二专业修改使用-yaml-文件>方法二：专业修改（使用 YAML 文件）</a></li><li><a href=#进阶如果我已经安装了怎么修改>进阶：如果我已经安装了，怎么修改？</a></li><li><a href=#总结>总结</a></li><li><a href=#既然您已经掌握了安装和配置>既然您已经掌握了安装和配置&mldr;</a></li><li><a href=#第一步自动生成骨架>第一步：自动生成骨架</a></li><li><a href=#第二步理解填空题原理>第二步：理解“填空题”原理</a></li><li><a href=#第三步修改配置>第三步：修改配置</a></li><li><a href=#第四步安装你的本地-chart>第四步：安装你的本地 Chart</a></li><li><a href=#第五步见证奇迹>第五步：见证奇迹</a></li><li><a href=#第六步访问你的网页>第六步：访问你的网页</a></li><li><a href=#恭喜>恭喜！</a></li><li><a href=#第一步设置开关修改-valuesyaml>第一步：设置开关（修改 values.yaml）</a></li><li><a href=#第二步编写带逻辑的模板>第二步：编写带逻辑的模板</a></li><li><a href=#第三步应用更改>第三步：应用更改</a></li><li><a href=#第四步验证是否存在>第四步：验证是否存在</a></li><li><a href=#第五步见证消失术-elsefalse>第五步：见证“消失术” (Else/False)</a></li><li><a href=#进阶if--else-组合拳>进阶：If / Else 组合拳</a></li><li><a href=#总结-1>总结</a></li><li><a href=#第一部分如何打包-packaging>第一部分：如何打包 (Packaging)</a></li><li><a href=#第二部分实战回滚-rollback--您的后悔药>第二部分：实战回滚 (Rollback) —— 您的“后悔药”</a></li><li><a href=#第三部分helm-回滚机制是如何工作的-under-the-hood>第三部分：Helm 回滚机制是如何工作的？ (Under the Hood)</a></li><li><a href=#总结-2>总结</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/utility/helm/>helm</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-12-14</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 13 分钟</time></div></footer></div></header><section class=article-content><p>在 DevOps 和云基础设施的背景下，<strong>Helm</strong> 是 <strong>Kubernetes 的标准包管理器</strong>。</p><p>你可以把它想象成 Ubuntu 上的 <code>apt</code>、CentOS 上的 <code>yum</code> 或 macOS 上的 <code>Homebrew</code>——但它是专门用于将应用程序部署到 Kubernetes 集群上的。</p><p>以下是关于 Helm 是什么、如何工作以及为何它如此重要的详细中文解析：</p><hr><h3 id=1-核心概念-core-concepts>1. 核心概念 (Core Concepts)</h3><p>Helm 依赖三个主要概念来管理 Kubernetes 应用程序：</p><ul><li><strong>Chart（图表/包）：</strong> Helm 的包被称为 <em>Chart</em>。它包含了在 Kubernetes 集群中运行应用程序、工具或服务所需的所有资源定义（YAML 文件）。</li><li><strong>Config（配置/值）：</strong> 配置信息与包本身是分离开的。通常使用一个文件（一般是 <code>values.yaml</code>）将特定的设置（如镜像版本、服务端口或持久卷大小）注入到 Chart 模板中。</li><li><strong>Release（发布）：</strong> 当你安装一个 Chart 时，它会创建一个 <em>Release</em>。这是该 Chart 在你集群中运行的一个特定实例。你可以多次安装同一个 Chart 来创建不同的 Release（例如 <code>mysql-dev</code> 和 <code>mysql-prod</code>）。</li></ul><h3 id=2-为什么使用-helm>2. 为什么使用 Helm？</h3><p>手动管理原始的 Kubernetes YAML 清单（如 Deployments, Services, Ingresses, ConfigMaps）会变得非常复杂且容易出错。Helm 通过以下方式解决了这个问题：</p><ul><li><strong>模板化 (Templating)：</strong> 它允许你在 YAML 文件中使用变量。你无需硬编码副本数量，而是写成 <code>replicas: {{ .Values.replicaCount }}</code>，这使得你的清单可以在不同的环境（开发、测试、生产）中重复使用。</li><li><strong>版本控制 (Version Control)：</strong> Helm 会追踪 Release 的版本历史。如果新的部署失败了，你可以运行 <code>helm rollback</code> 命令立即回滚到上一个正常工作的版本。</li><li><strong>依赖管理 (Dependency Management)：</strong> 如果你的应用程序依赖于数据库，你可以在 Chart 中定义这个依赖关系，Helm 会确保数据库与你的应用一起被安装。</li></ul><h3 id=3-chart-的文件结构>3. Chart 的文件结构</h3><p>如果你查看一个 Helm Chart 的目录内部，通常会看到这样的结构：</p><div class=table-wrapper><table><thead><tr><th><strong>文件/目录</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>Chart.yaml</code></td><td>关于 Chart 的元数据（名称、版本、描述）。</td></tr><tr><td><code>values.yaml</code></td><td>Chart 的默认配置值。</td></tr><tr><td><code>templates/</code></td><td>包含实际 K8s 清单模板的目录，这些模板会与配置值结合生成最终文件。</td></tr><tr><td><code>charts/</code></td><td>包含任何 Chart 依赖项的目录。</td></tr></tbody></table></div><h3 id=4-基本命令速查表>4. 基本命令速查表</h3><p>以下是 Helm 工作流中最常用的命令：</p><p><strong>仓库 (Repositories)</strong></p><ul><li><code>helm repo add [名称] [url]</code> – 添加一个 chart 仓库。</li><li><code>helm repo update</code> – 更新本地可用 chart 的缓存。</li></ul><p><strong>管理 (Management)</strong></p><ul><li><code>helm install [发布名称] [chart]</code> – 将 chart 安装到集群中。</li><li><code>helm upgrade [发布名称] [chart]</code> – 升级现有的 release。</li><li><code>helm rollback [发布名称] [版本号]</code> – 将 release 回滚到之前的版本。</li><li><code>helm uninstall [发布名称]</code> – 从集群中移除 release。</li></ul><p><strong>检查 (Inspection)</strong></p><ul><li><code>helm list</code> – 列出当前命名空间下的所有 release。</li><li><code>helm show values [chart]</code> – 查看 chart 的默认配置值。</li></ul><p>安装 Helm 通常非常简单，最推荐的方式是使用<strong>包管理器</strong>（Package Manager），这样以后升级也更方便。</p><p>以下是针对不同操作系统的安装方法：</p><h3 id=1-windows-用户-推荐>1. Windows 用户 (推荐)</h3><p>由于您正在学习 PowerShell，最便捷的方法是使用 <strong>Winget</strong> (Windows 自带) 或 <strong>Chocolatey</strong>。</p><p>打开您的 PowerShell（管理员模式），输入以下任一命令：</p><ul><li><strong>使用 Winget (系统自带):</strong><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>winget</span> <span class=n>install</span> <span class=n>Helm</span><span class=p>.</span><span class=py>Helm</span>
</span></span></code></pre></td></tr></table></div></div></li><li><strong>使用 Chocolatey (如果您已安装):</strong><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>choco</span> <span class=n>install</span> <span class=nb>kubernetes-helm</span>
</span></span></code></pre></td></tr></table></div></div></li><li><strong>使用 Scoop:</strong><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>scoop</span> <span class=n>install</span> <span class=n>helm</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=2-macos-用户>2. macOS 用户</h3><p>如果您使用的是 Mac，推荐使用 <strong>Homebrew</strong>。</p><p>打开终端 (Terminal) 并运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install helm
</span></span></code></pre></td></tr></table></div></div><h3 id=3-linux-用户>3. Linux 用户</h3><p>Linux 有多种安装方式，最通用的方式是使用官方的安装脚本：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
</span></span><span class=line><span class=cl>chmod <span class=m>700</span> get_helm.sh
</span></span><span class=line><span class=cl>./get_helm.sh
</span></span></code></pre></td></tr></table></div></div><p>如果您使用的是 <strong>Ubuntu</strong> 并且喜欢用 Snap：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo snap install helm --classic
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=4-验证安装>4. 验证安装</h3><p>安装完成后，请关闭并重新打开您的终端/PowerShell，然后输入以下命令来确认 Helm 是否就绪：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm version
</span></span></code></pre></td></tr></table></div></div><p>如果看到类似 <code>version.BuildInfo{Version:"v3.x.x"...}</code> 的输出，说明安装成功了！</p><h3 id=重要提示你需要-kubectl>重要提示：你需要 kubectl</h3><p>Helm 是用来指挥 Kubernetes 的，所以 Helm 必须能连接到一个集群。这意味着您本地通常也需要安装 <code>kubectl</code> 并配置好集群连接（kubeconfig）。</p><p>用 <strong>Redis</strong>（一个非常流行的数据库）来练手。这是最经典的 Helm 入门操作。</p><p>在开始之前，请确保您的 <strong>Docker Desktop</strong> 已经启动，并且在设置中启用了 Kubernetes（或者您有其他的 Kubernetes 集群正在运行）。</p><p>请在 PowerShell 中依次执行以下步骤：</p><h3 id=第一步添加应用商店添加仓库>第一步：添加“应用商店”（添加仓库）</h3><p>Helm 安装好后，默认是空的。我们需要先添加一个仓库（Repository），就像在手机上添加应用商店源一样。我们将使用 <strong>Bitnami</strong> 仓库，因为他们的 Chart 质量非常高。</p><p>复制并运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>repo</span> <span class=n>add</span> <span class=n>bitnami</span> <span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>charts</span><span class=p>.</span><span class=py>bitnami</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>bitnami</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=第二步更新缓存>第二步：更新缓存</h3><p>添加仓库后，需要告诉 Helm 获取最新的软件列表（类似刷新网页）。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>repo</span> <span class=n>update</span>
</span></span></code></pre></td></tr></table></div></div><p><em>您应该会看到类似 &ldquo;Update Complete&rdquo; 的提示。</em></p><h3 id=第三步搜索软件可选>第三步：搜索软件（可选）</h3><p>确认一下 Redis 是否在列表中：</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>search</span> <span class=n>repo</span> <span class=n>redis</span>
</span></span></code></pre></td></tr></table></div></div><p><em>您会看到很多结果，找到 <code>bitnami/redis</code> 这一行就是我们要用的。</em></p><h3 id=第四步正式安装>第四步：正式安装！</h3><p>现在我们来安装 Redis。我们将这个“实例”命名为 <code>my-redis</code>。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>install</span> <span class=nb>my-redis</span> <span class=n>bitnami</span><span class=p>/</span><span class=n>redis</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>发生了什么？</strong></p><ol><li>您会看到屏幕上输出<strong>一大段文字</strong>。不要慌，这是正常的！</li><li>这段文字包含了如何连接这个数据库的说明（密码在哪里、端口是多少）。</li><li>Helm 已经告诉 Kubernetes：“嘿，帮我拉取 Redis 镜像，配置好网络，并把它们跑起来。”</li></ol><h3 id=第五步验证安装>第五步：验证安装</h3><p>让我们看看它是不是真的在运行。</p><p><strong>方法 A：用 Helm 查看</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>list</span>
</span></span></code></pre></td></tr></table></div></div><p><em>您应该能看到 <code>my-redis</code> 的状态是 <code>deployed</code>。</em></p><p><strong>方法 B：用 kubectl 查看（看底层的 Pod）</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>pods</span>
</span></span></code></pre></td></tr></table></div></div><p><em>您应该会看到类似 <code>my-redis-master-0</code> 和 <code>my-redis-replicas-0</code> 的东西。状态可能是 <code>ContainerCreating</code>（正在下载）或者 <code>Running</code>（已运行）。</em></p><h3 id=第六步清理卸载>第六步：清理（卸载）</h3><p>练手结束后，如果您不想留着它占用电脑资源，可以把它一键卸载。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>uninstall</span> <span class=nb>my-redis</span>
</span></span></code></pre></td></tr></table></div></div><p><em>它会提示 <code>release "my-redis" uninstalled</code>，这表示所有相关的 Pod、服务和配置都已被清理干净。</em></p><p>在 Helm 中，修改配置的核心在于理解 <strong>Values（值）</strong> 的概念。</p><p>你可以把 Helm Chart 想象成一份**“填空题”<strong>试卷（Template），而配置就是你的</strong>“答案卡”**（Values）。Helm 的工作就是把答案填进试卷里，生成最终给 Kubernetes 的指令。</p><p>我们有两种主要方式来修改配置：</p><h3 id=方法一快速修改使用---set>方法一：快速修改（使用 <code>--set</code>）</h3><p>如果你只想改一两个简单的设置（比如改个密码，或者改个端口），可以直接在命令行里用 <code>--set</code> 参数。</p><p>我们继续以 Redis 为例。默认情况下，Bitnami 的 Redis 会安装“主从复制”模式（会启动 3 个 Pod，比较占电脑内存）。我们把它改成“单机”模式（standalone），并且设置一个自定义密码。</p><p>请运行：</p><p>PowerShell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>helm install my-redis-simple bitnami/redis --set architecture=standalone --set auth.password=MySecretPass123
</span></span></code></pre></td></tr></table></div></div><p><strong>命令解析：</strong></p><ul><li><code>--set architecture=standalone</code>: 告诉 Chart 我只要一个节点，不要集群。</li><li><code>--set auth.password=...</code>: 覆盖默认的随机密码。</li></ul><p>你可以运行 <code>kubectl get pods</code>，你会发现这次只启动了 <strong>1 个</strong> Pod，而不是默认的 3 个。</p><hr><h3 id=方法二专业修改使用-yaml-文件>方法二：专业修改（使用 YAML 文件）</h3><p>这是生产环境中最常用的方法。当你要修改几十个参数时，写在命令行里太乱了。我们会把配置写在一个文件里，通常叫 <code>values.yaml</code>。</p><p>步骤 1：查看所有可配置的选项</p><p>首先，我们需要知道这个软件到底有哪些“开关”可以拨动。我们可以把默认配置导出到一个文件里看看。</p><p>PowerShell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>helm show values bitnami/redis &gt; values.yaml
</span></span></code></pre></td></tr></table></div></div><p>步骤 2：编辑这个文件</p><p>现在，用记事本或 VS Code 打开当前目录下生成的 values.yaml 文件。</p><p>你会看到几百行配置！别担心，你只需要修改你关心的部分，其他的保持默认即可。</p><p>比如，找到 <code>architecture</code> 那一行，把它从 <code>replication</code> 改为 <code>standalone</code>。或者找到 <code>master.persistence.size</code> 把磁盘大小从 <code>8Gi</code> 改为 <code>1Gi</code>（节省空间）。</p><p><em>为了演示方便，您可以创建一个名为 <code>my-settings.yaml</code> 的新文件，只写我们要改的内容：</em></p><p>YAML</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># my-settings.yaml
</span></span><span class=line><span class=cl>architecture: standalone
</span></span><span class=line><span class=cl>auth:
</span></span><span class=line><span class=cl>  password: &#34;MySuperStrongPassword&#34;
</span></span><span class=line><span class=cl>master:
</span></span><span class=line><span class=cl>  persistence:
</span></span><span class=line><span class=cl>    size: 500Mi
</span></span></code></pre></td></tr></table></div></div><p>步骤 3：应用配置文件</p><p>现在告诉 Helm：“安装 Redis，但要使用我文件里的设置。”</p><p>PowerShell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>helm install my-custom-redis bitnami/redis -f my-settings.yaml
</span></span></code></pre></td></tr></table></div></div><p><em>(注意：<code>-f</code> 是 <code>--values</code> 的缩写)</em></p><hr><h3 id=进阶如果我已经安装了怎么修改>进阶：如果我已经安装了，怎么修改？</h3><p>如果你已经安装了 <code>my-redis</code>，突然想修改它的密码或内存限制，不需要卸载重装！</p><p>Helm 有一个强大的 <strong>Upgrade</strong> 功能。</p><p>假设你修改了 <code>my-settings.yaml</code>，想把变更应用到正在运行的 <code>my-custom-redis</code> 上：</p><p>PowerShell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>helm upgrade my-custom-redis bitnami/redis -f my-settings.yaml
</span></span></code></pre></td></tr></table></div></div><p>Helm 会自动计算差异，只更新需要变动的部分（比如重启 Pod 以应用新密码）。</p><h3 id=总结>总结</h3><div class=table-wrapper><table><thead><tr><th><strong>场景</strong></th><th><strong>方法</strong></th><th><strong>命令示例</strong></th></tr></thead><tbody><tr><td><strong>临时/简单修改</strong></td><td><code>--set</code></td><td><code>helm install ... --set key=value</code></td></tr><tr><td><strong>复杂/生产配置</strong></td><td><code>-f 文件名</code></td><td><code>helm install ... -f values.yaml</code></td></tr><tr><td><strong>修改已运行的服务</strong></td><td><code>upgrade</code></td><td><code>helm upgrade [名字] [chart] -f ...</code></td></tr></tbody></table></div><hr><h3 id=既然您已经掌握了安装和配置>既然您已经掌握了安装和配置&mldr;</h3><p>您想尝试自己 <strong>编写一个最简单的 Helm Chart</strong> 吗？我们可以写一个简单的网页服务器，体验一下如何自己制作那个“填空题”模板。</p><p>太好了！动手“造轮子”是学习最快的方法。</p><p>我们将创建一个名为 <code>mychart</code> 的 Chart。默认情况下，Helm 会帮我们生成一个 <strong>Nginx</strong>（网页服务器）的模板。</p><p>请在 PowerShell 中跟着我一步步操作：</p><h3 id=第一步自动生成骨架>第一步：自动生成骨架</h3><p>Helm 提供了一个命令，可以一键生成标准的目录结构，不需要手动新建文件夹。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>create</span> <span class=n>mychart</span>
</span></span></code></pre></td></tr></table></div></div><p>现在，查看一下生成了什么（进入目录）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>cd </span><span class=n>mychart</span>
</span></span><span class=line><span class=cl><span class=nb>ls
</span></span></span></code></pre></td></tr></table></div></div><p><em>你会看到 <code>Chart.yaml</code>、<code>values.yaml</code> 和 <code>templates</code> 文件夹。这就是一个标准的 Helm 包结构。</em></p><hr><h3 id=第二步理解填空题原理>第二步：理解“填空题”原理</h3><p>我们需要看看 Helm 是如何把“配置”填进“模板”里的。</p><p><strong>1. 看看答案卡 (<code>values.yaml</code>)</strong>
打开 <code>values.yaml</code> (用记事本或 <code>code .</code> 如果你有 VS Code)。
找到第一行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><em>这表示默认只启动 1 个副本。</em></p><p><strong>2. 看看试卷 (<code>templates/deployment.yaml</code>)</strong>
打开 <code>templates</code> 文件夹里的 <code>deployment.yaml</code>。
找到 <code>replicas:</code> 这一行，你会看到类似这样的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>replicas</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Values.replicaCount }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>这就是魔法所在！</strong> 也就是告诉 Helm：“去 <code>values.yaml</code> 文件里找 <code>replicaCount</code> 的值，填在这里。”</p><hr><h3 id=第三步修改配置>第三步：修改配置</h3><p>既然是我们可以自己控制的 Chart，我们来改点东西。</p><p>请打开 <code>mychart/values.yaml</code> 文件：</p><ol><li>把 <code>replicaCount: 1</code> 改为 <code>replicaCount: 2</code> (我们要启动两个实例)。</li><li>(可选) 找到 <code>service:</code> 部分，把 <code>type: ClusterIP</code> 改为 <code>type: NodePort</code> (这样更容易从外部访问，但这步不做也没关系)。</li><li><strong>保存文件</strong>。</li></ol><hr><h3 id=第四步安装你的本地-chart>第四步：安装你的本地 Chart</h3><p>以前我们安装是用 <code>bitnami/redis</code>（从云端下载），现在我们要安装刚才创建在<strong>本地硬盘</strong>上的文件夹。</p><p>请确保你退回到了 <code>mychart</code> 的<strong>上一级目录</strong>（或者在命令里指定路径）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>cd </span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=n>helm</span> <span class=n>install</span> <span class=nb>my-website</span> <span class=p>./</span><span class=n>mychart</span>
</span></span></code></pre></td></tr></table></div></div><p><em>注意：这里用的是 <code>./mychart</code>，表示“安装当前目录下的 mychart 文件夹”。</em></p><h3 id=第五步见证奇迹>第五步：见证奇迹</h3><p>让我们看看它是否跑起来了，而且是不是真的是 2 个副本。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>pods</span>
</span></span></code></pre></td></tr></table></div></div><p>你应该会看到类似这样的输出（有两行）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>my-website-nginx-xxxx-yyyy    1/1     Running   0          30s
</span></span><span class=line><span class=cl>my-website-nginx-xxxx-zzzz    1/1     Running   0          30s
</span></span></code></pre></td></tr></table></div></div><h3 id=第六步访问你的网页>第六步：访问你的网页</h3><p>既然它是一个网页服务器，我们得亲眼看到那个网页。我们可以使用 <code>port-forward</code> 把它的端口映射到你电脑上。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kubectl</span> <span class=nb>port-forward</span> <span class=n>svc</span><span class=p>/</span><span class=nb>my-website</span><span class=n>-mychart</span> <span class=mf>8080</span><span class=err>:</span><span class=mf>80</span>
</span></span></code></pre></td></tr></table></div></div><p><em>(注意：如果这步报错，可能是服务名称不同。你可以先用 <code>kubectl get svc</code> 查一下确切的服务名)</em></p><p>现在，打开你的浏览器（Chrome/Edge），访问：
<strong>http://localhost:8080</strong></p><p>你应该会看到 <strong>&ldquo;Welcome to nginx!&rdquo;</strong> 的页面。这就是你刚刚用 Helm 部署的应用！</p><hr><h3 id=恭喜>恭喜！</h3><p>你已经完成了一个 Helm 工程师 80% 的日常工作：</p><ol><li><code>helm create</code> (创建)</li><li>修改 <code>values.yaml</code> (配置)</li><li><code>helm install</code> (部署)</li></ol><p><strong>现在的你可能有一个疑问：</strong>
目前的模板里都是简单的“填空”。如果我想根据情况做判断呢？
比如：<strong>“如果是生产环境(Prod)，就开启高可用；如果是测试环境(Dev)，就关闭。”</strong></p><p>这需要用到 Helm 的<strong>逻辑控制（If/Else）</strong>。想学这一招进阶技巧吗？</p><p>这正是 Helm 模板语言（基于 Go 模板）最强大的地方。通过简单的 <code>if/else</code> 逻辑，你可以让同一个 Chart 在开发环境和生产环境中表现出完全不同的行为。</p><p>我们来做一个有趣的实验：<strong>“消失的配置文件”</strong>。
我们将创建一个 ConfigMap（配置文件），但设置一个开关：<strong>只有当开关打开时，这个文件才会被创建。</strong></p><p>请继续在您的 <code>mychart</code> 目录中操作。</p><h3 id=第一步设置开关修改-valuesyaml>第一步：设置开关（修改 values.yaml）</h3><p>首先，我们需要在“答案卡”里加一个选项。</p><p>打开 <code>mychart/values.yaml</code>，在文件的<strong>最后一行</strong>添加以下内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>enableSpecialFeature</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><em>这表示我们默认开启这个“特殊功能”。</em></p><hr><h3 id=第二步编写带逻辑的模板>第二步：编写带逻辑的模板</h3><p>我们不修改现有的文件，而是新建一个文件来专门测试逻辑，这样更清晰。</p><p>在 <code>mychart/templates/</code> 目录下，新建一个文件，命名为 <code>my-config.yaml</code>。
将以下代码复制进去：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{{- <span class=l>if .Values.enableSpecialFeature }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>special-config-map</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Congratulations! You found the secret feature.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>{{- <span class=l>end }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>逻辑解析：</strong></p><ul><li><code>{{- if .Values.enableSpecialFeature }}</code>：这是判断语句的开始。意思是：“如果 <code>values.yaml</code> 里的 <code>enableSpecialFeature</code> 是 <code>true</code>，那么&mldr;”</li><li><strong>中间的 YAML 内容</strong>：这是正常要生成的资源内容。</li><li><code>{{- end }}</code>：这是判断语句的结束。</li></ul><p><strong>注意那个减号 <code>-</code></strong>：<code>{{-</code> 表示“删除这个标签产生的空行/空格”。在 YAML 中空格非常敏感，加上这个是个好习惯，可以让生成的代码更整洁。</p><hr><h3 id=第三步应用更改>第三步：应用更改</h3><p>现在我们来更新我们之前安装的 <code>my-website</code>。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>upgrade</span> <span class=nb>my-website</span> <span class=p>./</span><span class=n>mychart</span>
</span></span></code></pre></td></tr></table></div></div><p><em>提示：一定要在 <code>mychart</code> 文件夹的<strong>上一级</strong>运行这个命令。</em></p><h3 id=第四步验证是否存在>第四步：验证是否存在</h3><p>看看这个 ConfigMap 是否被成功创建了。</p><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>configmap</span>
</span></span></code></pre></td></tr></table></div></div><p>你应该能看到一个名为 <code>special-config-map</code> 的项目。这说明 <code>if</code> 判断通过了！</p><hr><h3 id=第五步见证消失术-elsefalse>第五步：见证“消失术” (Else/False)</h3><p>现在，假设我们要部署到另一个环境，不需要这个功能。我们不需要改代码，只需要改配置。</p><p>我们使用 <code>--set</code> 临时覆盖配置，把开关关掉：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>upgrade</span> <span class=nb>my-website</span> <span class=p>./</span><span class=n>mychart</span> <span class=p>-</span><span class=n>-set</span> <span class=n>enableSpecialFeature</span><span class=p>=</span><span class=n>false</span>
</span></span></code></pre></td></tr></table></div></div><p>现在再次检查：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>configmap</span>
</span></span></code></pre></td></tr></table></div></div><p>你会发现 <code>special-config-map</code> <strong>不见了</strong>！
Helm 检测到条件为 <code>false</code>，所以直接跳过了那段 YAML，Kubernetes 也就把这个不再需要的资源删除了。</p><hr><h3 id=进阶if--else-组合拳>进阶：If / Else 组合拳</h3><p>除了决定“存不存在”，你还可以用来决定“具体的值”。</p><p>比如，你想实现：</p><ul><li>如果是生产环境 (<code>production</code>)，副本数设为 5。</li><li>否则（测试环境），副本数设为 1。</li></ul><p>你可以这样写（<strong>仅供阅读理解，无需操作</strong>）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>replicas</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>if eq .Values.env &#34;production&#34; }} 5 {{ else }} 1 {{ end }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>eq</code> 是 &ldquo;equal&rdquo;（等于）的缩写。</li><li>这就实现了根据环境自动调整参数。</li></ul><h3 id=总结-1>总结</h3><p>您现在已经掌握了 Helm 的三大法宝：</p><ol><li><strong>模板 (Templates)</strong>：把变量挖空。</li><li><strong>值 (Values)</strong>：填入具体的配置。</li><li><strong>逻辑 (Logic)</strong>：用 <code>if</code> 控制资源的创建和内容的生成。</li></ol><p>这基本上就是编写 Helm Chart 的核心了！</p><p><strong>打包分享</strong>、<strong>实战救灾（回滚）以及原理解析</strong>。</p><p>请继续在 PowerShell/终端中操作。</p><hr><h3 id=第一部分如何打包-packaging>第一部分：如何打包 (Packaging)</h3><p>您做好了 <code>mychart</code>，现在想把它像一个压缩包一样发给同事，或者上传到私有仓库。</p><p><strong>1. 确定版本号</strong>
打开 <code>mychart/Chart.yaml</code>。
确保 <code>version: 0.1.0</code> 这一行是您想要的版本。</p><p><strong>2. 执行打包命令</strong>
在 <code>mychart</code> 文件夹的<strong>上一级目录</strong>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>package</span> <span class=p>./</span><span class=n>mychart</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>3. 结果</strong>
您会发现当前目录下多了一个文件：<code>mychart-0.1.0.tgz</code>。
这就是您的“成品”！</p><ul><li>您可以把它发给同事。</li><li>同事拿到后，不需要解压，直接运行 <code>helm install my-app ./mychart-0.1.0.tgz</code> 即可安装。</li></ul><hr><h3 id=第二部分实战回滚-rollback--您的后悔药>第二部分：实战回滚 (Rollback) —— 您的“后悔药”</h3><p>为了演示回滚，我们需要先人为制造一次“由于手抖导致的错误更新”。</p><p><strong>1. 制造“事故现场” (创建一个新版本)</strong>
假设我们脑子一热，把副本数改成了 10 个，这太浪费资源了。
运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>upgrade</span> <span class=nb>my-website</span> <span class=p>./</span><span class=n>mychart</span> <span class=p>-</span><span class=n>-set</span> <span class=n>replicaCount</span><span class=p>=</span><span class=mf>10</span>
</span></span></code></pre></td></tr></table></div></div><p>此时，Helm 会更新应用，您会看到 Pod 数量开始疯狂增加。</p><p><strong>2. 查看历史记录 (关键步骤)</strong>
在回滚之前，您必须知道“回滚到哪里去”。
运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=nb>history my-website</span>
</span></span></code></pre></td></tr></table></div></div><p>您会看到类似这样的表格：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>REVISION    UPDATED      STATUS      CHART           DESCRIPTION
</span></span><span class=line><span class=cl>1           ...          SUPERSEDED  mychart-0.1.0   Install complete
</span></span><span class=line><span class=cl>2           ...          SUPERSEDED  mychart-0.1.0   Upgrade complete (之前做的开关测试)
</span></span><span class=line><span class=cl>3           ...          DEPLOYED    mychart-0.1.0   Upgrade complete (刚才手抖搞的10副本)
</span></span></code></pre></td></tr></table></div></div><p><em>注意：<code>REVISION</code> (版本号) 是递增的。当前我们在版本 3。</em></p><p><strong>3. 一键回滚 (救命稻草)</strong>
我们要回到版本 2（也就是副本数正常、或者开关测试那个状态）。
运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=n>rollback</span> <span class=nb>my-website</span> <span class=mf>2</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>4. 验证结果</strong>
Helm 会提示 <code>Rollback was a success</code>。
再次查看历史：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>helm</span> <span class=nb>history my-website</span>
</span></span></code></pre></td></tr></table></div></div><p>您会发现多了一个 <strong>版本 4</strong>，描述是 <code>Rollback to 2</code>。
<em>注意：Helm 的回滚不是“删除版本3”，而是“根据版本2的配置，生成一个新的版本4”。历史总是向前的。</em></p><p>检查 Pod 数量，应该又变回正常了。</p><hr><h3 id=第三部分helm-回滚机制是如何工作的-under-the-hood>第三部分：Helm 回滚机制是如何工作的？ (Under the Hood)</h3><p>您可能会好奇：<em>Helm 怎么知道版本 2 长什么样？它把旧文件存在哪里了？</em></p><p><strong>1. 秘密就在 Kubernetes 的 Secrets 里</strong>
Helm 并没有在您的本地电脑存数据库，而是把每一次发布的<strong>所有信息</strong>（包括当时的 Chart 模板、Config 值）都压缩加密后，存到了 Kubernetes 集群的 <strong>Secrets</strong>（保密字典）里。</p><p><strong>2. 亲眼看看这些存档</strong>
您可以运行以下命令，看看 Helm 在集群里藏了什么：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>secrets</span>
</span></span></code></pre></td></tr></table></div></div><p>您会看到类似这样的列表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>sh.helm.release.v1.my-website.v1
</span></span><span class=line><span class=cl>sh.helm.release.v1.my-website.v2
</span></span><span class=line><span class=cl>sh.helm.release.v1.my-website.v3
</span></span><span class=line><span class=cl>sh.helm.release.v1.my-website.v4
</span></span></code></pre></td></tr></table></div></div><p><strong>每一个版本对应一个 Secret 文件！</strong></p><p><strong>3. 它是如何还原的？（三方比对）</strong>
当您执行 <code>helm rollback my-website 2</code> 时，Helm 做了以下事情：</p><ol><li><strong>读取存档</strong>：从集群下载 <code>sh.helm.release.v1.my-website.v2</code> 这个 Secret。</li><li><strong>解压状态</strong>：获取当时所有的 YAML 定义。</li><li><strong>计算差异 (Diff)</strong>：将“版本 2”的配置与“当前集群正在运行”的状态进行比对。</li><li><strong>应用补丁</strong>：计算出需要增加、删除或修改哪些资源，才能让集群变回版本 2 的样子，然后执行 <code>kubectl apply</code>。</li></ol><hr><h3 id=总结-2>总结</h3><ul><li><strong>打包 (<code>package</code>)</strong>：生成 <code>.tgz</code> 文件，方便分发。</li><li><strong>历史 (<code>history</code>)</strong>：查看发布的时光轴。</li><li><strong>回滚 (<code>rollback</code>)</strong>：基于历史版本号，生成新的修正版本。</li><li><strong>原理</strong>：Helm 把每次发布的快照都存在了 K8s 的 Secret 里，像游戏的“存档点”一样，随时读取。</li></ul><p>至此，您已经掌握了从<strong>安装、配置、开发、逻辑编写</strong>到<strong>运维回滚</strong>的 Helm 完整核心链路！您可以自豪地说您会用 Helm 了！</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/utility/ansible/><div class=article-details><h2 class=article-title>Ansible</h2></div></a></article><article><a href=/utility/jenkins/><div class=article-details><h2 class=article-title>Jenkins</h2></div></a></article><article><a href=/utility/nfs/><div class=article-details><h2 class=article-title>NFS</h2></div></a></article><article><a href=/utility/prometheus-/><div class=article-details><h2 class=article-title>Prometheus</h2></div></a></article><article><a href=/utility/tomcat/><div class=article-details><h2 class=article-title>Tomcat</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>