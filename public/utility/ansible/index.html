<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Ansible搭建部署\n1. 安装必要的依赖和 EPEL 仓库 Ansible 不在 CentOS 默认的软件仓库中，需要先安装 EPEL 仓库：\nbash\n1 2 3 4 5 # 安装EPEL仓库 sudo yum install -y epel-release # 更新系统包 sudo yum update -y 2. 安装 Ansible bash\n"><title>Ansible</title><link rel=canonical href=http://localhost:1313/utility/ansible/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Ansible"><meta property='og:description' content="Ansible搭建部署\n1. 安装必要的依赖和 EPEL 仓库 Ansible 不在 CentOS 默认的软件仓库中，需要先安装 EPEL 仓库：\nbash\n1 2 3 4 5 # 安装EPEL仓库 sudo yum install -y epel-release # 更新系统包 sudo yum update -y 2. 安装 Ansible bash\n"><meta property='og:url' content='http://localhost:1313/utility/ansible/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Utility'><meta property='article:published_time' content='2025-12-14T00:00:00+00:00'><meta property='article:modified_time' content='2025-12-14T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="Ansible"><meta name=twitter:description content="Ansible搭建部署\n1. 安装必要的依赖和 EPEL 仓库 Ansible 不在 CentOS 默认的软件仓库中，需要先安装 EPEL 仓库：\nbash\n1 2 3 4 5 # 安装EPEL仓库 sudo yum install -y epel-release # 更新系统包 sudo yum update -y 2. 安装 Ansible bash\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/kali/><span>kali</span></a></li><li><a href=/ubuntu/><span>ubuntu</span></a></li><li><a href=/utility/><span>Utility</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#1-安装必要的依赖和-epel-仓库>1. 安装必要的依赖和 EPEL 仓库</a></li><li><a href=#2-安装-ansible>2. 安装 Ansible</a></li><li><a href=#3-验证-ansible-安装>3. 验证 Ansible 安装</a></li><li><a href=#4-配置-ansible>4. 配置 Ansible</a><ol><li><a href=#41-配置主机清单-inventory>4.1 配置主机清单 (inventory)</a></li><li><a href=#42-配置-ssh-免密码登录>4.2 配置 SSH 免密码登录</a></li><li><a href=#1-主机密钥验证问题最常见>1. 主机密钥验证问题（最常见）</a></li><li><a href=#2-权限拒绝认证失败>2. 权限拒绝（认证失败）</a></li><li><a href=#3-域名解析失败>3. 域名解析失败</a></li><li><a href=#4-网络不可达>4. 网络不可达</a></li></ol></li><li><a href=#修复后测试>修复后测试</a></li><li><a href=#区分-控制节点-和-目标主机>区分 “控制节点” 和 “目标主机”</a></li><li><a href=#验证-目标主机是否有效>验证 “目标主机是否有效”</a></li><li><a href=#5-测试-ansible-配置>5. 测试 Ansible 配置</a><ol><li><a href=#1-确认目标主机是否开机并正常运行>1. 确认目标主机是否开机并正常运行</a></li><li><a href=#2-验证目标主机的-ip-地址配置>2. 验证目标主机的 IP 地址配置</a></li><li><a href=#3-检查子网与网关配置>3. 检查子网与网关配置</a></li><li><a href=#4-排查物理连接与网络设备>4. 排查物理连接与网络设备</a></li><li><a href=#5-检查防火墙是否禁止-icmpping>5. 检查防火墙是否禁止 ICMP（ping）</a></li><li><a href=#6-清除本地-arp-缓存可选>6. 清除本地 ARP 缓存（可选）</a></li></ol></li><li><a href=#三验证结果>三、验证结果</a></li><li><a href=#6-基本-ansible-配置文件修改-可选>6. 基本 Ansible 配置文件修改 (可选)</a></li><li><a href=#如何使用这两个分组>如何使用这两个分组？</a><ol><li><a href=#1-基础用法直接对组执行命令>1. 基础用法：直接对组执行命令</a></li><li><a href=#2-进阶用法用模块批量管理服务--软件>2. 进阶用法：用模块批量管理服务 / 软件</a></li><li><a href=#3-高级用法用-playbook-实现自动化任务>3. 高级用法：用 Playbook 实现自动化任务</a></li></ol></li><li><a href=#四注意事项>四、注意事项</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/utility/ansible/>Ansible</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-12-14</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 9 分钟</time></div></footer></div></header><section class=article-content><p>Ansible搭建部署</p><h3 id=1-安装必要的依赖和-epel-仓库>1. 安装必要的依赖和 EPEL 仓库</h3><p>Ansible 不在 CentOS 默认的软件仓库中，需要先安装 EPEL 仓库：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 安装EPEL仓库</span>
</span></span><span class=line><span class=cl>sudo yum install -y epel-release
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更新系统包</span>
</span></span><span class=line><span class=cl>sudo yum update -y
</span></span></code></pre></td></tr></table></div></div><h3 id=2-安装-ansible>2. 安装 Ansible</h3><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 安装Ansible</span>
</span></span><span class=line><span class=cl>sudo yum install -y ansible
</span></span></code></pre></td></tr></table></div></div><h3 id=3-验证-ansible-安装>3. 验证 Ansible 安装</h3><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 检查Ansible版本</span>
</span></span><span class=line><span class=cl>ansible --version
</span></span></code></pre></td></tr></table></div></div><p>成功安装后，会显示类似以下的信息：</p><p>plaintext</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>ansible 2.9.x
</span></span><span class=line><span class=cl>  config file = /etc/ansible/ansible.cfg
</span></span><span class=line><span class=cl>  configured module search path = [u&#39;/root/.ansible/plugins/modules&#39;, u&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span class=line><span class=cl>  ansible python module location = /usr/lib/python2.7/site-packages/ansible
</span></span><span class=line><span class=cl>  executable location = /usr/bin/ansible
</span></span><span class=line><span class=cl>  python version = 2.7.5 (default, Jun 20 2019, 20:27:34) [GCC 4.8.5 20150623 (Red Hat 4.8.5-36)]
</span></span></code></pre></td></tr></table></div></div><h3 id=4-配置-ansible>4. 配置 Ansible</h3><h4 id=41-配置主机清单-inventory>4.1 配置主机清单 (inventory)</h4><p>Ansible 使用 inventory 文件来管理它所控制的主机，默认位置是<code>/etc/ansible/hosts</code></p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 编辑主机清单文件</span>
</span></span><span class=line><span class=cl>sudo vi /etc/ansible/hosts
</span></span></code></pre></td></tr></table></div></div><p>在文件中添加需要管理的主机，例如：</p><p>ini</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># 定义一个名为webservers的主机组</span>
</span></span><span class=line><span class=cl><span class=k>[webservers]</span>
</span></span><span class=line><span class=cl><span class=na>192.168.1.100</span>
</span></span><span class=line><span class=cl><span class=na>192.168.1.101</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义一个名为databases的主机组</span>
</span></span><span class=line><span class=cl><span class=k>[databases]</span>
</span></span><span class=line><span class=cl><span class=na>192.168.1.200</span>
</span></span><span class=line><span class=cl><span class=na>db.example.com</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=42-配置-ssh-免密码登录>4.2 配置 SSH 免密码登录</h4><p>为了让 Ansible 能够无密码登录到被管理节点，需要配置 SSH 密钥认证：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 生成SSH密钥对(如果还没有)</span>
</span></span><span class=line><span class=cl>ssh-keygen -t rsa -N <span class=s2>&#34;&#34;</span> -f ~/.ssh/id_rsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将公钥复制到被管理节点</span>
</span></span><span class=line><span class=cl>ssh-copy-id username@remote_host
</span></span></code></pre></td></tr></table></div></div><h4 id=1-主机密钥验证问题最常见>1. 主机密钥验证问题（最常见）</h4><p><strong>错误信息</strong>：</p><ul><li><code>The authenticity of host 'xxx' can't be established.</code>（首次连接提示确认主机密钥）</li><li><code>Host key verification failed.</code>（主机密钥验证失败）</li></ul><p><strong>原因</strong>：
SSH 首次连接陌生主机时，会提示确认主机密钥（防止中间人攻击），但 Ansible 在非交互式模式下无法手动输入<code>yes</code>，导致连接中断；或主机密钥已变更，与本地存储的不一致。</p><p><strong>解决方法</strong>：
临时关闭 Ansible 的主机密钥检查（适合测试环境）：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 临时生效（仅当前终端）</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ANSIBLE_HOST_KEY_CHECKING</span><span class=o>=</span>False
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 永久生效（修改Ansible配置文件）</span>
</span></span><span class=line><span class=cl>sudo vi /etc/ansible/ansible.cfg
</span></span><span class=line><span class=cl><span class=c1># 找到并修改以下配置（去掉注释并设为False）</span>
</span></span><span class=line><span class=cl><span class=nv>host_key_checking</span> <span class=o>=</span> False
</span></span></code></pre></td></tr></table></div></div><h4 id=2-权限拒绝认证失败>2. 权限拒绝（认证失败）</h4><p><strong>错误信息</strong>：
<code>Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).</code></p><p><strong>原因</strong>：
Ansible 默认使用 SSH 密钥认证，但目标主机未配置当前用户的公钥（或公钥配置错误），导致认证失败。</p><p><strong>解决方法</strong>：
确保 Ansible 控制节点的公钥已正确复制到目标主机：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 生成SSH密钥（如果还没有）</span>
</span></span><span class=line><span class=cl>ssh-keygen -t rsa -N <span class=s2>&#34;&#34;</span> -f ~/.ssh/id_rsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 将公钥复制到目标主机（替换为实际的用户名和IP）</span>
</span></span><span class=line><span class=cl><span class=c1># 例如：复制到192.168.200.100，远程用户为root</span>
</span></span><span class=line><span class=cl>ssh-copy-id root@192.168.200.100
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 验证SSH是否能无密码登录</span>
</span></span><span class=line><span class=cl>ssh root@192.168.200.100  <span class=c1># 无需输入密码即登录成功说明配置正确</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>注意</strong>：</p><ul><li><p>目标主机的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>~/.ssh
</span></span></code></pre></td></tr></table></div></div><p>目录权限必须为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>700
</span></span></code></pre></td></tr></table></div></div><p>，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>~/.ssh/authorized_keys
</span></span></code></pre></td></tr></table></div></div><p>权限必须为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>600
</span></span></code></pre></td></tr></table></div></div><p>，否则会认证失败：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在目标主机执行（修复权限）</span>
</span></span><span class=line><span class=cl>chmod <span class=m>700</span> ~/.ssh
</span></span><span class=line><span class=cl>chmod <span class=m>600</span> ~/.ssh/authorized_keys
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=3-域名解析失败>3. 域名解析失败</h4><p><strong>错误信息</strong>：
<code>ssh: Could not resolve hostname db.example.com: Name or service not known</code></p><p><strong>原因</strong>：
Ansible 清单（<code>/etc/ansible/hosts</code>）中配置的<code>db.example.com</code>域名无法被解析（本地 DNS 或<code>/etc/hosts</code>中无记录）。</p><p><strong>解决方法</strong>：</p><ul><li><p>方法 1：用 IP 地址替换域名（简单直接）：
编辑<code>/etc/ansible/hosts</code>，将<code>db.example.com</code>改为实际 IP（如<code>192.168.200.xxx</code>）。</p></li><li><p>方法 2：手动添加域名解析：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/hosts
</span></span><span class=line><span class=cl><span class=c1># 添加一行（替换为实际IP和域名）</span>
</span></span><span class=line><span class=cl>192.168.200.xxx  db.example.com
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=4-网络不可达>4. 网络不可达</h4><p><strong>错误信息</strong>：
<code>ssh: connect to host 192.168.200.200 port 22: No route to host</code></p><p><strong>原因</strong>：
目标主机（<code>192.168.200.200</code>）与控制节点网络不通，可能是：</p><ul><li>IP 地址错误（目标主机实际 IP 不是这个）；</li><li>子网掩码 / 网关配置错误；</li><li>目标主机防火墙阻止了 SSH 端口（22）；</li><li>目标主机未开机或网络未连接。</li></ul><p><strong>解决方法</strong>：</p><ol><li><p>先验证网络连通性：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#  ping目标主机（检查是否在线）</span>
</span></span><span class=line><span class=cl>ping 192.168.200.200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查SSH端口是否开放（22端口是否可达）</span>
</span></span><span class=line><span class=cl>telnet 192.168.200.200 <span class=m>22</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>若 ping 不通：确认目标主机 IP 是否正确、是否开机、网络是否连接。</p></li><li><p>若 ping 通但 telnet 失败：检查目标主机防火墙是否允许 22 端口：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在目标主机执行（开放22端口）</span>
</span></span><span class=line><span class=cl>sudo firewall-cmd --add-port<span class=o>=</span>22/tcp --permanent
</span></span><span class=line><span class=cl>sudo firewall-cmd --reload
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=修复后测试>修复后测试</h3><p>解决上述问题后，重新执行测试命令验证：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 测试所有主机连接</span>
</span></span><span class=line><span class=cl>ansible all -m ping
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试webservers组连接</span>
</span></span><span class=line><span class=cl>ansible webservers -m ping
</span></span></code></pre></td></tr></table></div></div><p><strong>测试 Ansible 对该主机的连接</strong>：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible 192.168.200.50 -m ping
</span></span></code></pre></td></tr></table></div></div><p>若输出类似以下内容，说明连接成功：</p><p>plaintext</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>192.168.200.100 | SUCCESS =&gt; {
</span></span><span class=line><span class=cl>    &#34;changed&#34;: false,
</span></span><span class=line><span class=cl>    &#34;ping&#34;: &#34;pong&#34;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=区分-控制节点-和-目标主机>区分 “控制节点” 和 “目标主机”</h3><ul><li><strong>控制节点</strong>：你当前登录并运行 Ansible 命令的机器（比如你操作的<code>client2</code>），Ansible 程序安装在这里，负责发起管理操作。</li><li><strong>目标主机</strong>：<code>webservers</code>、<code>databases</code>组里列出的远程服务器（如<code>192.168.200.50</code>），它们是被管理的对象，Ansible 通过 SSH 远程控制它们。</li></ul><h3 id=验证-目标主机是否有效>验证 “目标主机是否有效”</h3><p>如果不确定某个 IP 是否是 “可用的目标主机”，可以通过以下方式验证：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 先测试网络连通性（控制节点ping目标主机）</span>
</span></span><span class=line><span class=cl>ping 192.168.200.50
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 测试SSH是否能连接（控制节点SSH登录目标主机）</span>
</span></span><span class=line><span class=cl>ssh root@192.168.200.50  <span class=c1># 若免密配置正确，无需输密码即可登录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 用Ansible的ping模块测试（最直接的验证）</span>
</span></span><span class=line><span class=cl>ansible 192.168.200.50 -m ping  <span class=c1># 返回&#34;pong&#34;说明是有效目标主机</span>
</span></span></code></pre></td></tr></table></div></div><p>总结：<code>webservers</code>组里的 IP 就是 Ansible 要管理的 “目标主机”（Web 服务器类型），你通过 Ansible 命令操作这些 IP 时，它们就是本次操作的目标。</p><h3 id=5-测试-ansible-配置>5. 测试 Ansible 配置</h3><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 测试与所有主机的连接</span>
</span></span><span class=line><span class=cl>ansible all -m ping
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试与webservers组主机的连接</span>
</span></span><span class=line><span class=cl>ansible webservers -m ping
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在所有主机上执行date命令</span>
</span></span><span class=line><span class=cl>ansible all -a <span class=s2>&#34;date&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>如果配置正确，会显示类似以下的成功信息：</p><p>plaintext</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>192.168.1.100 | SUCCESS =&gt; {
</span></span><span class=line><span class=cl>    &#34;changed&#34;: false,
</span></span><span class=line><span class=cl>    &#34;ping&#34;: &#34;pong&#34;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h4 id=1-确认目标主机是否开机并正常运行>1. 确认目标主机是否开机并正常运行</h4><ul><li>直接登录目标主机（192.168.200.200）的控制台，检查是否处于开机状态（最基础的排查）。</li><li>若无法直接访问控制台，可尝试通过其他同网段主机 ping 该 IP，确认是否仅 192.168.200.50 无法连接。</li></ul><h4 id=2-验证目标主机的-ip-地址配置>2. 验证目标主机的 IP 地址配置</h4><p>登录目标主机（若能访问），检查其 IP 地址是否正确：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在目标主机（192.168.200.200）上执行</span>
</span></span><span class=line><span class=cl>ip addr show
</span></span></code></pre></td></tr></table></div></div><ul><li><p>确认是否存在<code>192.168.200.200</code>的 IP 地址（通常在<code>eth0</code>或<code>ens33</code>等网卡下）。</p></li><li><p>若 IP 地址错误，重新配置正确的 IP（以 CentOS 为例）：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 临时设置IP（重启失效）</span>
</span></span><span class=line><span class=cl>ip addr add 192.168.200.200/24 dev eth0  <span class=c1># 假设子网掩码为255.255.255.0，网卡为eth0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 永久配置（编辑网卡文件，不同系统路径可能不同）</span>
</span></span><span class=line><span class=cl>sudo vi /etc/sysconfig/network-scripts/ifcfg-eth0
</span></span><span class=line><span class=cl><span class=c1># 修改或添加：</span>
</span></span><span class=line><span class=cl><span class=nv>IPADDR</span><span class=o>=</span>192.168.200.200
</span></span><span class=line><span class=cl><span class=nv>NETMASK</span><span class=o>=</span>255.255.255.0
</span></span><span class=line><span class=cl><span class=c1># 重启网络服务</span>
</span></span><span class=line><span class=cl>sudo systemctl restart network
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=3-检查子网与网关配置>3. 检查子网与网关配置</h4><p>确保 192.168.200.50 和 192.168.200.200 在同一子网：</p><ul><li>在 192.168.200.50 上执行<code>ip addr show</code>，查看子网掩码（如<code>255.255.255.0</code>）。</li><li>若子网掩码为<code>255.255.255.0</code>，则两台主机的 IP 前三位（192.168.200）必须一致（当前符合），无需网关即可直接通信。</li><li>若子网掩码不同（如目标主机是<code>255.255.254.0</code>），则可能不在同一网段，需检查网关是否正确配置并确保网关可达。</li></ul><h4 id=4-排查物理连接与网络设备>4. 排查物理连接与网络设备</h4><ul><li>检查目标主机的网线是否插紧，交换机 / 路由器对应端口是否亮灯（正常工作状态）。</li><li>尝试更换目标主机的网线或交换机端口，排除硬件故障。</li></ul><h4 id=5-检查防火墙是否禁止-icmpping>5. 检查防火墙是否禁止 ICMP（ping）</h4><p>即使网络连通，防火墙也可能阻止 ICMP 协议导致 ping 失败：</p><ul><li><p>在目标主机（192.168.200.200）上开放 ICMP</p><p>：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># CentOS 7默认防火墙是firewalld，允许ICMP（ping）</span>
</span></span><span class=line><span class=cl>sudo firewall-cmd --add-icmp-block-inversion --permanent  <span class=c1># 允许所有ICMP请求</span>
</span></span><span class=line><span class=cl>sudo firewall-cmd --reload
</span></span></code></pre></td></tr></table></div></div></li><li><p>若目标主机使用 iptables 防火墙：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
</span></span><span class=line><span class=cl>sudo service iptables save
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=6-清除本地-arp-缓存可选>6. 清除本地 ARP 缓存（可选）</h4><p>若存在 ARP 缓存异常，可能导致 IP 与 MAC 地址映射错误：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在192.168.200.50上执行</span>
</span></span><span class=line><span class=cl>arp -d 192.168.200.200  <span class=c1># 清除目标主机的ARP缓存</span>
</span></span><span class=line><span class=cl>ping 192.168.200.200   <span class=c1># 重新尝试ping</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=三验证结果>三、验证结果</h3><p>完成上述排查后，重新在 192.168.200.50 上执行<code>ping 192.168.200.200</code>，若显示类似以下内容，说明网络连通：</p><p>plaintext</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>64 bytes from 192.168.200.200: icmp_seq=1 ttl=64 time=0.567 ms
</span></span><span class=line><span class=cl>64 bytes from 192.168.200.200: icmp_seq=2 ttl=64 time=0.452 ms
</span></span></code></pre></td></tr></table></div></div><h3 id=6-基本-ansible-配置文件修改-可选>6. 基本 Ansible 配置文件修改 (可选)</h3><p>Ansible 的主配置文件是<code>/etc/ansible/ansible.cfg</code>，可以根据需要修改：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/ansible/ansible.cfg
</span></span></code></pre></td></tr></table></div></div><p>常用的配置项：</p><ul><li><code>remote_user</code>: 默认的远程用户名</li><li><code>host_key_checking</code>: 是否检查主机密钥，设置为 False 可以跳过检查</li><li><code>timeout</code>: SSH 连接超时时间</li></ul><p>Ansible主机清单中自定义的主机分组两个分别是：webservers和databases</p><p>[webservers]组：运行Web服务的服务器（批量安装Web服务软件、统一配置网站文件、管理Web服务状态、部署网页代码）</p><p>[databases]组：运行数据库服务的服务器（批量安装数据库软件、配置数据库参数、管理数据库服务状态、执行数据库命令）</p><h3 id=如何使用这两个分组>如何使用这两个分组？</h3><h4 id=1-基础用法直接对组执行命令>1. 基础用法：直接对组执行命令</h4><p>通过 <code>ansible 组名</code> 替代 <code>ansible 单个IP</code>，即可批量操作组内所有主机。</p><p>示例 1：测试组内主机的连接性</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 测试 webservers 组所有主机是否能被 Ansible 连接</span>
</span></span><span class=line><span class=cl>ansible webservers -m ping
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试 databases 组所有主机是否能被 Ansible 连接</span>
</span></span><span class=line><span class=cl>ansible databases -m ping
</span></span></code></pre></td></tr></table></div></div><p>（如果组内某台主机不可达，会单独显示错误，不影响组内其他主机）</p><p><strong>示例 2：批量执行系统命令</strong></p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看 webservers 组所有主机的系统版本（如 CentOS 版本）</span>
</span></span><span class=line><span class=cl>ansible webservers -a <span class=s2>&#34;cat /etc/redhat-release&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看 databases 组所有主机的磁盘空间（检查数据库存储是否充足）</span>
</span></span><span class=line><span class=cl>ansible databases -a <span class=s2>&#34;df -h /var/lib/mysql&#34;</span>  <span class=c1># /var/lib/mysql 是 MySQL 数据默认目录</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-进阶用法用模块批量管理服务--软件>2. 进阶用法：用模块批量管理服务 / 软件</h4><p>结合 Ansible 模块（如 <code>yum</code> 安装软件、<code>service</code> 管理服务），对组内主机执行更复杂的操作。</p><p><strong>示例 1：给 webservers 组批量部署 Nginx</strong></p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 批量安装 Nginx（确保所有 Web 服务器都有 Nginx）</span>
</span></span><span class=line><span class=cl>ansible webservers -m yum -a <span class=s2>&#34;name=nginx state=installed&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 批量启动 Nginx 并设置开机自启</span>
</span></span><span class=line><span class=cl>ansible webservers -m service -a <span class=s2>&#34;name=nginx state=started enabled=yes&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 批量修改 Nginx 配置（比如替换默认首页）</span>
</span></span><span class=line><span class=cl><span class=c1># 先在控制节点创建一个简单的 index.html</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&lt;h1&gt;Hello from Ansible&lt;/h1&gt;&#34;</span> &gt; /tmp/index.html
</span></span><span class=line><span class=cl><span class=c1># 再用 copy 模块传到所有 Web 服务器的 Nginx 根目录</span>
</span></span><span class=line><span class=cl>ansible webservers -m copy -a <span class=s2>&#34;src=/tmp/index.html dest=/usr/share/nginx/html/index.html mode=0644&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>示例 2：给 databases 组批量部署 MySQL</strong></p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 批量安装 MySQL 服务器</span>
</span></span><span class=line><span class=cl>ansible databases -m yum -a <span class=s2>&#34;name=mariadb-server state=installed&#34;</span>  <span class=c1># CentOS 中 MySQL 通常用 mariadb 替代</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 批量启动 MySQL 并设置开机自启</span>
</span></span><span class=line><span class=cl>ansible databases -m service -a <span class=s2>&#34;name=mariadb state=started enabled=yes&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 批量初始化 MySQL（比如设置 root 密码，需结合 shell 模块）</span>
</span></span><span class=line><span class=cl>ansible databases -m shell -a <span class=s2>&#34;mysqladmin -u root password &#39;123456&#39;&#34;</span>  <span class=c1># 简单示例，生产环境需更安全的方式</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-高级用法用-playbook-实现自动化任务>3. 高级用法：用 Playbook 实现自动化任务</h4><p>对于复杂的批量操作（如 “部署 Web 服务 + 数据库服务的完整架构”），可以编写 YAML 格式的 Playbook，指定对哪个组执行哪些任务。</p><p><strong>示例：创建一个部署 Web 服务的 Playbook（<code>deploy_web.yml</code>）</strong></p><p>yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>给 webservers 组部署 Nginx 并配置网站</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>webservers </span><span class=w> </span><span class=c># 明确指定对 webservers 组操作</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>安装 Nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>yum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>installed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>启动 Nginx 并设置开机自启</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>started</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>复制自定义首页到所有 Web 服务器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>copy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/index.html </span><span class=w> </span><span class=c># 控制节点上的文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>/usr/share/nginx/html/index.html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=m>0644</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>重启 Nginx 使配置生效</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>restarted</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>执行这个 Playbook，会自动对 <code>webservers</code> 组所有主机执行上述 4 个任务：</p><p>bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible-playbook deploy_web.yml
</span></span></code></pre></td></tr></table></div></div><h3 id=四注意事项>四、注意事项</h3><ol><li><p><strong>组内主机需可用</strong>：如果组内有不可达的主机（如你提到的 <code>192.168.200.200</code>），执行组操作时会提示错误，建议先注释或删除无效主机（加 <code>#</code> 注释）。</p></li><li><p><strong>分组可自定义</strong>：<code>webservers</code> 和 <code>databases</code> 只是示例，你可以根据需求创建其他组，比如 <code>appservers</code>（应用服务器）、<code>monitor</code>（监控服务器）等。</p></li><li><p>组可以嵌套</p><p>：复杂场景下，组可以包含其他组，例如：</p><p>ini</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[webservers]</span>
</span></span><span class=line><span class=cl><span class=na>192.168.200.50</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[databases]</span>
</span></span><span class=line><span class=cl><span class=na>192.168.200.201</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>[all_servers:children]  # 嵌套组，包含上面两个组</span>
</span></span><span class=line><span class=cl><span class=na>webservers</span>
</span></span><span class=line><span class=cl><span class=na>databases</span>
</span></span></code></pre></td></tr></table></div></div><p>之后可以用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ansible all_servers -m ping
</span></span></code></pre></td></tr></table></div></div><p>测试所有服务器。</p></li></ol></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/utility/wireshar/><div class=article-details><h2 class=article-title>Wireshar</h2></div></a></article><article><a href=/utility/tcpdump/><div class=article-details><h2 class=article-title>Tcpdump</h2></div></a></article><article><a href=/utility/jenkins/><div class=article-details><h2 class=article-title>Jenkins</h2></div></a></article><article><a href=/utility/nfs/><div class=article-details><h2 class=article-title>NFS</h2></div></a></article><article><a href=/utility/prometheus-/><div class=article-details><h2 class=article-title>Prometheus</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>