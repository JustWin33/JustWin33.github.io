<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Linux 运维实战手册 (CentOS/Ubuntu 通用版) 一、系统核心命令与资源管理 本节包含系统最基础的信息侦查与存储管理，其中 LVM 管理部分包含了从物理磁盘到逻辑卷挂载的完整闭环操作。\n1.1 系统信息侦查 (System Info) 快速获取系统指纹、负载及内核状态。\n"><title>Linux实战手册</title><link rel=canonical href=http://localhost:1313/linux/centosubuntu%E5%B7%A5%E5%85%B7/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Linux实战手册"><meta property='og:description' content="Linux 运维实战手册 (CentOS/Ubuntu 通用版) 一、系统核心命令与资源管理 本节包含系统最基础的信息侦查与存储管理，其中 LVM 管理部分包含了从物理磁盘到逻辑卷挂载的完整闭环操作。\n1.1 系统信息侦查 (System Info) 快速获取系统指纹、负载及内核状态。\n"><meta property='og:url' content='http://localhost:1313/linux/centosubuntu%E5%B7%A5%E5%85%B7/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Linux'><meta property='article:published_time' content='2025-11-09T00:00:00+00:00'><meta property='article:modified_time' content='2025-11-09T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="Linux实战手册"><meta name=twitter:description content="Linux 运维实战手册 (CentOS/Ubuntu 通用版) 一、系统核心命令与资源管理 本节包含系统最基础的信息侦查与存储管理，其中 LVM 管理部分包含了从物理磁盘到逻辑卷挂载的完整闭环操作。\n1.1 系统信息侦查 (System Info) 快速获取系统指纹、负载及内核状态。\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/kali/><span>kali</span></a></li><li><a href=/ubuntu/><span>ubuntu</span></a></li><li><a href=/utility/><span>Utility</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#一系统核心命令与资源管理>一、系统核心命令与资源管理</a><ol><li><a href=#11-系统信息侦查-system-info>1.1 系统信息侦查 (System Info)</a></li><li><a href=#12-lvm-逻辑卷管理完整全流程>1.2 LVM 逻辑卷管理（完整全流程）</a></li></ol></li><li><a href=#二文件与磁盘高级管理>二、文件与磁盘高级管理</a><ol><li><a href=#21-磁盘清理与分析>2.1 磁盘清理与分析</a></li><li><a href=#22-文件传输技巧>2.2 文件传输技巧</a></li></ol></li><li><a href=#三网络诊断与抓包分析>三、网络诊断与抓包分析</a><ol><li><a href=#31-基础网络诊断>3.1 基础网络诊断</a></li><li><a href=#32-抓包分析-tcpdumpwireshark>3.2 抓包分析 (Tcpdump/Wireshark)</a></li><li><a href=#33-端口与漏洞扫描>3.3 端口与漏洞扫描</a></li></ol></li><li><a href=#四监控与性能分析>四、监控与性能分析</a><ol><li><a href=#41-实时监控工具集>4.1 实时监控工具集</a></li><li><a href=#42-深度性能分析>4.2 深度性能分析</a></li></ol></li><li><a href=#五文本编辑器终极配置>五、文本编辑器终极配置</a><ol><li><a href=#51-vim-运维专用配置>5.1 Vim 运维专用配置</a></li></ol></li><li><a href=#六安全加固与审计>六、安全加固与审计</a><ol><li><a href=#61-入侵防御-fail2ban>6.1 入侵防御 (Fail2ban)</a></li><li><a href=#62-安全扫描>6.2 安全扫描</a></li></ol></li><li><a href=#七自动化运维-ansible>七、自动化运维 (Ansible)</a></li><li><a href=#八终端效率神器>八、终端效率神器</a><ol><li><a href=#81-tmux-终端复用器>8.1 Tmux (终端复用器)</a></li><li><a href=#82-fzf-模糊查找>8.2 Fzf (模糊查找)</a></li></ol></li><li><a href=#九云原生工具集-docker--k8s>九、云原生工具集 (Docker & K8s)</a><ol><li><a href=#91-docker-优化配置>9.1 Docker 优化配置</a></li><li><a href=#92-kubernetes-别名-kubectl>9.2 Kubernetes 别名 (kubectl)</a></li></ol></li><li><a href=#十一键全家桶安装脚本>十、一键全家桶安装脚本</a><ol><li><a href=#101-centos-789-专用脚本>10.1 CentOS 7/8/9 专用脚本</a></li><li><a href=#102-ubuntudebian-专用脚本>10.2 Ubuntu/Debian 专用脚本</a></li></ol></li><li><a href=#十一运维别名库-bashrc>十一、运维别名库 (.bashrc)</a></li><li><a href=#十二应急响应与巡检>十二、应急响应与巡检</a><ol><li><a href=#121-系统被入侵应急脚本>12.1 系统被入侵应急脚本</a></li><li><a href=#122-日常巡检脚本-crontab>12.2 日常巡检脚本 (Crontab)</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/linux/centosubuntu%E5%B7%A5%E5%85%B7/>Linux实战手册</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-11-09</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 8 分钟</time></div></footer></div></header><section class=article-content><h1 id=linux-运维实战手册-centosubuntu-通用版>Linux 运维实战手册 (CentOS/Ubuntu 通用版)</h1><h2 id=一系统核心命令与资源管理>一、系统核心命令与资源管理</h2><p>本节包含系统最基础的信息侦查与存储管理，其中 LVM 管理部分包含了从物理磁盘到逻辑卷挂载的完整闭环操作。</p><h3 id=11-系统信息侦查-system-info>1.1 系统信息侦查 (System Info)</h3><p>快速获取系统指纹、负载及内核状态。</p><p>Bash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 综合信息（推荐）
</span></span><span class=line><span class=cl>hostnamectl                      # 查看内核版本、架构、虚拟化类型 (CentOS 7+/Ubuntu 16.04+)
</span></span><span class=line><span class=cl>cat /etc/os-release              # 查看发行版详细名称 (所有发行版标准)
</span></span><span class=line><span class=cl>lscpu | grep &#34;Model name&#34;        # 查看CPU具体型号
</span></span><span class=line><span class=cl>free -h                          # 查看内存使用情况 (人类可读格式)
</span></span><span class=line><span class=cl>df -hT                           # 查看磁盘挂载点及文件系统类型
</span></span><span class=line><span class=cl>uptime                           # 查看系统运行时间及平均负载
</span></span><span class=line><span class=cl>dmesg | tail -50                 # 查看最近50行内核启动/硬件日志
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 快速诊断别名 (直接复制到终端执行)
</span></span><span class=line><span class=cl>alias sysinfo=&#39;echo &#34;--- CPU ---&#34;; lscpu | grep &#34;Model name&#34;; echo &#34;--- Memory ---&#34;; free -h; echo &#34;--- Disk ---&#34;; df -hT | grep -v tmpfs; echo &#34;--- Network ---&#34;; ip a | grep &#34;inet &#34;; echo &#34;--- Load ---&#34;; uptime&#39;
</span></span></code></pre></td></tr></table></div></div><h3 id=12-lvm-逻辑卷管理完整全流程>1.2 LVM 逻辑卷管理（完整全流程）</h3><p>LVM 允许灵活调整分区大小。以下是从裸磁盘到文件系统的完整步骤。</p><p><strong>操作场景：</strong> 假设有两块新硬盘 <code>/dev/sdb</code> and <code>/dev/sdc</code>。</p><ol><li><p><strong>创建物理卷 (PV - Physical Volume)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pvcreate /dev/sdb /dev/sdc
</span></span><span class=line><span class=cl>pvs  # 验证PV
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>创建卷组 (VG - Volume Group)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 将sdb和sdc加入名为 vg_data 的卷组
</span></span><span class=line><span class=cl>vgcreate vg_data /dev/sdb /dev/sdc
</span></span><span class=line><span class=cl>vgs  # 验证VG
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>创建逻辑卷 (LV - Logical Volume)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 创建固定大小 50G 的LV，命名为 lv_app
</span></span><span class=line><span class=cl>lvcreate -L 50G -n lv_app vg_data
</span></span><span class=line><span class=cl># 将剩余所有空间创建为 lv_backup
</span></span><span class=line><span class=cl>lvcreate -l 100%FREE -n lv_backup vg_data
</span></span><span class=line><span class=cl>lvs  # 验证LV
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>格式化文件系统</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mkfs.xfs /dev/vg_data/lv_app      # CentOS 推荐使用 XFS
</span></span><span class=line><span class=cl>mkfs.ext4 /dev/vg_data/lv_backup  # Ubuntu 推荐使用 EXT4
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>挂载目录</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mkdir /app /backup
</span></span><span class=line><span class=cl>mount /dev/vg_data/lv_app /app
</span></span><span class=line><span class=cl>mount /dev/vg_data/lv_backup /backup
</span></span><span class=line><span class=cl># 注意：永久挂载需编辑 /etc/fstab
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>在线扩容 (无需停机)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 1. 扩容逻辑卷
</span></span><span class=line><span class=cl>lvextend -L +20G /dev/vg_data/lv_app
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 2. 刷新文件系统大小
</span></span><span class=line><span class=cl>xfs_growfs /app                   # 如果是 XFS 格式
</span></span><span class=line><span class=cl># resize2fs /dev/vg_data/lv_app   # 如果是 EXT4 格式
</span></span></code></pre></td></tr></table></div></div></li></ol><hr><h2 id=二文件与磁盘高级管理>二、文件与磁盘高级管理</h2><h3 id=21-磁盘清理与分析>2.1 磁盘清理与分析</h3><p>当磁盘报警时，使用以下命令快速定位问题。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># 快速定位大文件（排除虚拟文件系统）</span>
</span></span><span class=line><span class=cl><span class=n>du</span> <span class=o>-</span><span class=n>ah</span> <span class=o>--</span><span class=nb>max</span><span class=o>-</span><span class=n>depth</span><span class=o>=</span><span class=mi>2</span> <span class=o>/</span><span class=k>var</span> <span class=o>|</span> <span class=n>sort</span> <span class=o>-</span><span class=n>rh</span> <span class=o>|</span> <span class=n>head</span> <span class=o>-</span><span class=mi>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查找大于100M的文件</span>
</span></span><span class=line><span class=cl><span class=n>find</span> <span class=o>/</span> <span class=o>-</span><span class=n>type</span> <span class=n>f</span> <span class=o>-</span><span class=n>size</span> <span class=o>+</span><span class=mi>100</span><span class=n>M</span> <span class=o>-</span><span class=n>exec</span> <span class=n>ls</span> <span class=o>-</span><span class=n>lh</span> <span class=p>{}</span> \<span class=p>;</span> <span class=mi>2</span><span class=o>&gt;/</span><span class=n>dev</span><span class=o>/</span><span class=n>null</span> <span class=o>|</span> <span class=n>head</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查inode耗尽问题（小文件过多导致）</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>-</span><span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 交互式磁盘分析工具 (强力推荐)</span>
</span></span><span class=line><span class=cl><span class=n>yum</span> <span class=n>install</span> <span class=o>-</span><span class=n>y</span> <span class=n>ncdu</span> <span class=o>||</span> <span class=n>apt</span> <span class=n>install</span> <span class=o>-</span><span class=n>y</span> <span class=n>ncdu</span>
</span></span><span class=line><span class=cl><span class=n>ncdu</span> <span class=o>/</span>  <span class=c1># 使用键盘上下键浏览和删除</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自动化清理：删除 /tmp 下7天未访问的文件</span>
</span></span><span class=line><span class=cl><span class=n>find</span> <span class=o>/</span><span class=n>tmp</span> <span class=o>-</span><span class=n>type</span> <span class=n>f</span> <span class=o>-</span><span class=n>atime</span> <span class=o>+</span><span class=mi>7</span> <span class=o>-</span><span class=n>delete</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=22-文件传输技巧>2.2 文件传输技巧</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># rsync 高级同步 (带进度条、断点续传、限速)
</span></span><span class=line><span class=cl># 将本地 /src/ 同步到远程，限速 10MB/s
</span></span><span class=line><span class=cl>rsync -avz --progress --partial --bwlimit=10000 /src/ user@remote:/dst/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># lrzsz (Xshell/SecureCRT 拖拽上传工具)
</span></span><span class=line><span class=cl>yum install -y lrzsz || apt install -y lrzsz
</span></span><span class=line><span class=cl>rz -y           # 弹窗选择文件上传
</span></span><span class=line><span class=cl>sz filename     # 下载文件到本地
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=三网络诊断与抓包分析>三、网络诊断与抓包分析</h2><h3 id=31-基础网络诊断>3.1 基础网络诊断</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 查看已建立的TCP连接
</span></span><span class=line><span class=cl>ss -antp | grep ESTAB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 查看端口占用的进程 (PID)
</span></span><span class=line><span class=cl>lsof -i :8080
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 路由追踪 (MTR 是 traceroute 的增强版，显示丢包率)
</span></span><span class=line><span class=cl>yum install -y mtr || apt install -y mtr-tiny
</span></span><span class=line><span class=cl>mtr -r -c 10 baidu.com
</span></span></code></pre></td></tr></table></div></div><h3 id=32-抓包分析-tcpdumpwireshark>3.2 抓包分析 (Tcpdump/Wireshark)</h3><p>生产环境排查网络问题的利器。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 精确抓包：抓取 eth0 网卡，端口 80 且来源/目标是 192.168.1.100 的包
</span></span><span class=line><span class=cl>tcpdump -i eth0 -w capture.pcap port 80 and host 192.168.1.100
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># SQL审计：抓取 MySQL 流量并过滤 &#34;select&#34; 语句
</span></span><span class=line><span class=cl>tcpdump -A -s0 port 3306 and &#39;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x73656c65&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Tshark (命令行版 Wireshark) - 实时分析 HTTP 请求
</span></span><span class=line><span class=cl># 安装: yum install wireshark / apt install tshark
</span></span><span class=line><span class=cl>tshark -i eth0 -Y &#34;http.request&#34; -T fields -e http.host -e http.request.uri
</span></span></code></pre></td></tr></table></div></div><h3 id=33-端口与漏洞扫描>3.3 端口与漏洞扫描</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 扫描网段存活主机
</span></span><span class=line><span class=cl>nmap -sP 192.168.1.0/24
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 快速全端口扫描
</span></span><span class=line><span class=cl>nmap -sS -p 1-65535 -T4 target_ip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Masscan (超高速扫描，慎用，可能会打挂防火墙)
</span></span><span class=line><span class=cl>masscan 192.168.0.0/16 -p 80,443 --rate=10000
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=四监控与性能分析>四、监控与性能分析</h2><h3 id=41-实时监控工具集>4.1 实时监控工具集</h3><p>这些工具建议全部安装，分别对应不同维度的监控。</p><ul><li><strong>Glances</strong>: 全能系统监控 (CPU/Mem/Disk/Net/Proc)。<ul><li>命令: <code>glances</code> (Web模式: <code>glances -w</code>)</li></ul></li><li><strong>Nethogs</strong>: 查看<strong>哪个进程</strong>在偷跑流量。<ul><li>命令: <code>nethogs -d 5 -v 3</code></li></ul></li><li><strong>Iotop</strong>: 查看<strong>哪个进程</strong>在疯狂读写磁盘。<ul><li>命令: <code>iotop -oP</code></li></ul></li><li><strong>Iftop</strong>: 查看网卡实时的流量来源和去向 IP。<ul><li>命令: <code>iftop -i eth0 -n -P</code></li></ul></li></ul><h3 id=42-深度性能分析>4.2 深度性能分析</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># Strace: 跟踪进程的系统调用 (排查程序卡住、权限错误)</span>
</span></span><span class=line><span class=cl><span class=n>strace</span> <span class=o>-</span><span class=n>c</span> <span class=o>-</span><span class=n>p</span> <span class=n>PID</span>   <span class=c1># 统计系统调用耗时</span>
</span></span><span class=line><span class=cl><span class=n>strace</span> <span class=o>-</span><span class=n>f</span> <span class=o>-</span><span class=n>p</span> <span class=n>PID</span>   <span class=c1># 跟踪进程及其子进程</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Perf: Linux 内核级性能分析</span>
</span></span><span class=line><span class=cl><span class=c1># 安装: yum install perf / apt install linux-tools-common</span>
</span></span><span class=line><span class=cl><span class=n>perf</span> <span class=n>top</span> <span class=o>-</span><span class=n>p</span> <span class=n>PID</span>    <span class=c1># 实时查看函数级热点</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sar: 查看历史性能数据 (sysstat 包)</span>
</span></span><span class=line><span class=cl><span class=n>sar</span> <span class=o>-</span><span class=n>u</span> <span class=mi>1</span> <span class=mi>10</span>        <span class=c1># 查看CPU历史</span>
</span></span><span class=line><span class=cl><span class=n>sar</span> <span class=o>-</span><span class=n>n</span> <span class=n>DEV</span> <span class=mi>1</span> <span class=mi>10</span>    <span class=c1># 查看网络历史</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=五文本编辑器终极配置>五、文本编辑器终极配置</h2><h3 id=51-vim-运维专用配置>5.1 Vim 运维专用配置</h3><p>这是本手册的核心资产之一。它将 Vim 变成了 IDE，支持文件树、Git 状态、代码高亮和智能补全。</p><p><strong>安装步骤：</strong></p><ol><li>安装 Vim：<code>yum install -y vim-enhanced</code> 或 <code>apt install -y vim</code></li><li>复制以下内容并执行：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>cat</span> <span class=o>&gt;</span> <span class=o>~/.</span><span class=n>vimrc</span> <span class=o>&lt;&lt;</span> <span class=s1>&#39;EOF&#39;</span>
</span></span><span class=line><span class=cl><span class=s2>&#34; ==================== 运维专用 Vim 配置 ====================</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>nocompatible</span>
</span></span><span class=line><span class=cl><span class=n>syntax</span> <span class=n>on</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>number</span> <span class=n>relativenumber</span>       <span class=s2>&#34; 显示相对行号</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>cursorline</span> <span class=n>ruler</span> <span class=n>showcmd</span>    <span class=s2>&#34; 高亮当前行，显示状态</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>incsearch</span> <span class=n>hlsearch</span> <span class=n>ignorecase</span> <span class=n>smartcase</span> <span class=s2>&#34; 智能搜索</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>wrap</span> <span class=n>linebreak</span>              <span class=s2>&#34; 自动换行</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>tabstop</span><span class=o>=</span><span class=mi>4</span> <span class=n>shiftwidth</span><span class=o>=</span><span class=mi>4</span> <span class=n>expandtab</span> <span class=n>autoindent</span> <span class=n>smartindent</span> <span class=s2>&#34; 缩进设置</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>mouse</span><span class=o>=</span><span class=n>a</span> <span class=n>clipboard</span><span class=o>=</span><span class=n>unnamedplus</span> <span class=s2>&#34; 启用鼠标和系统剪贴板</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>encoding</span><span class=o>=</span><span class=n>utf</span><span class=o>-</span><span class=mi>8</span> <span class=n>fileencodings</span><span class=o>=</span><span class=n>utf</span><span class=o>-</span><span class=mi>8</span><span class=p>,</span><span class=n>gbk</span><span class=p>,</span><span class=n>gb2312</span><span class=p>,</span><span class=n>gb18030</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>pastetoggle</span><span class=o>=&lt;</span><span class=n>F2</span><span class=o>&gt;</span>            <span class=s2>&#34; F2 切换粘贴模式（防止缩进错乱）</span>
</span></span><span class=line><span class=cl><span class=n>set</span> <span class=n>listchars</span><span class=o>=</span><span class=n>tab</span><span class=p>:</span><span class=o>&gt;-</span><span class=p>,</span><span class=n>trail</span><span class=p>:</span><span class=err>·</span><span class=p>,</span><span class=n>space</span><span class=p>:</span><span class=err>·</span> <span class=s2>&#34; 显示不可见字符</span>
</span></span><span class=line><span class=cl><span class=n>nnoremap</span> <span class=o>&lt;</span><span class=n>F3</span><span class=o>&gt;</span> <span class=p>:</span><span class=n>set</span> <span class=n>list</span><span class=o>!&lt;</span><span class=n>cr</span><span class=o>&gt;</span>    <span class=s2>&#34; F3 开关特殊字符显示</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34; 快速编辑/重载 vimrc</span>
</span></span><span class=line><span class=cl><span class=n>nnoremap</span> <span class=o>&lt;</span><span class=n>leader</span><span class=o>&gt;</span><span class=n>ev</span> <span class=p>:</span><span class=n>vsplit</span> <span class=o>$</span><span class=n>MYVIMRC</span><span class=o>&lt;</span><span class=n>cr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>nnoremap</span> <span class=o>&lt;</span><span class=n>leader</span><span class=o>&gt;</span><span class=n>sv</span> <span class=p>:</span><span class=n>source</span> <span class=o>$</span><span class=n>MYVIMRC</span><span class=o>&lt;</span><span class=n>cr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34; --- 插件管理 (Vim-Plug) ---</span>
</span></span><span class=line><span class=cl><span class=s2>&#34; 首次运行需执行: curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span>
</span></span><span class=line><span class=cl><span class=n>call</span> <span class=n>plug</span><span class=c1>#begin(&#39;~/.vim/plugged&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;preservim/nerdtree&#39;</span>           <span class=s2>&#34; 文件树 (&lt;F5&gt; 开关)</span>
</span></span><span class=line><span class=cl><span class=n>nnoremap</span> <span class=o>&lt;</span><span class=n>F5</span><span class=o>&gt;</span> <span class=p>:</span><span class=n>NERDTreeToggle</span><span class=o>&lt;</span><span class=n>cr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>let</span> <span class=n>NERDTreeShowHidden</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;vim-airline/vim-airline&#39;</span>      <span class=s2>&#34; 状态栏</span>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;vim-airline/vim-airline-themes&#39;</span>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;tpope/vim-fugitive&#39;</span>           <span class=s2>&#34; Git 集成</span>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;luochen1990/rainbow&#39;</span>          <span class=s2>&#34; 彩虹括号</span>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;MTDL9/vim-log-highlighting&#39;</span>   <span class=s2>&#34; 日志文件高亮</span>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;andrewstuart/vim-kubernetes&#39;</span>  <span class=s2>&#34; K8s yaml 支持</span>
</span></span><span class=line><span class=cl><span class=n>Plug</span> <span class=s1>&#39;Yggdroot/indentLine&#39;</span>          <span class=s2>&#34; 缩进参考线</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>call</span> <span class=n>plug</span><span class=c1>#end()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34; --- 特定文件优化 ---</span>
</span></span><span class=line><span class=cl><span class=s2>&#34; YAML 自动2空格缩进 (Ansible/K8s 必备)</span>
</span></span><span class=line><span class=cl><span class=n>autocmd</span> <span class=n>FileType</span> <span class=n>yaml</span> <span class=n>setlocal</span> <span class=n>ts</span><span class=o>=</span><span class=mi>2</span> <span class=n>sts</span><span class=o>=</span><span class=mi>2</span> <span class=n>sw</span><span class=o>=</span><span class=mi>2</span> <span class=n>expandtab</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34; 大文件性能优化 (&gt;10MB 关闭高亮和语法)</span>
</span></span><span class=line><span class=cl><span class=n>let</span> <span class=n>g</span><span class=p>:</span><span class=n>LargeFile</span><span class=o>=</span><span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=n>autocmd</span> <span class=n>BufReadPre</span> <span class=o>*</span> <span class=n>let</span> <span class=n>f</span><span class=o>=</span><span class=n>getfsize</span><span class=p>(</span><span class=n>expand</span><span class=p>(</span><span class=s1>&#39;%&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>autocmd</span> <span class=n>BufReadPre</span> <span class=o>*</span> <span class=k>if</span> <span class=n>f</span> <span class=o>&gt;</span> <span class=n>g</span><span class=p>:</span><span class=n>LargeFile</span><span class=o>*</span><span class=mi>1024</span><span class=o>*</span><span class=mi>1024</span> <span class=o>|</span> <span class=n>set</span> <span class=n>eventignore</span><span class=o>+=</span><span class=n>FileType</span> <span class=o>|</span> <span class=n>set</span> <span class=n>syntax</span><span class=o>=</span><span class=n>OFF</span> <span class=o>|</span> <span class=n>set</span> <span class=n>filetype</span><span class=o>=</span><span class=n>conf</span> <span class=o>|</span> <span class=n>endif</span>
</span></span><span class=line><span class=cl><span class=n>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p><em>注：配置生效需联网并在 Vim 中运行 <code>:PlugInstall</code></em></p><hr><h2 id=六安全加固与审计>六、安全加固与审计</h2><h3 id=61-入侵防御-fail2ban>6.1 入侵防御 (Fail2ban)</h3><p>自动封禁多次 SSH 密码错误的 IP。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># 1. 安装</span>
</span></span><span class=line><span class=cl><span class=n>yum</span> <span class=n>install</span> <span class=o>-</span><span class=n>y</span> <span class=n>fail2ban</span> <span class=o>||</span> <span class=n>apt</span> <span class=n>install</span> <span class=o>-</span><span class=n>y</span> <span class=n>fail2ban</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 配置 (/etc/fail2ban/jail.local)</span>
</span></span><span class=line><span class=cl><span class=n>cat</span> <span class=o>&gt;</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>fail2ban</span><span class=o>/</span><span class=n>jail</span><span class=o>.</span><span class=n>local</span> <span class=o>&lt;&lt;</span> <span class=n>EOF</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>sshd</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>enabled</span> <span class=o>=</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl><span class=n>port</span> <span class=o>=</span> <span class=mi>22</span>
</span></span><span class=line><span class=cl><span class=n>filter</span> <span class=o>=</span> <span class=n>sshd</span>
</span></span><span class=line><span class=cl><span class=c1># CentOS日志路径: /var/log/secure, Ubuntu: /var/log/auth.log</span>
</span></span><span class=line><span class=cl><span class=n>logpath</span> <span class=o>=</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>secure</span>
</span></span><span class=line><span class=cl><span class=n>maxretry</span> <span class=o>=</span> <span class=mi>3</span>        <span class=c1># 尝试3次失败即封禁</span>
</span></span><span class=line><span class=cl><span class=n>bantime</span> <span class=o>=</span> <span class=mi>3600</span>      <span class=c1># 封禁1小时</span>
</span></span><span class=line><span class=cl><span class=n>findtime</span> <span class=o>=</span> <span class=mi>600</span>      <span class=c1># 统计10分钟内的失败次数</span>
</span></span><span class=line><span class=cl><span class=n>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 启动</span>
</span></span><span class=line><span class=cl><span class=n>systemctl</span> <span class=n>enable</span> <span class=o>--</span><span class=n>now</span> <span class=n>fail2ban</span>
</span></span><span class=line><span class=cl><span class=n>fail2ban</span><span class=o>-</span><span class=n>client</span> <span class=n>status</span> <span class=n>sshd</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=62-安全扫描>6.2 安全扫描</h3><ul><li><strong>Lynis</strong>: <code>lynis audit system --quick</code> (系统安全全面体检)</li><li><strong>Rootkit检查</strong>: <code>rkhunter --check --sk</code></li><li><strong>病毒扫描</strong>: <code>clamscan -r /var/www</code></li></ul><hr><h2 id=七自动化运维-ansible>七、自动化运维 (Ansible)</h2><p>无需 Agent，通过 SSH 管理多台主机。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 1. 安装 Ansible
</span></span><span class=line><span class=cl>pip3 install ansible --user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 2. 基础配置 (~/.ansible.cfg) - 关闭HostKey检查以提高速度
</span></span><span class=line><span class=cl>cat &gt; ~/.ansible.cfg &lt;&lt; EOF
</span></span><span class=line><span class=cl>[defaults]
</span></span><span class=line><span class=cl>host_key_checking = False
</span></span><span class=line><span class=cl>inventory = ./hosts
</span></span><span class=line><span class=cl>forks = 50
</span></span><span class=line><span class=cl>[privilege_escalation]
</span></span><span class=line><span class=cl>become = True
</span></span><span class=line><span class=cl>become_method = sudo
</span></span><span class=line><span class=cl>become_user = root
</span></span><span class=line><span class=cl>EOF
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 3. 主机清单 (hosts)
</span></span><span class=line><span class=cl>cat &gt; hosts &lt;&lt; EOF
</span></span><span class=line><span class=cl>[web]
</span></span><span class=line><span class=cl>web01.example.com
</span></span><span class=line><span class=cl>web02.example.com
</span></span><span class=line><span class=cl>EOF
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 4. 测试命令
</span></span><span class=line><span class=cl>ansible all -m ping
</span></span><span class=line><span class=cl>ansible web -m shell -a &#34;uptime&#34;
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=八终端效率神器>八、终端效率神器</h2><h3 id=81-tmux-终端复用器>8.1 Tmux (终端复用器)</h3><p>运维必备，防止 SSH 断开导致任务中断。</p><p><strong>终极配置 (~/.tmux.conf):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 将前缀键修改为 Ctrl+A (同 Screen 习惯)
</span></span><span class=line><span class=cl>unbind C-b
</span></span><span class=line><span class=cl>set -g prefix C-a
</span></span><span class=line><span class=cl>bind C-a send-prefix
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>set -g mouse on                 # 开启鼠标支持 (点击切换窗口，拖拽调整大小)
</span></span><span class=line><span class=cl>set -g status-right &#34;%Y-%m-%d %H:%M&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 快捷分屏
</span></span><span class=line><span class=cl>bind % split-window -h -c &#34;#{pane_current_path}&#34;  # 左右分屏
</span></span><span class=line><span class=cl>bind &#39;&#34;&#39; split-window -v -c &#34;#{pane_current_path}&#34; # 上下分屏
</span></span></code></pre></td></tr></table></div></div><p><strong>常用操作:</strong></p><ul><li><code>tmux new -s name</code>: 新建会话</li><li><code>Ctrl+A</code> 然后 <code>d</code>: 暂时离开会话 (任务后台继续运行)</li><li><code>tmux attach -t name</code>: 回到会话</li></ul><h3 id=82-fzf-模糊查找>8.2 Fzf (模糊查找)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 历史记录搜索增强
</span></span><span class=line><span class=cl>history | fzf
</span></span><span class=line><span class=cl># 文件快速查找
</span></span><span class=line><span class=cl>find . -type f | fzf
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=九云原生工具集-docker--k8s>九、云原生工具集 (Docker & K8s)</h2><h3 id=91-docker-优化配置>9.1 Docker 优化配置</h3><p>安装后配置国内镜像源及日志轮转（防止日志撑爆磁盘）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cat &gt; /etc/docker/daemon.json &lt;&lt; EOF
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;registry-mirrors&#34;: [&#34;https://mirror.gcr.io&#34;],
</span></span><span class=line><span class=cl>  &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span><span class=line><span class=cl>  &#34;log-opts&#34;: {
</span></span><span class=line><span class=cl>    &#34;max-size&#34;: &#34;100m&#34;,
</span></span><span class=line><span class=cl>    &#34;max-file&#34;: &#34;3&#34;
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>EOF
</span></span></code></pre></td></tr></table></div></div><h3 id=92-kubernetes-别名-kubectl>9.2 Kubernetes 别名 (kubectl)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>alias k=&#39;kubectl&#39;
</span></span><span class=line><span class=cl>alias kg=&#39;kubectl get&#39;
</span></span><span class=line><span class=cl>alias kd=&#39;kubectl describe&#39;
</span></span><span class=line><span class=cl>alias ke=&#39;kubectl exec -it&#39;
</span></span><span class=line><span class=cl>alias klog=&#39;kubectl logs -f&#39;
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十一键全家桶安装脚本>十、一键全家桶安装脚本</h2><p>请直接在服务器上以 root 身份运行以下脚本，即可安装上述所有工具。</p><h3 id=101-centos-789-专用脚本>10.1 CentOS 7/8/9 专用脚本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; install_ops_tools_centos.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>set -e
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 1: 安装 EPEL 源&#34;
</span></span></span><span class=line><span class=cl><span class=s>yum install -y epel-release
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 2: 安装基础系统工具&#34;
</span></span></span><span class=line><span class=cl><span class=s>yum install -y vim htop iotop iftop nethogs glances git telnet net-tools bind-utils traceroute mtr nc tcpdump nmap lsof strace ltrace sysstat dstat bash-completion chrony unzip zip psmisc screen tmux expect pv jq python3-pip ncdu tree smartmontools ipmitool dmidecode
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 3: 安装 Docker&#34;
</span></span></span><span class=line><span class=cl><span class=s>curl -fsSL https://get.docker.com | bash
</span></span></span><span class=line><span class=cl><span class=s>systemctl enable --now docker
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 4: 安装 Python 运维工具&#34;
</span></span></span><span class=line><span class=cl><span class=s>pip3 install --user mycli pgcli ansible yq thefuck
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 5: 配置 Vim 插件管理器&#34;
</span></span></span><span class=line><span class=cl><span class=s>curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; 安装完成！请记得运行 source ~/.bashrc 加载配置&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>chmod +x install_ops_tools_centos.sh
</span></span></code></pre></td></tr></table></div></div><h3 id=102-ubuntudebian-专用脚本>10.2 Ubuntu/Debian 专用脚本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; install_ops_tools_ubuntu.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>set -e
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 1: 更新软件源&#34;
</span></span></span><span class=line><span class=cl><span class=s>apt update
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 2: 安装基础系统工具&#34;
</span></span></span><span class=line><span class=cl><span class=s>apt install -y vim htop iotop iftop nethogs glances git telnet net-tools dnsutils traceroute mtr netcat-openbsd tcpdump nmap lsof strace ltrace sysstat dstat bash-completion chrony unzip zip psmisc screen tmux expect pv jq python3-pip ncdu tree smartmontools ipmitool dmidecode
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 3: 安装 Docker&#34;
</span></span></span><span class=line><span class=cl><span class=s>curl -fsSL https://get.docker.com | bash
</span></span></span><span class=line><span class=cl><span class=s>systemctl enable --now docker
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 4: 安装 Python 运维工具&#34;
</span></span></span><span class=line><span class=cl><span class=s>pip3 install --user mycli pgcli ansible yq thefuck
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; Step 5: 配置 Vim 插件管理器&#34;
</span></span></span><span class=line><span class=cl><span class=s>curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;&gt;&gt;&gt; 安装完成！请记得运行 source ~/.bashrc 加载配置&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>chmod +x install_ops_tools_ubuntu.sh
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十一运维别名库-bashrc>十一、运维别名库 (.bashrc)</h2><p>将以下内容追加到 <code>~/.bashrc</code>，可极大幅度提升工作效率。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># === 复制以下内容到 .bashrc 底部 ===</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. 实用信息别名</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>ports</span><span class=o>=</span><span class=s1>&#39;ss -tuln | grep LISTEN&#39;</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>bigfiles</span><span class=o>=</span><span class=s1>&#39;find / -type f -size +100M -exec ls -lh {} \; 2&gt;/dev/null | head -20&#39;</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>iplist</span><span class=o>=</span><span class=s1>&#39;ip a | grep &#34;inet &#34; | awk </span><span class=se>\&#39;</span><span class=s1>{print $2}</span><span class=se>\&#39;</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. Docker 快捷指令</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>dps</span><span class=o>=</span><span class=s1>&#39;docker ps --format &#34;table {{.ID}}</span><span class=se>\t</span><span class=s1>{{.Names}}</span><span class=se>\t</span><span class=s1>{{.Status}}</span><span class=se>\t</span><span class=s1>{{.Ports}}&#34;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>dsa</span><span class=o>=</span><span class=s1>&#39;docker stop $(docker ps -aq)&#39;</span>  <span class=c1># 停止所有容器</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>drma</span><span class=o>=</span><span class=s1>&#39;docker rm $(docker ps -aq)&#39;</span>   <span class=c1># 删除所有容器</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>dcl</span><span class=o>=</span><span class=s1>&#39;docker system prune -a&#39;</span>        <span class=c1># 清理所有未使用镜像和缓存</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 安全与历史记录</span>
</span></span><span class=line><span class=cl><span class=n>alias</span> <span class=n>rm</span><span class=o>=</span><span class=s1>&#39;rm -i&#39;</span> <span class=c1># 删除前必须确认</span>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>HISTTIMEFORMAT</span><span class=o>=</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S &#34;</span> <span class=c1># 历史记录带时间戳</span>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>HISTSIZE</span><span class=o>=</span><span class=mi>10000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 万能解压函数 (输入 extract 文件名 即可解压任何格式)</span>
</span></span><span class=line><span class=cl><span class=n>extract</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>[</span> <span class=o>-</span><span class=n>f</span> <span class=o>$</span><span class=mi>1</span> <span class=p>];</span> <span class=n>then</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=o>$</span><span class=mi>1</span> <span class=ow>in</span>
</span></span><span class=line><span class=cl>            <span class=o>*.</span><span class=n>tar</span><span class=o>.</span><span class=n>bz2</span><span class=p>)</span> <span class=n>tar</span> <span class=n>xjf</span> <span class=o>$</span><span class=mi>1</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>            <span class=o>*.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span><span class=p>)</span>  <span class=n>tar</span> <span class=n>xzf</span> <span class=o>$</span><span class=mi>1</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>            <span class=o>*.</span><span class=n>rar</span><span class=p>)</span>     <span class=n>unrar</span> <span class=n>x</span> <span class=o>$</span><span class=mi>1</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>            <span class=o>*.</span><span class=n>gz</span><span class=p>)</span>      <span class=n>gunzip</span> <span class=o>$</span><span class=mi>1</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>            <span class=o>*.</span><span class=n>tar</span><span class=p>)</span>     <span class=n>tar</span> <span class=n>xf</span> <span class=o>$</span><span class=mi>1</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>            <span class=o>*.</span><span class=n>zip</span><span class=p>)</span>     <span class=n>unzip</span> <span class=o>$</span><span class=mi>1</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>            <span class=o>*</span><span class=p>)</span>         <span class=n>echo</span> <span class=s2>&#34;&#39;$1&#39; cannot be extracted via extract()&#34;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>        <span class=n>esac</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=n>echo</span> <span class=s2>&#34;&#39;$1&#39; is not a valid file&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>fi</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十二应急响应与巡检>十二、应急响应与巡检</h2><h3 id=121-系统被入侵应急脚本>12.1 系统被入侵应急脚本</h3><p>当怀疑服务器被黑时，运行此脚本保存现场证据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># incident_response.sh</span>
</span></span><span class=line><span class=cl>mkdir -p /tmp/incident_<span class=k>$(</span>date +%Y%m%d<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /tmp/incident_<span class=k>$(</span>date +%Y%m%d<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&gt;&gt;&gt; 保存进程与网络状态...&#34;</span>
</span></span><span class=line><span class=cl>ps aux &gt; ps.aux.txt
</span></span><span class=line><span class=cl>netstat -tulpn &gt; netstat.tulpn.txt
</span></span><span class=line><span class=cl>ss -antp &gt; ss.antp.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&gt;&gt;&gt; 保存登录日志...&#34;</span>
</span></span><span class=line><span class=cl>last &gt; last.txt
</span></span><span class=line><span class=cl>cp /var/log/secure . 2&gt;/dev/null
</span></span><span class=line><span class=cl>cp /var/log/auth.log . 2&gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&gt;&gt;&gt; 查找高资源消耗进程...&#34;</span>
</span></span><span class=line><span class=cl>ps aux <span class=p>|</span> awk <span class=s1>&#39;$3 &gt; 50 {print $0}&#39;</span> &gt; high_cpu.txt <span class=c1># CPU &gt; 50%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&gt;&gt;&gt; 查找所有可执行的临时文件 (常见木马特征)...&#34;</span>
</span></span><span class=line><span class=cl>find /tmp /var/tmp -type f -executable -exec ls -lh <span class=o>{}</span> <span class=se>\;</span> &gt; suspicious_files.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;现场数据已保存至当前目录&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=122-日常巡检脚本-crontab>12.2 日常巡检脚本 (Crontab)</h3><p>部署该脚本到 Crontab (<code>0 8 * * *</code>)，每天早上8点发送报告。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># daily_check.sh</span>
</span></span><span class=line><span class=cl><span class=nv>REPORT</span><span class=o>=</span><span class=s2>&#34;/tmp/daily_report_</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>_</span><span class=k>$(</span>date +%Y%m%d<span class=k>)</span><span class=s2>.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;=== </span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2> 日常巡检 ===&#34;</span> &gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>uptime &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- 磁盘使用 ---&#34;</span> &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>df -hT &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- 异常登录 ---&#34;</span> &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;Failed password&#34;</span> /var/log/secure 2&gt;/dev/null <span class=p>|</span> tail -10 &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- 服务状态 (Failed) ---&#34;</span> &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>systemctl list-units --state<span class=o>=</span>failed --no-pager &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果配置了邮件服务，取消下面注释</span>
</span></span><span class=line><span class=cl><span class=c1># mail -s &#34;Daily Report: $(hostname)&#34; ops@company.com &lt; $REPORT</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/utility/wireshar/><div class=article-details><h2 class=article-title>Wireshar</h2></div></a></article><article><a href=/utility/tcpdump/><div class=article-details><h2 class=article-title>Tcpdump</h2></div></a></article><article><a href=/utility/ansible/><div class=article-details><h2 class=article-title>Ansible</h2></div></a></article><article><a href=/utility/jenkins/><div class=article-details><h2 class=article-title>Jenkins</h2></div></a></article><article><a href=/utility/nfs/><div class=article-details><h2 class=article-title>NFS</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>