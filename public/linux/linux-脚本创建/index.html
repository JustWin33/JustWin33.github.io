<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Linux 脚本创建 一、脚本创建全流程详解 1.1 创建脚本的标准步骤 根据搜索结果，创建一个可执行的 Linux 脚本需要以下完整流程：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 步骤1：创建文件 nano myscript.sh # 步骤2：添加 Shebang 行（必须为第一行） #!/bin/bash # 步骤3：编写脚本代码 echo "Hello, World!" # 步骤4：保存并退出 # (nano中按 Ctrl+O 保存，Ctrl+X 退出) # 步骤5：添加执行权限 chmod +x myscript.sh # 步骤6：执行脚本 ./myscript.sh 二、文本编辑器完全指南 2.1 主流编辑器对比与详细操作 Vim 编辑器（高级用户首选） 1 2 # 创建并打开脚本文件 vim myscript.sh 详细操作流程：\n'><title>Linux脚本创建</title><link rel=canonical href=http://localhost:1313/linux/linux-%E8%84%9A%E6%9C%AC%E5%88%9B%E5%BB%BA/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Linux脚本创建"><meta property='og:description' content='Linux 脚本创建 一、脚本创建全流程详解 1.1 创建脚本的标准步骤 根据搜索结果，创建一个可执行的 Linux 脚本需要以下完整流程：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 步骤1：创建文件 nano myscript.sh # 步骤2：添加 Shebang 行（必须为第一行） #!/bin/bash # 步骤3：编写脚本代码 echo "Hello, World!" # 步骤4：保存并退出 # (nano中按 Ctrl+O 保存，Ctrl+X 退出) # 步骤5：添加执行权限 chmod +x myscript.sh # 步骤6：执行脚本 ./myscript.sh 二、文本编辑器完全指南 2.1 主流编辑器对比与详细操作 Vim 编辑器（高级用户首选） 1 2 # 创建并打开脚本文件 vim myscript.sh 详细操作流程：\n'><meta property='og:url' content='http://localhost:1313/linux/linux-%E8%84%9A%E6%9C%AC%E5%88%9B%E5%BB%BA/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Linux'><meta property='article:published_time' content='2025-11-06T00:00:00+00:00'><meta property='article:modified_time' content='2025-11-06T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="Linux脚本创建"><meta name=twitter:description content='Linux 脚本创建 一、脚本创建全流程详解 1.1 创建脚本的标准步骤 根据搜索结果，创建一个可执行的 Linux 脚本需要以下完整流程：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 步骤1：创建文件 nano myscript.sh # 步骤2：添加 Shebang 行（必须为第一行） #!/bin/bash # 步骤3：编写脚本代码 echo "Hello, World!" # 步骤4：保存并退出 # (nano中按 Ctrl+O 保存，Ctrl+X 退出) # 步骤5：添加执行权限 chmod +x myscript.sh # 步骤6：执行脚本 ./myscript.sh 二、文本编辑器完全指南 2.1 主流编辑器对比与详细操作 Vim 编辑器（高级用户首选） 1 2 # 创建并打开脚本文件 vim myscript.sh 详细操作流程：\n'><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#一脚本创建全流程详解>一、脚本创建全流程详解</a><ol><li><a href=#11-创建脚本的标准步骤>1.1 创建脚本的标准步骤</a></li></ol></li><li><a href=#二文本编辑器完全指南>二、文本编辑器完全指南</a><ol><li><a href=#21-主流编辑器对比与详细操作>2.1 主流编辑器对比与详细操作</a><ol><li><a href=#vim-编辑器高级用户首选><strong>Vim 编辑器（高级用户首选）</strong></a></li><li><a href=#nano-编辑器新手友好><strong>Nano 编辑器（新手友好）</strong></a></li><li><a href=#gedit-图形界面编辑器><strong>Gedit 图形界面编辑器</strong></a></li><li><a href=#vs-code-远程开发现代推荐><strong>VS Code 远程开发（现代推荐）</strong></a></li></ol></li><li><a href=#22-批量创建脚本模板>2.2 批量创建脚本模板</a></li></ol></li><li><a href=#三脚本核心要素详解>三、脚本核心要素详解</a><ol><li><a href=#31-shebang-行深度解析>3.1 Shebang 行深度解析</a></li><li><a href=#32-脚本标准结构模板>3.2 脚本标准结构模板</a></li></ol></li><li><a href=#四脚本编写核心要素>四、脚本编写核心要素</a><ol><li><a href=#41-变量定义与使用>4.1 变量定义与使用</a><ol><li><a href=#变量命名规则><strong>变量命名规则</strong>：</a></li><li><a href=#变量定义方式><strong>变量定义方式</strong>：</a></li><li><a href=#特殊变量><strong>特殊变量</strong>：</a></li></ol></li><li><a href=#42-参数处理高级技巧>4.2 参数处理高级技巧</a></li><li><a href=#43-条件判断与测试>4.3 条件判断与测试</a><ol><li><a href=#if-语句><strong>if 语句</strong>：</a></li><li><a href=#case-语句><strong>case 语句</strong>：</a></li></ol></li><li><a href=#44-循环结构>4.4 循环结构</a><ol><li><a href=#for-循环><strong>for 循环</strong>：</a></li><li><a href=#while-循环><strong>while 循环</strong>：</a></li></ol></li><li><a href=#45-函数定义与使用>4.5 函数定义与使用</a></li></ol></li><li><a href=#五高级技巧与最佳实践>五、高级技巧与最佳实践</a><ol><li><a href=#51-错误处理机制>5.1 错误处理机制</a></li><li><a href=#52-调试技巧大全>5.2 调试技巧大全</a></li><li><a href=#53-代码规范与风格>5.3 代码规范与风格</a></li></ol></li><li><a href=#六实用开发工具链>六、实用开发工具链</a><ol><li><a href=#61-shellcheck-代码检查>6.1 ShellCheck 代码检查</a></li><li><a href=#62-bash-自动补全>6.2 Bash 自动补全</a></li><li><a href=#63-日志记录框架>6.3 日志记录框架</a></li></ol></li><li><a href=#七实战案例库>七、实战案例库</a><ol><li><a href=#71-系统巡检脚本>7.1 系统巡检脚本</a></li><li><a href=#72-自动化备份脚本带版本控制>7.2 自动化备份脚本（带版本控制）</a></li><li><a href=#73-nginx-日志分析脚本>7.3 Nginx 日志分析脚本</a></li><li><a href=#74-安全初始化脚本centos>7.4 安全初始化脚本（CentOS）</a></li></ol></li><li><a href=#八开发工作流建议>八、开发工作流建议</a><ol><li><a href=#81-版本控制>8.1 版本控制</a></li><li><a href=#82-测试框架>8.2 测试框架</a></li><li><a href=#83-持续集成>8.3 持续集成</a></li></ol></li><li><a href=#九总结与资源>九、总结与资源</a><ol><li><a href=#91-学习路径建议>9.1 学习路径建议</a></li><li><a href=#92-必备资源>9.2 必备资源</a></li><li><a href=#93-快速参考卡>9.3 快速参考卡</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/linux/linux-%E8%84%9A%E6%9C%AC%E5%88%9B%E5%BB%BA/>Linux脚本创建</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-11-06</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 15 分钟</time></div></footer></div></header><section class=article-content><h1 id=linux-脚本创建>Linux 脚本创建</h1><h2 id=一脚本创建全流程详解>一、脚本创建全流程详解</h2><h3 id=11-创建脚本的标准步骤>1.1 创建脚本的标准步骤</h3><p>根据搜索结果，创建一个可执行的 Linux 脚本需要以下完整流程：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 步骤1：创建文件</span>
</span></span><span class=line><span class=cl>nano myscript.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 步骤2：添加 Shebang 行（必须为第一行）</span>
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 步骤3：编写脚本代码</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Hello, World!&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 步骤4：保存并退出</span>
</span></span><span class=line><span class=cl><span class=c1># (nano中按 Ctrl+O 保存，Ctrl+X 退出)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 步骤5：添加执行权限</span>
</span></span><span class=line><span class=cl>chmod +x myscript.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 步骤6：执行脚本</span>
</span></span><span class=line><span class=cl>./myscript.sh
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=二文本编辑器完全指南>二、文本编辑器完全指南</h2><h3 id=21-主流编辑器对比与详细操作>2.1 主流编辑器对比与详细操作</h3><h4 id=vim-编辑器高级用户首选><strong>Vim 编辑器（高级用户首选）</strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建并打开脚本文件</span>
</span></span><span class=line><span class=cl>vim myscript.sh
</span></span></code></pre></td></tr></table></div></div><p><strong>详细操作流程</strong>：</p><ol><li>按 <code>i</code> 进入插入模式</li><li>输入脚本内容</li><li>按 <code>Esc</code> 退出插入模式</li><li>输入 <code>:w</code> 保存文件</li><li>输入 <code>:q</code> 退出vim</li><li>或者组合使用 <code>:wq</code> 保存并退出</li><li>如需强制退出不保存：<code>:q!</code></li></ol><p><strong>Vim 配置优化（智能脚本编写）</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在 ~/.vimrc 文件中添加以下配置</span>
</span></span><span class=line><span class=cl>syntax on           <span class=s2>&#34; 开启语法高亮
</span></span></span><span class=line><span class=cl><span class=s2>set number          &#34;</span> 显示行号
</span></span><span class=line><span class=cl><span class=nb>set</span> <span class=nv>tabstop</span><span class=o>=</span><span class=m>4</span>       <span class=s2>&#34; 设置制表符宽度
</span></span></span><span class=line><span class=cl><span class=s2>set autoindent      &#34;</span> 自动缩进
</span></span><span class=line><span class=cl><span class=nb>set</span> expandtab       <span class=s2>&#34; 将制表符转换为空格
</span></span></span></code></pre></td></tr></table></div></div><p><strong>Vim 插件推荐</strong>：</p><ul><li><strong>vim-bash-support</strong>：提供 Bash 语法补全、代码片段</li><li><strong>syntastic</strong>：语法检查</li><li><strong>NERDTree</strong>：文件浏览器</li></ul><hr><h4 id=nano-编辑器新手友好><strong>Nano 编辑器（新手友好）</strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建并打开脚本文件</span>
</span></span><span class=line><span class=cl>nano myscript.sh
</span></span></code></pre></td></tr></table></div></div><p><strong>操作快捷键</strong>：</p><ul><li><code>Ctrl+O</code>：保存文件（按 Enter 确认）</li><li><code>Ctrl+X</code>：退出编辑器</li><li><code>Ctrl+K</code>：剪切当前行</li><li><code>Ctrl+U</code>：粘贴</li><li><code>Alt+A</code>：标记文本块</li><li><code>Ctrl+W</code>：搜索文本</li><li><code>Alt+U</code>：撤销操作</li></ul><p><strong>Nano 配置优化</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 编辑 /etc/nanorc 或 ~/.nanorc</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> const            <span class=s2>&#34; 持续显示光标位置
</span></span></span><span class=line><span class=cl><span class=s2>set tabsize 4        &#34;</span> 设置制表符宽度
</span></span><span class=line><span class=cl><span class=nb>set</span> autoindent       <span class=s2>&#34; 自动缩进
</span></span></span><span class=line><span class=cl><span class=s2>include /usr/share/nano/sh.nanorc  &#34;</span> 加载 Bash 语法高亮
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=gedit-图形界面编辑器><strong>Gedit 图形界面编辑器</strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在桌面环境下使用</span>
</span></span><span class=line><span class=cl>gedit myscript.sh <span class=p>&amp;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>特点</strong>：</p><ul><li>支持语法高亮、自动缩进</li><li>支持插件扩展</li><li>适合不熟悉命令行的用户</li></ul><hr><h4 id=vs-code-远程开发现代推荐><strong>VS Code 远程开发（现代推荐）</strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 安装 VS Code 和 Remote-SSH 插件</span>
</span></span><span class=line><span class=cl><span class=c1># 通过 SSH 直接编辑远程服务器脚本</span>
</span></span><span class=line><span class=cl>code --remote<span class=o>=</span>ssh-remote+user@host /path/to/script.sh
</span></span></code></pre></td></tr></table></div></div><p><strong>优势</strong>：</p><ul><li>强大的 IntelliSense 自动补全</li><li>集成终端和调试器</li><li>Git 版本控制集成</li></ul><hr><h3 id=22-批量创建脚本模板>2.2 批量创建脚本模板</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 方法1：使用 cat 创建简单脚本</span>
</span></span><span class=line><span class=cl>cat &gt; myscript.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s># Description: 脚本描述
</span></span></span><span class=line><span class=cl><span class=s># Author: 你的名字
</span></span></span><span class=line><span class=cl><span class=s># Date: $(date +%Y-%m-%d)
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;这是一个快速创建的脚本&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法2：使用 heredoc 创建多行脚本</span>
</span></span><span class=line><span class=cl>cat &gt; backup.sh <span class=s>&lt;&lt; &#39;SCRIPT&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s># 自动备份脚本
</span></span></span><span class=line><span class=cl><span class=s>set -euo pipefail
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>SOURCE_DIR=&#34;/data&#34;
</span></span></span><span class=line><span class=cl><span class=s>BACKUP_DIR=&#34;/backup/$(date +%Y%m%d_%H%M%S)&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;[$(date)] 开始备份...&#34;
</span></span></span><span class=line><span class=cl><span class=s>mkdir -p &#34;$BACKUP_DIR&#34;
</span></span></span><span class=line><span class=cl><span class=s>cp -r &#34;$SOURCE_DIR&#34;/* &#34;$BACKUP_DIR&#34;/
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;[$(date)] 备份完成: $BACKUP_DIR&#34;
</span></span></span><span class=line><span class=cl><span class=s>SCRIPT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法3：使用 install 命令自动创建并设置权限</span>
</span></span><span class=line><span class=cl>install -m <span class=m>755</span> /dev/null myscript.sh
</span></span><span class=line><span class=cl><span class=c1># 然后编辑文件</span>
</span></span><span class=line><span class=cl>vim myscript.sh
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=三脚本核心要素详解>三、脚本核心要素详解</h2><h3 id=31-shebang-行深度解析>3.1 Shebang 行深度解析</h3><p><strong>Shebang 的作用</strong>：
Shebang (<code>#!</code>) 告诉系统使用哪个解释器执行脚本，必须位于文件第一行。</p><p><strong>常见 Shebang 写法</strong>：</p><div class=table-wrapper><table><thead><tr><th>Shebang</th><th>解释器</th><th>适用场景</th></tr></thead><tbody><tr><td><code>#!/bin/bash</code></td><td>Bash shell</td><td>大多数 Linux 系统（推荐）</td></tr><tr><td><code>#!/usr/bin/env bash</code></td><td>环境变量查找 Bash</td><td>跨平台兼容性好，优先使用</td></tr><tr><td><code>#!/bin/sh</code></td><td>POSIX shell</td><td>需要最大兼容性时使用</td></tr><tr><td><code>#!/bin/dash</code></td><td>Dash shell</td><td>追求脚本执行速度</td></tr><tr><td><code>#!/usr/bin/python3</code></td><td>Python 3</td><td>Python 脚本</td></tr><tr><td><code>#!/usr/bin/perl</code></td><td>Perl</td><td>Perl 脚本</td></tr><tr><td><code>#!/bin/zsh</code></td><td>Zsh</td><td>Zsh 特定功能</td></tr></tbody></table></div><p><strong>最佳实践</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># 优点：</span>
</span></span><span class=line><span class=cl><span class=c1># 1. 使用 PATH 查找 bash，更灵活</span>
</span></span><span class=line><span class=cl><span class=c1># 2. 支持用户自定义 bash 版本</span>
</span></span><span class=line><span class=cl><span class=c1># 3. 在虚拟环境中表现更好</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Shebang 特殊用法</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash -e  # 执行时自动启用 errexit
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>#!/bin/bash -x  # 执行时自动启用调试模式</span>
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash -eu # 同时启用 errexit 和 nounset</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=32-脚本标准结构模板>3.2 脚本标准结构模板</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 脚本名称: myscript.sh</span>
</span></span><span class=line><span class=cl><span class=c1># 描述:     [脚本的详细功能描述]</span>
</span></span><span class=line><span class=cl><span class=c1># 作者:     [你的名字]</span>
</span></span><span class=line><span class=cl><span class=c1># 日期:     2024-12-30</span>
</span></span><span class=line><span class=cl><span class=c1># 版本:     1.0.0</span>
</span></span><span class=line><span class=cl><span class=c1># 依赖:     [列出所有依赖的命令和工具]</span>
</span></span><span class=line><span class=cl><span class=c1># 用法:     ./myscript.sh [选项] &lt;参数&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># 示例:     ./myscript.sh -f config.conf</span>
</span></span><span class=line><span class=cl><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 配置区 - 可修改的变量</span>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=nv>SCRIPT_NAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>basename <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>SCRIPT_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>cd</span> <span class=s2>&#34;</span><span class=k>$(</span>dirname <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BASH_SOURCE</span><span class=p>[0]</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>pwd</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CONFIG_FILE</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>SCRIPT_DIR</span><span class=si>}</span><span class=s2>/config.conf&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;/var/log/</span><span class=si>${</span><span class=nv>SCRIPT_NAME</span><span class=p>%.*</span><span class=si>}</span><span class=s2>.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 安全设置 - 防御性编程</span>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail  <span class=c1># 遇到错误退出、变量未定义报错、管道失败检测</span>
</span></span><span class=line><span class=cl><span class=nv>IFS</span><span class=o>=</span><span class=s1>$&#39;\n\t&#39;</span>        <span class=c1># 设置内部字段分隔符</span>
</span></span><span class=line><span class=cl><span class=nb>umask</span> <span class=m>022</span>          <span class=c1># 设置默认文件权限</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 错误处理函数</span>
</span></span><span class=line><span class=cl>error_exit<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[ERROR] </span><span class=nv>$1</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 警告函数</span>
</span></span><span class=line><span class=cl>warning<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[WARNING] </span><span class=nv>$1</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 信息输出函数</span>
</span></span><span class=line><span class=cl>info<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[INFO] </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 通用函数定义区</span>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查命令是否存在</span>
</span></span><span class=line><span class=cl>check_command<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>command</span> -v <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> &gt;/dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=o>||</span> error_exit <span class=s2>&#34;命令 &#39;</span><span class=nv>$1</span><span class=s2>&#39; 未找到&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查是否为 root 用户</span>
</span></span><span class=line><span class=cl>check_root<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$EUID</span> -ne <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        error_exit <span class=s2>&#34;此脚本必须以 root 权限运行&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 打印帮助信息</span>
</span></span><span class=line><span class=cl>print_help<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    cat <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>用法: $SCRIPT_NAME [选项] &lt;参数&gt;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>选项:
</span></span></span><span class=line><span class=cl><span class=s>    -h, --help          显示此帮助信息
</span></span></span><span class=line><span class=cl><span class=s>    -v, --version       显示版本信息
</span></span></span><span class=line><span class=cl><span class=s>    -c, --config FILE   指定配置文件 (默认: $CONFIG_FILE)
</span></span></span><span class=line><span class=cl><span class=s>    -d, --debug         启用调试模式
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>参数:
</span></span></span><span class=line><span class=cl><span class=s>    &lt;input_file&gt;        输入文件路径
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>示例:
</span></span></span><span class=line><span class=cl><span class=s>    $SCRIPT_NAME -d /path/to/file.txt
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 主逻辑区</span>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解析命令行参数</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[[</span> <span class=nv>$#</span> -gt <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nv>$1</span> in
</span></span><span class=line><span class=cl>        -h<span class=p>|</span>--help<span class=o>)</span>
</span></span><span class=line><span class=cl>            print_help
</span></span><span class=line><span class=cl>            <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        -v<span class=p>|</span>--version<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$SCRIPT_NAME</span><span class=s2> version 1.0.0&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        -c<span class=p>|</span>--config<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>CONFIG_FILE</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>shift</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        -d<span class=p>|</span>--debug<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>set</span> -x  <span class=c1># 启用调试</span>
</span></span><span class=line><span class=cl>            <span class=nb>shift</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        *<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>POSITIONAL_ARGS</span><span class=o>+=(</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>shift</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>    <span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主执行逻辑</span>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    info <span class=s2>&#34;开始执行脚本...&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 检查依赖</span>
</span></span><span class=line><span class=cl>    check_command <span class=s2>&#34;grep&#34;</span>
</span></span><span class=line><span class=cl>    check_command <span class=s2>&#34;awk&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 检查权限</span>
</span></span><span class=line><span class=cl>    check_root
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 读取配置文件</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;</span><span class=nv>$CONFIG_FILE</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>source</span> <span class=s2>&#34;</span><span class=nv>$CONFIG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        warning <span class=s2>&#34;配置文件不存在: </span><span class=nv>$CONFIG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 核心业务逻辑</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    info <span class=s2>&#34;脚本执行完成&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 脚本入口</span>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================</span>
</span></span><span class=line><span class=cl><span class=c1># 捕获错误并执行清理</span>
</span></span><span class=line><span class=cl><span class=nb>trap</span> <span class=s1>&#39;error_exit &#34;执行失败，行号: $LINENO&#34;&#39;</span> ERR
</span></span><span class=line><span class=cl><span class=nb>trap</span> <span class=s1>&#39;info &#34;脚本已终止&#34;; exit 1&#39;</span> INT TERM
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行主函数</span>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=四脚本编写核心要素>四、脚本编写核心要素</h2><h3 id=41-变量定义与使用>4.1 变量定义与使用</h3><h4 id=变量命名规则><strong>变量命名规则</strong>：</h4><ul><li>只能包含字母、数字和下划线</li><li>不能以数字开头</li><li>建议使用小写字母加下划线（如 <code>backup_dir</code>）</li><li>环境变量使用大写字母（如 <code>PATH</code>, <code>HOME</code>）</li></ul><h4 id=变量定义方式><strong>变量定义方式</strong>：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 基本变量</span>
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span><span class=s2>&#34;John&#34;</span>              <span class=c1># 字符串变量</span>
</span></span><span class=line><span class=cl><span class=nv>age</span><span class=o>=</span><span class=m>20</span>                   <span class=c1># 数字变量（bash 中均为字符串）</span>
</span></span><span class=line><span class=cl><span class=nv>is_admin</span><span class=o>=</span><span class=nb>true</span>            <span class=c1># 布尔值（true/false 字符串）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 命令替换（推荐 $() 语法）</span>
</span></span><span class=line><span class=cl><span class=nv>current_date</span><span class=o>=</span><span class=k>$(</span>date +%Y-%m-%d<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>files_count</span><span class=o>=</span><span class=k>$(</span>ls -1 <span class=p>|</span> wc -l<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 旧式反引号（不推荐，但兼容性好）</span>
</span></span><span class=line><span class=cl><span class=nv>current_dir</span><span class=o>=</span><span class=sb>`</span><span class=nb>pwd</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 变量引用</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;名字: </span><span class=nv>$name</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;年龄: </span><span class=nv>$age</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;当前日期: </span><span class=nv>$current_date</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 大括号避免歧义</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;今天是 </span><span class=si>${</span><span class=nv>current_date</span><span class=si>}</span><span class=s2>_backup.tar.gz&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 只读变量</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>SCRIPT_VERSION</span><span class=o>=</span><span class=s2>&#34;1.0.0&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># SCRIPT_VERSION=&#34;2.0&#34;  # 会报错</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 删除变量</span>
</span></span><span class=line><span class=cl><span class=nb>unset</span> name
</span></span></code></pre></td></tr></table></div></div><h4 id=特殊变量><strong>特殊变量</strong>：</h4><div class=table-wrapper><table><thead><tr><th>变量</th><th>含义</th></tr></thead><tbody><tr><td><code>$0</code></td><td>脚本名称</td></tr><tr><td><code>$1</code>, <code>$2</code>, &mldr;</td><td>位置参数</td></tr><tr><td><code>$#</code></td><td>参数个数</td></tr><tr><td><code>$@</code></td><td>所有参数（数组形式）</td></tr><tr><td><code>$*</code></td><td>所有参数（字符串形式）</td></tr><tr><td><code>$?</code></td><td>上一个命令的退出状态</td></tr><tr><td><code>$$</code></td><td>当前进程ID</td></tr><tr><td><code>$!</code></td><td>最后一个后台进程ID</td></tr><tr><td><code>$-</code></td><td>当前选项标志</td></tr></tbody></table></div><hr><h3 id=42-参数处理高级技巧>4.2 参数处理高级技巧</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 位置参数示例</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;脚本名称: </span><span class=nv>$0</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;第一个参数: </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;第二个参数: </span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;所有参数: </span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;参数个数: </span><span class=nv>$#</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证参数数量</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$#</span> -lt <span class=m>2</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;用法: </span><span class=nv>$0</span><span class=s2> &lt;源目录&gt; &lt;目标目录&gt;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 处理可选参数</span>
</span></span><span class=line><span class=cl><span class=nv>DEBUG</span><span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=nv>VERBOSE</span><span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[[</span> <span class=nv>$#</span> -gt <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nv>$1</span> in
</span></span><span class=line><span class=cl>        -d<span class=p>|</span>--debug<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>DEBUG</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>            <span class=nb>set</span> -x
</span></span><span class=line><span class=cl>            <span class=nb>shift</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        -v<span class=p>|</span>--verbose<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>VERBOSE</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>            <span class=nb>shift</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        -*<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span> <span class=s2>&#34;未知选项: </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        *<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>POSITIONAL_ARGS</span><span class=o>+=(</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>shift</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>    <span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重置位置参数</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -- <span class=s2>&#34;</span><span class=si>${</span><span class=nv>POSITIONAL_ARGS</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 getopts（传统方式）</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nb>getopts</span> <span class=s2>&#34;hdv&#34;</span> opt<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nv>$opt</span> in
</span></span><span class=line><span class=cl>        h<span class=o>)</span>
</span></span><span class=line><span class=cl>            print_help
</span></span><span class=line><span class=cl>            <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        d<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>DEBUG</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        v<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>VERBOSE</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>        <span class=se>\?</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span> <span class=s2>&#34;无效选项: -</span><span class=nv>$OPTARG</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>            <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>    <span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 getopt（支持长选项，更强大）</span>
</span></span><span class=line><span class=cl><span class=nv>OPTIONS</span><span class=o>=</span><span class=k>$(</span>getopt -o hvd --long help,verbose,debug -- <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=nb>eval</span> <span class=nb>set</span> -- <span class=s2>&#34;</span><span class=nv>$OPTIONS</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=43-条件判断与测试>4.3 条件判断与测试</h3><h4 id=if-语句><strong>if 语句</strong>：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 文件测试</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;/etc/passwd&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;文件存在&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 目录测试</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -d <span class=s2>&#34;/tmp&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;目录存在&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 字符串比较</span>
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span><span class=s2>&#34;admin&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$name</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;admin&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;是管理员&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$name</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;user&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;是普通用户&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;未知用户&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数字比较</span>
</span></span><span class=line><span class=cl><span class=nv>count</span><span class=o>=</span><span class=m>10</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$count</span> -eq <span class=m>10</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;等于10&#34;</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=o>[[</span> <span class=nv>$count</span> -gt <span class=m>5</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;大于5&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 逻辑运算</span>
</span></span><span class=line><span class=cl><span class=nv>age</span><span class=o>=</span><span class=m>25</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$age</span> -ge <span class=m>18</span> <span class=o>&amp;&amp;</span> <span class=nv>$age</span> -le <span class=m>60</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;工作年龄&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 模式匹配</span>
</span></span><span class=line><span class=cl><span class=nv>filename</span><span class=o>=</span><span class=s2>&#34;script.sh&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$filename</span> <span class=o>==</span> *.sh <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;是 shell 脚本&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 正则表达式匹配</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$email</span> <span class=o>=</span>~ ^<span class=o>[</span>a-zA-Z0-9._%+-<span class=o>]</span>+@<span class=o>[</span>a-zA-Z0-9.-<span class=o>]</span>+<span class=se>\.</span><span class=o>[</span>a-zA-Z<span class=o>]{</span>2,<span class=o>}</span>$ <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;有效的邮箱格式&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=case-语句><strong>case 语句</strong>：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nb>read</span> -p <span class=s2>&#34;输入选择 (start/stop/restart): &#34;</span> action
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$action</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>    start<span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;启动服务...&#34;</span>
</span></span><span class=line><span class=cl>        systemctl start nginx
</span></span><span class=line><span class=cl>        <span class=p>;;</span>
</span></span><span class=line><span class=cl>    stop<span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;停止服务...&#34;</span>
</span></span><span class=line><span class=cl>        systemctl stop nginx
</span></span><span class=line><span class=cl>        <span class=p>;;</span>
</span></span><span class=line><span class=cl>    restart<span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;重启服务...&#34;</span>
</span></span><span class=line><span class=cl>        systemctl restart nginx
</span></span><span class=line><span class=cl>        <span class=p>;;</span>
</span></span><span class=line><span class=cl>    *<span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;无效选项: </span><span class=nv>$action</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>        <span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=44-循环结构>4.4 循环结构</h3><h4 id=for-循环><strong>for 循环</strong>：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 遍历数字</span>
</span></span><span class=line><span class=cl><span class=k>for</span> i in <span class=o>{</span>1..5<span class=o>}</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;数字: </span><span class=nv>$i</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 遍历文件</span>
</span></span><span class=line><span class=cl><span class=k>for</span> file in *.sh<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;处理文件: </span><span class=nv>$file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    chmod +x <span class=s2>&#34;</span><span class=nv>$file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># C 风格 for 循环</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=o>((</span><span class=nv>i</span><span class=o>=</span>0<span class=p>;</span> i&lt;10<span class=p>;</span> i++<span class=o>))</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;计数: </span><span class=nv>$i</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 遍历数组</span>
</span></span><span class=line><span class=cl><span class=nv>apps</span><span class=o>=(</span><span class=s2>&#34;nginx&#34;</span> <span class=s2>&#34;mysql&#34;</span> <span class=s2>&#34;redis&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> app in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>apps</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;检查服务: </span><span class=nv>$app</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    systemctl status <span class=s2>&#34;</span><span class=nv>$app</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 读取文件内容</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span> <span class=nb>read</span> -r line<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;行内容: </span><span class=nv>$line</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span> &lt; /etc/passwd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 遍历命令输出</span>
</span></span><span class=line><span class=cl><span class=k>for</span> user in <span class=k>$(</span>awk -F: <span class=s1>&#39;{print $1}&#39;</span> /etc/passwd<span class=k>)</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;用户: </span><span class=nv>$user</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=while-循环><strong>while 循环</strong>：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 条件循环</span>
</span></span><span class=line><span class=cl><span class=nv>count</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[[</span> <span class=nv>$count</span> -le <span class=m>5</span> <span class=o>]]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;计数: </span><span class=nv>$count</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>((</span>count++<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 无限循环（带退出条件）</span>
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>read</span> -p <span class=s2>&#34;输入 &#39;exit&#39; 退出: &#34;</span> input
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$input</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;exit&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>break</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;你输入了: </span><span class=nv>$input</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 读取文件</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span>: <span class=nb>read</span> -r username password uid gid info home shell<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;用户: </span><span class=nv>$username</span><span class=s2>, UID: </span><span class=nv>$uid</span><span class=s2>, HOME: </span><span class=nv>$home</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span> &lt; /etc/passwd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 带条件的 while</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[[</span> -f <span class=s2>&#34;/tmp/lockfile&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;等待锁文件删除...&#34;</span>
</span></span><span class=line><span class=cl>    sleep <span class=m>5</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=45-函数定义与使用>4.5 函数定义与使用</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 基本函数定义</span>
</span></span><span class=line><span class=cl><span class=k>function</span> say_hello<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Hello, </span><span class=nv>$1</span><span class=s2>!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 或者不使用 function 关键字</span>
</span></span><span class=line><span class=cl>say_goodbye<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Goodbye, </span><span class=nv>$1</span><span class=s2>!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 调用函数</span>
</span></span><span class=line><span class=cl>say_hello <span class=s2>&#34;World&#34;</span>
</span></span><span class=line><span class=cl>say_goodbye <span class=s2>&#34;World&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 带返回值的函数</span>
</span></span><span class=line><span class=cl>check_disk_usage<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>threshold</span><span class=o>=</span><span class=m>80</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>usage</span><span class=o>=</span><span class=k>$(</span>df / <span class=p>|</span> awk <span class=s1>&#39;NR==2 {print $5}&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/%//&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$usage</span> -gt <span class=nv>$threshold</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;警告: 磁盘使用率超过 </span><span class=si>${</span><span class=nv>threshold</span><span class=si>}</span><span class=s2>%&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;磁盘使用率正常: </span><span class=si>${</span><span class=nv>usage</span><span class=si>}</span><span class=s2>%&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 捕获返回值</span>
</span></span><span class=line><span class=cl><span class=k>if</span> check_disk_usage<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;检查通过&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;检查失败&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 返回数据</span>
</span></span><span class=line><span class=cl>get_config_value<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>key</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    grep <span class=s2>&#34;^</span><span class=si>${</span><span class=nv>key</span><span class=si>}</span><span class=s2>=&#34;</span> config.conf <span class=p>|</span> cut -d<span class=o>=</span> -f2
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用返回值</span>
</span></span><span class=line><span class=cl><span class=nv>db_host</span><span class=o>=</span><span class=k>$(</span>get_config_value <span class=s2>&#34;DB_HOST&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;数据库主机: </span><span class=nv>$db_host</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 递归函数</span>
</span></span><span class=line><span class=cl>factorial<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>n</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$n</span> -le <span class=m>1</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=k>$((</span> n <span class=o>*</span> <span class=k>$(</span>factorial <span class=k>$((</span>n-1<span class=k>)))</span> <span class=k>))</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>result</span><span class=o>=</span><span class=k>$(</span>factorial 5<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;5! = </span><span class=nv>$result</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=五高级技巧与最佳实践>五、高级技巧与最佳实践</h2><h3 id=51-错误处理机制>5.1 错误处理机制</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 启用严格模式（推荐放在脚本开头）</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 详细解释：</span>
</span></span><span class=line><span class=cl><span class=c1># set -e: 遇到错误立即退出（errexit）</span>
</span></span><span class=line><span class=cl><span class=c1># set -u: 使用未定义变量时报错（nounset）</span>
</span></span><span class=line><span class=cl><span class=c1># set -o pipefail: 管道命令中任何失败都认为是失败</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自定义错误处理</span>
</span></span><span class=line><span class=cl><span class=nb>trap</span> <span class=s1>&#39;error_handler $? $LINENO&#39;</span> ERR
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>error_handler<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>exit_code</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>line_no</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;错误发生在第 </span><span class=nv>$line_no</span><span class=s2> 行，退出码: </span><span class=nv>$exit_code</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    cleanup
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=nv>$exit_code</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清理函数</span>
</span></span><span class=line><span class=cl>cleanup<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;清理临时文件...&#34;</span>
</span></span><span class=line><span class=cl>    rm -f /tmp/temp_file_<span class=nv>$$</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 确保 cleanup 在脚本退出时执行</span>
</span></span><span class=line><span class=cl><span class=nb>trap</span> cleanup EXIT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查命令是否成功</span>
</span></span><span class=line><span class=cl><span class=k>if</span> ! <span class=nb>command</span> arg1 arg2<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    error_handler <span class=nv>$?</span> <span class=nv>$LINENO</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 或者使用 ||</span>
</span></span><span class=line><span class=cl><span class=nb>command</span> arg1 arg2 <span class=o>||</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;命令失败&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 $?</span>
</span></span><span class=line><span class=cl>mkdir /tmp/mydir
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;创建目录失败&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=52-调试技巧大全>5.2 调试技巧大全</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 方法1：在 Shebang 中启用调试</span>
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash -x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法2：在脚本中使用 set 命令</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -x  <span class=c1># 开启调试</span>
</span></span><span class=line><span class=cl><span class=c1># ... 需要调试的代码 ...</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> +x  <span class=c1># 关闭调试</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法3：调试特定代码块</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>set</span> -x
</span></span><span class=line><span class=cl>    <span class=c1># 调试这段代码</span>
</span></span><span class=line><span class=cl>    ls -l /nonexistent_dir
</span></span><span class=line><span class=cl>    <span class=nb>set</span> +x
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法4：打印变量值</span>
</span></span><span class=line><span class=cl>debug<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>DEBUG</span><span class=k>:-</span><span class=nv>false</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;true&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[DEBUG] </span><span class=nv>$*</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>DEBUG</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>debug <span class=s2>&#34;变量值: name=</span><span class=nv>$name</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法5：使用 BASH_XTRACEFD 重定向调试输出</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span> 5&gt; debug.log
</span></span><span class=line><span class=cl><span class=nv>BASH_XTRACEFD</span><span class=o>=</span><span class=m>5</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -x
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法6：显示完整的命令执行</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -v  <span class=c1># 显示原始命令</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -x  <span class=c1># 显示扩展后的命令</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 方法7：使用 PS4 自定义调试前缀</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PS4</span><span class=o>=</span><span class=s1>&#39;+(${BASH_SOURCE}:${LINENO}) ${FUNCNAME:+$FUNCNAME(): }&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -x
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=53-代码规范与风格>5.3 代码规范与风格</h3><p><strong>Google Shell Style Guide 推荐规范</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 1. 变量命名：小写加下划线</span>
</span></span><span class=line><span class=cl><span class=nb>local</span> <span class=nv>backup_dir</span><span class=o>=</span><span class=s2>&#34;/backup&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 常量：大写加下划线</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>BACKUP_RETENTION_DAYS</span><span class=o>=</span><span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 函数命名：小写加下划线，使用动词开头</span>
</span></span><span class=line><span class=cl>check_permissions<span class=o>()</span> <span class=o>{</span> ... <span class=o>}</span>
</span></span><span class=line><span class=cl>backup_files<span class=o>()</span> <span class=o>{</span> ... <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 缩进：使用2个空格（不是制表符）</span>
</span></span><span class=line><span class=cl><span class=k>function</span> main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[[</span> ... <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;缩进2个空格&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 行长：不超过80字符</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$very_long_condition</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;something&#34;</span> <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>      <span class=s2>&#34;</span><span class=nv>$another_condition</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;something_else&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;换行&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 引用变量：总是使用双引号</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$variable</span><span class=s2>&#34;</span>  <span class=c1># 正确</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$variable</span>    <span class=c1># 错误</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 7. 命令替换：使用 $() 而不是反引号</span>
</span></span><span class=line><span class=cl><span class=nv>current_dir</span><span class=o>=</span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>  <span class=c1># 正确</span>
</span></span><span class=line><span class=cl><span class=nv>current_dir</span><span class=o>=</span><span class=sb>`</span><span class=nb>pwd</span><span class=sb>`</span>   <span class=c1># 错误</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 8. 条件判断：使用 [[ ]] 而不是 [ ]</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$var</span> <span class=o>==</span> <span class=s2>&#34;value&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>  <span class=c1># 正确</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$var</span> <span class=o>=</span> <span class=s2>&#34;value&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>     <span class=c1># 错误（易出错）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 9. 注释规范</span>
</span></span><span class=line><span class=cl><span class=c1># 单行注释</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多行注释</span>
</span></span><span class=line><span class=cl><span class=c1># 可以跨越多行</span>
</span></span><span class=line><span class=cl><span class=c1># 说明复杂逻辑</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>: <span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>这是另一种多行注释方式
</span></span></span><span class=line><span class=cl><span class=s1>使用 : 和单引号
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 10. 函数文档</span>
</span></span><span class=line><span class=cl><span class=c1>#######################################</span>
</span></span><span class=line><span class=cl><span class=c1># 检查磁盘空间</span>
</span></span><span class=line><span class=cl><span class=c1># Arguments:</span>
</span></span><span class=line><span class=cl><span class=c1>#   阈值百分比</span>
</span></span><span class=line><span class=cl><span class=c1># Returns:</span>
</span></span><span class=line><span class=cl><span class=c1>#   0 如果空间充足, 1 如果空间不足</span>
</span></span><span class=line><span class=cl><span class=c1>#######################################</span>
</span></span><span class=line><span class=cl>check_disk_space<span class=o>()</span> <span class=o>{</span> ... <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=六实用开发工具链>六、实用开发工具链</h2><h3 id=61-shellcheck-代码检查>6.1 ShellCheck 代码检查</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 安装 ShellCheck</span>
</span></span><span class=line><span class=cl>yum install -y epel-release
</span></span><span class=line><span class=cl>yum install -y ShellCheck
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用方式</span>
</span></span><span class=line><span class=cl>shellcheck myscript.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在 Vim 中集成</span>
</span></span><span class=line><span class=cl><span class=c1># 在 ~/.vimrc 中添加</span>
</span></span><span class=line><span class=cl>autocmd FileType sh setlocal <span class=nv>makeprg</span><span class=o>=</span>shellcheck<span class=se>\ </span>-f<span class=se>\ </span>gcc<span class=se>\ </span>%
</span></span><span class=line><span class=cl>autocmd FileType sh setlocal <span class=nv>errorformat</span><span class=o>=</span>%f:%l:%c:<span class=se>\ </span>%m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在 VS Code 中安装 ShellCheck 插件</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=62-bash-自动补全>6.2 Bash 自动补全</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 为脚本添加自动补全</span>
</span></span><span class=line><span class=cl>_complete_myscript<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> cur prev opts
</span></span><span class=line><span class=cl>    <span class=nv>COMPREPLY</span><span class=o>=()</span>
</span></span><span class=line><span class=cl>    <span class=nv>cur</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>COMP_WORDS</span><span class=p>[COMP_CWORD]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>prev</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>COMP_WORDS</span><span class=p>[COMP_CWORD-1]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>opts</span><span class=o>=</span><span class=s2>&#34;-h --help -v --version -d --debug&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=si>${</span><span class=nv>cur</span><span class=si>}</span> <span class=o>==</span> -* <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>COMPREPLY</span><span class=o>=(</span> <span class=k>$(</span><span class=nb>compgen</span> -W <span class=s2>&#34;</span><span class=si>${</span><span class=nv>opts</span><span class=si>}</span><span class=s2>&#34;</span> -- <span class=si>${</span><span class=nv>cur</span><span class=si>}</span><span class=k>)</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>complete</span> -F _complete_myscript myscript.sh
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=63-日志记录框架>6.3 日志记录框架</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 日志级别</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_LEVEL_DEBUG</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_LEVEL_INFO</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_LEVEL_WARN</span><span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_LEVEL_ERROR</span><span class=o>=</span><span class=m>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当前日志级别</span>
</span></span><span class=line><span class=cl><span class=nv>CURRENT_LOG_LEVEL</span><span class=o>=</span><span class=si>${</span><span class=nv>LOG_LEVEL_INFO</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 日志函数</span>
</span></span><span class=line><span class=cl>log<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>level</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl>    <span class=nb>shift</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>message</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>timestamp</span><span class=o>=</span><span class=k>$(</span>date <span class=s1>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> level_str
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nv>$level</span> in
</span></span><span class=line><span class=cl>        <span class=nv>$LOG_LEVEL_DEBUG</span><span class=o>)</span> <span class=nv>level_str</span><span class=o>=</span><span class=s2>&#34;DEBUG&#34;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$LOG_LEVEL_INFO</span><span class=o>)</span>  <span class=nv>level_str</span><span class=o>=</span><span class=s2>&#34;INFO&#34;</span>  <span class=p>;;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$LOG_LEVEL_WARN</span><span class=o>)</span>  <span class=nv>level_str</span><span class=o>=</span><span class=s2>&#34;WARN&#34;</span>  <span class=p>;;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$LOG_LEVEL_ERROR</span><span class=o>)</span> <span class=nv>level_str</span><span class=o>=</span><span class=s2>&#34;ERROR&#34;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>    <span class=k>esac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$level</span> -ge <span class=nv>$CURRENT_LOG_LEVEL</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[</span><span class=nv>$timestamp</span><span class=s2>] [</span><span class=nv>$level_str</span><span class=s2>] </span><span class=nv>$message</span><span class=s2>&#34;</span> <span class=p>|</span> tee -a <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>debug<span class=o>()</span> <span class=o>{</span> log <span class=nv>$LOG_LEVEL_DEBUG</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>info<span class=o>()</span>  <span class=o>{</span> log <span class=nv>$LOG_LEVEL_INFO</span>  <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>warn<span class=o>()</span>  <span class=o>{</span> log <span class=nv>$LOG_LEVEL_WARN</span>  <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>error<span class=o>()</span> <span class=o>{</span> log <span class=nv>$LOG_LEVEL_ERROR</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用示例</span>
</span></span><span class=line><span class=cl>debug <span class=s2>&#34;调试信息&#34;</span>
</span></span><span class=line><span class=cl>info <span class=s2>&#34;普通信息&#34;</span>
</span></span><span class=line><span class=cl>warn <span class=s2>&#34;警告信息&#34;</span>
</span></span><span class=line><span class=cl>error <span class=s2>&#34;错误信息&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=七实战案例库>七、实战案例库</h2><h3 id=71-系统巡检脚本>7.1 系统巡检脚本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 系统健康检查脚本</span>
</span></span><span class=line><span class=cl><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查CPU使用率</span>
</span></span><span class=line><span class=cl>check_cpu<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>usage</span><span class=o>=</span><span class=k>$(</span>top -bn1 <span class=p>|</span> grep <span class=s2>&#34;Cpu(s)&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> cut -d<span class=s1>&#39;%&#39;</span> -f1<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>((</span> <span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$usage</span><span class=s2> &gt; 80&#34;</span> <span class=p>|</span> bc -l<span class=k>)</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;WARNING: CPU使用率过高: </span><span class=si>${</span><span class=nv>usage</span><span class=si>}</span><span class=s2>%&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;OK: CPU使用率正常: </span><span class=si>${</span><span class=nv>usage</span><span class=si>}</span><span class=s2>%&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查内存使用率</span>
</span></span><span class=line><span class=cl>check_memory<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>total</span><span class=o>=</span><span class=k>$(</span>free -m <span class=p>|</span> awk <span class=s1>&#39;NR==2{print $2}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>used</span><span class=o>=</span><span class=k>$(</span>free -m <span class=p>|</span> awk <span class=s1>&#39;NR==2{print $3}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>usage</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;scale=2; </span><span class=nv>$used</span><span class=s2>*100/</span><span class=nv>$total</span><span class=s2>&#34;</span> <span class=p>|</span> bc<span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>((</span> <span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$usage</span><span class=s2> &gt; 85&#34;</span> <span class=p>|</span> bc -l<span class=k>)</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;WARNING: 内存使用率过高: </span><span class=si>${</span><span class=nv>usage</span><span class=si>}</span><span class=s2>%&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;OK: 内存使用率正常: </span><span class=si>${</span><span class=nv>usage</span><span class=si>}</span><span class=s2>%&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查磁盘使用率</span>
</span></span><span class=line><span class=cl>check_disk<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    df -h <span class=p>|</span> awk <span class=s1>&#39;NR&gt;1 &amp;&amp; $5+0 &gt; 80 {print &#34;WARNING: 磁盘使用率过高: &#34; $0}&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主函数</span>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;===== 系统巡检报告 (</span><span class=k>$(</span>date<span class=k>)</span><span class=s2>) =====&#34;</span>
</span></span><span class=line><span class=cl>    check_cpu
</span></span><span class=line><span class=cl>    check_memory
</span></span><span class=line><span class=cl>    check_disk
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;===== 巡检完成 =====&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=72-自动化备份脚本带版本控制>7.2 自动化备份脚本（带版本控制）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 自动化备份脚本 - 保留7天历史</span>
</span></span><span class=line><span class=cl><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 配置</span>
</span></span><span class=line><span class=cl><span class=nv>SOURCE_DIR</span><span class=o>=</span><span class=s2>&#34;/data/website&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BACKUP_BASE</span><span class=o>=</span><span class=s2>&#34;/backup&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>RETENTION_DAYS</span><span class=o>=</span><span class=m>7</span>
</span></span><span class=line><span class=cl><span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date +%Y%m%d_%H%M%S<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>BACKUP_NAME</span><span class=o>=</span><span class=s2>&#34;website_</span><span class=si>${</span><span class=nv>TIMESTAMP</span><span class=si>}</span><span class=s2>.tar.gz&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BACKUP_PATH</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>BACKUP_BASE</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>BACKUP_NAME</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建备份</span>
</span></span><span class=line><span class=cl>create_backup<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[</span><span class=k>$(</span>date<span class=k>)</span><span class=s2>] 开始创建备份...&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建备份目录</span>
</span></span><span class=line><span class=cl>    mkdir -p <span class=s2>&#34;</span><span class=nv>$BACKUP_BASE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 执行备份（排除日志和临时文件）</span>
</span></span><span class=line><span class=cl>    tar -czf <span class=s2>&#34;</span><span class=nv>$BACKUP_PATH</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --exclude<span class=o>=</span><span class=s2>&#34;*.log&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --exclude<span class=o>=</span><span class=s2>&#34;temp/*&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -C <span class=s2>&#34;</span><span class=k>$(</span>dirname <span class=s2>&#34;</span><span class=nv>$SOURCE_DIR</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        <span class=s2>&#34;</span><span class=k>$(</span>basename <span class=s2>&#34;</span><span class=nv>$SOURCE_DIR</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 验证备份</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;</span><span class=nv>$BACKUP_PATH</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[</span><span class=k>$(</span>date<span class=k>)</span><span class=s2>] 备份成功: </span><span class=nv>$BACKUP_PATH</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        ls -lh <span class=s2>&#34;</span><span class=nv>$BACKUP_PATH</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[</span><span class=k>$(</span>date<span class=k>)</span><span class=s2>] 备份失败!&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>        <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清理旧备份</span>
</span></span><span class=line><span class=cl>cleanup_old<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[</span><span class=k>$(</span>date<span class=k>)</span><span class=s2>] 清理 </span><span class=si>${</span><span class=nv>RETENTION_DAYS</span><span class=si>}</span><span class=s2> 天前的旧备份...&#34;</span>
</span></span><span class=line><span class=cl>    find <span class=s2>&#34;</span><span class=nv>$BACKUP_BASE</span><span class=s2>&#34;</span> -name <span class=s2>&#34;website_*.tar.gz&#34;</span> -mtime +<span class=si>${</span><span class=nv>RETENTION_DAYS</span><span class=si>}</span> -delete
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;[</span><span class=k>$(</span>date<span class=k>)</span><span class=s2>] 清理完成&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主流程</span>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    create_backup
</span></span><span class=line><span class=cl>    cleanup_old
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=73-nginx-日志分析脚本>7.3 Nginx 日志分析脚本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl><span class=c1># Nginx 访问日志分析脚本</span>
</span></span><span class=line><span class=cl><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;/var/log/nginx/access.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>REPORT_FILE</span><span class=o>=</span><span class=s2>&#34;/tmp/nginx_report_</span><span class=k>$(</span>date +%Y%m%d<span class=k>)</span><span class=s2>.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查日志文件</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> ! -f <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;错误: 日志文件不存在: </span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析IP地址</span>
</span></span><span class=line><span class=cl>analyze_ips<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;===== Top 10 IP 地址 =====&#34;</span> &gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    awk <span class=s1>&#39;{print $1}&#39;</span> <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10 &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析状态码</span>
</span></span><span class=line><span class=cl>analyze_status<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;\n===== 状态码统计 =====&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    awk <span class=s1>&#39;{print $9}&#39;</span> <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析访问最多的URL</span>
</span></span><span class=line><span class=cl>analyze_urls<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;\n===== Top 10 URL =====&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    awk <span class=s1>&#39;{print $7}&#39;</span> <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10 &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成报告</span>
</span></span><span class=line><span class=cl>generate_report<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    analyze_ips
</span></span><span class=line><span class=cl>    analyze_status
</span></span><span class=line><span class=cl>    analyze_urls
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;报告已生成: </span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    cat <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 邮件发送</span>
</span></span><span class=line><span class=cl>send_email<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>recipient</span><span class=o>=</span><span class=s2>&#34;admin@example.com&#34;</span>
</span></span><span class=line><span class=cl>    mail -s <span class=s2>&#34;Nginx 日志报告&#34;</span> <span class=s2>&#34;</span><span class=nv>$recipient</span><span class=s2>&#34;</span> &lt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    generate_report
</span></span><span class=line><span class=cl>    send_email
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=74-安全初始化脚本centos>7.4 安全初始化脚本（CentOS）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl><span class=c1># CentOS 系统安全初始化脚本</span>
</span></span><span class=line><span class=cl><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 颜色定义</span>
</span></span><span class=line><span class=cl><span class=nv>RED</span><span class=o>=</span><span class=s1>&#39;\033[0;31m&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>GREEN</span><span class=o>=</span><span class=s1>&#39;\033[0;32m&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>YELLOW</span><span class=o>=</span><span class=s1>&#39;\033[1;33m&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>NC</span><span class=o>=</span><span class=s1>&#39;\033[0m&#39;</span> <span class=c1># No Color</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>log<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=si>${</span><span class=nv>GREEN</span><span class=si>}</span><span class=s2>[INFO]</span><span class=si>${</span><span class=nv>NC</span><span class=si>}</span><span class=s2> </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>warn<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=si>${</span><span class=nv>YELLOW</span><span class=si>}</span><span class=s2>[WARN]</span><span class=si>${</span><span class=nv>NC</span><span class=si>}</span><span class=s2> </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>error<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=si>${</span><span class=nv>RED</span><span class=si>}</span><span class=s2>[ERROR]</span><span class=si>${</span><span class=nv>NC</span><span class=si>}</span><span class=s2> </span><span class=nv>$1</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查是否为 root</span>
</span></span><span class=line><span class=cl><span class=o>[[</span> <span class=nv>$EUID</span> -eq <span class=m>0</span> <span class=o>]]</span> <span class=o>||</span> error <span class=s2>&#34;此脚本必须以 root 身份运行&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更新系统</span>
</span></span><span class=line><span class=cl>update_system<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;更新系统...&#34;</span>
</span></span><span class=line><span class=cl>    yum update -y
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 配置防火墙</span>
</span></span><span class=line><span class=cl>configure_firewall<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;配置防火墙...&#34;</span>
</span></span><span class=line><span class=cl>    systemctl <span class=nb>enable</span> firewalld
</span></span><span class=line><span class=cl>    systemctl start firewalld
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 开放 SSH 端口</span>
</span></span><span class=line><span class=cl>    firewall-cmd --permanent --add-service<span class=o>=</span>ssh
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 开放 HTTP/HTTPS</span>
</span></span><span class=line><span class=cl>    firewall-cmd --permanent --add-service<span class=o>=</span>http
</span></span><span class=line><span class=cl>    firewall-cmd --permanent --add-service<span class=o>=</span>https
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    firewall-cmd --reload
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 配置 SSH</span>
</span></span><span class=line><span class=cl>configure_ssh<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;加固 SSH 配置...&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 备份原始配置</span>
</span></span><span class=line><span class=cl>    cp /etc/ssh/sshd_config<span class=o>{</span>,.bak.<span class=k>$(</span>date +%Y%m%d<span class=k>)</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 修改配置</span>
</span></span><span class=line><span class=cl>    sed -i <span class=s1>&#39;s/#PermitRootLogin yes/PermitRootLogin no/&#39;</span> /etc/ssh/sshd_config
</span></span><span class=line><span class=cl>    sed -i <span class=s1>&#39;s/#PasswordAuthentication yes/PasswordAuthentication no/&#39;</span> /etc/ssh/sshd_config
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 重启 SSH</span>
</span></span><span class=line><span class=cl>    systemctl restart sshd
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安装 fail2ban</span>
</span></span><span class=line><span class=cl>install_fail2ban<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;安装 fail2ban...&#34;</span>
</span></span><span class=line><span class=cl>    yum install -y epel-release
</span></span><span class=line><span class=cl>    yum install -y fail2ban
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 配置</span>
</span></span><span class=line><span class=cl>    cat &gt; /etc/fail2ban/jail.local <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>[sshd]
</span></span></span><span class=line><span class=cl><span class=s>enabled = true
</span></span></span><span class=line><span class=cl><span class=s>port = 22
</span></span></span><span class=line><span class=cl><span class=s>filter = sshd
</span></span></span><span class=line><span class=cl><span class=s>logpath = /var/log/secure
</span></span></span><span class=line><span class=cl><span class=s>maxretry = 3
</span></span></span><span class=line><span class=cl><span class=s>bantime = 3600
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    systemctl <span class=nb>enable</span> fail2ban
</span></span><span class=line><span class=cl>    systemctl start fail2ban
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主流程</span>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;开始系统安全初始化...&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    update_system
</span></span><span class=line><span class=cl>    configure_firewall
</span></span><span class=line><span class=cl>    configure_ssh
</span></span><span class=line><span class=cl>    install_fail2ban
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;安全初始化完成！&#34;</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;请重新登录以应用 SSH 更改&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=八开发工作流建议>八、开发工作流建议</h2><h3 id=81-版本控制>8.1 版本控制</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 初始化 Git 仓库</span>
</span></span><span class=line><span class=cl>git init
</span></span><span class=line><span class=cl>git add myscript.sh
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;Initial commit&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 添加版本信息到脚本</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;1.0.0&#34;</span>
</span></span><span class=line><span class=cl>git tag -a <span class=s2>&#34;v</span><span class=nv>$VERSION</span><span class=s2>&#34;</span> -m <span class=s2>&#34;Release version </span><span class=nv>$VERSION</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自动生成版本</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION</span><span class=o>=</span><span class=k>$(</span>git describe --tags --always --dirty<span class=k>)</span>
</span></span><span class=line><span class=cl>sed -i <span class=s2>&#34;s/^VERSION=.*/VERSION=\&#34;</span><span class=nv>$VERSION</span><span class=s2>\&#34;/&#34;</span> myscript.sh
</span></span></code></pre></td></tr></table></div></div><h3 id=82-测试框架>8.2 测试框架</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># test_myscript.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 引入测试框架（如 Bats）</span>
</span></span><span class=line><span class=cl>load <span class=s1>&#39;libs/bats-support/load&#39;</span>
</span></span><span class=line><span class=cl>load <span class=s1>&#39;libs/bats-assert/load&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试函数</span>
</span></span><span class=line><span class=cl>@test <span class=s2>&#34;检查函数返回值&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>result</span><span class=o>=</span><span class=k>$(</span>my_function <span class=s2>&#34;test&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$result</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;expected&#34;</span> <span class=o>]]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>@test <span class=s2>&#34;检查文件创建&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    run create_file <span class=s2>&#34;/tmp/testfile&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>[[</span> -f <span class=s2>&#34;/tmp/testfile&#34;</span> <span class=o>]]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=83-持续集成>8.3 持续集成</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .github/workflows/ci.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>push, pull_request]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run ShellCheck</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>ludeeus/action-shellcheck@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Test script</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          chmod +x myscript.sh
</span></span></span><span class=line><span class=cl><span class=sd>          ./myscript.sh test</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=九总结与资源>九、总结与资源</h2><h3 id=91-学习路径建议>9.1 学习路径建议</h3><ol><li><strong>入门</strong>（1-2周）：掌握基础语法、变量、条件、循环</li><li><strong>进阶</strong>（2-4周）：学习函数、错误处理、调试技巧</li><li><strong>高级</strong>（1-2月）：掌握性能优化、安全编程、复杂项目管理</li><li><strong>专家</strong>：贡献开源项目、编写可复用库</li></ol><h3 id=92-必备资源>9.2 必备资源</h3><ul><li><p><strong>在线教程</strong>：</p><ul><li><a class=link href=https://www.bash.academy/ target=_blank rel=noopener>Bash Academy</a></li><li><a class=link href=https://github.com/koalaman/shellcheck/wiki target=_blank rel=noopener>ShellCheck 规则文档</a></li></ul></li><li><p><strong>书籍</strong>：</p><ul><li>《Linux命令行与Shell脚本编程大全》</li><li>《Bash Cookbook》</li></ul></li><li><p><strong>社区</strong>：</p><ul><li>Stack Overflow: [bash] 标签</li><li>Unix & Linux Stack Exchange</li></ul></li></ul><h3 id=93-快速参考卡>9.3 快速参考卡</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建并执行脚本的最简流程</span>
</span></span><span class=line><span class=cl>cat &gt; script.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=s># Script description
</span></span></span><span class=line><span class=cl><span class=s>set -euo pipefail
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>main() {
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;Hello, World!&#34;
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>main &#34;$@&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x script.sh
</span></span><span class=line><span class=cl>./script.sh
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>最终建议</strong>：对于你的 <code>install_ops_tools_centos.sh</code> 脚本，建议按照以下结构重构：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 运维工具安装脚本</span>
</span></span><span class=line><span class=cl><span class=c1># Description: 自动化安装常用运维工具</span>
</span></span><span class=line><span class=cl><span class=c1># Author: 你的名字</span>
</span></span><span class=line><span class=cl><span class=c1># Date: 2024-12-30</span>
</span></span><span class=line><span class=cl><span class=c1>################################################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 颜色定义</span>
</span></span><span class=line><span class=cl><span class=nv>GREEN</span><span class=o>=</span><span class=s1>&#39;\033[0;32m&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>RED</span><span class=o>=</span><span class=s1>&#39;\033[0;31m&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>NC</span><span class=o>=</span><span class=s1>&#39;\033[0m&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>log<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=si>${</span><span class=nv>GREEN</span><span class=si>}</span><span class=s2>[INFO]</span><span class=si>${</span><span class=nv>NC</span><span class=si>}</span><span class=s2> </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>error<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=si>${</span><span class=nv>RED</span><span class=si>}</span><span class=s2>[ERROR]</span><span class=si>${</span><span class=nv>NC</span><span class=si>}</span><span class=s2> </span><span class=nv>$1</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_root<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>[[</span> <span class=nv>$EUID</span> -eq <span class=m>0</span> <span class=o>]]</span> <span class=o>||</span> error <span class=s2>&#34;需要 root 权限&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>install_neofetch<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;安装 neofetch...&#34;</span>
</span></span><span class=line><span class=cl>    yum install -y neofetch <span class=o>||</span> error <span class=s2>&#34;neofetch 安装失败&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    check_root
</span></span><span class=line><span class=cl>    install_neofetch
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;安装完成！请手动运行 vim +PlugInstall 和 tmux 插件安装&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>这样你的脚本将更加专业、健壮和易于维护。</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/k8s/kubernetes%E5%85%A8%E6%A0%88%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/><div class=article-details><h2 class=article-title>Kubernetes全栈知识体系</h2></div></a></article><article><a href=/linux/vmware-ubuntu/><div class=article-details><h2 class=article-title>Ubuntu</h2></div></a></article><article><a href=/project/%E9%A1%B9%E7%9B%AE04centos%E9%83%A8%E7%BD%B2mha/><div class=article-details><h2 class=article-title>centos部署MHA</h2></div></a></article><article><a href=/docker/docker%E6%BA%90/><div class=article-details><h2 class=article-title>docker源</h2></div></a></article><article><a href=/linux/%E4%BF%AE%E6%94%B9%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/><div class=article-details><h2 class=article-title>修改网络配置</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>