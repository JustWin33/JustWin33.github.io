<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Linux日志分析 一、核心日志文件 1. 文本类系统日志 (Syslog) 这些文件通常由 rsyslog 或 syslog-ng 管理，是文本格式，可直接阅读。\n发行版 主要日志文件 作用与分析重点 CentOS/RHEL /var/log/messages 系统总览：记录服务启动、内核报错、网络状态等非敏感信息。 Ubuntu/Debian /var/log/syslog 同上。 CentOS/RHEL /var/log/secure 安全认证：SSH 登录、sudo 提权、添加用户等安全事件。 Ubuntu/Debian /var/log/auth.log 同上。 通用 /var/log/cron 定时任务：记录 Crontab 任务的执行时间、命令及是否启动成功。 通用 /var/log/boot.log 启动流程：记录开机时服务的启动顺序和状态（OK/FAILED）。 通用 /var/log/maillog 邮件服务：Postfix/Sendmail 的发送记录。 2. 二进制日志 (需专用命令查看) 这些文件无法直接用 cat 查看，记录了用户登录的历史数据，防篡改性更强。\n"><title>linux日志分析</title><link rel=canonical href=http://localhost:1313/linux/linux%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="linux日志分析"><meta property='og:description' content="Linux日志分析 一、核心日志文件 1. 文本类系统日志 (Syslog) 这些文件通常由 rsyslog 或 syslog-ng 管理，是文本格式，可直接阅读。\n发行版 主要日志文件 作用与分析重点 CentOS/RHEL /var/log/messages 系统总览：记录服务启动、内核报错、网络状态等非敏感信息。 Ubuntu/Debian /var/log/syslog 同上。 CentOS/RHEL /var/log/secure 安全认证：SSH 登录、sudo 提权、添加用户等安全事件。 Ubuntu/Debian /var/log/auth.log 同上。 通用 /var/log/cron 定时任务：记录 Crontab 任务的执行时间、命令及是否启动成功。 通用 /var/log/boot.log 启动流程：记录开机时服务的启动顺序和状态（OK/FAILED）。 通用 /var/log/maillog 邮件服务：Postfix/Sendmail 的发送记录。 2. 二进制日志 (需专用命令查看) 这些文件无法直接用 cat 查看，记录了用户登录的历史数据，防篡改性更强。\n"><meta property='og:url' content='http://localhost:1313/linux/linux%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Linux'><meta property='article:published_time' content='2025-11-11T00:00:00+00:00'><meta property='article:modified_time' content='2025-11-11T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="linux日志分析"><meta name=twitter:description content="Linux日志分析 一、核心日志文件 1. 文本类系统日志 (Syslog) 这些文件通常由 rsyslog 或 syslog-ng 管理，是文本格式，可直接阅读。\n发行版 主要日志文件 作用与分析重点 CentOS/RHEL /var/log/messages 系统总览：记录服务启动、内核报错、网络状态等非敏感信息。 Ubuntu/Debian /var/log/syslog 同上。 CentOS/RHEL /var/log/secure 安全认证：SSH 登录、sudo 提权、添加用户等安全事件。 Ubuntu/Debian /var/log/auth.log 同上。 通用 /var/log/cron 定时任务：记录 Crontab 任务的执行时间、命令及是否启动成功。 通用 /var/log/boot.log 启动流程：记录开机时服务的启动顺序和状态（OK/FAILED）。 通用 /var/log/maillog 邮件服务：Postfix/Sendmail 的发送记录。 2. 二进制日志 (需专用命令查看) 这些文件无法直接用 cat 查看，记录了用户登录的历史数据，防篡改性更强。\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/kali/><span>kali</span></a></li><li><a href=/ubuntu/><span>ubuntu</span></a></li><li><a href=/utility/><span>Utility</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#一核心日志文件>一、核心日志文件</a><ol><li><a href=#1-文本类系统日志-syslog>1. 文本类系统日志 (Syslog)</a></li><li><a href=#2-二进制日志-需专用命令查看>2. 二进制日志 (需专用命令查看)</a></li><li><a href=#3-特殊组件日志>3. 特殊组件日志</a></li></ol></li><li><a href=#二日志级别标准-log-levels>二、日志级别标准 (Log Levels)</a></li><li><a href=#三基础查看与搜索技巧>三、基础查看与搜索技巧</a><ol><li><a href=#1-实时监控-tail>1. 实时监控 (Tail)</a></li><li><a href=#2-高效浏览-less>2. 高效浏览 (Less)</a></li><li><a href=#3-强力搜索-grep-进阶>3. 强力搜索 (Grep 进阶)</a></li></ol></li><li><a href=#四systemd-时代的日志神器journalctl>四、Systemd 时代的日志神器：journalctl</a><ol><li><a href=#1-时间过滤>1. 时间过滤</a></li><li><a href=#2-服务与级别过滤>2. 服务与级别过滤</a></li><li><a href=#3-启动记录分析>3. 启动记录分析</a></li><li><a href=#4-维护日志体积>4. 维护日志体积</a></li></ol></li><li><a href=#五深度实战分析案例>五、深度实战分析案例</a><ol><li><a href=#案例-1ssh-暴力破解精准画像>案例 1：SSH 暴力破解精准画像</a></li><li><a href=#案例-2内存泄漏与-oom-out-of-memory>案例 2：内存泄漏与 OOM (Out Of Memory)</a></li><li><a href=#案例-3定位流量请求异常>案例 3：定位流量/请求异常</a></li></ol></li><li><a href=#六自动化日志分析脚本-enhanced>六、自动化日志分析脚本 (Enhanced)</a></li><li><a href=#七日志轮转-logrotate-核心配置>七、日志轮转 (Logrotate) 核心配置</a></li><li><a href=#八故障排查速查表>八、故障排查速查表</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/linux/linux%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/>linux日志分析</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-11-11</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 6 分钟</time></div></footer></div></header><section class=article-content><h1 id=linux日志分析>Linux日志分析</h1><h2 id=一核心日志文件>一、核心日志文件</h2><h3 id=1-文本类系统日志-syslog>1. 文本类系统日志 (Syslog)</h3><p>这些文件通常由 <code>rsyslog</code> 或 <code>syslog-ng</code> 管理，是文本格式，可直接阅读。</p><div class=table-wrapper><table><thead><tr><th style=text-align:left>发行版</th><th style=text-align:left>主要日志文件</th><th style=text-align:left>作用与分析重点</th></tr></thead><tbody><tr><td style=text-align:left><strong>CentOS/RHEL</strong></td><td style=text-align:left><code>/var/log/messages</code></td><td style=text-align:left><strong>系统总览</strong>：记录服务启动、内核报错、网络状态等非敏感信息。</td></tr><tr><td style=text-align:left><strong>Ubuntu/Debian</strong></td><td style=text-align:left><code>/var/log/syslog</code></td><td style=text-align:left>同上。</td></tr><tr><td style=text-align:left><strong>CentOS/RHEL</strong></td><td style=text-align:left><code>/var/log/secure</code></td><td style=text-align:left><strong>安全认证</strong>：SSH 登录、sudo 提权、添加用户等安全事件。</td></tr><tr><td style=text-align:left><strong>Ubuntu/Debian</strong></td><td style=text-align:left><code>/var/log/auth.log</code></td><td style=text-align:left>同上。</td></tr><tr><td style=text-align:left><strong>通用</strong></td><td style=text-align:left><code>/var/log/cron</code></td><td style=text-align:left><strong>定时任务</strong>：记录 Crontab 任务的执行时间、命令及是否启动成功。</td></tr><tr><td style=text-align:left><strong>通用</strong></td><td style=text-align:left><code>/var/log/boot.log</code></td><td style=text-align:left><strong>启动流程</strong>：记录开机时服务的启动顺序和状态（OK/FAILED）。</td></tr><tr><td style=text-align:left><strong>通用</strong></td><td style=text-align:left><code>/var/log/maillog</code></td><td style=text-align:left><strong>邮件服务</strong>：Postfix/Sendmail 的发送记录。</td></tr></tbody></table></div><h3 id=2-二进制日志-需专用命令查看>2. 二进制日志 (需专用命令查看)</h3><p>这些文件无法直接用 <code>cat</code> 查看，记录了用户登录的历史数据，防篡改性更强。</p><div class=table-wrapper><table><thead><tr><th style=text-align:left>文件路径</th><th style=text-align:left>查看命令</th><th style=text-align:left>作用</th></tr></thead><tbody><tr><td style=text-align:left><code>/var/log/wtmp</code></td><td style=text-align:left><code>last</code></td><td style=text-align:left>查看<strong>成功登录</strong>的历史记录（含重启记录）。</td></tr><tr><td style=text-align:left><code>/var/log/btmp</code></td><td style=text-align:left><code>lastb</code></td><td style=text-align:left>查看<strong>失败登录</strong>的历史记录（暴力破解分析的核心）。</td></tr><tr><td style=text-align:left><code>/var/log/lastlog</code></td><td style=text-align:left><code>lastlog</code></td><td style=text-align:left>查看系统中所有用户<strong>最后一次登录</strong>的时间。</td></tr></tbody></table></div><h3 id=3-特殊组件日志>3. 特殊组件日志</h3><ul><li><strong><code>/var/log/dmesg</code></strong>：内核环缓冲区日志，主要记录硬件检测、驱动加载信息（使用 <code>dmesg</code> 命令查看效果更好）。</li><li><strong><code>/var/log/audit/audit.log</code></strong>：Linux 审计守护进程日志，记录极其详细的系统调用信息（SELinux 报错主要看这里）。</li></ul><hr><h2 id=二日志级别标准-log-levels>二、日志级别标准 (Log Levels)</h2><p>在分析日志时，通过级别过滤是最高效的方法。Syslog 标准定义了 0-7 级：</p><div class=table-wrapper><table><thead><tr><th style=text-align:left>代码</th><th style=text-align:left>级别 (Keyword)</th><th style=text-align:left>含义</th><th style=text-align:left>建议</th></tr></thead><tbody><tr><td style=text-align:left><strong>0</strong></td><td style=text-align:left><code>emerg</code></td><td style=text-align:left>系统不可用</td><td style=text-align:left>系统级崩溃，需立即处理。</td></tr><tr><td style=text-align:left><strong>1</strong></td><td style=text-align:left><code>alert</code></td><td style=text-align:left>必须立即采取行动</td><td style=text-align:left>数据库损坏等严重问题。</td></tr><tr><td style=text-align:left><strong>2</strong></td><td style=text-align:left><code>crit</code></td><td style=text-align:left>关键状况</td><td style=text-align:left>硬件错误、磁盘写满。</td></tr><tr><td style=text-align:left><strong>3</strong></td><td style=text-align:left><code>err</code></td><td style=text-align:left><strong>错误</strong></td><td style=text-align:left>软件运行报错，最常关注的级别。</td></tr><tr><td style=text-align:left><strong>4</strong></td><td style=text-align:left><code>warning</code></td><td style=text-align:left>警告</td><td style=text-align:left>配置过时、资源紧张，但暂不影响运行。</td></tr><tr><td style=text-align:left><strong>5</strong></td><td style=text-align:left><code>notice</code></td><td style=text-align:left>普通但重要的消息</td><td style=text-align:left>服务正常启动/停止。</td></tr><tr><td style=text-align:left><strong>6</strong></td><td style=text-align:left><code>info</code></td><td style=text-align:left>信息性消息</td><td style=text-align:left>常规运行日志。</td></tr><tr><td style=text-align:left><strong>7</strong></td><td style=text-align:left><code>debug</code></td><td style=text-align:left>调试信息</td><td style=text-align:left>开发调试用，数据量巨大。</td></tr></tbody></table></div><hr><h2 id=三基础查看与搜索技巧>三、基础查看与搜索技巧</h2><h3 id=1-实时监控-tail>1. 实时监控 (Tail)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基础监控：查看最后 20 行并持续跟踪</span>
</span></span><span class=line><span class=cl>tail -n <span class=m>20</span> -f /var/log/messages
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多文件监控：同时对比系统日志和安全日志（排查服务报错引发的权限问题）</span>
</span></span><span class=line><span class=cl>tail -f /var/log/messages /var/log/secure
</span></span></code></pre></td></tr></table></div></div><h3 id=2-高效浏览-less>2. 高效浏览 (Less)</h3><p><code>less</code> 是查看大日志文件（GB级别）的最佳工具，因为它不会一次性加载整个文件。</p><ul><li><strong>常用快捷键</strong>：<ul><li><code>G</code>：跳到文件末尾（查看最新日志）。</li><li><code>g</code>：跳到文件开头。</li><li><code>/error</code>：向下搜索 &ldquo;error&rdquo;。</li><li><code>?error</code>：向上搜索 &ldquo;error&rdquo;。</li><li><code>Shift+F</code>：进入实时滚动模式（类似 <code>tail -f</code>），按 <code>Ctrl+C</code> 退出回普通浏览。</li></ul></li></ul><h3 id=3-强力搜索-grep-进阶>3. 强力搜索 (Grep 进阶)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 忽略大小写查找错误</span>
</span></span><span class=line><span class=cl>grep -i <span class=s2>&#34;error&#34;</span> /var/log/syslog
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 扩展正则：同时查找 error, fail, fatal, denied</span>
</span></span><span class=line><span class=cl>grep -E -i <span class=s2>&#34;error|fail|fatal|denied&#34;</span> /var/log/messages
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 上下文定位：显示匹配行及其前后各 5 行 (Context)</span>
</span></span><span class=line><span class=cl>grep -C <span class=m>5</span> -i <span class=s2>&#34;oom-killer&#34;</span> /var/log/messages
</span></span><span class=line><span class=cl><span class=c1># -A 5 (After): 后5行, -B 5 (Before): 前5行</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 反向排除：查找错误但排除 debug 信息</span>
</span></span><span class=line><span class=cl>grep -i <span class=s2>&#34;error&#34;</span> /var/log/messages <span class=p>|</span> grep -v <span class=s2>&#34;debug&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=四systemd-时代的日志神器journalctl>四、Systemd 时代的日志神器：journalctl</h2><p><code>journalctl</code> 统一管理了所有由 systemd 启动的服务的日志，支持结构化查询。</p><h3 id=1-时间过滤>1. 时间过滤</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看从昨天到现在的日志</span>
</span></span><span class=line><span class=cl>journalctl --since <span class=s2>&#34;yesterday&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看最近1小时的日志</span>
</span></span><span class=line><span class=cl>journalctl --since <span class=s2>&#34;1 hour ago&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看特定时间段</span>
</span></span><span class=line><span class=cl>journalctl --since <span class=s2>&#34;2024-11-10 10:00:00&#34;</span> --until <span class=s2>&#34;2024-11-10 12:00:00&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-服务与级别过滤>2. 服务与级别过滤</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看 Nginx 服务的错误级别(err)日志</span>
</span></span><span class=line><span class=cl>journalctl -u nginx -p err
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实时跟踪 SSH 服务日志</span>
</span></span><span class=line><span class=cl>journalctl -f -u sshd
</span></span></code></pre></td></tr></table></div></div><h3 id=3-启动记录分析>3. 启动记录分析</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 列出系统所有启动记录</span>
</span></span><span class=line><span class=cl>journalctl --list-boots
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看上一次启动期间的日志（用于排查系统因故障重启前发生了什么）</span>
</span></span><span class=line><span class=cl>journalctl -b -1
</span></span></code></pre></td></tr></table></div></div><h3 id=4-维护日志体积>4. 维护日志体积</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看日志占用的磁盘空间</span>
</span></span><span class=line><span class=cl>journalctl --disk-usage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清理日志，只保留最近 1GB</span>
</span></span><span class=line><span class=cl>journalctl --vacuum-size<span class=o>=</span>1G
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清理日志，只保留最近 7 天</span>
</span></span><span class=line><span class=cl>journalctl --vacuum-time<span class=o>=</span>7d
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=五深度实战分析案例>五、深度实战分析案例</h2><h3 id=案例-1ssh-暴力破解精准画像>案例 1：SSH 暴力破解精准画像</h3><p><strong>场景</strong>：发现服务器变慢，<code>/var/log/secure</code> 疯涨。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 统计前 10 名攻击者 IP</span>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;Failed password&#34;</span> /var/log/secure <span class=p>|</span> awk <span class=s1>&#39;{print $(NF-3)}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10
</span></span><span class=line><span class=cl><span class=c1># 注意：$(NF-3) 表示倒数第4列，这比固定 $11 更通用，适应不同日志格式。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 统计攻击者尝试猜测的用户名</span>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;Failed password&#34;</span> /var/log/secure <span class=p>|</span> awk <span class=s1>&#39;{print $(NF-5)}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 使用 lastb 查看二进制记录（更防篡改）</span>
</span></span><span class=line><span class=cl>lastb <span class=p>|</span> awk <span class=s1>&#39;{print $3}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10
</span></span></code></pre></td></tr></table></div></div><h3 id=案例-2内存泄漏与-oom-out-of-memory>案例 2：内存泄漏与 OOM (Out Of Memory)</h3><p><strong>场景</strong>：MySQL 或 Java 应用突然崩溃，没有产生应用日志。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 搜索内核日志中的 OOM Killer 记录</span>
</span></span><span class=line><span class=cl>grep -i <span class=s2>&#34;killed process&#34;</span> /var/log/messages
</span></span><span class=line><span class=cl><span class=c1># 或者</span>
</span></span><span class=line><span class=cl>dmesg <span class=p>|</span> grep -i <span class=s2>&#34;oom&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 journalctl 查看详细上下文</span>
</span></span><span class=line><span class=cl>journalctl -k <span class=p>|</span> grep -i -C <span class=m>5</span> <span class=s2>&#34;out of memory&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解读输出：</span>
</span></span><span class=line><span class=cl><span class=c1># kernel: Out of memory: Kill process 1234 (java) score 800 or sacrifice child</span>
</span></span><span class=line><span class=cl><span class=c1># 含义：进程 1234 (java) 占用内存过高，被内核强制杀死以保护系统。</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=案例-3定位流量请求异常>案例 3：定位流量/请求异常</h3><p><strong>场景</strong>：Web 访问日志分析（以 Nginx 为例）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 找出 HTTP 状态码非 200 的分布</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $9}&#39;</span> /var/log/nginx/access.log <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -rn
</span></span><span class=line><span class=cl><span class=c1># $9 通常是状态码</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 找出访问最慢的 10 个请求（假设日志配置了响应时间在最后）</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $NF &#34; &#34; $7}&#39;</span> /var/log/nginx/access.log <span class=p>|</span> sort -nr <span class=p>|</span> head -10
</span></span><span class=line><span class=cl><span class=c1># $NF: 最后一列(响应时间), $7: 请求路径</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 统计每分钟的请求数（查看并发波峰）</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $4}&#39;</span> /var/log/nginx/access.log <span class=p>|</span> cut -c 14-18 <span class=p>|</span> sort <span class=p>|</span> uniq -c
</span></span><span class=line><span class=cl><span class=c1># 截取时间字段中的分钟部分</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=六自动化日志分析脚本-enhanced>六、自动化日志分析脚本 (Enhanced)</h2><p>保存为 <code>log_audit.sh</code>，赋予执行权限 <code>chmod +x log_audit.sh</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># Linux 系统日志健康检查脚本</span>
</span></span><span class=line><span class=cl><span class=c1># 适用：CentOS/Ubuntu/Debian</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;/var/log/messages&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span> -f /var/log/syslog <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;/var/log/syslog&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>SECURE_LOG</span><span class=o>=</span><span class=s2>&#34;/var/log/secure&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span> -f /var/log/auth.log <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nv>SECURE_LOG</span><span class=o>=</span><span class=s2>&#34;/var/log/auth.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>DATE_TODAY</span><span class=o>=</span><span class=k>$(</span>date <span class=s2>&#34;+%b %e&#34;</span><span class=k>)</span> <span class=c1># 格式如: &#34;Nov 11&#34; (注意: %e单数字日期前有空格)</span>
</span></span><span class=line><span class=cl><span class=nv>REPORT_FILE</span><span class=o>=</span><span class=s2>&#34;/tmp/sys_audit_</span><span class=k>$(</span>date +%Y%m%d<span class=k>)</span><span class=s2>.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;====== 系统日志审计报告 [</span><span class=k>$(</span>date<span class=k>)</span><span class=s2>] ======&#34;</span> &gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. 错误概览</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n[1] 今日错误与警告统计 (</span><span class=nv>$DATE_TODAY</span><span class=s2>)&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;---------------------------------&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;</span><span class=nv>$DATE_TODAY</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span> <span class=p>|</span> grep -E -i <span class=s2>&#34;error|fail|critical|alert|emerg&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{$1=$2=$3=&#34;&#34;; print $0}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10 &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 暴力破解检测</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n[2] 今日 SSH 失败登录 TOP 10 IP&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;---------------------------------&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;</span><span class=nv>$DATE_TODAY</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$SECURE_LOG</span><span class=s2>&#34;</span> <span class=p>|</span> grep <span class=s2>&#34;Failed password&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{for(i=1;i&lt;=NF;i++) if($i~/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/) print $i}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10 &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 关键硬件与内核事件</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n[3] 硬件与内核异常 (dmesg)&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;---------------------------------&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>dmesg <span class=p>|</span> grep -E -i <span class=s2>&#34;error|fail|warn|temp|sector&#34;</span> <span class=p>|</span> tail -10 &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 磁盘空间检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n[4] 磁盘空间使用情况&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;---------------------------------&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>df -h <span class=p>|</span> grep -E <span class=s2>&#34;^/dev&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;$5 &gt; &#34;85%&#34; {print &#34;警告: &#34; $1 &#34; 使用率 &#34; $5}&#39;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;审计完成，报告已生成: </span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>cat <span class=s2>&#34;</span><span class=nv>$REPORT_FILE</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=七日志轮转-logrotate-核心配置>七、日志轮转 (Logrotate) 核心配置</h2><p>防止日志占满磁盘的关键机制。配置文件位于 <code>/etc/logrotate.conf</code> 和 <code>/etc/logrotate.d/</code>。</p><p><strong>常用配置解释：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=c1># /etc/logrotate.d/nginx
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>/var/log/nginx/*.log</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>daily</span>                   <span class=c1># 每天切割
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>rotate</span> <span class=mi>14</span>               <span class=c1># 保留最近14份
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>missingok</span>               <span class=c1># 日志不存在不报错
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>notifempty</span>              <span class=c1># 空文件不切割
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>compress</span>                <span class=c1># 切割后的旧日志使用 gzip 压缩
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>delaycompress</span>           <span class=c1># 延迟一天压缩（防止当前还有进程在写）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>sharedscripts</span>           <span class=c1># 所有日志切完后只执行一次脚本
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s>postrotate</span>
</span></span><span class=line><span class=cl>        <span class=c1># 发送信号给 Nginx 让其重新生成日志文件
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=s>if</span> <span class=s>[</span> <span class=s>-f</span> <span class=s>/var/run/nginx.pid</span> <span class=s>]</span><span class=p>;</span> <span class=kn>then</span>
</span></span><span class=line><span class=cl>            <span class=s>kill</span> <span class=s>-USR1</span> <span class=s>`cat</span> <span class=s>/var/run/nginx.pid`</span>
</span></span><span class=line><span class=cl>        <span class=s>fi</span>
</span></span><span class=line><span class=cl>    <span class=s>endscript</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>强制测试命令</strong>（修改配置后验证用）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>logrotate -d -f /etc/logrotate.d/nginx
</span></span><span class=line><span class=cl><span class=c1># -d: Debug 模式（不实际操作）</span>
</span></span><span class=line><span class=cl><span class=c1># -f: Force 强制立即执行</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=八故障排查速查表>八、故障排查速查表</h2><div class=table-wrapper><table><thead><tr><th style=text-align:left>现象</th><th style=text-align:left>可能原因</th><th style=text-align:left>排查命令 (优先级从高到低)</th></tr></thead><tbody><tr><td style=text-align:left><strong>服务器连不上</strong></td><td style=text-align:left>网络/SSHD死锁/防火墙</td><td style=text-align:left>1. 控制台登录<br>2. <code>systemctl status sshd</code><br>3. <code>iptables -L -n</code></td></tr><tr><td style=text-align:left><strong>服务自动停止</strong></td><td style=text-align:left>内存溢出/配置错误</td><td style=text-align:left>1. <code>journalctl -u &lt;服务> -e</code><br>2. `dmesg</td></tr><tr><td style=text-align:left><strong>磁盘空间满</strong></td><td style=text-align:left>日志未轮转/大文件</td><td style=text-align:left>1. <code>du -sh /*</code> (定位大目录)<br>2. `lsof</td></tr><tr><td style=text-align:left><strong>系统负载高</strong></td><td style=text-align:left>进程死循环/IO瓶颈</td><td style=text-align:left>1. <code>top</code><br>2. <code>iostat -x 1</code><br>3. 查看日志中是否有大量重复报错</td></tr><tr><td style=text-align:left><strong>文件无法写入</strong></td><td style=text-align:left>权限/磁盘满/inode满</td><td style=text-align:left>1. <code>ls -ld &lt;目录></code><br>2. <code>df -h</code><br>3. <code>df -i</code> (查inode节点)</td></tr><tr><td style=text-align:left><strong>时间不准</strong></td><td style=text-align:left>时区/NTP服务</td><td style=text-align:left>1. <code>timedatectl</code><br>2. <code>grep "ntp" /var/log/messages</code></td></tr></tbody></table></div></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/linux/clash%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/><div class=article-details><h2 class=article-title>Linuxclash</h2></div></a></article><article><a href=/utility/wireshar/><div class=article-details><h2 class=article-title>Wireshar</h2></div></a></article><article><a href=/utility/tcpdump/><div class=article-details><h2 class=article-title>Tcpdump</h2></div></a></article><article><a href=/utility/ansible/><div class=article-details><h2 class=article-title>Ansible</h2></div></a></article><article><a href=/utility/jenkins/><div class=article-details><h2 class=article-title>Jenkins</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>