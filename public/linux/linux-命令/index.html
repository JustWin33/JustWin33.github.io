<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="🐧 Linux 运维命令手册 适用场景：系统管理、故障排查、性能调优、自动化运维 核心原则：生产环境安全第一，操作前确认，高危命令需谨慎。\n📂 第一章：核心文件与目录管理 1.1 目录列表与切换 (ls, cd, pwd) ls (List)：查看目录内容\n"><title>Linux命令</title><link rel=canonical href=http://localhost:1313/linux/linux-%E5%91%BD%E4%BB%A4/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Linux命令"><meta property='og:description' content="🐧 Linux 运维命令手册 适用场景：系统管理、故障排查、性能调优、自动化运维 核心原则：生产环境安全第一，操作前确认，高危命令需谨慎。\n📂 第一章：核心文件与目录管理 1.1 目录列表与切换 (ls, cd, pwd) ls (List)：查看目录内容\n"><meta property='og:url' content='http://localhost:1313/linux/linux-%E5%91%BD%E4%BB%A4/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Linux'><meta property='article:published_time' content='2025-11-08T00:00:00+00:00'><meta property='article:modified_time' content='2025-11-08T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="Linux命令"><meta name=twitter:description content="🐧 Linux 运维命令手册 适用场景：系统管理、故障排查、性能调优、自动化运维 核心原则：生产环境安全第一，操作前确认，高危命令需谨慎。\n📂 第一章：核心文件与目录管理 1.1 目录列表与切换 (ls, cd, pwd) ls (List)：查看目录内容\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#-第一章核心文件与目录管理>📂 第一章：核心文件与目录管理</a><ol><li><a href=#11-目录列表与切换-ls-cd-pwd>1.1 目录列表与切换 (<code>ls</code>, <code>cd</code>, <code>pwd</code>)</a></li><li><a href=#12-文件增删改-mkdir-rm-cp-mv-touch>1.2 文件增删改 (<code>mkdir</code>, <code>rm</code>, <code>cp</code>, <code>mv</code>, <code>touch</code>)</a></li></ol></li><li><a href=#-第二章系统资源与性能深度监控>📊 第二章：系统资源与性能深度监控</a><ol><li><a href=#21-cpu-与-进程-top-htop-vmstat-mpstat>2.1 CPU 与 进程 (<code>top</code>, <code>htop</code>, <code>vmstat</code>, <code>mpstat</code>)</a></li><li><a href=#22-内存分析-free-pmap-smem>2.2 内存分析 (<code>free</code>, <code>pmap</code>, <code>smem</code>)</a></li><li><a href=#23-磁盘-io-iostat-iotop-du-df>2.3 磁盘 IO (<code>iostat</code>, <code>iotop</code>, <code>du</code>, <code>df</code>)</a></li><li><a href=#24-网络流量-iftop-ss-tcpdump>2.4 网络流量 (<code>iftop</code>, <code>ss</code>, <code>tcpdump</code>)</a></li></ol></li><li><a href=#-第三章文本处理三剑客-运维必修>📝 第三章：文本处理“三剑客” (运维必修)</a><ol><li><a href=#31-grep-文本搜索>3.1 <code>grep</code> (文本搜索)</a></li><li><a href=#32-awk-文本处理与统计>3.2 <code>awk</code> (文本处理与统计)</a></li><li><a href=#33-sed-流编辑器>3.3 <code>sed</code> (流编辑器)</a></li></ol></li><li><a href=#-第四章进程全生命周期管理>💻 第四章：进程全生命周期管理</a><ol><li><a href=#41-查找进程-ps-pgrep>4.1 查找进程 (<code>ps</code>, <code>pgrep</code>)</a></li><li><a href=#42-控制进程-kill-nohup>4.2 控制进程 (<code>kill</code>, <code>nohup</code>)</a></li></ol></li><li><a href=#-第五章系统服务与日志-systemd>🛠️ 第五章：系统服务与日志 (Systemd)</a><ol><li><a href=#51-服务管理-systemctl>5.1 服务管理 (<code>systemctl</code>)</a></li><li><a href=#52-日志查询-journalctl>5.2 日志查询 (<code>journalctl</code>)</a></li></ol></li><li><a href=#-第六章压缩备份与传输>📦 第六章：压缩、备份与传输</a><ol><li><a href=#61-打包与压缩-tar>6.1 打包与压缩 (<code>tar</code>)</a></li><li><a href=#62-同步与传输-rsync>6.2 同步与传输 (<code>rsync</code>)</a></li></ol></li><li><a href=#-第七章用户权限与安全>🔐 第七章：用户权限与安全</a><ol><li><a href=#71-权限控制-chmod-chown>7.1 权限控制 (<code>chmod</code>, <code>chown</code>)</a></li><li><a href=#72-特殊权限与安全>7.2 特殊权限与安全</a></li></ol></li><li><a href=#-第八章内核调优与硬件信息-专家级>⚙️ 第八章：内核调优与硬件信息 (专家级)</a><ol><li><a href=#81-硬件查看>8.1 硬件查看</a></li><li><a href=#82-内核参数-sysctl>8.2 内核参数 (<code>sysctl</code>)</a></li></ol></li><li><a href=#-第九章生产环境故障排查实战案例>🧩 第九章：生产环境故障排查实战案例</a><ol><li><a href=#案例-1cpu-100-但找不到高负载进程>案例 1：CPU 100% 但找不到高负载进程</a></li><li><a href=#案例-2磁盘满了但-du-统计不到大文件>案例 2：磁盘满了但 <code>du</code> 统计不到大文件</a></li><li><a href=#案例-3网络连接数暴增>案例 3：网络连接数暴增</a></li></ol></li><li><a href=#-第十章自动化巡检脚本模板>📜 第十章：自动化巡检脚本模板</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/linux/linux-%E5%91%BD%E4%BB%A4/>Linux命令</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-11-08</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 7 分钟</time></div></footer></div></header><section class=article-content><h1 id=-linux-运维命令手册>🐧 Linux 运维命令手册</h1><p><strong>适用场景</strong>：系统管理、故障排查、性能调优、自动化运维
<strong>核心原则</strong>：生产环境安全第一，操作前确认，高危命令需谨慎。</p><hr><h2 id=-第一章核心文件与目录管理>📂 第一章：核心文件与目录管理</h2><h3 id=11-目录列表与切换-ls-cd-pwd>1.1 目录列表与切换 (<code>ls</code>, <code>cd</code>, <code>pwd</code>)</h3><ul><li><p><strong><code>ls</code> (List)</strong>：查看目录内容</p><ul><li><code>ls -lhS --color=auto</code>：<strong>[运维推荐]</strong> 按文件大小排序，显示人类可读单位 (KB/MB)，带颜色区分。</li><li><code>ls -lart</code>：按修改时间倒序排列（最新的在最下），常用于快速查看最近改动的文件。</li><li><code>ls -i</code>：查看 inode 号（排查硬链接或文件名乱码无法删除时使用）。</li><li><code>ls -Z</code>：查看 SELinux 上下文。</li></ul></li><li><p><strong><code>cd</code> (Change Directory)</strong></p><ul><li><code>cd -</code>：<strong>[高频]</strong> 快速回到上一次所在的目录。</li><li><code>cd ~</code> / <code>cd</code>：回到当前用户家目录。</li></ul></li><li><p><strong><code>pwd</code> (Print Working Directory)</strong></p><ul><li><code>pwd -P</code>：显示真实的物理路径（解析软链接后的路径）。</li></ul></li></ul><h3 id=12-文件增删改-mkdir-rm-cp-mv-touch>1.2 文件增删改 (<code>mkdir</code>, <code>rm</code>, <code>cp</code>, <code>mv</code>, <code>touch</code>)</h3><ul><li><p><strong><code>mkdir</code> (Make Directory)</strong></p><ul><li><code>mkdir -p /path/to/dir</code>：递归创建多级目录，若存在不报错。</li><li><code>mkdir -m 755 /path</code>：创建目录时直接指定权限。</li></ul></li><li><p><strong><code>rm</code> (Remove) —— ⚠️ 高危命令</strong></p><ul><li><strong>[黄金法则]</strong>：先 <code>ls</code> 确认文件，再 <code>rm</code>。例如：<code>ls /tmp/garbage && rm -rf /tmp/garbage</code>。</li><li><strong>[安全技巧]</strong>：在 <code>.bashrc</code> 中设置别名 <code>alias rm='rm -i'</code> (删除前确认) 或 <code>alias rm='rm --preserve-root'</code> (防删根目录)。</li><li><code>rm -rf /path</code>：强制递归删除，不可恢复。</li></ul></li><li><p><strong><code>cp</code> (Copy)</strong></p><ul><li><code>cp -a source dest</code>：<strong>[备份首选]</strong> 等同于 <code>-dR --preserve=all</code>，完整保留权限、时间戳、链接等属性。</li><li><code>cp -u source dest</code>：增量复制，仅当源文件比目标新或目标不存在时才复制。</li></ul></li><li><p><strong><code>mv</code> (Move)</strong></p><ul><li><code>mv -n file1 file2</code>：不覆盖已存在的目标文件。</li><li><code>mv -t target_dir source_files</code>：将多个源文件移动到目标目录。</li></ul></li><li><p><strong><code>touch</code></strong></p><ul><li><code>touch -t 202501011200 file</code>：修改文件时间戳为指定时间。</li><li><code>touch -r ref_file file</code>：将 <code>file</code> 的时间戳改成与 <code>ref_file</code> 一致。</li></ul></li></ul><hr><h2 id=-第二章系统资源与性能深度监控>📊 第二章：系统资源与性能深度监控</h2><h3 id=21-cpu-与-进程-top-htop-vmstat-mpstat>2.1 CPU 与 进程 (<code>top</code>, <code>htop</code>, <code>vmstat</code>, <code>mpstat</code>)</h3><ul><li><p><strong><code>top</code> (实时监控)</strong></p><ul><li><code>top -Hp &lt;PID></code>：<strong>[排查神器]</strong> 查看指定进程内的所有<strong>线程</strong>资源占用（排查 Java/Go 高负载关键）。</li><li><code>top -b -n 1 > top.log</code>：批处理模式，将快照保存到文件。</li><li><em>交互快捷键</em>：<code>P</code> (按CPU排序), <code>M</code> (按内存排序), <code>1</code> (显示多核详情)。</li></ul></li><li><p><strong><code>vmstat</code> (虚拟内存统计)</strong></p><ul><li><code>vmstat 1 10</code>：每秒刷新1次，共10次。</li><li><strong>[关键指标解读]</strong>：<ul><li><code>r</code> (Running)：运行队列，超过 CPU 核数表示 CPU 瓶颈。</li><li><code>si</code>/<code>so</code> (Swap In/Out)：非 0 表示内存不足，正在使用交换分区。</li><li><code>wa</code> (IO Wait)：持续 >20% 说明磁盘 IO 是瓶颈。</li></ul></li></ul></li><li><p><strong><code>mpstat</code> (多核 CPU 分析)</strong></p><ul><li><code>mpstat -P ALL 1</code>：显示每个 CPU 核心的独立利用率，排查单核被打满的情况。</li></ul></li></ul><h3 id=22-内存分析-free-pmap-smem>2.2 内存分析 (<code>free</code>, <code>pmap</code>, <code>smem</code>)</h3><ul><li><p><strong><code>free</code></strong></p><ul><li><code>free -h</code>：人类可读格式。</li><li><strong>[避坑]</strong>：不要只看 <code>free</code> 列，<code>available</code> 才是真正应用程序可用的内存。</li></ul></li><li><p><strong><code>pmap</code> (进程内存映射)</strong></p><ul><li><code>pmap -x &lt;PID></code>：查看进程详细内存分布，排查内存泄漏。</li></ul></li></ul><h3 id=23-磁盘-io-iostat-iotop-du-df>2.3 磁盘 IO (<code>iostat</code>, <code>iotop</code>, <code>du</code>, <code>df</code>)</h3><ul><li><p><strong><code>iostat</code></strong></p><ul><li><code>iostat -x 1 10</code>：显示扩展统计信息。</li><li><strong>[关键指标]</strong>：<code>%util</code> (设备利用率) >80% 为瓶颈；<code>await</code> (平均响应时间) >10ms 需关注。</li></ul></li><li><p><strong><code>du</code> / <code>df</code></strong></p><ul><li><code>df -h</code>：查看磁盘挂载点使用率（生产红线：>85% 预警）。</li><li><code>df -i</code>：查看 inode 使用率（inode 耗尽会导致无法写入）。</li><li><code>du -h --max-depth=1 /var | sort -hr | head -10</code>：<strong>[实战]</strong> 快速找出 <code>/var</code> 下最大的一级子目录。</li></ul></li></ul><h3 id=24-网络流量-iftop-ss-tcpdump>2.4 网络流量 (<code>iftop</code>, <code>ss</code>, <code>tcpdump</code>)</h3><ul><li><p><strong><code>ss</code> (Socket Statistics - 推荐替代 netstat)</strong></p><ul><li><code>ss -tuln</code>：显示所有监听的 TCP/UDP 端口。</li><li><code>ss -s</code>：显示 Socket 统计摘要（快速查看连接总数）。</li><li><code>ss -o state established '( dport = :22 or sport = :22 )'</code>：过滤特定端口的已建立连接。</li></ul></li><li><p><strong><code>tcpdump</code> (抓包 - 网络排障核心)</strong></p><ul><li><code>tcpdump -i eth0 -nn -s0 -v port 80</code>：抓取 HTTP 流量。</li><li><code>tcpdump -i any -nn host 1.2.3.4</code>：抓取与特定 IP 的交互。</li><li><code>tcpdump -w capture.pcap</code>：保存为文件供 Wireshark 分析。</li><li><code>tcpdump -A -s0 port 80</code>：以 ASCII 码显示包内容（可看 HTTP Body）。</li></ul></li></ul><hr><h2 id=-第三章文本处理三剑客-运维必修>📝 第三章：文本处理“三剑客” (运维必修)</h2><h3 id=31-grep-文本搜索>3.1 <code>grep</code> (文本搜索)</h3><ul><li><strong>基础</strong>：<code>grep -i "error" file</code> (忽略大小写)；<code>grep -v "info" file</code> (反选，排除)。</li><li><strong>正则</strong>：<code>grep -E "error|warn" file</code> (匹配多个关键字)。</li><li><strong>上下文</strong>：<code>grep -C 5 "exception" file</code> (显示匹配行前后 5 行，<code>-A</code> 后，<code>-B</code> 前)。</li><li><strong>统计</strong>：<code>grep -c "404" access.log</code> (统计行数)。</li></ul><h3 id=32-awk-文本处理与统计>3.2 <code>awk</code> (文本处理与统计)</h3><ul><li><strong>提取列</strong>：<code>awk '{print $1, $NF}' file</code> (打印第1列和最后一列)。</li><li><strong>条件过滤</strong>：<code>awk '$9=="500" {print $0}' access.log</code> (打印第9列为500的行)。</li><li><strong>[实战] Nginx 日志分析 Top IP</strong>：<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>awk <span class=s1>&#39;{print $1}&#39;</span> access.log <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=33-sed-流编辑器>3.3 <code>sed</code> (流编辑器)</h3><ul><li><strong>替换</strong>：<code>sed 's/old/new/g' file</code> (全局替换输出，不改源文件)。</li><li><strong>修改文件</strong>：<code>sed -i 's/PORT/8080/g' config.conf</code> (直接修改文件，建议先备份)。</li><li><strong>时间范围提取</strong>：<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sed -n <span class=s1>&#39;/2024-01-01 10:00/,/2024-01-01 11:00/p&#39;</span> access.log
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h2 id=-第四章进程全生命周期管理>💻 第四章：进程全生命周期管理</h2><h3 id=41-查找进程-ps-pgrep>4.1 查找进程 (<code>ps</code>, <code>pgrep</code>)</h3><ul><li><code>ps aux --sort=-%cpu</code>：显示所有进程并按 CPU 使用率降序排列。</li><li><code>pgrep -f "java -jar app.jar"</code>：按完整命令行查找 PID。</li><li><code>pstree -p</code>：以树状图显示进程关系及 PID。</li></ul><h3 id=42-控制进程-kill-nohup>4.2 控制进程 (<code>kill</code>, <code>nohup</code>)</h3><ul><li><p><strong><code>kill</code></strong></p><ul><li><code>kill -15 &lt;PID></code>：<strong>[推荐]</strong> 发送 TERM 信号，让进程优雅退出（保存数据、关闭句柄）。</li><li><code>kill -9 &lt;PID></code>：强制杀死进程，可能导致数据丢失，仅在进程卡死时使用。</li><li><code>kill -HUP &lt;PID></code>：让进程重载配置（如 Nginx 平滑重启）。</li></ul></li><li><p><strong><code>nohup</code></strong></p><ul><li><code>nohup java -jar app.jar > app.log 2>&amp;1 &</code>：标准后台运行写法，防挂断，重定向标准输出和错误。</li></ul></li></ul><hr><h2 id=-第五章系统服务与日志-systemd>🛠️ 第五章：系统服务与日志 (Systemd)</h2><h3 id=51-服务管理-systemctl>5.1 服务管理 (<code>systemctl</code>)</h3><ul><li><code>systemctl status/start/stop/restart nginx</code>：基本控制。</li><li><code>systemctl enable nginx</code>：设置开机自启。</li><li><code>systemctl list-units --type=service --state=failed</code>：<strong>[实战]</strong> 快速列出所有启动失败的服务。</li></ul><h3 id=52-日志查询-journalctl>5.2 日志查询 (<code>journalctl</code>)</h3><ul><li><code>journalctl -u nginx -f</code>：实时跟踪特定服务的日志。</li><li><code>journalctl --since "10 minutes ago"</code>：查看最近 10 分钟的日志。</li><li><code>journalctl -p err</code>：只看错误级别的日志。</li><li><code>journalctl --disk-usage</code>：查看日志占用了多少磁盘。</li></ul><hr><h2 id=-第六章压缩备份与传输>📦 第六章：压缩、备份与传输</h2><h3 id=61-打包与压缩-tar>6.1 打包与压缩 (<code>tar</code>)</h3><ul><li><strong>压缩</strong>：<code>tar -czf backup.tar.gz /data</code><ul><li><code>-c</code>: 创建, <code>-z</code>: gzip压缩, <code>-f</code>: 指定文件名。</li></ul></li><li><strong>解压</strong>：<code>tar -xzf backup.tar.gz -C /opt</code><ul><li><code>-x</code>: 解压, <code>-C</code>: 指定解压目录。</li></ul></li><li><strong>查看</strong>：<code>tar -tzf backup.tar.gz</code> (不解压查看内容)。</li></ul><h3 id=62-同步与传输-rsync>6.2 同步与传输 (<code>rsync</code>)</h3><ul><li><strong><code>rsync</code> (运维神器)</strong><ul><li><code>rsync -avz /src/ /dst/</code>：同步目录（<code>-a</code> 归档模式保留属性, <code>-v</code> 详细, <code>-z</code> 压缩传输）。</li><li><code>rsync -avz --delete /src/ /dst/</code>：<strong>[慎用]</strong> 镜像同步，目标端多余文件会被删除。</li><li><code>rsync -avz --bwlimit=10240 /src/ user@host:/dst/</code>：限速 10MB/s 传输，防止占满带宽。</li></ul></li></ul><hr><h2 id=-第七章用户权限与安全>🔐 第七章：用户权限与安全</h2><h3 id=71-权限控制-chmod-chown>7.1 权限控制 (<code>chmod</code>, <code>chown</code>)</h3><ul><li><code>chmod 755 file</code> (rwx-r-x-r-x) / <code>chmod 644 file</code> (rw-r&ndash;r&ndash;)。</li><li><code>chmod +x script.sh</code>：赋予执行权限。</li><li><code>chown -R user:group /data</code>：递归修改目录的所有者和所属组。</li></ul><h3 id=72-特殊权限与安全>7.2 特殊权限与安全</h3><ul><li><code>lsattr / chattr</code>：<ul><li><code>chattr +i file</code>：<strong>[安全加固]</strong> 锁定文件，root 也无法修改或删除（适用于 <code>/etc/passwd</code> 等关键文件）。</li><li><code>chattr -i file</code>：解锁文件。</li></ul></li><li><code>w</code> / <code>last</code>：查看当前登录用户及历史登录记录，排查非法入侵。</li></ul><hr><h2 id=-第八章内核调优与硬件信息-专家级>⚙️ 第八章：内核调优与硬件信息 (专家级)</h2><h3 id=81-硬件查看>8.1 硬件查看</h3><ul><li><code>lscpu</code>：查看 CPU 架构、核数。</li><li><code>lsblk</code> / <code>fdisk -l</code>：查看磁盘分区情况。</li><li><code>dmidecode -t memory</code>：查看内存硬件条数、频率。</li></ul><h3 id=82-内核参数-sysctl>8.2 内核参数 (<code>sysctl</code>)</h3><ul><li><code>sysctl -a</code>：查看所有内核参数。</li><li><code>sysctl -p</code>：加载 <code>/etc/sysctl.conf</code> 配置。</li><li><strong>[常见调优]</strong>：<ul><li>减少 Swap 使用：<code>vm.swappiness = 10</code></li><li>开启端口复用：<code>net.ipv4.tcp_tw_reuse = 1</code> (解决大量 TIME_WAIT)。</li></ul></li></ul><hr><h2 id=-第九章生产环境故障排查实战案例>🧩 第九章：生产环境故障排查实战案例</h2><h3 id=案例-1cpu-100-但找不到高负载进程>案例 1：CPU 100% 但找不到高负载进程</h3><p><strong>现象</strong>：<code>top</code> 显示 CPU 使用率高，但进程列表无异常。
<strong>分析</strong>：可能是短命进程（频繁启动退出）或 IO 等待。
<strong>排查</strong>：</p><ol><li>看 <code>top</code> 中的 <code>wa</code> (IO Wait) 是否高。</li><li><code>perf top</code> 查看热点函数。</li><li>如果 <code>wa</code> 高，用 <code>iotop -oP</code> 抓出正在进行磁盘读写的进程。</li></ol><h3 id=案例-2磁盘满了但-du-统计不到大文件>案例 2：磁盘满了但 <code>du</code> 统计不到大文件</h3><p><strong>现象</strong>：<code>df -h</code> 显示 100%，但 <code>du -sh /</code> 显示占用很少。
<strong>原因</strong>：文件被删除（rm），但进程仍持有句柄，空间未释放。
<strong>排查</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsof <span class=p>|</span> grep deleted
</span></span></code></pre></td></tr></table></div></div><p><strong>解决</strong>：重启对应进程，或 <code>echo > /proc/&lt;PID>/fd/&lt;FD></code> 清空文件描述符。</p><h3 id=案例-3网络连接数暴增>案例 3：网络连接数暴增</h3><p><strong>排查</strong>：</p><ol><li><code>ss -s</code> 查看总连接数。</li><li><code>netstat -anp | grep ESTABLISHED | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr | head</code> 找出连接数最多的来源 IP。</li></ol><hr><h2 id=-第十章自动化巡检脚本模板>📜 第十章：自动化巡检脚本模板</h2><p>将以下脚本保存为 <code>check.sh</code> 即可快速进行系统体检：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># 系统健康检查简易脚本</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;===== System Check </span><span class=k>$(</span>date<span class=k>)</span><span class=s2> =====&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. 负载检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Load Average ---&#34;</span>
</span></span><span class=line><span class=cl>uptime
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 内存检查 (重点看 available)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Memory ---&#34;</span>
</span></span><span class=line><span class=cl>free -h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 磁盘空间 (&gt;85% 需警惕)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Disk Usage ---&#34;</span>
</span></span><span class=line><span class=cl>df -h <span class=p>|</span> grep -E <span class=s1>&#39;^/dev&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 磁盘 IO 检查 (查看是否有设备利用率超标)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Disk IO ---&#34;</span>
</span></span><span class=line><span class=cl>iostat -x <span class=m>1</span> <span class=m>1</span> <span class=p>|</span> awk <span class=s1>&#39;$NF &gt; 80 {print &#34;WARNING: High IO on &#34; $1}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 网络连接概况</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Network Connections ---&#34;</span>
</span></span><span class=line><span class=cl>ss -s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 检查失败的服务</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Failed Services ---&#34;</span>
</span></span><span class=line><span class=cl>systemctl list-units --type<span class=o>=</span>service --state<span class=o>=</span>failed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;===== Check Complete =====&#34;</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/k8s/kubernetes%E5%85%A8%E6%A0%88%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/><div class=article-details><h2 class=article-title>Kubernetes全栈知识体系</h2></div></a></article><article><a href=/linux/vmware-ubuntu/><div class=article-details><h2 class=article-title>Ubuntu</h2></div></a></article><article><a href=/project/%E9%A1%B9%E7%9B%AE04centos%E9%83%A8%E7%BD%B2mha/><div class=article-details><h2 class=article-title>centos部署MHA</h2></div></a></article><article><a href=/docker/docker%E6%BA%90/><div class=article-details><h2 class=article-title>docker源</h2></div></a></article><article><a href=/linux/%E4%BF%AE%E6%94%B9%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/><div class=article-details><h2 class=article-title>修改网络配置</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>