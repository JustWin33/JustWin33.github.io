<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Linux 命令 作为运维工程师，我为您深度挖掘全网权威资料，整理出这份涵盖基础到内核级调试的完整命令手册。每个命令都包含生产环境实战技巧和避坑指南。\n一、基础命令深度解析（运维视角） 1.1 文件目录操作（含性能优化） ls - 目录列表 1 2 3 4 5 6 7 8 # 运维必用组合：按大小排序，显示隐藏文件，人性化单位 ls -lhS --color=auto # 按大小排序，人类可读 ls -lart # 按修改时间倒序（最新在最后） ls -i # 显示inode号（排查硬链接问题） ls -Z # 显示SELinux上下文 # 生产环境技巧：快速找出大目录 du -h --max-depth=1 /var | sort -hr | head -10 cd - 切换目录 1 2 3 4 5 6 7 cd - # 快速返回上次目录（运维高频操作） cd .. # 返回上级 cd ~ # 返回home目录 cd / # 返回根目录 # 高级技巧：自动纠正拼写错误 shopt -s cdspell # 开启cd命令自动纠错 pwd - 显示当前路径 1 2 pwd -P # 显示物理路径（解析符号链接） pwd -L # 显示逻辑路径（默认） mkdir - 创建目录 1 2 3 mkdir -p /path/to/dir # 递归创建（-p = parents） mkdir -m 755 /path # 直接指定权限 mkdir -v /path # 显示创建过程 rm - 删除文件/目录（⚠️高危命令） 1 2 3 4 5 6 7 8 9 # 生产环境黄金法则：先ls确认，再rm删除 ls /path/to/delete && rm -rf /path/to/delete # 安全删除：使用trash-cli替代rm # rm -rf 的危险性：删除后无法恢复，操作前务必确认 # 运维技巧：限制rm别名防止误删 alias rm=&#39;rm -i&#39; # 删除前提示确认 alias rm=&#39;rm --preserve-root&#39; # 防止删除根目录 cp - 复制文件 1 2 3 4 5 cp -a source dest # -a = -dR --preserve=all，保留所有属性（备份首选） cp -r dir1 dir2 # 递归复制目录 cp -u source dest # 只复制更新的文件（update） cp -p source dest # 保留文件属性（时间戳、权限等） cp --sparse=always # 优化稀疏文件复制（虚拟机镜像） mv - 移动/重命名文件 1 2 3 mv -i file1 file2 # 交互式，覆盖前提示 mv -n file1 file2 # 不覆盖已存在文件 mv -t target_dir source_files # 指定目标目录 touch - 修改时间戳 1 2 3 4 touch file # 不存在则创建，存在则更新时间为当前 touch -c file # 不创建新文件 touch -t 202501011200 file # 指定时间戳 touch -r ref_file file # 使用参考文件的时间 1.2 文件查看与编辑 cat - 连接文件并打印 1 2 3 cat -n file # 显示行号 cat -A file # 显示所有控制字符（包括换行符$） cat file1 file2 > file3 # 合并文件 more - 分页查看 1 2 more +100 file # 从第100行开始显示 more -d file # 显示帮助提示 less - 增强分页查看（运维首选） 1 2 3 4 5 6 less -N file # 显示行号 less +F file # 实时跟踪文件更新（类似tail -f） less -S file # 不换行显示（查看宽日志） # 内部命令： # /pattern 搜索 n/N 下一个/上一个 # g 跳到行首 G 跳到行尾 q 退出 head - 查看文件头部 1 2 3 head -n 20 file # 显示前20行 head -c 100 file # 显示前100字节 head -n -5 file # 显示除最后5行的所有内容 tail - 查看文件尾部（运维高频） 1 2 3 4 5 6 7 8 tail -f file # 实时跟踪文件更新（日志监控） tail -F file # 跟踪文件，即使文件被旋转也继续 tail -n 100 file # 显示最后100行 tail -c 100 file # 显示最后100字节 tail -n +100 file # 从第100行开始显示 # 生产技巧：同时查看多个日志 tail -f /var/log/*.log vim - 文本编辑器（运维必备） 1 2 3 4 5 6 7 8 9 10 11 12 # 常用操作 vim +100 file # 打开文件并定位到第100行 vim -R file # 只读模式打开 # 内部命令 # :set nu 显示行号 # :set nonu 取消行号 # /pattern 搜索 # n 下一个匹配 # :%s/old/new/g 全局替换 # :wq 保存退出 # :q! 强制退出不保存 二、系统监控与性能分析（生产级） 2.1 CPU性能监控 top - 实时监控系统 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 top # 默认按CPU排序 top -Hp <PID> # 查看进程内所有线程（排查Java/Python多线程问题关键） top -p 1,2,3 # 只监控指定PID top -u username # 只显示指定用户 top -b -n 1 > top.log # 批处理模式，运行一次后退出 # 内部交互命令 # P - 按CPU排序 M - 按内存排序 T - 按时间排序 # k - 杀死进程 r - 修改nice值 H - 显示线程 # 1 - 显示各CPU核心详情 # 生产案例：Java应用CPU飙高排查 # 1. top找到高CPU进程PID # 2. top -Hp PID查看线程 # 3. printf "%xn" <TID> 转16进制 # 4. jstack PID | grep -A 20 <hex_TID> htop - 增强版top（推荐） 1 2 3 4 5 htop # 彩色显示，支持鼠标操作 htop -d 10 # 刷新间隔10秒 htop -u root # 只显示root用户进程 # 优点：支持树状显示、直接kill、renice、搜索过滤 vmstat - 系统资源综合监控 1 2 3 4 5 6 7 8 9 10 11 12 vmstat 2 10 # 每2秒采样一次，共10次 vmstat -s # 显示内存统计摘要 vmstat -d # 显示磁盘统计 # 输出解读： # procs: r(运行队列) b(不可中断睡眠进程) # memory: swpd(交换内存) free(空闲) buff/cache(缓存) # swap: si(换入) so(换出) - 这两个值应该为0 # io: bi(读块) bo(写块) # cpu: us(用户) sy(系统) id(空闲) wa(IO等待) # 警戒线：wa持续>20%说明IO瓶颈 mpstat - 多核CPU分析 1 2 3 4 mpstat -P ALL 1 10 # 显示每个CPU核心的使用情况 mpstat 1 10 # 显示所有CPU平均情况 # 输出列：%usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle pidstat - 进程级资源监控（sysstat工具） 1 2 3 4 5 6 7 pidstat -u 1 10 # 监控CPU使用 pidstat -r 1 10 # 监控内存使用 pidstat -d 1 10 # 监控磁盘IO pidstat -t -p <PID> # 监控指定进程的线程 # 生产技巧：监控Java应用所有指标 pidstat -u -r -d -t -p <PID> 2 sar - 系统活动报告（历史数据） 1 2 3 4 5 6 7 8 sar -u 1 10 # CPU使用情况 sar -r 1 10 # 内存使用情况 sar -b 1 10 # IO传输速率 sar -n DEV 1 10 # 网络设备流量 sar -q 1 10 # 负载队列 sar -f /var/log/sa/saXX # 查看历史数据 # 安装：yum install sysstat / apt-get install sysstat perf - 性能分析利器（内核级） 1 2 3 4 5 6 7 8 perf top # 实时分析系统性能热点 perf stat -p <PID> # 统计进程性能数据 perf record -g -p <PID> # 记录性能数据（用于火焰图） perf report # 报告分析结果 # 生产案例：分析CPU热点函数 perf top -g -p <PID> # 定位到具体函数后，可结合jstack/gdb分析 strace - 系统调用跟踪（调试神器） 1 2 3 4 5 6 7 8 9 strace -p <PID> # 跟踪指定进程 strace -c -p <PID> # 统计系统调用耗时 strace -e trace=file -p <PID> # 只跟踪文件操作 strace -f -e trace=network -p <PID> # 跟踪子进程和网络调用 strace -T -tt -p <PID> # 显示时间戳和耗时 # 生产案例：进程卡住排查 strace -p <PID> -e trace=futex # 发现卡在futex_wait，说明在等待锁 2.2 内存性能监控 free - 内存使用 1 2 3 4 5 6 7 8 9 10 free -h # 人类可读格式 free -m # MB单位 free -w # 显示 buff 和 cache 分开 # 解读： # available: 真正可用内存（最重要指标） # free: 完全空闲内存 # buff/cache: 缓存（可被回收） # 生产误区：不要被free值迷惑，关键看available pmap - 进程内存映射 1 2 3 4 5 pmap -x <PID> # 详细内存映射 pmap -x <PID> | tail -5 # 只显示汇总 # 排查内存泄漏：持续观察RSS列 watch -n 5 "pmap -x <PID> | grep total" smem - 内存统计工具 1 2 3 4 5 smem -rs swap -p # 按swap使用排序（%） smem -rs rss -p # 按物理内存排序 smem -u # 按用户汇总 # 优势：能准确反映PSS（比例集大小），比RSS更有意义 vmstat -s - 内存统计 1 2 vmstat -s # 显示详细内存统计 # 重点看：swap pages in/out，应该为0 2.3 磁盘IO性能监控 iostat - IO统计（sysstat） 1 2 3 4 5 6 7 8 9 iostat -x 1 10 # 详细IO统计（-x显示扩展信息） iostat -dk 1 10 # 以KB/s显示 iostat -p sda 1 10 # 显示分区详细 # 关键指标： # %util: 设备利用率，>80%说明瓶颈 # await: 平均IO响应时间，>10ms需关注 # svctm: 平均服务时间 # r/s w/s: 读写IOPS iotop - IO实时监控 1 2 3 iotop # 需要root权限 iotop -oP -d 2 # 只显示有IO的进程(-o)，只显示进程(-P)，2秒刷新 iotop -a # 显示累积IO量 df - 磁盘空间 1 2 3 4 5 6 df -h # 人类可读 df -i # 显示inode使用情况（inode满导致无法写入） df -T # 显示文件系统类型 df -h /path # 只显示指定路径的挂载点 # 生产警戒线：使用率>85%预警，>95%紧急 du - 目录大小统计 1 2 3 4 5 6 du -h --max-depth=1 /path # 统计一级子目录大小 du -sh /path # 只显示总大小(-s) du -ah /path | sort -hr | head -20 # 找出最大的20个文件 # 生产技巧：快速定位磁盘满的原因 du -h --max-depth=1 / | sort -hr | head -10 lsof - 查看打开的文件 1 2 3 4 5 6 7 8 9 10 lsof # 列出所有打开的文件 lsof -p <PID> # 指定进程打开的文件 lsof /path/to/file # 查看文件被哪些进程使用 lsof -i :8080 # 查看端口占用进程 lsof -u username # 指定用户 lsof +D /path # 递归目录（慢，用lsof | grep /path更快） # 生产案例：删除文件后空间不释放 lsof | grep deleted # 查找已删除但仍被进程占用的文件 # 解决：重启对应进程或> /proc/<PID>/fd/<FD> 2.4 网络性能监控 ss - socket统计（替代netstat） 1 2 3 4 5 6 7 ss -tuln # 显示所有监听端口（-t TCP, -u UDP, -l 监听, -n 数字） ss -tan # 显示所有TCP连接 ss -s # 显示socket统计摘要 ss -p # 显示进程信息 ss -o state established &#39;( dport = :22 or sport = :22 )&#39; # 过滤特定端口 # 比netstat更快，适合高并发环境 netstat - 网络连接（传统工具） 1 2 3 4 5 netstat -tuln # 显示监听端口 netstat -anp # 显示所有连接和进程 netstat -i # 显示网络接口统计 netstat -r # 显示路由表 netstat -s # 显示协议统计 iftop - 实时流量监控 1 2 3 4 5 6 iftop -i eth0 # 监控指定网卡 iftop -n # 不解析主机名 iftop -P # 显示端口 iftop -f "port 80" # 过滤特定端口 # 需要root权限，适合排查带宽占用 tcpdump - 抓包分析（网络排障核心） 1 2 3 4 5 6 7 8 9 tcpdump -i eth0 -nn -s0 -v port 80 # 抓HTTP流量 tcpdump -i any -nn host 192.168.1.1 # 抓特定IP tcpdump -w capture.pcap # 写入文件（wireshark分析） tcpdump -r capture.pcap # 读取文件 tcpdump -A -s0 port 80 # ASCII显示HTTP内容 tcpdump -i eth0 -c 1000 # 只抓1000个包 # 生产案例：排查MySQL慢查询网络原因 tcpdump -i eth0 -s0 -nn -A dst port 3306 | grep -E "SELECT|INSERT" nethogs - 按进程统计流量 1 2 nethogs # 需要root，显示进程级流量 nethogs eth0 # 指定网卡 ping - 测试连通性 1 2 3 ping -c 4 -i 0.2 -W 1 8.8.8.8 # 发送4次，间隔0.2秒，超时1秒 ping -f 8.8.8.8 # 洪水ping（需root，测试网络极限） ping -s 1400 8.8.8.8 # 指定包大小（测试MTU） traceroute - 路由追踪 1 2 3 traceroute -n 8.8.8.8 # 不解析主机名（快） traceroute -T -p 80 8.8.8.8 # TCP SYN方式（绕过防火墙ICMP限制） traceroute -I 8.8.8.8 # ICMP方式 mtr - 综合网络诊断 1 2 mtr -r -c 10 8.8.8.8 # 报告模式，发送10次 mtr -w 8.8.8.8 # 宽格式（长主机名） 2.5 系统负载与运行时长 uptime - 系统运行时间与负载 1 2 3 4 5 6 7 uptime # 显示：时间、运行时长、用户数、负载 uptime -p # 只显示运行时长 # 负载解读： # 1分钟、5分钟、15分钟平均负载 # 理想值：负载 < CPU核心数 # 警戒线：负载 > CPU核心数 * 0.7 who - 查看登录用户 1 2 3 who # 显示当前登录用户 who -b # 显示上次启动时间 who -r # 显示运行级别 last - 查看登录历史 1 2 3 4 last # 显示所有登录历史 last root # 只显示root登录历史 last -n 10 # 只显示最近10条 last -f /var/log/btmp # 查看失败登录尝试 dmesg - 内核日志 1 2 3 4 5 6 7 8 dmesg # 查看内核环形缓冲区 dmesg -T # 显示人类可读时间 dmesg -c # 读取后清除 dmesg | grep -i error # 搜索错误 dmesg | grep -i oom # 查找OOM killer记录 # 生产案例：排查硬件故障 dmesg | grep -E " Hardware|Error|Fail" 三、进程管理（运维核心） 3.1 进程查看 ps - 进程快照 1 2 3 4 5 6 7 8 ps aux # BSD风格，显示所有进程（常用） ps -ef # System V风格 ps aux --sort=-%cpu # 按CPU排序（降序） ps aux --sort=-%mem # 按内存排序 ps -o pid,ppid,cmd,%cpu,%mem -p <PID> # 自定义输出列 # 生产技巧：查找僵尸进程 ps aux | awk &#39;$8=="Z"&#39; pgrep - 按名称查找PID 1 2 3 4 pgrep nginx # 查找nginx进程PID pgrep -f "python3 app.py" # 匹配完整命令行 pgrep -u root sshd # 查找root用户的sshd进程 pgrep -d, -f java # 用逗号分隔输出（用于top -p） pidof - 按名称查找PID 1 pidof nginx # 返回所有nginx worker PID pstree - 进程树 1 2 3 4 5 pstree # 显示进程树 pstree -p # 显示PID pstree -u # 显示用户 pstree -a # 显示完整命令 pstree | grep -A 5 nginx # 查找nginx相关进程树 3.2 进程控制 kill - 发送信号 1 2 3 4 5 6 7 8 9 10 11 12 13 14 kill -l # 列出所有信号 kill -15 <PID> # 发送TERM信号（优雅终止） kill -9 <PID> # 发送KILL信号（强制终止，谨慎使用） kill -2 <PID> # 发送INT信号（类似Ctrl+C） kill -1 <PID> # 发送HUP信号（重载配置） # 批量杀进程 pkill -9 java # 按名称杀进程 killall -9 java # 杀所有名为java的进程 kill -9 $(pgrep -f "test.py") # 组合使用 # 生产案例：优雅重启nginx kill -USR1 $(cat /var/run/nginx.pid) # 重新打开日志文件 kill -HUP $(cat /var/run/nginx.pid) # 重载配置 killall - 按名称杀进程 1 2 killall -9 python3 # 杀所有python3进程 killall -w process # 等待进程终止 pkill - 按模式杀进程 1 2 3 pkill -f "test.py" # 匹配完整命令行 pkill -u username # 杀死某用户的所有进程 pkill -t pts/0 # 杀死某个终端的所有进程 nice/renice - 调整优先级 1 2 3 4 5 nice -n 19 command # 以最低优先级运行（19最低，-20最高） renice -n 10 -p <PID> # 调整已运行进程优先级 # 生产技巧：降低备份任务优先级 nice -n 19 tar -czf backup.tar.gz /data nohup - 后台持久运行 1 2 nohup command & # &放入后台，nohup忽略挂起信号 nohup java -jar app.jar > app.log 2>&amp;1 & # 标准推荐写法 disown - 从shell移除作业 1 2 3 disown %1 # 移除作业1 disown -a # 移除所有作业 disown -h %1 # 标记为不接收SIGHUP 3.3 作业控制 & - 后台运行 1 command & # 放入后台执行 jobs - 查看后台作业 1 2 3 4 jobs # 查看当前shell的后台作业 jobs -l # 显示PID jobs -r # 只显示运行中的作业 jobs -s # 只显示停止的作业 fg/bg - 前台/后台切换 1 2 fg %1 # 将作业1调到前台 bg %1 # 将作业1在后台继续运行 wait - 等待作业完成 1 2 wait <PID> # 等待指定PID进程结束 wait # 等待所有后台作业结束 3.4 高级进程调试 strace - 系统调用跟踪 1 # 详见2.1节 ltrace - 库函数调用跟踪 1 2 ltrace -p <PID> # 跟踪库函数调用 ltrace -c -p <PID> # 统计调用耗时 gdb - 调试器 1 2 3 4 5 6 7 8 gdb -p <PID> # 附加到运行进程 gdb /path/to/binary core # 分析core dump # 生产案例：分析Java core文件 gdb java core.12345 (gdb) bt # 查看堆栈 (gdb) info threads # 查看线程 (gdb) thread apply all bt # 查看所有线程堆栈 perf - 性能分析 1 # 详见2.1节 四、网络管理（运维核心） 4.1 网络配置 ip - 现代网络配置（推荐） 1 2 3 4 5 6 7 8 9 10 11 12 ip addr # 显示IP地址（替代ifconfig） ip addr add 192.168.1.100/24 dev eth0 # 添加IP ip addr del 192.168.1.100/24 dev eth0 # 删除IP ip link set eth0 up # 启用网卡 ip link set eth0 down # 禁用网卡 ip route # 显示路由表 ip route add default via 192.168.1.1 # 添加默认网关 ip neighbor # 显示ARP表 ip -s link # 显示统计信息 # 生产技巧：快速查看IP ip -4 -o addr show scope global | awk &#39;{print $4}&#39; ifconfig - 传统网络配置 1 2 3 4 5 6 ifconfig # 显示所有网卡 ifconfig eth0 # 显示指定网卡 ifconfig eth0 up/down # 启用/禁用 ifconfig eth0 192.168.1.100 netmask 255.255.255.0 # 配置IP # 已废弃，推荐使用ip命令 route - 路由管理 1 2 3 4 route -n # 显示路由表 route add default gw 192.168.1.1 # 添加默认网关 route add -net 10.0.0.0/8 gw 10.0.0.1 # 添加静态路由 route del -net 10.0.0.0/8 # 删除路由 nmcli - NetworkManager命令行 1 2 3 4 nmcli device status # 查看设备状态 nmcli connection show # 查看连接 nmcli connection up/down id "conn-name" # 启用/禁用连接 nmcli device wifi list # 查看WiFi 4.2 网络诊断 ping - 连通性测试 1 # 详见2.4节 traceroute - 路由追踪 1 # 详见2.4节 mtr - 综合诊断 1 # 详见2.4节 nslookup/dig - DNS查询 1 2 3 4 5 6 7 dig www.baidu.com # 详细DNS查询 dig +short www.baidu.com # 简短输出 dig @8.8.8.8 www.baidu.com # 指定DNS服务器 dig +trace www.baidu.com # 追踪查询过程 dig -x 8.8.8.8 # 反向解析 nslookup www.baidu.com 8.8.8.8 # 指定DNS host - 简单DNS查询 1 2 host www.baidu.com host -t mx baidu.com # 查询MX记录 telnet - 测试端口连通性 1 2 telnet 192.168.1.1 22 # 测试SSH端口 # Ctrl+] 然后输入quit退出 nc (netcat) - 网络瑞士军刀 1 2 3 4 5 6 7 8 nc -zv 192.168.1.1 22 # 测试端口（-z 零IO，-v 详细） nc -l 8080 # 监听8080端口 nc 192.168.1.1 8080 # 连接端口 echo "test" | nc 192.168.1.1 8080 # 发送数据 # 生产技巧：快速传输文件 # 接收端：nc -l 8888 > file # 发送端：nc receiver_ip 8888 < file 4.3 高级网络工具 tcpdump - 抓包分析 1 # 详见2.4节 wireshark - 图形化抓包 1 2 wireshark # 图形界面 tshark -i eth0 # 命令行版wireshark ss - socket统计（推荐） 1 # 详见4.1节 lsof - 查看网络连接 1 2 3 lsof -i :8080 # 查看8080端口占用 lsof -i TCP # 查看所有TCP连接 lsof -i @192.168.1.1 # 查看连接到该IP的连接 五、文本处理三剑客（运维核心） 5.1 grep - 文本搜索 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 基本用法 grep "error" file.log # 搜索包含error的行 grep -i "error" file # 忽略大小写 grep -v "error" file # 反向匹配（不包含） grep -r "error" /path # 递归目录搜索 grep -E "error|warn" file # 正则表达式（扩展） grep -A 3 -B 3 "error" file # 显示前后3行 grep -n "error" file # 显示行号 grep -c "error" file # 统计匹配行数 grep -o "error" file # 只显示匹配部分 grep -w "error" file # 整词匹配 grep -f patterns.txt file # 从文件读取模式 # 生产案例：分析Nginx访问日志 grep "200" access.log | wc -l # 统计成功请求 grep -E "5[0-9]{2}" access.log | awk &#39;{print $7}&#39; | sort | uniq -c | sort -nr | head # Top错误URL # 高级用法：排除多个模式 grep -vE "(debug|info)" app.log # 查找IP地址 grep -oE "([0-9]{1,3}\\.){3}[0-9]{1,3}" access.log 5.2 sed - 流编辑器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # 基本语法：sed [选项] &#39;命令&#39; 文件 # 替换 sed &#39;s/old/new/&#39; file # 每行第一个匹配 sed &#39;s/old/new/g&#39; file # 全局替换 sed -i &#39;s/old/new/g&#39; file # 直接修改文件（-i危险，先备份） # 删除 sed &#39;/pattern/d&#39; file # 删除匹配行 sed &#39;1,10d&#39; file # 删除1-10行 sed &#39;$d&#39; file # 删除最后一行 # 插入 sed &#39;1i\\insert&#39; file # 第1行前插入 sed &#39;$a\\append&#39; file # 最后追加 # 打印 sed -n &#39;1,10p&#39; file # 打印1-10行 sed -n &#39;/pattern/p&#39; file # 打印匹配行 # 生产案例：批量修改配置文件 sed -i &#39;s/Port 22/Port 2222/&#39; /etc/ssh/sshd_config # 修改SSH端口 sed -i &#39;/^#ServerActive/s/#//&#39; /etc/zabbix/zabbix_agentd.conf # 取消注释 # 提取特定行 sed -n &#39;/2024-01-01/,/2024-01-02/p&#39; access.log # 提取日期范围 5.3 awk - 文本处理语言 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # 基本语法：awk &#39;模式{动作}&#39; 文件 # 打印列 awk &#39;{print $1}&#39; file # 打印第1列（默认空格分隔） awk -F: &#39;{print $1}&#39; /etc/passwd # 指定分隔符: awk &#39;{print $NF}&#39; file # 打印最后一列 # 条件过滤 awk &#39;$3 > 100&#39; file # 第3列大于100 awk &#39;/error/&#39; file # 匹配模式 awk &#39;$1 ~ /^192/ {print $2}&#39; file # 第1列匹配正则 # 生产案例：分析Nginx日志 awk &#39;{print $1}&#39; access.log | sort | uniq -c | sort -nr | head -20 # Top IP awk &#39;{print $7}&#39; access.log | grep -v &#39;^$&#39; | sort | uniq -c | sort -nr | head -20 # Top URL awk &#39;$9 ~ /^5/ {print $7}&#39; access.log | sort | uniq -c | sort -nr # 500错误的URL # 统计 awk &#39;{sum+=$1} END {print sum/NR}&#39; file # 求平均值 awk &#39;{if($1>max) max=$1} END {print max}&#39; file # 求最大值 # 多分隔符 awk -F&#39;[: ]&#39; &#39;{print $1}&#39; file # 分隔符为冒号或空格 # 内置变量 # NR: 行号 NF: 列数 $0: 整行 FILENAME: 文件名 5.4 组合使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 案例1：查找Top内存进程 ps aux | sort -nk4 -r | head -10 # 案例2：日志分析完整流程 cat access.log | grep "200" | awk &#39;{print $7}&#39; | sort | uniq -c | sort -nr | head -10 > top_urls.txt # 案例3：多条件过滤 cat app.log | grep -v "DEBUG" | grep -E "error|warn" | awk -F&#39;[&#39; &#39;{print $2}&#39; | awk -F&#39;]&#39; &#39;{print $1}&#39; # 案例4：时间范围提取 sed -n &#39;/2024-01-01 10:00:00/,/2024-01-01 11:00:00/p&#39; access.log # 案例5：CSV处理 awk -F&#39;,&#39; &#39;{printf "%-20s %-10s %5.2f\\n", $1, $2, $3}&#39; data.csv 六、文件系统与存储管理 6.1 磁盘管理 fdisk - 分区管理 1 2 3 fdisk -l # 列出所有磁盘 fdisk /dev/sdb # 进入交互模式 # 内部命令：m(帮助) n(新建) p(打印) w(写入) q(退出) d(删除) gdisk - GPT分区管理 1 gdisk -l /dev/sdb # 查看GPT分区 parted - 分区管理（支持大磁盘） 1 2 3 parted -l # 列出所有磁盘 parted /dev/sdb mklabel gpt # 创建GPT标签 parted /dev/sdb mkpart primary 0% 100% # 创建分区 mkfs - 创建文件系统 1 2 3 mkfs.ext4 /dev/sdb1 # 创建ext4文件系统 mkfs.xfs /dev/sdb1 # 创建xfs文件系统 mkfs -t ext4 /dev/sdb1 # 通用格式 fsck - 文件系统检查 1 2 3 4 5 fsck /dev/sda1 # 检查并修复（卸载后执行） fsck -y /dev/sda1 # 自动修复 fsck -n /dev/sda1 # 只检查不修复 # 生产警告：不要在挂载的文件系统上运行！ mount/umount - 挂载/卸载 1 2 3 4 5 6 7 8 9 mount # 显示挂载信息 mount /dev/sdb1 /mnt # 挂载 mount -t nfs 192.168.1.1:/data /mnt # 挂载NFS mount -o remount,rw / # 重新挂载为读写（救援模式常用） umount /mnt # 卸载 umount -l /mnt # 懒卸载（文件系统忙时使用） umount -f /mnt # 强制卸载 # 开机挂载：编辑/etc/fstab 6.2 LVM管理 pvcreate - 创建物理卷 1 2 3 pvcreate /dev/sdb1 # 将分区初始化为物理卷 pvdisplay # 显示物理卷信息 pvs # 简要显示 vgcreate - 创建卷组 1 2 3 4 5 vgcreate vg_data /dev/sdb1 /dev/sdc1 # 创建卷组包含两个PV vgdisplay vgs vgextend vg_data /dev/sdd1 # 扩展卷组 vgreduce vg_data /dev/sdd1 # 缩减卷组 lvcreate - 创建逻辑卷 1 2 3 4 5 6 lvcreate -L 100G -n lv_home vg_data # 创建100G逻辑卷 lvcreate -l 100%FREE -n lv_opt vg_data # 使用所有剩余空间 lvdisplay lvs lvextend -L +50G /dev/vg_data/lv_home # 扩展逻辑卷 lvreduce -L -50G /dev/vg_data/lv_home # 缩减逻辑卷（危险） resize2fs/xfs_growfs - 调整文件系统大小 1 2 resize2fs /dev/vg_data/lv_home # ext4在线扩容 xfs_growfs /mnt/home # xfs在线扩容 6.3 RAID管理 mdadm - RAID管理 1 2 3 4 5 mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1 # 创建RAID1 mdadm --detail /dev/md0 # 查看RAID详情 mdadm --manage /dev/md0 --add /dev/sdd1 # 添加磁盘 mdadm --manage /dev/md0 --fail /dev/sdb1 # 标记故障盘 watch -n 1 cat /proc/mdstat # 监控RAID同步 七、系统服务管理 7.1 systemd（现代系统） systemctl - 服务控制 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 systemctl start nginx # 启动服务 systemctl stop nginx # 停止服务 systemctl restart nginx # 重启服务 systemctl reload nginx # 重载配置 systemctl status nginx # 查看状态 systemctl enable nginx # 开机自启 systemctl disable nginx # 取消开机自启 systemctl is-active nginx # 检查是否运行 systemctl is-enabled nginx # 检查是否开机自启 systemctl list-units --type=service --state=active # 列出所有运行服务 systemctl list-unit-files | grep enabled # 列出所有开机自启服务 systemctl daemon-reload # 重载配置（修改unit文件后） systemctl show nginx # 显示详细属性 # 生产技巧：查看服务启动失败原因 systemctl status nginx -l # 显示完整日志 journalctl -u nginx -f # 实时跟踪服务日志 journalctl -u nginx --since "10 minutes ago" # 最近10分钟日志 journalctl - systemd日志 1 2 3 4 5 6 7 8 journalctl -f # 实时跟踪 journalctl -u nginx # 指定服务 journalctl -k # 内核日志 journalctl --since "2024-01-01" --until "2024-01-02" # 时间范围 journalctl -p err # 只显示错误 journalctl -n 100 # 最后100行 journalctl --disk-usage # 查看日志占用空间 journalctl --vacuum-size=100M # 清理日志到100M 7.2 SysVinit（传统系统） service - 服务控制 1 2 3 4 5 6 7 service nginx start service nginx stop service nginx restart service nginx reload service nginx status # 已废弃，推荐systemctl chkconfig - 开机自启管理 1 2 3 chkconfig --list # 列出所有服务 chkconfig nginx on # 开机自启 chkconfig nginx off # 取消自启 7.3 定时任务 crontab - 计划任务 1 2 3 4 5 6 7 8 crontab -e # 编辑当前用户的crontab crontab -l # 列出 crontab -r # 删除 crontab -u user -e # 编辑指定用户的 # 格式：分 时 日 月 周 命令 # */5 * * * * /path/to/script.sh # 每5分钟 # 0 2 * * * /path/to/backup.sh # 每天2点 at - 一次性任务 1 2 3 4 5 6 at 14:00 tomorrow # 明天14点执行 at> /path/to/command at> Ctrl+D atq # 查看队列 atrm 1 # 删除任务1 八、用户与权限管理 8.1 用户管理 useradd - 添加用户 1 2 3 4 5 useradd -m -s /bin/bash -g users -G wheel newuser # 创建用户 # -m 创建home目录 -s 指定shell -g 主组 -G 附加组 # 生产技巧：批量创建用户 for i in {1..10}; do useradd -m user$i; echo "user$i:password" | chpasswd; done usermod - 修改用户 1 2 3 4 usermod -aG wheel newuser # 追加到wheel组 usermod -s /bin/zsh newuser # 修改shell usermod -L newuser # 锁定用户 usermod -U newuser # 解锁用户 userdel - 删除用户 1 2 userdel newuser # 删除用户 userdel -r newuser # 同时删除home目录和邮件 passwd - 修改密码 1 2 3 4 5 passwd # 修改当前用户密码 passwd newuser # 修改指定用户密码 passwd -l newuser # 锁定用户 passwd -u newuser # 解锁用户 passwd -e newuser # 强制下次登录修改密码 su - 切换用户 1 2 3 su - username # 完全切换（推荐） su username # 不切换环境变量 su -c "command" username # 以某用户执行命令 sudo - 提权执行 1 2 3 4 5 6 7 8 sudo command # 以root执行 sudo -u user command # 以指定用户执行 sudo -i # 切换到root shell sudo -l # 列出当前用户可执行命令 # 生产配置：/etc/sudoers # visudo 安全编辑 # user ALL=(ALL) NOPASSWD:ALL # 免密码sudo（谨慎） 8.2 组管理 groupadd - 添加组 1 2 groupadd developers # 创建组 groupadd -g 1000 dev # 指定GID groupmod - 修改组 1 groupmod -n newname oldname # 重命名 groupdel - 删除组 1 groupdel developers # 删除组（不能有用户为主组） 8.3 权限管理 chmod - 修改权限 1 2 3 4 5 6 7 8 chmod 755 file # rwxr-xr-x chmod u+x file # 用户添加执行权限 chmod g-w file # 组移除写权限 chmod o=r-- file # 其他用户只读 chmod -R 755 dir # 递归修改 # 数字权限：r=4 w=2 x=1 # 755 = 7(rwx) 5(r-x) 5(r-x) chown - 修改所有者 1 2 3 4 5 6 7 chown user:group file # 同时修改用户和组 chown user file # 只修改用户 chown :group file # 只修改组 chown -R user:group dir # 递归修改 # 生产技巧：批量修改 chown -R www-data:www-data /var/www/html chgrp - 修改组 1 2 chgrp group file # 修改文件组 chgrp -R group dir # 递归修改 umask - 默认权限掩码 1 2 3 4 umask # 查看当前掩码 umask 022 # 设置掩码 # 默认文件权限：666-umask # 默认目录权限：777-umask 8.4 高级权限 setuid/setgid/sticky bit 1 2 3 4 5 6 7 chmod u+s file # setuid (4) 以文件所有者权限执行 chmod g+s dir # setgid (2) 新建文件继承目录组 chmod +t dir # sticky bit (1) 用户只能删除自己的文件 # 数字表示：chmod 4755 file (setuid) # chmod 2755 dir (setgid) # chmod 1777 dir (sticky) ACL - 访问控制列表 1 2 3 4 5 6 7 8 9 setfacl -m u:user:rwx file # 给用户添加权限 setfacl -m g:group:r-x file # 给组添加权限 setfacl -x u:user file # 删除用户ACL setfacl -b file # 清除所有ACL getfacl file # 查看ACL # 生产场景：多用户共享目录 setfacl -R -m u:user1:rwx,u:user2:rwx /shared setfacl -R -d -m u:user1:rwx,u:user2:rwx /shared # 默认ACL 九、压缩与备份 9.1 压缩工具 tar - 归档（运维必备） 1 2 3 4 5 6 7 8 9 10 11 tar -czf archive.tar.gz /path # 压缩（c创建，z gzip，f文件） tar -xzf archive.tar.gz # 解压（x解压） tar -tzf archive.tar.gz # 查看内容（t列表） tar -czf - /path | ssh user@host "tar -xzf - -C /dest" # 远程压缩传输 tar --exclude=&#39;*.log&#39; -czf archive.tar.gz /path # 排除文件 # 参数： # c: 创建 x: 解压 t: 查看 # z: gzip j: bzip2 J: xz # v: 显示过程 f: 指定文件 # C: 切换到目录 gzip/gunzip 1 2 3 4 gzip file # 压缩为file.gz gzip -9 file # 最高压缩率（1-9） gzip -d file.gz # 解压 gunzip file.gz # 解压 zip/unzip 1 2 3 zip -r archive.zip dir # 压缩目录 unzip archive.zip # 解压 unzip -l archive.zip # 查看内容 rsync - 同步与备份（运维神器） 1 2 3 4 5 6 7 8 9 10 rsync -avz /src/ /dst/ # 同步目录（a归档，v详细，z压缩） rsync -avz /src/ user@host:/dst/ # 远程同步 rsync -avz --delete /src/ /dst/ # 删除目标端多余文件 rsync -avz --exclude=&#39;*.log&#39; /src/ /dst/ # 排除 rsync -avz --bwlimit=10240 /src/ /dst/ # 限速10MB/s rsync -avz --partial --progress /src/ /dst/ # 断点续传 rsync -avzh --link-dest=/latest /src/ /dst/`date +%Y%m%d`/ # 硬链接增量备份 # 生产案例：每日备份脚本 rsync -avz --delete /data/ /backup/`date +%Y%m%d`/ 9.2 备份策略 dd - 磁盘克隆 1 2 3 4 5 6 dd if=/dev/sda of=/dev/sdb bs=4M # 磁盘对拷 dd if=/dev/sda of=disk.img # 创建镜像 dd if=disk.img of=/dev/sda # 恢复镜像 dd if=/dev/zero of=/swapfile bs=1M count=4096 # 创建swap文件 # 生产警告：dd是危险命令，if/of参数务必确认 cpio - 归档 1 2 find /path | cpio -o > archive.cpio # 创建 cpio -i < archive.cpio # 解压 十、系统信息与管理 10.1 系统信息 uname - 内核信息 1 2 3 4 uname -a # 显示所有信息 uname -r # 内核版本 uname -m # 架构 uname -n # 主机名 hostnamectl - 主机名管理 1 2 hostnamectl # 显示主机信息 hostnamectl set-hostname newname # 修改主机名 uptime - 运行时间与负载 1 # 详见2.5节 who/w - 登录用户 1 2 who # 显示登录用户 w # 显示登录用户及正在执行的命令 last - 登录历史 1 # 详见2.5节 10.2 硬件信息 lspci - PCI设备 1 2 3 lspci # 显示所有PCI设备 lspci -v # 详细信息 lspci | grep -i vga # 查找显卡 lsusb - USB设备 1 2 lsusb # 显示USB设备 lsusb -t # 树状显示 lscpu - CPU信息 1 2 lscpu # 显示CPU架构信息 lscpu | grep "CPU(s)" # 核心数 dmidecode - 硬件DMI信息 1 2 3 dmidecode # 显示所有硬件信息 dmidecode -t memory # 显示内存信息 dmidecode -t system # 显示系统信息 hdparm - 磁盘信息 1 2 hdparm -I /dev/sda # 显示磁盘详细信息 hdparm -tT /dev/sda # 测试磁盘性能 10.3 内核与模块 lsmod - 加载的模块 1 2 lsmod # 显示已加载内核模块 lsmod | grep kvm # 查找特定模块 modinfo - 模块信息 1 modinfo kvm # 显示模块详细信息 modprobe - 加载/卸载模块 1 2 modprobe kvm # 加载模块 modprobe -r kvm # 卸载模块 insmod/rmmod - 加载/卸载模块 1 2 insmod /path/to/module.ko rmmod kvm sysctl - 内核参数 1 2 3 4 sysctl -a # 显示所有参数 sysctl -p # 加载/etc/sysctl.conf sysctl -w vm.swappiness=10 # 临时修改 echo "vm.swappiness=10" >> /etc/sysctl.conf && sysctl -p # 永久修改 十一、性能调优（专家级） 11.1 CPU调优 CPU亲和性 1 # 详见10.1节 中断均衡 1 2 3 4 5 cat /proc/interrupts # 查看中断分布 echo 2 > /proc/irq/24/smp_affinity # 将中断绑定到CPU2 # 自动均衡：irqbalance服务 systemctl status irqbalance 调节器 1 2 3 4 5 cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 查看当前调节器 echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 性能模式 echo powersave > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 节能模式 # 可用调节器：performance powersave ondemand conservative 11.2 内存调优 swappiness 1 # 详见2.2节 透明大页 1 2 cat /sys/kernel/mm/transparent_hugepage/enabled # 查看状态 echo never > /sys/kernel/mm/transparent_hugepage/enabled # 禁用（数据库推荐） 内存压缩 1 2 3 4 cat /proc/sys/vm/drop_caches # 释放缓存 # echo 1 > /proc/sys/vm/drop_caches # 释放pagecache # echo 2 > /proc/sys/vm/drop_caches # 释放dentries和inodes # echo 3 > /proc/sys/vm/drop_caches # 释放所有缓存（生产环境慎用） 11.3 磁盘调优 IO调度器 1 2 3 4 5 6 7 cat /sys/block/sda/queue/scheduler # 查看当前调度器 echo deadline > /sys/block/sda/queue/scheduler # 修改为deadline # 调度器选择： # noop: SSD/闪存 # deadline: 数据库（保证延迟） # cfq: 桌面/通用 文件系统调优 1 2 3 4 5 # ext4挂载选项 /dev/sdb1 /data ext4 defaults,noatime,nodiratime 0 0 # XFS调优 xfs_info /dev/sda1 # 查看XFS信息 11.4 网络调优 TCP参数 1 # 详见10.1节 文件描述符限制 1 2 3 4 5 6 ulimit -n # 查看当前限制 ulimit -n 65535 # 临时修改 # 永久修改：/etc/security/limits.conf * soft nofile 65535 * hard nofile 65535 端口范围 1 2 cat /proc/sys/net/ipv4/ip_local_port_range # 查看端口范围 echo "1024 65535" > /proc/sys/net/ipv4/ip_local_port_range # 扩大范围 十二、安全与审计 12.1 文件完整性 md5sum/sha256sum - 校验和 1 2 3 md5sum file # 计算MD5 sha256sum file # 计算SHA256 md5sum -c file.md5 # 校验文件 chattr/lsattr - 扩展属性 1 2 3 4 5 6 7 chattr +i file # 设置不可变（无法修改删除） chattr -i file # 取消不可变 chattr +a file # 只允许追加 lsattr file # 查看扩展属性 # 生产应用：保护关键配置文件 chattr +i /etc/passwd /etc/shadow 12.2 安全工具 iptables - 防火墙（传统） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 iptables -L -n # 查看规则 iptables -A INPUT -p tcp --dport 22 -j ACCEPT # 放行SSH iptables -A INPUT -p tcp --dport 80 -j ACCEPT # 放行HTTP iptables -A INPUT -j DROP # 默认拒绝（注意顺序） service iptables save # 保存规则 # 生产脚本：配置基础防火墙 #!/bin/bash iptables -F iptables -A INPUT -i lo -j ACCEPT iptables -A INPUT -p tcp --dport 22 -j ACCEPT iptables -A INPUT -p tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp --dport 443 -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -P INPUT DROP firewalld - 动态防火墙 1 2 3 4 firewall-cmd --state # 查看状态 firewall-cmd --list-all # 查看所有规则 firewall-cmd --add-port=8080/tcp --permanent # 永久添加端口 firewall-cmd --reload # 重载规则 ufw - Ubuntu防火墙 1 2 3 ufw status # 查看状态 ufw allow 22/tcp # 放行SSH ufw enable # 启用防火墙 12.3 审计 lastlog - 最后登录 1 2 lastlog # 显示所有用户最后登录 lastlog -u username # 指定用户 lastb - 失败登录 1 lastb # 查看失败登录尝试 ausearch - SELinux审计 1 ausearch -m avc -ts today # 查看今天SELinux拒绝 十三、自动化运维脚本模板 13.1 系统巡检脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 #!/bin/bash # 系统健康检查脚本 LOGFILE="/var/log/system_check_$(date +%Y%m%d).log" exec > $LOGFILE 2>&amp;1 echo "===== System Check $(date) =====" # CPU检查 echo "--- CPU Check ---" top -bn1 | grep "Cpu(s)" mpstat -P ALL 1 1 # 内存检查 echo "--- Memory Check ---" free -h vmstat -s | grep -E "swapped|used memory" # 磁盘检查 echo "--- Disk Check ---" df -h df -i # IO检查 echo "--- IO Check ---" iostat -x 1 3 # 网络检查 echo "--- Network Check ---" ss -s netstat -i # 负载检查 echo "--- Load Check ---" uptime cat /proc/loadavg # 服务检查 echo "--- Service Check ---" systemctl list-units --type=service --state=failed echo "===== Check Complete $(date) =====" 13.2 日志分析脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/bash # Nginx日志分析脚本 LOGFILE="/var/log/nginx/access.log" REPORT="/tmp/nginx_report_$(date +%Y%m%d).txt" # Top 10 IP echo "Top 10 IP:" > $REPORT awk &#39;{print $1}&#39; $LOGFILE | sort | uniq -c | sort -nr | head -10 >> $REPORT # Top 10 URL echo -e "\\nTop 10 URL:" >> $REPORT awk &#39;{print $7}&#39; $LOGFILE | grep -v &#39;^$&#39; | sort | uniq -c | sort -nr | head -10 >> $REPORT # 状态码统计 echo -e "\\nStatus Code:" >> $REPORT awk &#39;{print $9}&#39; $LOGFILE | sort | uniq -c | sort -nr >> $REPORT # 响应时间分析（假设日志格式包含$request_time） echo -e "\\nResponse Time:" >> $REPORT awk &#39;{print $NF}&#39; $LOGFILE | awk &#39;{sum+=$1; count++} END {print "Avg: " sum/count}&#39; >> $REPORT mail -s "Nginx Daily Report" admin@example.com < $REPORT 13.3 自动扩容脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/bin/bash # 磁盘空间监控与扩容（LVM） THRESHOLD=85 VG_NAME="vg_data" LV_NAME="lv_home" MOUNT_POINT="/home" CURRENT=$(df -h $MOUNT_POINT | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;) if [ $CURRENT -gt $THRESHOLD ]; then # 检查是否有可用空间 FREE=$(vgs --noheadings -o vg_free $VG_NAME | sed &#39;s/ //g&#39;) if [ "$FREE" != "0" ]; then # 扩展逻辑卷（增加10G） lvextend -L +10G /dev/$VG_NAME/$LV_NAME # 扩展文件系统 resize2fs /dev/$VG_NAME/$LV_NAME # ext4 # xfs_growfs $MOUNT_POINT # xfs echo "Expanded $LV_NAME by 10G" | mail -s "Disk Alert" admin@example.com else echo "No free space in VG" | mail -s "URGENT Disk Alert" admin@example.com fi fi 十四、生产环境故障排查案例 案例1：CPU 100%但找不到进程 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. 检查系统负载 uptime # 2. 查看CPU等待IO情况 top # 发现wa很高（94%） # 3. 定位IO瓶颈进程 iotop -oP # 发现是rsync备份进程 # 4. 限制带宽 killall rsync nohup rsync -avz --bwlimit=10240 /src/ /dst/ & # 解决：将备份任务调整到凌晨2点执行 案例2：内存泄漏排查 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #!/bin/bash # 内存泄漏检测脚本 PID=$1 INTERVAL=60 LOG="mem_leak_${PID}.log" echo "Monitoring PID $PID every $INTERVAL seconds..." > $LOG while true; do echo "=== $(date) ===" >> $LOG pmap -x $PID | tail -1 >> $LOG ps -p $PID -o pid,rss,vsz,cmd >> $LOG sleep $INTERVAL done # 分析：观察RSS列是否持续增长 # 配合jmap分析Java堆：jmap -histo:live <PID> 案例3：网络连接数暴增 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. 查看连接数 ss -s # 2. 查看TIME_WAIT ss -tan | grep TIME_WAIT | wc -l # 3. 查看ESTABLISHED ss -tan | grep ESTABLISHED | wc -l # 4. 查找异常IP netstat -anp | grep ESTABLISHED | awk &#39;{print $5}&#39; | cut -d: -f1 | sort | uniq -c | sort -nr | head # 解决：调整TCP参数 echo "net.ipv4.tcp_tw_reuse = 1" >> /etc/sysctl.conf echo "net.ipv4.tcp_max_tw_buckets = 5000" >> /etc/sysctl.conf sysctl -p 案例4：磁盘空间异常 1 2 3 4 5 6 7 8 9 10 11 # 1. 查看磁盘使用 df -h # 发现/分区100% # 2. 查找大文件 du -h --max-depth=1 / | sort -hr | head -10 # 3. 检查已删除但仍在占用的文件 lsof | grep deleted # 发现日志文件被删除但进程未释放 # 4. 释放空间 > /proc/<PID>/fd/<FD> # 或者重启进程 十五、运维最佳实践总结 15.1 生产环境黄金法则 备份先行：任何操作前备份配置文件和数据 测试验证：先在测试环境验证，再应用到生产 灰度发布：分批重启服务，避免全量操作 监控告警：所有操作都要监控，设置告警 文档记录：所有变更必须记录 15.2 命令使用原则 rm：使用rm -i别名，高危操作先ls确认 dd：操作磁盘前再三确认if=和of= vim：编辑配置文件前先备份 systemctl：重启服务前检查配置语法 iptables：修改防火墙前保存当前规则 15.3 性能优化 checklist CPU：检查亲和性、中断均衡、调度器 内存：检查swappiness、泄漏、缓存 磁盘：检查IO调度器、使用率、inode 网络：检查连接数、TCP参数、带宽 服务：检查资源限制、日志级别、健康检查 15.4 推荐工具组合 监控：Prometheus + Grafana + Alertmanager 日志：ELK (Elasticsearch + Logstash + Kibana) 自动化：Ansible + Jenkins/GitLab CI 追踪：SkyWalking / Jaeger CMDB：NetBox / CMDBuild '><title>Linux命令</title><link rel=canonical href=http://localhost:1313/blockchain/linux-%E5%91%BD%E4%BB%A4/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Linux命令"><meta property='og:description' content='Linux 命令 作为运维工程师，我为您深度挖掘全网权威资料，整理出这份涵盖基础到内核级调试的完整命令手册。每个命令都包含生产环境实战技巧和避坑指南。\n一、基础命令深度解析（运维视角） 1.1 文件目录操作（含性能优化） ls - 目录列表 1 2 3 4 5 6 7 8 # 运维必用组合：按大小排序，显示隐藏文件，人性化单位 ls -lhS --color=auto # 按大小排序，人类可读 ls -lart # 按修改时间倒序（最新在最后） ls -i # 显示inode号（排查硬链接问题） ls -Z # 显示SELinux上下文 # 生产环境技巧：快速找出大目录 du -h --max-depth=1 /var | sort -hr | head -10 cd - 切换目录 1 2 3 4 5 6 7 cd - # 快速返回上次目录（运维高频操作） cd .. # 返回上级 cd ~ # 返回home目录 cd / # 返回根目录 # 高级技巧：自动纠正拼写错误 shopt -s cdspell # 开启cd命令自动纠错 pwd - 显示当前路径 1 2 pwd -P # 显示物理路径（解析符号链接） pwd -L # 显示逻辑路径（默认） mkdir - 创建目录 1 2 3 mkdir -p /path/to/dir # 递归创建（-p = parents） mkdir -m 755 /path # 直接指定权限 mkdir -v /path # 显示创建过程 rm - 删除文件/目录（⚠️高危命令） 1 2 3 4 5 6 7 8 9 # 生产环境黄金法则：先ls确认，再rm删除 ls /path/to/delete && rm -rf /path/to/delete # 安全删除：使用trash-cli替代rm # rm -rf 的危险性：删除后无法恢复，操作前务必确认 # 运维技巧：限制rm别名防止误删 alias rm=&#39;rm -i&#39; # 删除前提示确认 alias rm=&#39;rm --preserve-root&#39; # 防止删除根目录 cp - 复制文件 1 2 3 4 5 cp -a source dest # -a = -dR --preserve=all，保留所有属性（备份首选） cp -r dir1 dir2 # 递归复制目录 cp -u source dest # 只复制更新的文件（update） cp -p source dest # 保留文件属性（时间戳、权限等） cp --sparse=always # 优化稀疏文件复制（虚拟机镜像） mv - 移动/重命名文件 1 2 3 mv -i file1 file2 # 交互式，覆盖前提示 mv -n file1 file2 # 不覆盖已存在文件 mv -t target_dir source_files # 指定目标目录 touch - 修改时间戳 1 2 3 4 touch file # 不存在则创建，存在则更新时间为当前 touch -c file # 不创建新文件 touch -t 202501011200 file # 指定时间戳 touch -r ref_file file # 使用参考文件的时间 1.2 文件查看与编辑 cat - 连接文件并打印 1 2 3 cat -n file # 显示行号 cat -A file # 显示所有控制字符（包括换行符$） cat file1 file2 > file3 # 合并文件 more - 分页查看 1 2 more +100 file # 从第100行开始显示 more -d file # 显示帮助提示 less - 增强分页查看（运维首选） 1 2 3 4 5 6 less -N file # 显示行号 less +F file # 实时跟踪文件更新（类似tail -f） less -S file # 不换行显示（查看宽日志） # 内部命令： # /pattern 搜索 n/N 下一个/上一个 # g 跳到行首 G 跳到行尾 q 退出 head - 查看文件头部 1 2 3 head -n 20 file # 显示前20行 head -c 100 file # 显示前100字节 head -n -5 file # 显示除最后5行的所有内容 tail - 查看文件尾部（运维高频） 1 2 3 4 5 6 7 8 tail -f file # 实时跟踪文件更新（日志监控） tail -F file # 跟踪文件，即使文件被旋转也继续 tail -n 100 file # 显示最后100行 tail -c 100 file # 显示最后100字节 tail -n +100 file # 从第100行开始显示 # 生产技巧：同时查看多个日志 tail -f /var/log/*.log vim - 文本编辑器（运维必备） 1 2 3 4 5 6 7 8 9 10 11 12 # 常用操作 vim +100 file # 打开文件并定位到第100行 vim -R file # 只读模式打开 # 内部命令 # :set nu 显示行号 # :set nonu 取消行号 # /pattern 搜索 # n 下一个匹配 # :%s/old/new/g 全局替换 # :wq 保存退出 # :q! 强制退出不保存 二、系统监控与性能分析（生产级） 2.1 CPU性能监控 top - 实时监控系统 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 top # 默认按CPU排序 top -Hp <PID> # 查看进程内所有线程（排查Java/Python多线程问题关键） top -p 1,2,3 # 只监控指定PID top -u username # 只显示指定用户 top -b -n 1 > top.log # 批处理模式，运行一次后退出 # 内部交互命令 # P - 按CPU排序 M - 按内存排序 T - 按时间排序 # k - 杀死进程 r - 修改nice值 H - 显示线程 # 1 - 显示各CPU核心详情 # 生产案例：Java应用CPU飙高排查 # 1. top找到高CPU进程PID # 2. top -Hp PID查看线程 # 3. printf "%xn" <TID> 转16进制 # 4. jstack PID | grep -A 20 <hex_TID> htop - 增强版top（推荐） 1 2 3 4 5 htop # 彩色显示，支持鼠标操作 htop -d 10 # 刷新间隔10秒 htop -u root # 只显示root用户进程 # 优点：支持树状显示、直接kill、renice、搜索过滤 vmstat - 系统资源综合监控 1 2 3 4 5 6 7 8 9 10 11 12 vmstat 2 10 # 每2秒采样一次，共10次 vmstat -s # 显示内存统计摘要 vmstat -d # 显示磁盘统计 # 输出解读： # procs: r(运行队列) b(不可中断睡眠进程) # memory: swpd(交换内存) free(空闲) buff/cache(缓存) # swap: si(换入) so(换出) - 这两个值应该为0 # io: bi(读块) bo(写块) # cpu: us(用户) sy(系统) id(空闲) wa(IO等待) # 警戒线：wa持续>20%说明IO瓶颈 mpstat - 多核CPU分析 1 2 3 4 mpstat -P ALL 1 10 # 显示每个CPU核心的使用情况 mpstat 1 10 # 显示所有CPU平均情况 # 输出列：%usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle pidstat - 进程级资源监控（sysstat工具） 1 2 3 4 5 6 7 pidstat -u 1 10 # 监控CPU使用 pidstat -r 1 10 # 监控内存使用 pidstat -d 1 10 # 监控磁盘IO pidstat -t -p <PID> # 监控指定进程的线程 # 生产技巧：监控Java应用所有指标 pidstat -u -r -d -t -p <PID> 2 sar - 系统活动报告（历史数据） 1 2 3 4 5 6 7 8 sar -u 1 10 # CPU使用情况 sar -r 1 10 # 内存使用情况 sar -b 1 10 # IO传输速率 sar -n DEV 1 10 # 网络设备流量 sar -q 1 10 # 负载队列 sar -f /var/log/sa/saXX # 查看历史数据 # 安装：yum install sysstat / apt-get install sysstat perf - 性能分析利器（内核级） 1 2 3 4 5 6 7 8 perf top # 实时分析系统性能热点 perf stat -p <PID> # 统计进程性能数据 perf record -g -p <PID> # 记录性能数据（用于火焰图） perf report # 报告分析结果 # 生产案例：分析CPU热点函数 perf top -g -p <PID> # 定位到具体函数后，可结合jstack/gdb分析 strace - 系统调用跟踪（调试神器） 1 2 3 4 5 6 7 8 9 strace -p <PID> # 跟踪指定进程 strace -c -p <PID> # 统计系统调用耗时 strace -e trace=file -p <PID> # 只跟踪文件操作 strace -f -e trace=network -p <PID> # 跟踪子进程和网络调用 strace -T -tt -p <PID> # 显示时间戳和耗时 # 生产案例：进程卡住排查 strace -p <PID> -e trace=futex # 发现卡在futex_wait，说明在等待锁 2.2 内存性能监控 free - 内存使用 1 2 3 4 5 6 7 8 9 10 free -h # 人类可读格式 free -m # MB单位 free -w # 显示 buff 和 cache 分开 # 解读： # available: 真正可用内存（最重要指标） # free: 完全空闲内存 # buff/cache: 缓存（可被回收） # 生产误区：不要被free值迷惑，关键看available pmap - 进程内存映射 1 2 3 4 5 pmap -x <PID> # 详细内存映射 pmap -x <PID> | tail -5 # 只显示汇总 # 排查内存泄漏：持续观察RSS列 watch -n 5 "pmap -x <PID> | grep total" smem - 内存统计工具 1 2 3 4 5 smem -rs swap -p # 按swap使用排序（%） smem -rs rss -p # 按物理内存排序 smem -u # 按用户汇总 # 优势：能准确反映PSS（比例集大小），比RSS更有意义 vmstat -s - 内存统计 1 2 vmstat -s # 显示详细内存统计 # 重点看：swap pages in/out，应该为0 2.3 磁盘IO性能监控 iostat - IO统计（sysstat） 1 2 3 4 5 6 7 8 9 iostat -x 1 10 # 详细IO统计（-x显示扩展信息） iostat -dk 1 10 # 以KB/s显示 iostat -p sda 1 10 # 显示分区详细 # 关键指标： # %util: 设备利用率，>80%说明瓶颈 # await: 平均IO响应时间，>10ms需关注 # svctm: 平均服务时间 # r/s w/s: 读写IOPS iotop - IO实时监控 1 2 3 iotop # 需要root权限 iotop -oP -d 2 # 只显示有IO的进程(-o)，只显示进程(-P)，2秒刷新 iotop -a # 显示累积IO量 df - 磁盘空间 1 2 3 4 5 6 df -h # 人类可读 df -i # 显示inode使用情况（inode满导致无法写入） df -T # 显示文件系统类型 df -h /path # 只显示指定路径的挂载点 # 生产警戒线：使用率>85%预警，>95%紧急 du - 目录大小统计 1 2 3 4 5 6 du -h --max-depth=1 /path # 统计一级子目录大小 du -sh /path # 只显示总大小(-s) du -ah /path | sort -hr | head -20 # 找出最大的20个文件 # 生产技巧：快速定位磁盘满的原因 du -h --max-depth=1 / | sort -hr | head -10 lsof - 查看打开的文件 1 2 3 4 5 6 7 8 9 10 lsof # 列出所有打开的文件 lsof -p <PID> # 指定进程打开的文件 lsof /path/to/file # 查看文件被哪些进程使用 lsof -i :8080 # 查看端口占用进程 lsof -u username # 指定用户 lsof +D /path # 递归目录（慢，用lsof | grep /path更快） # 生产案例：删除文件后空间不释放 lsof | grep deleted # 查找已删除但仍被进程占用的文件 # 解决：重启对应进程或> /proc/<PID>/fd/<FD> 2.4 网络性能监控 ss - socket统计（替代netstat） 1 2 3 4 5 6 7 ss -tuln # 显示所有监听端口（-t TCP, -u UDP, -l 监听, -n 数字） ss -tan # 显示所有TCP连接 ss -s # 显示socket统计摘要 ss -p # 显示进程信息 ss -o state established &#39;( dport = :22 or sport = :22 )&#39; # 过滤特定端口 # 比netstat更快，适合高并发环境 netstat - 网络连接（传统工具） 1 2 3 4 5 netstat -tuln # 显示监听端口 netstat -anp # 显示所有连接和进程 netstat -i # 显示网络接口统计 netstat -r # 显示路由表 netstat -s # 显示协议统计 iftop - 实时流量监控 1 2 3 4 5 6 iftop -i eth0 # 监控指定网卡 iftop -n # 不解析主机名 iftop -P # 显示端口 iftop -f "port 80" # 过滤特定端口 # 需要root权限，适合排查带宽占用 tcpdump - 抓包分析（网络排障核心） 1 2 3 4 5 6 7 8 9 tcpdump -i eth0 -nn -s0 -v port 80 # 抓HTTP流量 tcpdump -i any -nn host 192.168.1.1 # 抓特定IP tcpdump -w capture.pcap # 写入文件（wireshark分析） tcpdump -r capture.pcap # 读取文件 tcpdump -A -s0 port 80 # ASCII显示HTTP内容 tcpdump -i eth0 -c 1000 # 只抓1000个包 # 生产案例：排查MySQL慢查询网络原因 tcpdump -i eth0 -s0 -nn -A dst port 3306 | grep -E "SELECT|INSERT" nethogs - 按进程统计流量 1 2 nethogs # 需要root，显示进程级流量 nethogs eth0 # 指定网卡 ping - 测试连通性 1 2 3 ping -c 4 -i 0.2 -W 1 8.8.8.8 # 发送4次，间隔0.2秒，超时1秒 ping -f 8.8.8.8 # 洪水ping（需root，测试网络极限） ping -s 1400 8.8.8.8 # 指定包大小（测试MTU） traceroute - 路由追踪 1 2 3 traceroute -n 8.8.8.8 # 不解析主机名（快） traceroute -T -p 80 8.8.8.8 # TCP SYN方式（绕过防火墙ICMP限制） traceroute -I 8.8.8.8 # ICMP方式 mtr - 综合网络诊断 1 2 mtr -r -c 10 8.8.8.8 # 报告模式，发送10次 mtr -w 8.8.8.8 # 宽格式（长主机名） 2.5 系统负载与运行时长 uptime - 系统运行时间与负载 1 2 3 4 5 6 7 uptime # 显示：时间、运行时长、用户数、负载 uptime -p # 只显示运行时长 # 负载解读： # 1分钟、5分钟、15分钟平均负载 # 理想值：负载 < CPU核心数 # 警戒线：负载 > CPU核心数 * 0.7 who - 查看登录用户 1 2 3 who # 显示当前登录用户 who -b # 显示上次启动时间 who -r # 显示运行级别 last - 查看登录历史 1 2 3 4 last # 显示所有登录历史 last root # 只显示root登录历史 last -n 10 # 只显示最近10条 last -f /var/log/btmp # 查看失败登录尝试 dmesg - 内核日志 1 2 3 4 5 6 7 8 dmesg # 查看内核环形缓冲区 dmesg -T # 显示人类可读时间 dmesg -c # 读取后清除 dmesg | grep -i error # 搜索错误 dmesg | grep -i oom # 查找OOM killer记录 # 生产案例：排查硬件故障 dmesg | grep -E " Hardware|Error|Fail" 三、进程管理（运维核心） 3.1 进程查看 ps - 进程快照 1 2 3 4 5 6 7 8 ps aux # BSD风格，显示所有进程（常用） ps -ef # System V风格 ps aux --sort=-%cpu # 按CPU排序（降序） ps aux --sort=-%mem # 按内存排序 ps -o pid,ppid,cmd,%cpu,%mem -p <PID> # 自定义输出列 # 生产技巧：查找僵尸进程 ps aux | awk &#39;$8=="Z"&#39; pgrep - 按名称查找PID 1 2 3 4 pgrep nginx # 查找nginx进程PID pgrep -f "python3 app.py" # 匹配完整命令行 pgrep -u root sshd # 查找root用户的sshd进程 pgrep -d, -f java # 用逗号分隔输出（用于top -p） pidof - 按名称查找PID 1 pidof nginx # 返回所有nginx worker PID pstree - 进程树 1 2 3 4 5 pstree # 显示进程树 pstree -p # 显示PID pstree -u # 显示用户 pstree -a # 显示完整命令 pstree | grep -A 5 nginx # 查找nginx相关进程树 3.2 进程控制 kill - 发送信号 1 2 3 4 5 6 7 8 9 10 11 12 13 14 kill -l # 列出所有信号 kill -15 <PID> # 发送TERM信号（优雅终止） kill -9 <PID> # 发送KILL信号（强制终止，谨慎使用） kill -2 <PID> # 发送INT信号（类似Ctrl+C） kill -1 <PID> # 发送HUP信号（重载配置） # 批量杀进程 pkill -9 java # 按名称杀进程 killall -9 java # 杀所有名为java的进程 kill -9 $(pgrep -f "test.py") # 组合使用 # 生产案例：优雅重启nginx kill -USR1 $(cat /var/run/nginx.pid) # 重新打开日志文件 kill -HUP $(cat /var/run/nginx.pid) # 重载配置 killall - 按名称杀进程 1 2 killall -9 python3 # 杀所有python3进程 killall -w process # 等待进程终止 pkill - 按模式杀进程 1 2 3 pkill -f "test.py" # 匹配完整命令行 pkill -u username # 杀死某用户的所有进程 pkill -t pts/0 # 杀死某个终端的所有进程 nice/renice - 调整优先级 1 2 3 4 5 nice -n 19 command # 以最低优先级运行（19最低，-20最高） renice -n 10 -p <PID> # 调整已运行进程优先级 # 生产技巧：降低备份任务优先级 nice -n 19 tar -czf backup.tar.gz /data nohup - 后台持久运行 1 2 nohup command & # &放入后台，nohup忽略挂起信号 nohup java -jar app.jar > app.log 2>&amp;1 & # 标准推荐写法 disown - 从shell移除作业 1 2 3 disown %1 # 移除作业1 disown -a # 移除所有作业 disown -h %1 # 标记为不接收SIGHUP 3.3 作业控制 & - 后台运行 1 command & # 放入后台执行 jobs - 查看后台作业 1 2 3 4 jobs # 查看当前shell的后台作业 jobs -l # 显示PID jobs -r # 只显示运行中的作业 jobs -s # 只显示停止的作业 fg/bg - 前台/后台切换 1 2 fg %1 # 将作业1调到前台 bg %1 # 将作业1在后台继续运行 wait - 等待作业完成 1 2 wait <PID> # 等待指定PID进程结束 wait # 等待所有后台作业结束 3.4 高级进程调试 strace - 系统调用跟踪 1 # 详见2.1节 ltrace - 库函数调用跟踪 1 2 ltrace -p <PID> # 跟踪库函数调用 ltrace -c -p <PID> # 统计调用耗时 gdb - 调试器 1 2 3 4 5 6 7 8 gdb -p <PID> # 附加到运行进程 gdb /path/to/binary core # 分析core dump # 生产案例：分析Java core文件 gdb java core.12345 (gdb) bt # 查看堆栈 (gdb) info threads # 查看线程 (gdb) thread apply all bt # 查看所有线程堆栈 perf - 性能分析 1 # 详见2.1节 四、网络管理（运维核心） 4.1 网络配置 ip - 现代网络配置（推荐） 1 2 3 4 5 6 7 8 9 10 11 12 ip addr # 显示IP地址（替代ifconfig） ip addr add 192.168.1.100/24 dev eth0 # 添加IP ip addr del 192.168.1.100/24 dev eth0 # 删除IP ip link set eth0 up # 启用网卡 ip link set eth0 down # 禁用网卡 ip route # 显示路由表 ip route add default via 192.168.1.1 # 添加默认网关 ip neighbor # 显示ARP表 ip -s link # 显示统计信息 # 生产技巧：快速查看IP ip -4 -o addr show scope global | awk &#39;{print $4}&#39; ifconfig - 传统网络配置 1 2 3 4 5 6 ifconfig # 显示所有网卡 ifconfig eth0 # 显示指定网卡 ifconfig eth0 up/down # 启用/禁用 ifconfig eth0 192.168.1.100 netmask 255.255.255.0 # 配置IP # 已废弃，推荐使用ip命令 route - 路由管理 1 2 3 4 route -n # 显示路由表 route add default gw 192.168.1.1 # 添加默认网关 route add -net 10.0.0.0/8 gw 10.0.0.1 # 添加静态路由 route del -net 10.0.0.0/8 # 删除路由 nmcli - NetworkManager命令行 1 2 3 4 nmcli device status # 查看设备状态 nmcli connection show # 查看连接 nmcli connection up/down id "conn-name" # 启用/禁用连接 nmcli device wifi list # 查看WiFi 4.2 网络诊断 ping - 连通性测试 1 # 详见2.4节 traceroute - 路由追踪 1 # 详见2.4节 mtr - 综合诊断 1 # 详见2.4节 nslookup/dig - DNS查询 1 2 3 4 5 6 7 dig www.baidu.com # 详细DNS查询 dig +short www.baidu.com # 简短输出 dig @8.8.8.8 www.baidu.com # 指定DNS服务器 dig +trace www.baidu.com # 追踪查询过程 dig -x 8.8.8.8 # 反向解析 nslookup www.baidu.com 8.8.8.8 # 指定DNS host - 简单DNS查询 1 2 host www.baidu.com host -t mx baidu.com # 查询MX记录 telnet - 测试端口连通性 1 2 telnet 192.168.1.1 22 # 测试SSH端口 # Ctrl+] 然后输入quit退出 nc (netcat) - 网络瑞士军刀 1 2 3 4 5 6 7 8 nc -zv 192.168.1.1 22 # 测试端口（-z 零IO，-v 详细） nc -l 8080 # 监听8080端口 nc 192.168.1.1 8080 # 连接端口 echo "test" | nc 192.168.1.1 8080 # 发送数据 # 生产技巧：快速传输文件 # 接收端：nc -l 8888 > file # 发送端：nc receiver_ip 8888 < file 4.3 高级网络工具 tcpdump - 抓包分析 1 # 详见2.4节 wireshark - 图形化抓包 1 2 wireshark # 图形界面 tshark -i eth0 # 命令行版wireshark ss - socket统计（推荐） 1 # 详见4.1节 lsof - 查看网络连接 1 2 3 lsof -i :8080 # 查看8080端口占用 lsof -i TCP # 查看所有TCP连接 lsof -i @192.168.1.1 # 查看连接到该IP的连接 五、文本处理三剑客（运维核心） 5.1 grep - 文本搜索 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 基本用法 grep "error" file.log # 搜索包含error的行 grep -i "error" file # 忽略大小写 grep -v "error" file # 反向匹配（不包含） grep -r "error" /path # 递归目录搜索 grep -E "error|warn" file # 正则表达式（扩展） grep -A 3 -B 3 "error" file # 显示前后3行 grep -n "error" file # 显示行号 grep -c "error" file # 统计匹配行数 grep -o "error" file # 只显示匹配部分 grep -w "error" file # 整词匹配 grep -f patterns.txt file # 从文件读取模式 # 生产案例：分析Nginx访问日志 grep "200" access.log | wc -l # 统计成功请求 grep -E "5[0-9]{2}" access.log | awk &#39;{print $7}&#39; | sort | uniq -c | sort -nr | head # Top错误URL # 高级用法：排除多个模式 grep -vE "(debug|info)" app.log # 查找IP地址 grep -oE "([0-9]{1,3}\\.){3}[0-9]{1,3}" access.log 5.2 sed - 流编辑器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # 基本语法：sed [选项] &#39;命令&#39; 文件 # 替换 sed &#39;s/old/new/&#39; file # 每行第一个匹配 sed &#39;s/old/new/g&#39; file # 全局替换 sed -i &#39;s/old/new/g&#39; file # 直接修改文件（-i危险，先备份） # 删除 sed &#39;/pattern/d&#39; file # 删除匹配行 sed &#39;1,10d&#39; file # 删除1-10行 sed &#39;$d&#39; file # 删除最后一行 # 插入 sed &#39;1i\\insert&#39; file # 第1行前插入 sed &#39;$a\\append&#39; file # 最后追加 # 打印 sed -n &#39;1,10p&#39; file # 打印1-10行 sed -n &#39;/pattern/p&#39; file # 打印匹配行 # 生产案例：批量修改配置文件 sed -i &#39;s/Port 22/Port 2222/&#39; /etc/ssh/sshd_config # 修改SSH端口 sed -i &#39;/^#ServerActive/s/#//&#39; /etc/zabbix/zabbix_agentd.conf # 取消注释 # 提取特定行 sed -n &#39;/2024-01-01/,/2024-01-02/p&#39; access.log # 提取日期范围 5.3 awk - 文本处理语言 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # 基本语法：awk &#39;模式{动作}&#39; 文件 # 打印列 awk &#39;{print $1}&#39; file # 打印第1列（默认空格分隔） awk -F: &#39;{print $1}&#39; /etc/passwd # 指定分隔符: awk &#39;{print $NF}&#39; file # 打印最后一列 # 条件过滤 awk &#39;$3 > 100&#39; file # 第3列大于100 awk &#39;/error/&#39; file # 匹配模式 awk &#39;$1 ~ /^192/ {print $2}&#39; file # 第1列匹配正则 # 生产案例：分析Nginx日志 awk &#39;{print $1}&#39; access.log | sort | uniq -c | sort -nr | head -20 # Top IP awk &#39;{print $7}&#39; access.log | grep -v &#39;^$&#39; | sort | uniq -c | sort -nr | head -20 # Top URL awk &#39;$9 ~ /^5/ {print $7}&#39; access.log | sort | uniq -c | sort -nr # 500错误的URL # 统计 awk &#39;{sum+=$1} END {print sum/NR}&#39; file # 求平均值 awk &#39;{if($1>max) max=$1} END {print max}&#39; file # 求最大值 # 多分隔符 awk -F&#39;[: ]&#39; &#39;{print $1}&#39; file # 分隔符为冒号或空格 # 内置变量 # NR: 行号 NF: 列数 $0: 整行 FILENAME: 文件名 5.4 组合使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 案例1：查找Top内存进程 ps aux | sort -nk4 -r | head -10 # 案例2：日志分析完整流程 cat access.log | grep "200" | awk &#39;{print $7}&#39; | sort | uniq -c | sort -nr | head -10 > top_urls.txt # 案例3：多条件过滤 cat app.log | grep -v "DEBUG" | grep -E "error|warn" | awk -F&#39;[&#39; &#39;{print $2}&#39; | awk -F&#39;]&#39; &#39;{print $1}&#39; # 案例4：时间范围提取 sed -n &#39;/2024-01-01 10:00:00/,/2024-01-01 11:00:00/p&#39; access.log # 案例5：CSV处理 awk -F&#39;,&#39; &#39;{printf "%-20s %-10s %5.2f\\n", $1, $2, $3}&#39; data.csv 六、文件系统与存储管理 6.1 磁盘管理 fdisk - 分区管理 1 2 3 fdisk -l # 列出所有磁盘 fdisk /dev/sdb # 进入交互模式 # 内部命令：m(帮助) n(新建) p(打印) w(写入) q(退出) d(删除) gdisk - GPT分区管理 1 gdisk -l /dev/sdb # 查看GPT分区 parted - 分区管理（支持大磁盘） 1 2 3 parted -l # 列出所有磁盘 parted /dev/sdb mklabel gpt # 创建GPT标签 parted /dev/sdb mkpart primary 0% 100% # 创建分区 mkfs - 创建文件系统 1 2 3 mkfs.ext4 /dev/sdb1 # 创建ext4文件系统 mkfs.xfs /dev/sdb1 # 创建xfs文件系统 mkfs -t ext4 /dev/sdb1 # 通用格式 fsck - 文件系统检查 1 2 3 4 5 fsck /dev/sda1 # 检查并修复（卸载后执行） fsck -y /dev/sda1 # 自动修复 fsck -n /dev/sda1 # 只检查不修复 # 生产警告：不要在挂载的文件系统上运行！ mount/umount - 挂载/卸载 1 2 3 4 5 6 7 8 9 mount # 显示挂载信息 mount /dev/sdb1 /mnt # 挂载 mount -t nfs 192.168.1.1:/data /mnt # 挂载NFS mount -o remount,rw / # 重新挂载为读写（救援模式常用） umount /mnt # 卸载 umount -l /mnt # 懒卸载（文件系统忙时使用） umount -f /mnt # 强制卸载 # 开机挂载：编辑/etc/fstab 6.2 LVM管理 pvcreate - 创建物理卷 1 2 3 pvcreate /dev/sdb1 # 将分区初始化为物理卷 pvdisplay # 显示物理卷信息 pvs # 简要显示 vgcreate - 创建卷组 1 2 3 4 5 vgcreate vg_data /dev/sdb1 /dev/sdc1 # 创建卷组包含两个PV vgdisplay vgs vgextend vg_data /dev/sdd1 # 扩展卷组 vgreduce vg_data /dev/sdd1 # 缩减卷组 lvcreate - 创建逻辑卷 1 2 3 4 5 6 lvcreate -L 100G -n lv_home vg_data # 创建100G逻辑卷 lvcreate -l 100%FREE -n lv_opt vg_data # 使用所有剩余空间 lvdisplay lvs lvextend -L +50G /dev/vg_data/lv_home # 扩展逻辑卷 lvreduce -L -50G /dev/vg_data/lv_home # 缩减逻辑卷（危险） resize2fs/xfs_growfs - 调整文件系统大小 1 2 resize2fs /dev/vg_data/lv_home # ext4在线扩容 xfs_growfs /mnt/home # xfs在线扩容 6.3 RAID管理 mdadm - RAID管理 1 2 3 4 5 mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1 # 创建RAID1 mdadm --detail /dev/md0 # 查看RAID详情 mdadm --manage /dev/md0 --add /dev/sdd1 # 添加磁盘 mdadm --manage /dev/md0 --fail /dev/sdb1 # 标记故障盘 watch -n 1 cat /proc/mdstat # 监控RAID同步 七、系统服务管理 7.1 systemd（现代系统） systemctl - 服务控制 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 systemctl start nginx # 启动服务 systemctl stop nginx # 停止服务 systemctl restart nginx # 重启服务 systemctl reload nginx # 重载配置 systemctl status nginx # 查看状态 systemctl enable nginx # 开机自启 systemctl disable nginx # 取消开机自启 systemctl is-active nginx # 检查是否运行 systemctl is-enabled nginx # 检查是否开机自启 systemctl list-units --type=service --state=active # 列出所有运行服务 systemctl list-unit-files | grep enabled # 列出所有开机自启服务 systemctl daemon-reload # 重载配置（修改unit文件后） systemctl show nginx # 显示详细属性 # 生产技巧：查看服务启动失败原因 systemctl status nginx -l # 显示完整日志 journalctl -u nginx -f # 实时跟踪服务日志 journalctl -u nginx --since "10 minutes ago" # 最近10分钟日志 journalctl - systemd日志 1 2 3 4 5 6 7 8 journalctl -f # 实时跟踪 journalctl -u nginx # 指定服务 journalctl -k # 内核日志 journalctl --since "2024-01-01" --until "2024-01-02" # 时间范围 journalctl -p err # 只显示错误 journalctl -n 100 # 最后100行 journalctl --disk-usage # 查看日志占用空间 journalctl --vacuum-size=100M # 清理日志到100M 7.2 SysVinit（传统系统） service - 服务控制 1 2 3 4 5 6 7 service nginx start service nginx stop service nginx restart service nginx reload service nginx status # 已废弃，推荐systemctl chkconfig - 开机自启管理 1 2 3 chkconfig --list # 列出所有服务 chkconfig nginx on # 开机自启 chkconfig nginx off # 取消自启 7.3 定时任务 crontab - 计划任务 1 2 3 4 5 6 7 8 crontab -e # 编辑当前用户的crontab crontab -l # 列出 crontab -r # 删除 crontab -u user -e # 编辑指定用户的 # 格式：分 时 日 月 周 命令 # */5 * * * * /path/to/script.sh # 每5分钟 # 0 2 * * * /path/to/backup.sh # 每天2点 at - 一次性任务 1 2 3 4 5 6 at 14:00 tomorrow # 明天14点执行 at> /path/to/command at> Ctrl+D atq # 查看队列 atrm 1 # 删除任务1 八、用户与权限管理 8.1 用户管理 useradd - 添加用户 1 2 3 4 5 useradd -m -s /bin/bash -g users -G wheel newuser # 创建用户 # -m 创建home目录 -s 指定shell -g 主组 -G 附加组 # 生产技巧：批量创建用户 for i in {1..10}; do useradd -m user$i; echo "user$i:password" | chpasswd; done usermod - 修改用户 1 2 3 4 usermod -aG wheel newuser # 追加到wheel组 usermod -s /bin/zsh newuser # 修改shell usermod -L newuser # 锁定用户 usermod -U newuser # 解锁用户 userdel - 删除用户 1 2 userdel newuser # 删除用户 userdel -r newuser # 同时删除home目录和邮件 passwd - 修改密码 1 2 3 4 5 passwd # 修改当前用户密码 passwd newuser # 修改指定用户密码 passwd -l newuser # 锁定用户 passwd -u newuser # 解锁用户 passwd -e newuser # 强制下次登录修改密码 su - 切换用户 1 2 3 su - username # 完全切换（推荐） su username # 不切换环境变量 su -c "command" username # 以某用户执行命令 sudo - 提权执行 1 2 3 4 5 6 7 8 sudo command # 以root执行 sudo -u user command # 以指定用户执行 sudo -i # 切换到root shell sudo -l # 列出当前用户可执行命令 # 生产配置：/etc/sudoers # visudo 安全编辑 # user ALL=(ALL) NOPASSWD:ALL # 免密码sudo（谨慎） 8.2 组管理 groupadd - 添加组 1 2 groupadd developers # 创建组 groupadd -g 1000 dev # 指定GID groupmod - 修改组 1 groupmod -n newname oldname # 重命名 groupdel - 删除组 1 groupdel developers # 删除组（不能有用户为主组） 8.3 权限管理 chmod - 修改权限 1 2 3 4 5 6 7 8 chmod 755 file # rwxr-xr-x chmod u+x file # 用户添加执行权限 chmod g-w file # 组移除写权限 chmod o=r-- file # 其他用户只读 chmod -R 755 dir # 递归修改 # 数字权限：r=4 w=2 x=1 # 755 = 7(rwx) 5(r-x) 5(r-x) chown - 修改所有者 1 2 3 4 5 6 7 chown user:group file # 同时修改用户和组 chown user file # 只修改用户 chown :group file # 只修改组 chown -R user:group dir # 递归修改 # 生产技巧：批量修改 chown -R www-data:www-data /var/www/html chgrp - 修改组 1 2 chgrp group file # 修改文件组 chgrp -R group dir # 递归修改 umask - 默认权限掩码 1 2 3 4 umask # 查看当前掩码 umask 022 # 设置掩码 # 默认文件权限：666-umask # 默认目录权限：777-umask 8.4 高级权限 setuid/setgid/sticky bit 1 2 3 4 5 6 7 chmod u+s file # setuid (4) 以文件所有者权限执行 chmod g+s dir # setgid (2) 新建文件继承目录组 chmod +t dir # sticky bit (1) 用户只能删除自己的文件 # 数字表示：chmod 4755 file (setuid) # chmod 2755 dir (setgid) # chmod 1777 dir (sticky) ACL - 访问控制列表 1 2 3 4 5 6 7 8 9 setfacl -m u:user:rwx file # 给用户添加权限 setfacl -m g:group:r-x file # 给组添加权限 setfacl -x u:user file # 删除用户ACL setfacl -b file # 清除所有ACL getfacl file # 查看ACL # 生产场景：多用户共享目录 setfacl -R -m u:user1:rwx,u:user2:rwx /shared setfacl -R -d -m u:user1:rwx,u:user2:rwx /shared # 默认ACL 九、压缩与备份 9.1 压缩工具 tar - 归档（运维必备） 1 2 3 4 5 6 7 8 9 10 11 tar -czf archive.tar.gz /path # 压缩（c创建，z gzip，f文件） tar -xzf archive.tar.gz # 解压（x解压） tar -tzf archive.tar.gz # 查看内容（t列表） tar -czf - /path | ssh user@host "tar -xzf - -C /dest" # 远程压缩传输 tar --exclude=&#39;*.log&#39; -czf archive.tar.gz /path # 排除文件 # 参数： # c: 创建 x: 解压 t: 查看 # z: gzip j: bzip2 J: xz # v: 显示过程 f: 指定文件 # C: 切换到目录 gzip/gunzip 1 2 3 4 gzip file # 压缩为file.gz gzip -9 file # 最高压缩率（1-9） gzip -d file.gz # 解压 gunzip file.gz # 解压 zip/unzip 1 2 3 zip -r archive.zip dir # 压缩目录 unzip archive.zip # 解压 unzip -l archive.zip # 查看内容 rsync - 同步与备份（运维神器） 1 2 3 4 5 6 7 8 9 10 rsync -avz /src/ /dst/ # 同步目录（a归档，v详细，z压缩） rsync -avz /src/ user@host:/dst/ # 远程同步 rsync -avz --delete /src/ /dst/ # 删除目标端多余文件 rsync -avz --exclude=&#39;*.log&#39; /src/ /dst/ # 排除 rsync -avz --bwlimit=10240 /src/ /dst/ # 限速10MB/s rsync -avz --partial --progress /src/ /dst/ # 断点续传 rsync -avzh --link-dest=/latest /src/ /dst/`date +%Y%m%d`/ # 硬链接增量备份 # 生产案例：每日备份脚本 rsync -avz --delete /data/ /backup/`date +%Y%m%d`/ 9.2 备份策略 dd - 磁盘克隆 1 2 3 4 5 6 dd if=/dev/sda of=/dev/sdb bs=4M # 磁盘对拷 dd if=/dev/sda of=disk.img # 创建镜像 dd if=disk.img of=/dev/sda # 恢复镜像 dd if=/dev/zero of=/swapfile bs=1M count=4096 # 创建swap文件 # 生产警告：dd是危险命令，if/of参数务必确认 cpio - 归档 1 2 find /path | cpio -o > archive.cpio # 创建 cpio -i < archive.cpio # 解压 十、系统信息与管理 10.1 系统信息 uname - 内核信息 1 2 3 4 uname -a # 显示所有信息 uname -r # 内核版本 uname -m # 架构 uname -n # 主机名 hostnamectl - 主机名管理 1 2 hostnamectl # 显示主机信息 hostnamectl set-hostname newname # 修改主机名 uptime - 运行时间与负载 1 # 详见2.5节 who/w - 登录用户 1 2 who # 显示登录用户 w # 显示登录用户及正在执行的命令 last - 登录历史 1 # 详见2.5节 10.2 硬件信息 lspci - PCI设备 1 2 3 lspci # 显示所有PCI设备 lspci -v # 详细信息 lspci | grep -i vga # 查找显卡 lsusb - USB设备 1 2 lsusb # 显示USB设备 lsusb -t # 树状显示 lscpu - CPU信息 1 2 lscpu # 显示CPU架构信息 lscpu | grep "CPU(s)" # 核心数 dmidecode - 硬件DMI信息 1 2 3 dmidecode # 显示所有硬件信息 dmidecode -t memory # 显示内存信息 dmidecode -t system # 显示系统信息 hdparm - 磁盘信息 1 2 hdparm -I /dev/sda # 显示磁盘详细信息 hdparm -tT /dev/sda # 测试磁盘性能 10.3 内核与模块 lsmod - 加载的模块 1 2 lsmod # 显示已加载内核模块 lsmod | grep kvm # 查找特定模块 modinfo - 模块信息 1 modinfo kvm # 显示模块详细信息 modprobe - 加载/卸载模块 1 2 modprobe kvm # 加载模块 modprobe -r kvm # 卸载模块 insmod/rmmod - 加载/卸载模块 1 2 insmod /path/to/module.ko rmmod kvm sysctl - 内核参数 1 2 3 4 sysctl -a # 显示所有参数 sysctl -p # 加载/etc/sysctl.conf sysctl -w vm.swappiness=10 # 临时修改 echo "vm.swappiness=10" >> /etc/sysctl.conf && sysctl -p # 永久修改 十一、性能调优（专家级） 11.1 CPU调优 CPU亲和性 1 # 详见10.1节 中断均衡 1 2 3 4 5 cat /proc/interrupts # 查看中断分布 echo 2 > /proc/irq/24/smp_affinity # 将中断绑定到CPU2 # 自动均衡：irqbalance服务 systemctl status irqbalance 调节器 1 2 3 4 5 cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 查看当前调节器 echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 性能模式 echo powersave > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 节能模式 # 可用调节器：performance powersave ondemand conservative 11.2 内存调优 swappiness 1 # 详见2.2节 透明大页 1 2 cat /sys/kernel/mm/transparent_hugepage/enabled # 查看状态 echo never > /sys/kernel/mm/transparent_hugepage/enabled # 禁用（数据库推荐） 内存压缩 1 2 3 4 cat /proc/sys/vm/drop_caches # 释放缓存 # echo 1 > /proc/sys/vm/drop_caches # 释放pagecache # echo 2 > /proc/sys/vm/drop_caches # 释放dentries和inodes # echo 3 > /proc/sys/vm/drop_caches # 释放所有缓存（生产环境慎用） 11.3 磁盘调优 IO调度器 1 2 3 4 5 6 7 cat /sys/block/sda/queue/scheduler # 查看当前调度器 echo deadline > /sys/block/sda/queue/scheduler # 修改为deadline # 调度器选择： # noop: SSD/闪存 # deadline: 数据库（保证延迟） # cfq: 桌面/通用 文件系统调优 1 2 3 4 5 # ext4挂载选项 /dev/sdb1 /data ext4 defaults,noatime,nodiratime 0 0 # XFS调优 xfs_info /dev/sda1 # 查看XFS信息 11.4 网络调优 TCP参数 1 # 详见10.1节 文件描述符限制 1 2 3 4 5 6 ulimit -n # 查看当前限制 ulimit -n 65535 # 临时修改 # 永久修改：/etc/security/limits.conf * soft nofile 65535 * hard nofile 65535 端口范围 1 2 cat /proc/sys/net/ipv4/ip_local_port_range # 查看端口范围 echo "1024 65535" > /proc/sys/net/ipv4/ip_local_port_range # 扩大范围 十二、安全与审计 12.1 文件完整性 md5sum/sha256sum - 校验和 1 2 3 md5sum file # 计算MD5 sha256sum file # 计算SHA256 md5sum -c file.md5 # 校验文件 chattr/lsattr - 扩展属性 1 2 3 4 5 6 7 chattr +i file # 设置不可变（无法修改删除） chattr -i file # 取消不可变 chattr +a file # 只允许追加 lsattr file # 查看扩展属性 # 生产应用：保护关键配置文件 chattr +i /etc/passwd /etc/shadow 12.2 安全工具 iptables - 防火墙（传统） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 iptables -L -n # 查看规则 iptables -A INPUT -p tcp --dport 22 -j ACCEPT # 放行SSH iptables -A INPUT -p tcp --dport 80 -j ACCEPT # 放行HTTP iptables -A INPUT -j DROP # 默认拒绝（注意顺序） service iptables save # 保存规则 # 生产脚本：配置基础防火墙 #!/bin/bash iptables -F iptables -A INPUT -i lo -j ACCEPT iptables -A INPUT -p tcp --dport 22 -j ACCEPT iptables -A INPUT -p tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp --dport 443 -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -P INPUT DROP firewalld - 动态防火墙 1 2 3 4 firewall-cmd --state # 查看状态 firewall-cmd --list-all # 查看所有规则 firewall-cmd --add-port=8080/tcp --permanent # 永久添加端口 firewall-cmd --reload # 重载规则 ufw - Ubuntu防火墙 1 2 3 ufw status # 查看状态 ufw allow 22/tcp # 放行SSH ufw enable # 启用防火墙 12.3 审计 lastlog - 最后登录 1 2 lastlog # 显示所有用户最后登录 lastlog -u username # 指定用户 lastb - 失败登录 1 lastb # 查看失败登录尝试 ausearch - SELinux审计 1 ausearch -m avc -ts today # 查看今天SELinux拒绝 十三、自动化运维脚本模板 13.1 系统巡检脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 #!/bin/bash # 系统健康检查脚本 LOGFILE="/var/log/system_check_$(date +%Y%m%d).log" exec > $LOGFILE 2>&amp;1 echo "===== System Check $(date) =====" # CPU检查 echo "--- CPU Check ---" top -bn1 | grep "Cpu(s)" mpstat -P ALL 1 1 # 内存检查 echo "--- Memory Check ---" free -h vmstat -s | grep -E "swapped|used memory" # 磁盘检查 echo "--- Disk Check ---" df -h df -i # IO检查 echo "--- IO Check ---" iostat -x 1 3 # 网络检查 echo "--- Network Check ---" ss -s netstat -i # 负载检查 echo "--- Load Check ---" uptime cat /proc/loadavg # 服务检查 echo "--- Service Check ---" systemctl list-units --type=service --state=failed echo "===== Check Complete $(date) =====" 13.2 日志分析脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/bash # Nginx日志分析脚本 LOGFILE="/var/log/nginx/access.log" REPORT="/tmp/nginx_report_$(date +%Y%m%d).txt" # Top 10 IP echo "Top 10 IP:" > $REPORT awk &#39;{print $1}&#39; $LOGFILE | sort | uniq -c | sort -nr | head -10 >> $REPORT # Top 10 URL echo -e "\\nTop 10 URL:" >> $REPORT awk &#39;{print $7}&#39; $LOGFILE | grep -v &#39;^$&#39; | sort | uniq -c | sort -nr | head -10 >> $REPORT # 状态码统计 echo -e "\\nStatus Code:" >> $REPORT awk &#39;{print $9}&#39; $LOGFILE | sort | uniq -c | sort -nr >> $REPORT # 响应时间分析（假设日志格式包含$request_time） echo -e "\\nResponse Time:" >> $REPORT awk &#39;{print $NF}&#39; $LOGFILE | awk &#39;{sum+=$1; count++} END {print "Avg: " sum/count}&#39; >> $REPORT mail -s "Nginx Daily Report" admin@example.com < $REPORT 13.3 自动扩容脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/bin/bash # 磁盘空间监控与扩容（LVM） THRESHOLD=85 VG_NAME="vg_data" LV_NAME="lv_home" MOUNT_POINT="/home" CURRENT=$(df -h $MOUNT_POINT | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;) if [ $CURRENT -gt $THRESHOLD ]; then # 检查是否有可用空间 FREE=$(vgs --noheadings -o vg_free $VG_NAME | sed &#39;s/ //g&#39;) if [ "$FREE" != "0" ]; then # 扩展逻辑卷（增加10G） lvextend -L +10G /dev/$VG_NAME/$LV_NAME # 扩展文件系统 resize2fs /dev/$VG_NAME/$LV_NAME # ext4 # xfs_growfs $MOUNT_POINT # xfs echo "Expanded $LV_NAME by 10G" | mail -s "Disk Alert" admin@example.com else echo "No free space in VG" | mail -s "URGENT Disk Alert" admin@example.com fi fi 十四、生产环境故障排查案例 案例1：CPU 100%但找不到进程 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. 检查系统负载 uptime # 2. 查看CPU等待IO情况 top # 发现wa很高（94%） # 3. 定位IO瓶颈进程 iotop -oP # 发现是rsync备份进程 # 4. 限制带宽 killall rsync nohup rsync -avz --bwlimit=10240 /src/ /dst/ & # 解决：将备份任务调整到凌晨2点执行 案例2：内存泄漏排查 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #!/bin/bash # 内存泄漏检测脚本 PID=$1 INTERVAL=60 LOG="mem_leak_${PID}.log" echo "Monitoring PID $PID every $INTERVAL seconds..." > $LOG while true; do echo "=== $(date) ===" >> $LOG pmap -x $PID | tail -1 >> $LOG ps -p $PID -o pid,rss,vsz,cmd >> $LOG sleep $INTERVAL done # 分析：观察RSS列是否持续增长 # 配合jmap分析Java堆：jmap -histo:live <PID> 案例3：网络连接数暴增 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. 查看连接数 ss -s # 2. 查看TIME_WAIT ss -tan | grep TIME_WAIT | wc -l # 3. 查看ESTABLISHED ss -tan | grep ESTABLISHED | wc -l # 4. 查找异常IP netstat -anp | grep ESTABLISHED | awk &#39;{print $5}&#39; | cut -d: -f1 | sort | uniq -c | sort -nr | head # 解决：调整TCP参数 echo "net.ipv4.tcp_tw_reuse = 1" >> /etc/sysctl.conf echo "net.ipv4.tcp_max_tw_buckets = 5000" >> /etc/sysctl.conf sysctl -p 案例4：磁盘空间异常 1 2 3 4 5 6 7 8 9 10 11 # 1. 查看磁盘使用 df -h # 发现/分区100% # 2. 查找大文件 du -h --max-depth=1 / | sort -hr | head -10 # 3. 检查已删除但仍在占用的文件 lsof | grep deleted # 发现日志文件被删除但进程未释放 # 4. 释放空间 > /proc/<PID>/fd/<FD> # 或者重启进程 十五、运维最佳实践总结 15.1 生产环境黄金法则 备份先行：任何操作前备份配置文件和数据 测试验证：先在测试环境验证，再应用到生产 灰度发布：分批重启服务，避免全量操作 监控告警：所有操作都要监控，设置告警 文档记录：所有变更必须记录 15.2 命令使用原则 rm：使用rm -i别名，高危操作先ls确认 dd：操作磁盘前再三确认if=和of= vim：编辑配置文件前先备份 systemctl：重启服务前检查配置语法 iptables：修改防火墙前保存当前规则 15.3 性能优化 checklist CPU：检查亲和性、中断均衡、调度器 内存：检查swappiness、泄漏、缓存 磁盘：检查IO调度器、使用率、inode 网络：检查连接数、TCP参数、带宽 服务：检查资源限制、日志级别、健康检查 15.4 推荐工具组合 监控：Prometheus + Grafana + Alertmanager 日志：ELK (Elasticsearch + Logstash + Kibana) 自动化：Ansible + Jenkins/GitLab CI 追踪：SkyWalking / Jaeger CMDB：NetBox / CMDBuild '><meta property='og:url' content='http://localhost:1313/blockchain/linux-%E5%91%BD%E4%BB%A4/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Blockchain'><meta property='article:published_time' content='2025-11-08T00:00:00+00:00'><meta property='article:modified_time' content='2025-11-08T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="Linux命令"><meta name=twitter:description content='Linux 命令 作为运维工程师，我为您深度挖掘全网权威资料，整理出这份涵盖基础到内核级调试的完整命令手册。每个命令都包含生产环境实战技巧和避坑指南。\n一、基础命令深度解析（运维视角） 1.1 文件目录操作（含性能优化） ls - 目录列表 1 2 3 4 5 6 7 8 # 运维必用组合：按大小排序，显示隐藏文件，人性化单位 ls -lhS --color=auto # 按大小排序，人类可读 ls -lart # 按修改时间倒序（最新在最后） ls -i # 显示inode号（排查硬链接问题） ls -Z # 显示SELinux上下文 # 生产环境技巧：快速找出大目录 du -h --max-depth=1 /var | sort -hr | head -10 cd - 切换目录 1 2 3 4 5 6 7 cd - # 快速返回上次目录（运维高频操作） cd .. # 返回上级 cd ~ # 返回home目录 cd / # 返回根目录 # 高级技巧：自动纠正拼写错误 shopt -s cdspell # 开启cd命令自动纠错 pwd - 显示当前路径 1 2 pwd -P # 显示物理路径（解析符号链接） pwd -L # 显示逻辑路径（默认） mkdir - 创建目录 1 2 3 mkdir -p /path/to/dir # 递归创建（-p = parents） mkdir -m 755 /path # 直接指定权限 mkdir -v /path # 显示创建过程 rm - 删除文件/目录（⚠️高危命令） 1 2 3 4 5 6 7 8 9 # 生产环境黄金法则：先ls确认，再rm删除 ls /path/to/delete && rm -rf /path/to/delete # 安全删除：使用trash-cli替代rm # rm -rf 的危险性：删除后无法恢复，操作前务必确认 # 运维技巧：限制rm别名防止误删 alias rm=&#39;rm -i&#39; # 删除前提示确认 alias rm=&#39;rm --preserve-root&#39; # 防止删除根目录 cp - 复制文件 1 2 3 4 5 cp -a source dest # -a = -dR --preserve=all，保留所有属性（备份首选） cp -r dir1 dir2 # 递归复制目录 cp -u source dest # 只复制更新的文件（update） cp -p source dest # 保留文件属性（时间戳、权限等） cp --sparse=always # 优化稀疏文件复制（虚拟机镜像） mv - 移动/重命名文件 1 2 3 mv -i file1 file2 # 交互式，覆盖前提示 mv -n file1 file2 # 不覆盖已存在文件 mv -t target_dir source_files # 指定目标目录 touch - 修改时间戳 1 2 3 4 touch file # 不存在则创建，存在则更新时间为当前 touch -c file # 不创建新文件 touch -t 202501011200 file # 指定时间戳 touch -r ref_file file # 使用参考文件的时间 1.2 文件查看与编辑 cat - 连接文件并打印 1 2 3 cat -n file # 显示行号 cat -A file # 显示所有控制字符（包括换行符$） cat file1 file2 > file3 # 合并文件 more - 分页查看 1 2 more +100 file # 从第100行开始显示 more -d file # 显示帮助提示 less - 增强分页查看（运维首选） 1 2 3 4 5 6 less -N file # 显示行号 less +F file # 实时跟踪文件更新（类似tail -f） less -S file # 不换行显示（查看宽日志） # 内部命令： # /pattern 搜索 n/N 下一个/上一个 # g 跳到行首 G 跳到行尾 q 退出 head - 查看文件头部 1 2 3 head -n 20 file # 显示前20行 head -c 100 file # 显示前100字节 head -n -5 file # 显示除最后5行的所有内容 tail - 查看文件尾部（运维高频） 1 2 3 4 5 6 7 8 tail -f file # 实时跟踪文件更新（日志监控） tail -F file # 跟踪文件，即使文件被旋转也继续 tail -n 100 file # 显示最后100行 tail -c 100 file # 显示最后100字节 tail -n +100 file # 从第100行开始显示 # 生产技巧：同时查看多个日志 tail -f /var/log/*.log vim - 文本编辑器（运维必备） 1 2 3 4 5 6 7 8 9 10 11 12 # 常用操作 vim +100 file # 打开文件并定位到第100行 vim -R file # 只读模式打开 # 内部命令 # :set nu 显示行号 # :set nonu 取消行号 # /pattern 搜索 # n 下一个匹配 # :%s/old/new/g 全局替换 # :wq 保存退出 # :q! 强制退出不保存 二、系统监控与性能分析（生产级） 2.1 CPU性能监控 top - 实时监控系统 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 top # 默认按CPU排序 top -Hp <PID> # 查看进程内所有线程（排查Java/Python多线程问题关键） top -p 1,2,3 # 只监控指定PID top -u username # 只显示指定用户 top -b -n 1 > top.log # 批处理模式，运行一次后退出 # 内部交互命令 # P - 按CPU排序 M - 按内存排序 T - 按时间排序 # k - 杀死进程 r - 修改nice值 H - 显示线程 # 1 - 显示各CPU核心详情 # 生产案例：Java应用CPU飙高排查 # 1. top找到高CPU进程PID # 2. top -Hp PID查看线程 # 3. printf "%xn" <TID> 转16进制 # 4. jstack PID | grep -A 20 <hex_TID> htop - 增强版top（推荐） 1 2 3 4 5 htop # 彩色显示，支持鼠标操作 htop -d 10 # 刷新间隔10秒 htop -u root # 只显示root用户进程 # 优点：支持树状显示、直接kill、renice、搜索过滤 vmstat - 系统资源综合监控 1 2 3 4 5 6 7 8 9 10 11 12 vmstat 2 10 # 每2秒采样一次，共10次 vmstat -s # 显示内存统计摘要 vmstat -d # 显示磁盘统计 # 输出解读： # procs: r(运行队列) b(不可中断睡眠进程) # memory: swpd(交换内存) free(空闲) buff/cache(缓存) # swap: si(换入) so(换出) - 这两个值应该为0 # io: bi(读块) bo(写块) # cpu: us(用户) sy(系统) id(空闲) wa(IO等待) # 警戒线：wa持续>20%说明IO瓶颈 mpstat - 多核CPU分析 1 2 3 4 mpstat -P ALL 1 10 # 显示每个CPU核心的使用情况 mpstat 1 10 # 显示所有CPU平均情况 # 输出列：%usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle pidstat - 进程级资源监控（sysstat工具） 1 2 3 4 5 6 7 pidstat -u 1 10 # 监控CPU使用 pidstat -r 1 10 # 监控内存使用 pidstat -d 1 10 # 监控磁盘IO pidstat -t -p <PID> # 监控指定进程的线程 # 生产技巧：监控Java应用所有指标 pidstat -u -r -d -t -p <PID> 2 sar - 系统活动报告（历史数据） 1 2 3 4 5 6 7 8 sar -u 1 10 # CPU使用情况 sar -r 1 10 # 内存使用情况 sar -b 1 10 # IO传输速率 sar -n DEV 1 10 # 网络设备流量 sar -q 1 10 # 负载队列 sar -f /var/log/sa/saXX # 查看历史数据 # 安装：yum install sysstat / apt-get install sysstat perf - 性能分析利器（内核级） 1 2 3 4 5 6 7 8 perf top # 实时分析系统性能热点 perf stat -p <PID> # 统计进程性能数据 perf record -g -p <PID> # 记录性能数据（用于火焰图） perf report # 报告分析结果 # 生产案例：分析CPU热点函数 perf top -g -p <PID> # 定位到具体函数后，可结合jstack/gdb分析 strace - 系统调用跟踪（调试神器） 1 2 3 4 5 6 7 8 9 strace -p <PID> # 跟踪指定进程 strace -c -p <PID> # 统计系统调用耗时 strace -e trace=file -p <PID> # 只跟踪文件操作 strace -f -e trace=network -p <PID> # 跟踪子进程和网络调用 strace -T -tt -p <PID> # 显示时间戳和耗时 # 生产案例：进程卡住排查 strace -p <PID> -e trace=futex # 发现卡在futex_wait，说明在等待锁 2.2 内存性能监控 free - 内存使用 1 2 3 4 5 6 7 8 9 10 free -h # 人类可读格式 free -m # MB单位 free -w # 显示 buff 和 cache 分开 # 解读： # available: 真正可用内存（最重要指标） # free: 完全空闲内存 # buff/cache: 缓存（可被回收） # 生产误区：不要被free值迷惑，关键看available pmap - 进程内存映射 1 2 3 4 5 pmap -x <PID> # 详细内存映射 pmap -x <PID> | tail -5 # 只显示汇总 # 排查内存泄漏：持续观察RSS列 watch -n 5 "pmap -x <PID> | grep total" smem - 内存统计工具 1 2 3 4 5 smem -rs swap -p # 按swap使用排序（%） smem -rs rss -p # 按物理内存排序 smem -u # 按用户汇总 # 优势：能准确反映PSS（比例集大小），比RSS更有意义 vmstat -s - 内存统计 1 2 vmstat -s # 显示详细内存统计 # 重点看：swap pages in/out，应该为0 2.3 磁盘IO性能监控 iostat - IO统计（sysstat） 1 2 3 4 5 6 7 8 9 iostat -x 1 10 # 详细IO统计（-x显示扩展信息） iostat -dk 1 10 # 以KB/s显示 iostat -p sda 1 10 # 显示分区详细 # 关键指标： # %util: 设备利用率，>80%说明瓶颈 # await: 平均IO响应时间，>10ms需关注 # svctm: 平均服务时间 # r/s w/s: 读写IOPS iotop - IO实时监控 1 2 3 iotop # 需要root权限 iotop -oP -d 2 # 只显示有IO的进程(-o)，只显示进程(-P)，2秒刷新 iotop -a # 显示累积IO量 df - 磁盘空间 1 2 3 4 5 6 df -h # 人类可读 df -i # 显示inode使用情况（inode满导致无法写入） df -T # 显示文件系统类型 df -h /path # 只显示指定路径的挂载点 # 生产警戒线：使用率>85%预警，>95%紧急 du - 目录大小统计 1 2 3 4 5 6 du -h --max-depth=1 /path # 统计一级子目录大小 du -sh /path # 只显示总大小(-s) du -ah /path | sort -hr | head -20 # 找出最大的20个文件 # 生产技巧：快速定位磁盘满的原因 du -h --max-depth=1 / | sort -hr | head -10 lsof - 查看打开的文件 1 2 3 4 5 6 7 8 9 10 lsof # 列出所有打开的文件 lsof -p <PID> # 指定进程打开的文件 lsof /path/to/file # 查看文件被哪些进程使用 lsof -i :8080 # 查看端口占用进程 lsof -u username # 指定用户 lsof +D /path # 递归目录（慢，用lsof | grep /path更快） # 生产案例：删除文件后空间不释放 lsof | grep deleted # 查找已删除但仍被进程占用的文件 # 解决：重启对应进程或> /proc/<PID>/fd/<FD> 2.4 网络性能监控 ss - socket统计（替代netstat） 1 2 3 4 5 6 7 ss -tuln # 显示所有监听端口（-t TCP, -u UDP, -l 监听, -n 数字） ss -tan # 显示所有TCP连接 ss -s # 显示socket统计摘要 ss -p # 显示进程信息 ss -o state established &#39;( dport = :22 or sport = :22 )&#39; # 过滤特定端口 # 比netstat更快，适合高并发环境 netstat - 网络连接（传统工具） 1 2 3 4 5 netstat -tuln # 显示监听端口 netstat -anp # 显示所有连接和进程 netstat -i # 显示网络接口统计 netstat -r # 显示路由表 netstat -s # 显示协议统计 iftop - 实时流量监控 1 2 3 4 5 6 iftop -i eth0 # 监控指定网卡 iftop -n # 不解析主机名 iftop -P # 显示端口 iftop -f "port 80" # 过滤特定端口 # 需要root权限，适合排查带宽占用 tcpdump - 抓包分析（网络排障核心） 1 2 3 4 5 6 7 8 9 tcpdump -i eth0 -nn -s0 -v port 80 # 抓HTTP流量 tcpdump -i any -nn host 192.168.1.1 # 抓特定IP tcpdump -w capture.pcap # 写入文件（wireshark分析） tcpdump -r capture.pcap # 读取文件 tcpdump -A -s0 port 80 # ASCII显示HTTP内容 tcpdump -i eth0 -c 1000 # 只抓1000个包 # 生产案例：排查MySQL慢查询网络原因 tcpdump -i eth0 -s0 -nn -A dst port 3306 | grep -E "SELECT|INSERT" nethogs - 按进程统计流量 1 2 nethogs # 需要root，显示进程级流量 nethogs eth0 # 指定网卡 ping - 测试连通性 1 2 3 ping -c 4 -i 0.2 -W 1 8.8.8.8 # 发送4次，间隔0.2秒，超时1秒 ping -f 8.8.8.8 # 洪水ping（需root，测试网络极限） ping -s 1400 8.8.8.8 # 指定包大小（测试MTU） traceroute - 路由追踪 1 2 3 traceroute -n 8.8.8.8 # 不解析主机名（快） traceroute -T -p 80 8.8.8.8 # TCP SYN方式（绕过防火墙ICMP限制） traceroute -I 8.8.8.8 # ICMP方式 mtr - 综合网络诊断 1 2 mtr -r -c 10 8.8.8.8 # 报告模式，发送10次 mtr -w 8.8.8.8 # 宽格式（长主机名） 2.5 系统负载与运行时长 uptime - 系统运行时间与负载 1 2 3 4 5 6 7 uptime # 显示：时间、运行时长、用户数、负载 uptime -p # 只显示运行时长 # 负载解读： # 1分钟、5分钟、15分钟平均负载 # 理想值：负载 < CPU核心数 # 警戒线：负载 > CPU核心数 * 0.7 who - 查看登录用户 1 2 3 who # 显示当前登录用户 who -b # 显示上次启动时间 who -r # 显示运行级别 last - 查看登录历史 1 2 3 4 last # 显示所有登录历史 last root # 只显示root登录历史 last -n 10 # 只显示最近10条 last -f /var/log/btmp # 查看失败登录尝试 dmesg - 内核日志 1 2 3 4 5 6 7 8 dmesg # 查看内核环形缓冲区 dmesg -T # 显示人类可读时间 dmesg -c # 读取后清除 dmesg | grep -i error # 搜索错误 dmesg | grep -i oom # 查找OOM killer记录 # 生产案例：排查硬件故障 dmesg | grep -E " Hardware|Error|Fail" 三、进程管理（运维核心） 3.1 进程查看 ps - 进程快照 1 2 3 4 5 6 7 8 ps aux # BSD风格，显示所有进程（常用） ps -ef # System V风格 ps aux --sort=-%cpu # 按CPU排序（降序） ps aux --sort=-%mem # 按内存排序 ps -o pid,ppid,cmd,%cpu,%mem -p <PID> # 自定义输出列 # 生产技巧：查找僵尸进程 ps aux | awk &#39;$8=="Z"&#39; pgrep - 按名称查找PID 1 2 3 4 pgrep nginx # 查找nginx进程PID pgrep -f "python3 app.py" # 匹配完整命令行 pgrep -u root sshd # 查找root用户的sshd进程 pgrep -d, -f java # 用逗号分隔输出（用于top -p） pidof - 按名称查找PID 1 pidof nginx # 返回所有nginx worker PID pstree - 进程树 1 2 3 4 5 pstree # 显示进程树 pstree -p # 显示PID pstree -u # 显示用户 pstree -a # 显示完整命令 pstree | grep -A 5 nginx # 查找nginx相关进程树 3.2 进程控制 kill - 发送信号 1 2 3 4 5 6 7 8 9 10 11 12 13 14 kill -l # 列出所有信号 kill -15 <PID> # 发送TERM信号（优雅终止） kill -9 <PID> # 发送KILL信号（强制终止，谨慎使用） kill -2 <PID> # 发送INT信号（类似Ctrl+C） kill -1 <PID> # 发送HUP信号（重载配置） # 批量杀进程 pkill -9 java # 按名称杀进程 killall -9 java # 杀所有名为java的进程 kill -9 $(pgrep -f "test.py") # 组合使用 # 生产案例：优雅重启nginx kill -USR1 $(cat /var/run/nginx.pid) # 重新打开日志文件 kill -HUP $(cat /var/run/nginx.pid) # 重载配置 killall - 按名称杀进程 1 2 killall -9 python3 # 杀所有python3进程 killall -w process # 等待进程终止 pkill - 按模式杀进程 1 2 3 pkill -f "test.py" # 匹配完整命令行 pkill -u username # 杀死某用户的所有进程 pkill -t pts/0 # 杀死某个终端的所有进程 nice/renice - 调整优先级 1 2 3 4 5 nice -n 19 command # 以最低优先级运行（19最低，-20最高） renice -n 10 -p <PID> # 调整已运行进程优先级 # 生产技巧：降低备份任务优先级 nice -n 19 tar -czf backup.tar.gz /data nohup - 后台持久运行 1 2 nohup command & # &放入后台，nohup忽略挂起信号 nohup java -jar app.jar > app.log 2>&amp;1 & # 标准推荐写法 disown - 从shell移除作业 1 2 3 disown %1 # 移除作业1 disown -a # 移除所有作业 disown -h %1 # 标记为不接收SIGHUP 3.3 作业控制 & - 后台运行 1 command & # 放入后台执行 jobs - 查看后台作业 1 2 3 4 jobs # 查看当前shell的后台作业 jobs -l # 显示PID jobs -r # 只显示运行中的作业 jobs -s # 只显示停止的作业 fg/bg - 前台/后台切换 1 2 fg %1 # 将作业1调到前台 bg %1 # 将作业1在后台继续运行 wait - 等待作业完成 1 2 wait <PID> # 等待指定PID进程结束 wait # 等待所有后台作业结束 3.4 高级进程调试 strace - 系统调用跟踪 1 # 详见2.1节 ltrace - 库函数调用跟踪 1 2 ltrace -p <PID> # 跟踪库函数调用 ltrace -c -p <PID> # 统计调用耗时 gdb - 调试器 1 2 3 4 5 6 7 8 gdb -p <PID> # 附加到运行进程 gdb /path/to/binary core # 分析core dump # 生产案例：分析Java core文件 gdb java core.12345 (gdb) bt # 查看堆栈 (gdb) info threads # 查看线程 (gdb) thread apply all bt # 查看所有线程堆栈 perf - 性能分析 1 # 详见2.1节 四、网络管理（运维核心） 4.1 网络配置 ip - 现代网络配置（推荐） 1 2 3 4 5 6 7 8 9 10 11 12 ip addr # 显示IP地址（替代ifconfig） ip addr add 192.168.1.100/24 dev eth0 # 添加IP ip addr del 192.168.1.100/24 dev eth0 # 删除IP ip link set eth0 up # 启用网卡 ip link set eth0 down # 禁用网卡 ip route # 显示路由表 ip route add default via 192.168.1.1 # 添加默认网关 ip neighbor # 显示ARP表 ip -s link # 显示统计信息 # 生产技巧：快速查看IP ip -4 -o addr show scope global | awk &#39;{print $4}&#39; ifconfig - 传统网络配置 1 2 3 4 5 6 ifconfig # 显示所有网卡 ifconfig eth0 # 显示指定网卡 ifconfig eth0 up/down # 启用/禁用 ifconfig eth0 192.168.1.100 netmask 255.255.255.0 # 配置IP # 已废弃，推荐使用ip命令 route - 路由管理 1 2 3 4 route -n # 显示路由表 route add default gw 192.168.1.1 # 添加默认网关 route add -net 10.0.0.0/8 gw 10.0.0.1 # 添加静态路由 route del -net 10.0.0.0/8 # 删除路由 nmcli - NetworkManager命令行 1 2 3 4 nmcli device status # 查看设备状态 nmcli connection show # 查看连接 nmcli connection up/down id "conn-name" # 启用/禁用连接 nmcli device wifi list # 查看WiFi 4.2 网络诊断 ping - 连通性测试 1 # 详见2.4节 traceroute - 路由追踪 1 # 详见2.4节 mtr - 综合诊断 1 # 详见2.4节 nslookup/dig - DNS查询 1 2 3 4 5 6 7 dig www.baidu.com # 详细DNS查询 dig +short www.baidu.com # 简短输出 dig @8.8.8.8 www.baidu.com # 指定DNS服务器 dig +trace www.baidu.com # 追踪查询过程 dig -x 8.8.8.8 # 反向解析 nslookup www.baidu.com 8.8.8.8 # 指定DNS host - 简单DNS查询 1 2 host www.baidu.com host -t mx baidu.com # 查询MX记录 telnet - 测试端口连通性 1 2 telnet 192.168.1.1 22 # 测试SSH端口 # Ctrl+] 然后输入quit退出 nc (netcat) - 网络瑞士军刀 1 2 3 4 5 6 7 8 nc -zv 192.168.1.1 22 # 测试端口（-z 零IO，-v 详细） nc -l 8080 # 监听8080端口 nc 192.168.1.1 8080 # 连接端口 echo "test" | nc 192.168.1.1 8080 # 发送数据 # 生产技巧：快速传输文件 # 接收端：nc -l 8888 > file # 发送端：nc receiver_ip 8888 < file 4.3 高级网络工具 tcpdump - 抓包分析 1 # 详见2.4节 wireshark - 图形化抓包 1 2 wireshark # 图形界面 tshark -i eth0 # 命令行版wireshark ss - socket统计（推荐） 1 # 详见4.1节 lsof - 查看网络连接 1 2 3 lsof -i :8080 # 查看8080端口占用 lsof -i TCP # 查看所有TCP连接 lsof -i @192.168.1.1 # 查看连接到该IP的连接 五、文本处理三剑客（运维核心） 5.1 grep - 文本搜索 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 基本用法 grep "error" file.log # 搜索包含error的行 grep -i "error" file # 忽略大小写 grep -v "error" file # 反向匹配（不包含） grep -r "error" /path # 递归目录搜索 grep -E "error|warn" file # 正则表达式（扩展） grep -A 3 -B 3 "error" file # 显示前后3行 grep -n "error" file # 显示行号 grep -c "error" file # 统计匹配行数 grep -o "error" file # 只显示匹配部分 grep -w "error" file # 整词匹配 grep -f patterns.txt file # 从文件读取模式 # 生产案例：分析Nginx访问日志 grep "200" access.log | wc -l # 统计成功请求 grep -E "5[0-9]{2}" access.log | awk &#39;{print $7}&#39; | sort | uniq -c | sort -nr | head # Top错误URL # 高级用法：排除多个模式 grep -vE "(debug|info)" app.log # 查找IP地址 grep -oE "([0-9]{1,3}\\.){3}[0-9]{1,3}" access.log 5.2 sed - 流编辑器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # 基本语法：sed [选项] &#39;命令&#39; 文件 # 替换 sed &#39;s/old/new/&#39; file # 每行第一个匹配 sed &#39;s/old/new/g&#39; file # 全局替换 sed -i &#39;s/old/new/g&#39; file # 直接修改文件（-i危险，先备份） # 删除 sed &#39;/pattern/d&#39; file # 删除匹配行 sed &#39;1,10d&#39; file # 删除1-10行 sed &#39;$d&#39; file # 删除最后一行 # 插入 sed &#39;1i\\insert&#39; file # 第1行前插入 sed &#39;$a\\append&#39; file # 最后追加 # 打印 sed -n &#39;1,10p&#39; file # 打印1-10行 sed -n &#39;/pattern/p&#39; file # 打印匹配行 # 生产案例：批量修改配置文件 sed -i &#39;s/Port 22/Port 2222/&#39; /etc/ssh/sshd_config # 修改SSH端口 sed -i &#39;/^#ServerActive/s/#//&#39; /etc/zabbix/zabbix_agentd.conf # 取消注释 # 提取特定行 sed -n &#39;/2024-01-01/,/2024-01-02/p&#39; access.log # 提取日期范围 5.3 awk - 文本处理语言 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # 基本语法：awk &#39;模式{动作}&#39; 文件 # 打印列 awk &#39;{print $1}&#39; file # 打印第1列（默认空格分隔） awk -F: &#39;{print $1}&#39; /etc/passwd # 指定分隔符: awk &#39;{print $NF}&#39; file # 打印最后一列 # 条件过滤 awk &#39;$3 > 100&#39; file # 第3列大于100 awk &#39;/error/&#39; file # 匹配模式 awk &#39;$1 ~ /^192/ {print $2}&#39; file # 第1列匹配正则 # 生产案例：分析Nginx日志 awk &#39;{print $1}&#39; access.log | sort | uniq -c | sort -nr | head -20 # Top IP awk &#39;{print $7}&#39; access.log | grep -v &#39;^$&#39; | sort | uniq -c | sort -nr | head -20 # Top URL awk &#39;$9 ~ /^5/ {print $7}&#39; access.log | sort | uniq -c | sort -nr # 500错误的URL # 统计 awk &#39;{sum+=$1} END {print sum/NR}&#39; file # 求平均值 awk &#39;{if($1>max) max=$1} END {print max}&#39; file # 求最大值 # 多分隔符 awk -F&#39;[: ]&#39; &#39;{print $1}&#39; file # 分隔符为冒号或空格 # 内置变量 # NR: 行号 NF: 列数 $0: 整行 FILENAME: 文件名 5.4 组合使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 案例1：查找Top内存进程 ps aux | sort -nk4 -r | head -10 # 案例2：日志分析完整流程 cat access.log | grep "200" | awk &#39;{print $7}&#39; | sort | uniq -c | sort -nr | head -10 > top_urls.txt # 案例3：多条件过滤 cat app.log | grep -v "DEBUG" | grep -E "error|warn" | awk -F&#39;[&#39; &#39;{print $2}&#39; | awk -F&#39;]&#39; &#39;{print $1}&#39; # 案例4：时间范围提取 sed -n &#39;/2024-01-01 10:00:00/,/2024-01-01 11:00:00/p&#39; access.log # 案例5：CSV处理 awk -F&#39;,&#39; &#39;{printf "%-20s %-10s %5.2f\\n", $1, $2, $3}&#39; data.csv 六、文件系统与存储管理 6.1 磁盘管理 fdisk - 分区管理 1 2 3 fdisk -l # 列出所有磁盘 fdisk /dev/sdb # 进入交互模式 # 内部命令：m(帮助) n(新建) p(打印) w(写入) q(退出) d(删除) gdisk - GPT分区管理 1 gdisk -l /dev/sdb # 查看GPT分区 parted - 分区管理（支持大磁盘） 1 2 3 parted -l # 列出所有磁盘 parted /dev/sdb mklabel gpt # 创建GPT标签 parted /dev/sdb mkpart primary 0% 100% # 创建分区 mkfs - 创建文件系统 1 2 3 mkfs.ext4 /dev/sdb1 # 创建ext4文件系统 mkfs.xfs /dev/sdb1 # 创建xfs文件系统 mkfs -t ext4 /dev/sdb1 # 通用格式 fsck - 文件系统检查 1 2 3 4 5 fsck /dev/sda1 # 检查并修复（卸载后执行） fsck -y /dev/sda1 # 自动修复 fsck -n /dev/sda1 # 只检查不修复 # 生产警告：不要在挂载的文件系统上运行！ mount/umount - 挂载/卸载 1 2 3 4 5 6 7 8 9 mount # 显示挂载信息 mount /dev/sdb1 /mnt # 挂载 mount -t nfs 192.168.1.1:/data /mnt # 挂载NFS mount -o remount,rw / # 重新挂载为读写（救援模式常用） umount /mnt # 卸载 umount -l /mnt # 懒卸载（文件系统忙时使用） umount -f /mnt # 强制卸载 # 开机挂载：编辑/etc/fstab 6.2 LVM管理 pvcreate - 创建物理卷 1 2 3 pvcreate /dev/sdb1 # 将分区初始化为物理卷 pvdisplay # 显示物理卷信息 pvs # 简要显示 vgcreate - 创建卷组 1 2 3 4 5 vgcreate vg_data /dev/sdb1 /dev/sdc1 # 创建卷组包含两个PV vgdisplay vgs vgextend vg_data /dev/sdd1 # 扩展卷组 vgreduce vg_data /dev/sdd1 # 缩减卷组 lvcreate - 创建逻辑卷 1 2 3 4 5 6 lvcreate -L 100G -n lv_home vg_data # 创建100G逻辑卷 lvcreate -l 100%FREE -n lv_opt vg_data # 使用所有剩余空间 lvdisplay lvs lvextend -L +50G /dev/vg_data/lv_home # 扩展逻辑卷 lvreduce -L -50G /dev/vg_data/lv_home # 缩减逻辑卷（危险） resize2fs/xfs_growfs - 调整文件系统大小 1 2 resize2fs /dev/vg_data/lv_home # ext4在线扩容 xfs_growfs /mnt/home # xfs在线扩容 6.3 RAID管理 mdadm - RAID管理 1 2 3 4 5 mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1 # 创建RAID1 mdadm --detail /dev/md0 # 查看RAID详情 mdadm --manage /dev/md0 --add /dev/sdd1 # 添加磁盘 mdadm --manage /dev/md0 --fail /dev/sdb1 # 标记故障盘 watch -n 1 cat /proc/mdstat # 监控RAID同步 七、系统服务管理 7.1 systemd（现代系统） systemctl - 服务控制 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 systemctl start nginx # 启动服务 systemctl stop nginx # 停止服务 systemctl restart nginx # 重启服务 systemctl reload nginx # 重载配置 systemctl status nginx # 查看状态 systemctl enable nginx # 开机自启 systemctl disable nginx # 取消开机自启 systemctl is-active nginx # 检查是否运行 systemctl is-enabled nginx # 检查是否开机自启 systemctl list-units --type=service --state=active # 列出所有运行服务 systemctl list-unit-files | grep enabled # 列出所有开机自启服务 systemctl daemon-reload # 重载配置（修改unit文件后） systemctl show nginx # 显示详细属性 # 生产技巧：查看服务启动失败原因 systemctl status nginx -l # 显示完整日志 journalctl -u nginx -f # 实时跟踪服务日志 journalctl -u nginx --since "10 minutes ago" # 最近10分钟日志 journalctl - systemd日志 1 2 3 4 5 6 7 8 journalctl -f # 实时跟踪 journalctl -u nginx # 指定服务 journalctl -k # 内核日志 journalctl --since "2024-01-01" --until "2024-01-02" # 时间范围 journalctl -p err # 只显示错误 journalctl -n 100 # 最后100行 journalctl --disk-usage # 查看日志占用空间 journalctl --vacuum-size=100M # 清理日志到100M 7.2 SysVinit（传统系统） service - 服务控制 1 2 3 4 5 6 7 service nginx start service nginx stop service nginx restart service nginx reload service nginx status # 已废弃，推荐systemctl chkconfig - 开机自启管理 1 2 3 chkconfig --list # 列出所有服务 chkconfig nginx on # 开机自启 chkconfig nginx off # 取消自启 7.3 定时任务 crontab - 计划任务 1 2 3 4 5 6 7 8 crontab -e # 编辑当前用户的crontab crontab -l # 列出 crontab -r # 删除 crontab -u user -e # 编辑指定用户的 # 格式：分 时 日 月 周 命令 # */5 * * * * /path/to/script.sh # 每5分钟 # 0 2 * * * /path/to/backup.sh # 每天2点 at - 一次性任务 1 2 3 4 5 6 at 14:00 tomorrow # 明天14点执行 at> /path/to/command at> Ctrl+D atq # 查看队列 atrm 1 # 删除任务1 八、用户与权限管理 8.1 用户管理 useradd - 添加用户 1 2 3 4 5 useradd -m -s /bin/bash -g users -G wheel newuser # 创建用户 # -m 创建home目录 -s 指定shell -g 主组 -G 附加组 # 生产技巧：批量创建用户 for i in {1..10}; do useradd -m user$i; echo "user$i:password" | chpasswd; done usermod - 修改用户 1 2 3 4 usermod -aG wheel newuser # 追加到wheel组 usermod -s /bin/zsh newuser # 修改shell usermod -L newuser # 锁定用户 usermod -U newuser # 解锁用户 userdel - 删除用户 1 2 userdel newuser # 删除用户 userdel -r newuser # 同时删除home目录和邮件 passwd - 修改密码 1 2 3 4 5 passwd # 修改当前用户密码 passwd newuser # 修改指定用户密码 passwd -l newuser # 锁定用户 passwd -u newuser # 解锁用户 passwd -e newuser # 强制下次登录修改密码 su - 切换用户 1 2 3 su - username # 完全切换（推荐） su username # 不切换环境变量 su -c "command" username # 以某用户执行命令 sudo - 提权执行 1 2 3 4 5 6 7 8 sudo command # 以root执行 sudo -u user command # 以指定用户执行 sudo -i # 切换到root shell sudo -l # 列出当前用户可执行命令 # 生产配置：/etc/sudoers # visudo 安全编辑 # user ALL=(ALL) NOPASSWD:ALL # 免密码sudo（谨慎） 8.2 组管理 groupadd - 添加组 1 2 groupadd developers # 创建组 groupadd -g 1000 dev # 指定GID groupmod - 修改组 1 groupmod -n newname oldname # 重命名 groupdel - 删除组 1 groupdel developers # 删除组（不能有用户为主组） 8.3 权限管理 chmod - 修改权限 1 2 3 4 5 6 7 8 chmod 755 file # rwxr-xr-x chmod u+x file # 用户添加执行权限 chmod g-w file # 组移除写权限 chmod o=r-- file # 其他用户只读 chmod -R 755 dir # 递归修改 # 数字权限：r=4 w=2 x=1 # 755 = 7(rwx) 5(r-x) 5(r-x) chown - 修改所有者 1 2 3 4 5 6 7 chown user:group file # 同时修改用户和组 chown user file # 只修改用户 chown :group file # 只修改组 chown -R user:group dir # 递归修改 # 生产技巧：批量修改 chown -R www-data:www-data /var/www/html chgrp - 修改组 1 2 chgrp group file # 修改文件组 chgrp -R group dir # 递归修改 umask - 默认权限掩码 1 2 3 4 umask # 查看当前掩码 umask 022 # 设置掩码 # 默认文件权限：666-umask # 默认目录权限：777-umask 8.4 高级权限 setuid/setgid/sticky bit 1 2 3 4 5 6 7 chmod u+s file # setuid (4) 以文件所有者权限执行 chmod g+s dir # setgid (2) 新建文件继承目录组 chmod +t dir # sticky bit (1) 用户只能删除自己的文件 # 数字表示：chmod 4755 file (setuid) # chmod 2755 dir (setgid) # chmod 1777 dir (sticky) ACL - 访问控制列表 1 2 3 4 5 6 7 8 9 setfacl -m u:user:rwx file # 给用户添加权限 setfacl -m g:group:r-x file # 给组添加权限 setfacl -x u:user file # 删除用户ACL setfacl -b file # 清除所有ACL getfacl file # 查看ACL # 生产场景：多用户共享目录 setfacl -R -m u:user1:rwx,u:user2:rwx /shared setfacl -R -d -m u:user1:rwx,u:user2:rwx /shared # 默认ACL 九、压缩与备份 9.1 压缩工具 tar - 归档（运维必备） 1 2 3 4 5 6 7 8 9 10 11 tar -czf archive.tar.gz /path # 压缩（c创建，z gzip，f文件） tar -xzf archive.tar.gz # 解压（x解压） tar -tzf archive.tar.gz # 查看内容（t列表） tar -czf - /path | ssh user@host "tar -xzf - -C /dest" # 远程压缩传输 tar --exclude=&#39;*.log&#39; -czf archive.tar.gz /path # 排除文件 # 参数： # c: 创建 x: 解压 t: 查看 # z: gzip j: bzip2 J: xz # v: 显示过程 f: 指定文件 # C: 切换到目录 gzip/gunzip 1 2 3 4 gzip file # 压缩为file.gz gzip -9 file # 最高压缩率（1-9） gzip -d file.gz # 解压 gunzip file.gz # 解压 zip/unzip 1 2 3 zip -r archive.zip dir # 压缩目录 unzip archive.zip # 解压 unzip -l archive.zip # 查看内容 rsync - 同步与备份（运维神器） 1 2 3 4 5 6 7 8 9 10 rsync -avz /src/ /dst/ # 同步目录（a归档，v详细，z压缩） rsync -avz /src/ user@host:/dst/ # 远程同步 rsync -avz --delete /src/ /dst/ # 删除目标端多余文件 rsync -avz --exclude=&#39;*.log&#39; /src/ /dst/ # 排除 rsync -avz --bwlimit=10240 /src/ /dst/ # 限速10MB/s rsync -avz --partial --progress /src/ /dst/ # 断点续传 rsync -avzh --link-dest=/latest /src/ /dst/`date +%Y%m%d`/ # 硬链接增量备份 # 生产案例：每日备份脚本 rsync -avz --delete /data/ /backup/`date +%Y%m%d`/ 9.2 备份策略 dd - 磁盘克隆 1 2 3 4 5 6 dd if=/dev/sda of=/dev/sdb bs=4M # 磁盘对拷 dd if=/dev/sda of=disk.img # 创建镜像 dd if=disk.img of=/dev/sda # 恢复镜像 dd if=/dev/zero of=/swapfile bs=1M count=4096 # 创建swap文件 # 生产警告：dd是危险命令，if/of参数务必确认 cpio - 归档 1 2 find /path | cpio -o > archive.cpio # 创建 cpio -i < archive.cpio # 解压 十、系统信息与管理 10.1 系统信息 uname - 内核信息 1 2 3 4 uname -a # 显示所有信息 uname -r # 内核版本 uname -m # 架构 uname -n # 主机名 hostnamectl - 主机名管理 1 2 hostnamectl # 显示主机信息 hostnamectl set-hostname newname # 修改主机名 uptime - 运行时间与负载 1 # 详见2.5节 who/w - 登录用户 1 2 who # 显示登录用户 w # 显示登录用户及正在执行的命令 last - 登录历史 1 # 详见2.5节 10.2 硬件信息 lspci - PCI设备 1 2 3 lspci # 显示所有PCI设备 lspci -v # 详细信息 lspci | grep -i vga # 查找显卡 lsusb - USB设备 1 2 lsusb # 显示USB设备 lsusb -t # 树状显示 lscpu - CPU信息 1 2 lscpu # 显示CPU架构信息 lscpu | grep "CPU(s)" # 核心数 dmidecode - 硬件DMI信息 1 2 3 dmidecode # 显示所有硬件信息 dmidecode -t memory # 显示内存信息 dmidecode -t system # 显示系统信息 hdparm - 磁盘信息 1 2 hdparm -I /dev/sda # 显示磁盘详细信息 hdparm -tT /dev/sda # 测试磁盘性能 10.3 内核与模块 lsmod - 加载的模块 1 2 lsmod # 显示已加载内核模块 lsmod | grep kvm # 查找特定模块 modinfo - 模块信息 1 modinfo kvm # 显示模块详细信息 modprobe - 加载/卸载模块 1 2 modprobe kvm # 加载模块 modprobe -r kvm # 卸载模块 insmod/rmmod - 加载/卸载模块 1 2 insmod /path/to/module.ko rmmod kvm sysctl - 内核参数 1 2 3 4 sysctl -a # 显示所有参数 sysctl -p # 加载/etc/sysctl.conf sysctl -w vm.swappiness=10 # 临时修改 echo "vm.swappiness=10" >> /etc/sysctl.conf && sysctl -p # 永久修改 十一、性能调优（专家级） 11.1 CPU调优 CPU亲和性 1 # 详见10.1节 中断均衡 1 2 3 4 5 cat /proc/interrupts # 查看中断分布 echo 2 > /proc/irq/24/smp_affinity # 将中断绑定到CPU2 # 自动均衡：irqbalance服务 systemctl status irqbalance 调节器 1 2 3 4 5 cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 查看当前调节器 echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 性能模式 echo powersave > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor # 节能模式 # 可用调节器：performance powersave ondemand conservative 11.2 内存调优 swappiness 1 # 详见2.2节 透明大页 1 2 cat /sys/kernel/mm/transparent_hugepage/enabled # 查看状态 echo never > /sys/kernel/mm/transparent_hugepage/enabled # 禁用（数据库推荐） 内存压缩 1 2 3 4 cat /proc/sys/vm/drop_caches # 释放缓存 # echo 1 > /proc/sys/vm/drop_caches # 释放pagecache # echo 2 > /proc/sys/vm/drop_caches # 释放dentries和inodes # echo 3 > /proc/sys/vm/drop_caches # 释放所有缓存（生产环境慎用） 11.3 磁盘调优 IO调度器 1 2 3 4 5 6 7 cat /sys/block/sda/queue/scheduler # 查看当前调度器 echo deadline > /sys/block/sda/queue/scheduler # 修改为deadline # 调度器选择： # noop: SSD/闪存 # deadline: 数据库（保证延迟） # cfq: 桌面/通用 文件系统调优 1 2 3 4 5 # ext4挂载选项 /dev/sdb1 /data ext4 defaults,noatime,nodiratime 0 0 # XFS调优 xfs_info /dev/sda1 # 查看XFS信息 11.4 网络调优 TCP参数 1 # 详见10.1节 文件描述符限制 1 2 3 4 5 6 ulimit -n # 查看当前限制 ulimit -n 65535 # 临时修改 # 永久修改：/etc/security/limits.conf * soft nofile 65535 * hard nofile 65535 端口范围 1 2 cat /proc/sys/net/ipv4/ip_local_port_range # 查看端口范围 echo "1024 65535" > /proc/sys/net/ipv4/ip_local_port_range # 扩大范围 十二、安全与审计 12.1 文件完整性 md5sum/sha256sum - 校验和 1 2 3 md5sum file # 计算MD5 sha256sum file # 计算SHA256 md5sum -c file.md5 # 校验文件 chattr/lsattr - 扩展属性 1 2 3 4 5 6 7 chattr +i file # 设置不可变（无法修改删除） chattr -i file # 取消不可变 chattr +a file # 只允许追加 lsattr file # 查看扩展属性 # 生产应用：保护关键配置文件 chattr +i /etc/passwd /etc/shadow 12.2 安全工具 iptables - 防火墙（传统） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 iptables -L -n # 查看规则 iptables -A INPUT -p tcp --dport 22 -j ACCEPT # 放行SSH iptables -A INPUT -p tcp --dport 80 -j ACCEPT # 放行HTTP iptables -A INPUT -j DROP # 默认拒绝（注意顺序） service iptables save # 保存规则 # 生产脚本：配置基础防火墙 #!/bin/bash iptables -F iptables -A INPUT -i lo -j ACCEPT iptables -A INPUT -p tcp --dport 22 -j ACCEPT iptables -A INPUT -p tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp --dport 443 -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -P INPUT DROP firewalld - 动态防火墙 1 2 3 4 firewall-cmd --state # 查看状态 firewall-cmd --list-all # 查看所有规则 firewall-cmd --add-port=8080/tcp --permanent # 永久添加端口 firewall-cmd --reload # 重载规则 ufw - Ubuntu防火墙 1 2 3 ufw status # 查看状态 ufw allow 22/tcp # 放行SSH ufw enable # 启用防火墙 12.3 审计 lastlog - 最后登录 1 2 lastlog # 显示所有用户最后登录 lastlog -u username # 指定用户 lastb - 失败登录 1 lastb # 查看失败登录尝试 ausearch - SELinux审计 1 ausearch -m avc -ts today # 查看今天SELinux拒绝 十三、自动化运维脚本模板 13.1 系统巡检脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 #!/bin/bash # 系统健康检查脚本 LOGFILE="/var/log/system_check_$(date +%Y%m%d).log" exec > $LOGFILE 2>&amp;1 echo "===== System Check $(date) =====" # CPU检查 echo "--- CPU Check ---" top -bn1 | grep "Cpu(s)" mpstat -P ALL 1 1 # 内存检查 echo "--- Memory Check ---" free -h vmstat -s | grep -E "swapped|used memory" # 磁盘检查 echo "--- Disk Check ---" df -h df -i # IO检查 echo "--- IO Check ---" iostat -x 1 3 # 网络检查 echo "--- Network Check ---" ss -s netstat -i # 负载检查 echo "--- Load Check ---" uptime cat /proc/loadavg # 服务检查 echo "--- Service Check ---" systemctl list-units --type=service --state=failed echo "===== Check Complete $(date) =====" 13.2 日志分析脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/bash # Nginx日志分析脚本 LOGFILE="/var/log/nginx/access.log" REPORT="/tmp/nginx_report_$(date +%Y%m%d).txt" # Top 10 IP echo "Top 10 IP:" > $REPORT awk &#39;{print $1}&#39; $LOGFILE | sort | uniq -c | sort -nr | head -10 >> $REPORT # Top 10 URL echo -e "\\nTop 10 URL:" >> $REPORT awk &#39;{print $7}&#39; $LOGFILE | grep -v &#39;^$&#39; | sort | uniq -c | sort -nr | head -10 >> $REPORT # 状态码统计 echo -e "\\nStatus Code:" >> $REPORT awk &#39;{print $9}&#39; $LOGFILE | sort | uniq -c | sort -nr >> $REPORT # 响应时间分析（假设日志格式包含$request_time） echo -e "\\nResponse Time:" >> $REPORT awk &#39;{print $NF}&#39; $LOGFILE | awk &#39;{sum+=$1; count++} END {print "Avg: " sum/count}&#39; >> $REPORT mail -s "Nginx Daily Report" admin@example.com < $REPORT 13.3 自动扩容脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/bin/bash # 磁盘空间监控与扩容（LVM） THRESHOLD=85 VG_NAME="vg_data" LV_NAME="lv_home" MOUNT_POINT="/home" CURRENT=$(df -h $MOUNT_POINT | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;) if [ $CURRENT -gt $THRESHOLD ]; then # 检查是否有可用空间 FREE=$(vgs --noheadings -o vg_free $VG_NAME | sed &#39;s/ //g&#39;) if [ "$FREE" != "0" ]; then # 扩展逻辑卷（增加10G） lvextend -L +10G /dev/$VG_NAME/$LV_NAME # 扩展文件系统 resize2fs /dev/$VG_NAME/$LV_NAME # ext4 # xfs_growfs $MOUNT_POINT # xfs echo "Expanded $LV_NAME by 10G" | mail -s "Disk Alert" admin@example.com else echo "No free space in VG" | mail -s "URGENT Disk Alert" admin@example.com fi fi 十四、生产环境故障排查案例 案例1：CPU 100%但找不到进程 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. 检查系统负载 uptime # 2. 查看CPU等待IO情况 top # 发现wa很高（94%） # 3. 定位IO瓶颈进程 iotop -oP # 发现是rsync备份进程 # 4. 限制带宽 killall rsync nohup rsync -avz --bwlimit=10240 /src/ /dst/ & # 解决：将备份任务调整到凌晨2点执行 案例2：内存泄漏排查 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #!/bin/bash # 内存泄漏检测脚本 PID=$1 INTERVAL=60 LOG="mem_leak_${PID}.log" echo "Monitoring PID $PID every $INTERVAL seconds..." > $LOG while true; do echo "=== $(date) ===" >> $LOG pmap -x $PID | tail -1 >> $LOG ps -p $PID -o pid,rss,vsz,cmd >> $LOG sleep $INTERVAL done # 分析：观察RSS列是否持续增长 # 配合jmap分析Java堆：jmap -histo:live <PID> 案例3：网络连接数暴增 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. 查看连接数 ss -s # 2. 查看TIME_WAIT ss -tan | grep TIME_WAIT | wc -l # 3. 查看ESTABLISHED ss -tan | grep ESTABLISHED | wc -l # 4. 查找异常IP netstat -anp | grep ESTABLISHED | awk &#39;{print $5}&#39; | cut -d: -f1 | sort | uniq -c | sort -nr | head # 解决：调整TCP参数 echo "net.ipv4.tcp_tw_reuse = 1" >> /etc/sysctl.conf echo "net.ipv4.tcp_max_tw_buckets = 5000" >> /etc/sysctl.conf sysctl -p 案例4：磁盘空间异常 1 2 3 4 5 6 7 8 9 10 11 # 1. 查看磁盘使用 df -h # 发现/分区100% # 2. 查找大文件 du -h --max-depth=1 / | sort -hr | head -10 # 3. 检查已删除但仍在占用的文件 lsof | grep deleted # 发现日志文件被删除但进程未释放 # 4. 释放空间 > /proc/<PID>/fd/<FD> # 或者重启进程 十五、运维最佳实践总结 15.1 生产环境黄金法则 备份先行：任何操作前备份配置文件和数据 测试验证：先在测试环境验证，再应用到生产 灰度发布：分批重启服务，避免全量操作 监控告警：所有操作都要监控，设置告警 文档记录：所有变更必须记录 15.2 命令使用原则 rm：使用rm -i别名，高危操作先ls确认 dd：操作磁盘前再三确认if=和of= vim：编辑配置文件前先备份 systemctl：重启服务前检查配置语法 iptables：修改防火墙前保存当前规则 15.3 性能优化 checklist CPU：检查亲和性、中断均衡、调度器 内存：检查swappiness、泄漏、缓存 磁盘：检查IO调度器、使用率、inode 网络：检查连接数、TCP参数、带宽 服务：检查资源限制、日志级别、健康检查 15.4 推荐工具组合 监控：Prometheus + Grafana + Alertmanager 日志：ELK (Elasticsearch + Logstash + Kibana) 自动化：Ansible + Jenkins/GitLab CI 追踪：SkyWalking / Jaeger CMDB：NetBox / CMDBuild '><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/archives/><span>归档</span></a></li><li><a href=/about/><span>关于</span></a></li><li><a href=/links/><span>网站分享</span></a></li><li><a href=/blockchain/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href><span></span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#一基础命令深度解析运维视角>一、基础命令深度解析（运维视角）</a><ol><li><a href=#11-文件目录操作含性能优化>1.1 文件目录操作（含性能优化）</a><ol><li><a href=#ls---目录列表><code>ls</code> - 目录列表</a></li><li><a href=#cd---切换目录><code>cd</code> - 切换目录</a></li><li><a href=#pwd---显示当前路径><code>pwd</code> - 显示当前路径</a></li><li><a href=#mkdir---创建目录><code>mkdir</code> - 创建目录</a></li><li><a href=#rm---删除文件目录高危命令><code>rm</code> - 删除文件/目录（⚠️高危命令）</a></li><li><a href=#cp---复制文件><code>cp</code> - 复制文件</a></li><li><a href=#mv---移动重命名文件><code>mv</code> - 移动/重命名文件</a></li><li><a href=#touch---修改时间戳><code>touch</code> - 修改时间戳</a></li></ol></li><li><a href=#12-文件查看与编辑>1.2 文件查看与编辑</a><ol><li><a href=#cat---连接文件并打印><code>cat</code> - 连接文件并打印</a></li><li><a href=#more---分页查看><code>more</code> - 分页查看</a></li><li><a href=#less---增强分页查看运维首选><code>less</code> - 增强分页查看（运维首选）</a></li><li><a href=#head---查看文件头部><code>head</code> - 查看文件头部</a></li><li><a href=#tail---查看文件尾部运维高频><code>tail</code> - 查看文件尾部（运维高频）</a></li><li><a href=#vim---文本编辑器运维必备><code>vim</code> - 文本编辑器（运维必备）</a></li></ol></li></ol></li><li><a href=#二系统监控与性能分析生产级>二、系统监控与性能分析（生产级）</a><ol><li><a href=#21-cpu性能监控>2.1 CPU性能监控</a><ol><li><a href=#top---实时监控系统><code>top</code> - 实时监控系统</a></li><li><a href=#htop---增强版top推荐><code>htop</code> - 增强版top（推荐）</a></li><li><a href=#vmstat---系统资源综合监控><code>vmstat</code> - 系统资源综合监控</a></li><li><a href=#mpstat---多核cpu分析><code>mpstat</code> - 多核CPU分析</a></li><li><a href=#pidstat---进程级资源监控sysstat工具><code>pidstat</code> - 进程级资源监控（sysstat工具）</a></li><li><a href=#sar---系统活动报告历史数据><code>sar</code> - 系统活动报告（历史数据）</a></li><li><a href=#perf---性能分析利器内核级><code>perf</code> - 性能分析利器（内核级）</a></li><li><a href=#strace---系统调用跟踪调试神器><code>strace</code> - 系统调用跟踪（调试神器）</a></li></ol></li><li><a href=#22-内存性能监控>2.2 内存性能监控</a><ol><li><a href=#free---内存使用><code>free</code> - 内存使用</a></li><li><a href=#pmap---进程内存映射><code>pmap</code> - 进程内存映射</a></li><li><a href=#smem---内存统计工具><code>smem</code> - 内存统计工具</a></li><li><a href=#vmstat--s---内存统计><code>vmstat -s</code> - 内存统计</a></li></ol></li><li><a href=#23-磁盘io性能监控>2.3 磁盘IO性能监控</a><ol><li><a href=#iostat---io统计sysstat><code>iostat</code> - IO统计（sysstat）</a></li><li><a href=#iotop---io实时监控><code>iotop</code> - IO实时监控</a></li><li><a href=#df---磁盘空间><code>df</code> - 磁盘空间</a></li><li><a href=#du---目录大小统计><code>du</code> - 目录大小统计</a></li><li><a href=#lsof---查看打开的文件><code>lsof</code> - 查看打开的文件</a></li></ol></li><li><a href=#24-网络性能监控>2.4 网络性能监控</a><ol><li><a href=#ss---socket统计替代netstat><code>ss</code> - socket统计（替代netstat）</a></li><li><a href=#netstat---网络连接传统工具><code>netstat</code> - 网络连接（传统工具）</a></li><li><a href=#iftop---实时流量监控><code>iftop</code> - 实时流量监控</a></li><li><a href=#tcpdump---抓包分析网络排障核心><code>tcpdump</code> - 抓包分析（网络排障核心）</a></li><li><a href=#nethogs---按进程统计流量><code>nethogs</code> - 按进程统计流量</a></li><li><a href=#ping---测试连通性><code>ping</code> - 测试连通性</a></li><li><a href=#traceroute---路由追踪><code>traceroute</code> - 路由追踪</a></li><li><a href=#mtr---综合网络诊断><code>mtr</code> - 综合网络诊断</a></li></ol></li><li><a href=#25-系统负载与运行时长>2.5 系统负载与运行时长</a><ol><li><a href=#uptime---系统运行时间与负载><code>uptime</code> - 系统运行时间与负载</a></li><li><a href=#who---查看登录用户><code>who</code> - 查看登录用户</a></li><li><a href=#last---查看登录历史><code>last</code> - 查看登录历史</a></li><li><a href=#dmesg---内核日志><code>dmesg</code> - 内核日志</a></li></ol></li></ol></li><li><a href=#三进程管理运维核心>三、进程管理（运维核心）</a><ol><li><a href=#31-进程查看>3.1 进程查看</a><ol><li><a href=#ps---进程快照><code>ps</code> - 进程快照</a></li><li><a href=#pgrep---按名称查找pid><code>pgrep</code> - 按名称查找PID</a></li><li><a href=#pidof---按名称查找pid><code>pidof</code> - 按名称查找PID</a></li><li><a href=#pstree---进程树><code>pstree</code> - 进程树</a></li></ol></li><li><a href=#32-进程控制>3.2 进程控制</a><ol><li><a href=#kill---发送信号><code>kill</code> - 发送信号</a></li><li><a href=#killall---按名称杀进程><code>killall</code> - 按名称杀进程</a></li><li><a href=#pkill---按模式杀进程><code>pkill</code> - 按模式杀进程</a></li><li><a href=#nicerenice---调整优先级><code>nice</code>/<code>renice</code> - 调整优先级</a></li><li><a href=#nohup---后台持久运行><code>nohup</code> - 后台持久运行</a></li><li><a href=#disown---从shell移除作业><code>disown</code> - 从shell移除作业</a></li></ol></li><li><a href=#33-作业控制>3.3 作业控制</a><ol><li><a href=#---后台运行><code>&</code> - 后台运行</a></li><li><a href=#jobs---查看后台作业><code>jobs</code> - 查看后台作业</a></li><li><a href=#fgbg---前台后台切换><code>fg</code>/<code>bg</code> - 前台/后台切换</a></li><li><a href=#wait---等待作业完成><code>wait</code> - 等待作业完成</a></li></ol></li><li><a href=#34-高级进程调试>3.4 高级进程调试</a><ol><li><a href=#strace---系统调用跟踪><code>strace</code> - 系统调用跟踪</a></li><li><a href=#ltrace---库函数调用跟踪><code>ltrace</code> - 库函数调用跟踪</a></li><li><a href=#gdb---调试器><code>gdb</code> - 调试器</a></li><li><a href=#perf---性能分析><code>perf</code> - 性能分析</a></li></ol></li></ol></li><li><a href=#四网络管理运维核心>四、网络管理（运维核心）</a><ol><li><a href=#41-网络配置>4.1 网络配置</a><ol><li><a href=#ip---现代网络配置推荐><code>ip</code> - 现代网络配置（推荐）</a></li><li><a href=#ifconfig---传统网络配置><code>ifconfig</code> - 传统网络配置</a></li><li><a href=#route---路由管理><code>route</code> - 路由管理</a></li><li><a href=#nmcli---networkmanager命令行><code>nmcli</code> - NetworkManager命令行</a></li></ol></li><li><a href=#42-网络诊断>4.2 网络诊断</a><ol><li><a href=#ping---连通性测试><code>ping</code> - 连通性测试</a></li><li><a href=#traceroute---路由追踪-1><code>traceroute</code> - 路由追踪</a></li><li><a href=#mtr---综合诊断><code>mtr</code> - 综合诊断</a></li><li><a href=#nslookupdig---dns查询><code>nslookup</code>/<code>dig</code> - DNS查询</a></li><li><a href=#host---简单dns查询><code>host</code> - 简单DNS查询</a></li><li><a href=#telnet---测试端口连通性><code>telnet</code> - 测试端口连通性</a></li><li><a href=#nc-netcat---网络瑞士军刀><code>nc</code> (netcat) - 网络瑞士军刀</a></li></ol></li><li><a href=#43-高级网络工具>4.3 高级网络工具</a><ol><li><a href=#tcpdump---抓包分析><code>tcpdump</code> - 抓包分析</a></li><li><a href=#wireshark---图形化抓包><code>wireshark</code> - 图形化抓包</a></li><li><a href=#ss---socket统计推荐><code>ss</code> - socket统计（推荐）</a></li><li><a href=#lsof---查看网络连接><code>lsof</code> - 查看网络连接</a></li></ol></li></ol></li><li><a href=#五文本处理三剑客运维核心>五、文本处理三剑客（运维核心）</a><ol><li><a href=#51-grep---文本搜索>5.1 <code>grep</code> - 文本搜索</a></li><li><a href=#52-sed---流编辑器>5.2 <code>sed</code> - 流编辑器</a></li><li><a href=#53-awk---文本处理语言>5.3 <code>awk</code> - 文本处理语言</a></li><li><a href=#54-组合使用>5.4 组合使用</a></li></ol></li><li><a href=#六文件系统与存储管理>六、文件系统与存储管理</a><ol><li><a href=#61-磁盘管理>6.1 磁盘管理</a><ol><li><a href=#fdisk---分区管理><code>fdisk</code> - 分区管理</a></li><li><a href=#gdisk---gpt分区管理><code>gdisk</code> - GPT分区管理</a></li><li><a href=#parted---分区管理支持大磁盘><code>parted</code> - 分区管理（支持大磁盘）</a></li><li><a href=#mkfs---创建文件系统><code>mkfs</code> - 创建文件系统</a></li><li><a href=#fsck---文件系统检查><code>fsck</code> - 文件系统检查</a></li><li><a href=#mountumount---挂载卸载><code>mount</code>/<code>umount</code> - 挂载/卸载</a></li></ol></li><li><a href=#62-lvm管理>6.2 LVM管理</a><ol><li><a href=#pvcreate---创建物理卷><code>pvcreate</code> - 创建物理卷</a></li><li><a href=#vgcreate---创建卷组><code>vgcreate</code> - 创建卷组</a></li><li><a href=#lvcreate---创建逻辑卷><code>lvcreate</code> - 创建逻辑卷</a></li><li><a href=#resize2fsxfs_growfs---调整文件系统大小><code>resize2fs</code>/<code>xfs_growfs</code> - 调整文件系统大小</a></li></ol></li><li><a href=#63-raid管理>6.3 RAID管理</a><ol><li><a href=#mdadm---raid管理><code>mdadm</code> - RAID管理</a></li></ol></li></ol></li><li><a href=#七系统服务管理>七、系统服务管理</a><ol><li><a href=#71-systemd现代系统>7.1 systemd（现代系统）</a><ol><li><a href=#systemctl---服务控制><code>systemctl</code> - 服务控制</a></li><li><a href=#journalctl---systemd日志><code>journalctl</code> - systemd日志</a></li></ol></li><li><a href=#72-sysvinit传统系统>7.2 SysVinit（传统系统）</a><ol><li><a href=#service---服务控制><code>service</code> - 服务控制</a></li><li><a href=#chkconfig---开机自启管理><code>chkconfig</code> - 开机自启管理</a></li></ol></li><li><a href=#73-定时任务>7.3 定时任务</a><ol><li><a href=#crontab---计划任务><code>crontab</code> - 计划任务</a></li><li><a href=#at---一次性任务><code>at</code> - 一次性任务</a></li></ol></li></ol></li><li><a href=#八用户与权限管理>八、用户与权限管理</a><ol><li><a href=#81-用户管理>8.1 用户管理</a><ol><li><a href=#useradd---添加用户><code>useradd</code> - 添加用户</a></li><li><a href=#usermod---修改用户><code>usermod</code> - 修改用户</a></li><li><a href=#userdel---删除用户><code>userdel</code> - 删除用户</a></li><li><a href=#passwd---修改密码><code>passwd</code> - 修改密码</a></li><li><a href=#su---切换用户><code>su</code> - 切换用户</a></li><li><a href=#sudo---提权执行><code>sudo</code> - 提权执行</a></li></ol></li><li><a href=#82-组管理>8.2 组管理</a><ol><li><a href=#groupadd---添加组><code>groupadd</code> - 添加组</a></li><li><a href=#groupmod---修改组><code>groupmod</code> - 修改组</a></li><li><a href=#groupdel---删除组><code>groupdel</code> - 删除组</a></li></ol></li><li><a href=#83-权限管理>8.3 权限管理</a><ol><li><a href=#chmod---修改权限><code>chmod</code> - 修改权限</a></li><li><a href=#chown---修改所有者><code>chown</code> - 修改所有者</a></li><li><a href=#chgrp---修改组><code>chgrp</code> - 修改组</a></li><li><a href=#umask---默认权限掩码><code>umask</code> - 默认权限掩码</a></li></ol></li><li><a href=#84-高级权限>8.4 高级权限</a><ol><li><a href=#setuidsetgidsticky-bit><code>setuid</code>/<code>setgid</code>/<code>sticky bit</code></a></li><li><a href=#acl---访问控制列表><code>ACL</code> - 访问控制列表</a></li></ol></li></ol></li><li><a href=#九压缩与备份>九、压缩与备份</a><ol><li><a href=#91-压缩工具>9.1 压缩工具</a><ol><li><a href=#tar---归档运维必备><code>tar</code> - 归档（运维必备）</a></li><li><a href=#gzipgunzip><code>gzip</code>/<code>gunzip</code></a></li><li><a href=#zipunzip><code>zip</code>/<code>unzip</code></a></li><li><a href=#rsync---同步与备份运维神器><code>rsync</code> - 同步与备份（运维神器）</a></li></ol></li><li><a href=#92-备份策略>9.2 备份策略</a><ol><li><a href=#dd---磁盘克隆><code>dd</code> - 磁盘克隆</a></li><li><a href=#cpio---归档><code>cpio</code> - 归档</a></li></ol></li></ol></li><li><a href=#十系统信息与管理>十、系统信息与管理</a><ol><li><a href=#101-系统信息>10.1 系统信息</a><ol><li><a href=#uname---内核信息><code>uname</code> - 内核信息</a></li><li><a href=#hostnamectl---主机名管理><code>hostnamectl</code> - 主机名管理</a></li><li><a href=#uptime---运行时间与负载><code>uptime</code> - 运行时间与负载</a></li><li><a href=#whow---登录用户><code>who</code>/<code>w</code> - 登录用户</a></li><li><a href=#last---登录历史><code>last</code> - 登录历史</a></li></ol></li><li><a href=#102-硬件信息>10.2 硬件信息</a><ol><li><a href=#lspci---pci设备><code>lspci</code> - PCI设备</a></li><li><a href=#lsusb---usb设备><code>lsusb</code> - USB设备</a></li><li><a href=#lscpu---cpu信息><code>lscpu</code> - CPU信息</a></li><li><a href=#dmidecode---硬件dmi信息><code>dmidecode</code> - 硬件DMI信息</a></li><li><a href=#hdparm---磁盘信息><code>hdparm</code> - 磁盘信息</a></li></ol></li><li><a href=#103-内核与模块>10.3 内核与模块</a><ol><li><a href=#lsmod---加载的模块><code>lsmod</code> - 加载的模块</a></li><li><a href=#modinfo---模块信息><code>modinfo</code> - 模块信息</a></li><li><a href=#modprobe---加载卸载模块><code>modprobe</code> - 加载/卸载模块</a></li><li><a href=#insmodrmmod---加载卸载模块><code>insmod</code>/<code>rmmod</code> - 加载/卸载模块</a></li><li><a href=#sysctl---内核参数><code>sysctl</code> - 内核参数</a></li></ol></li></ol></li><li><a href=#十一性能调优专家级>十一、性能调优（专家级）</a><ol><li><a href=#111-cpu调优>11.1 CPU调优</a><ol><li><a href=#cpu亲和性>CPU亲和性</a></li><li><a href=#中断均衡>中断均衡</a></li><li><a href=#调节器>调节器</a></li></ol></li><li><a href=#112-内存调优>11.2 内存调优</a><ol><li><a href=#swappiness>swappiness</a></li><li><a href=#透明大页>透明大页</a></li><li><a href=#内存压缩>内存压缩</a></li></ol></li><li><a href=#113-磁盘调优>11.3 磁盘调优</a><ol><li><a href=#io调度器>IO调度器</a></li><li><a href=#文件系统调优>文件系统调优</a></li></ol></li><li><a href=#114-网络调优>11.4 网络调优</a><ol><li><a href=#tcp参数>TCP参数</a></li><li><a href=#文件描述符限制>文件描述符限制</a></li><li><a href=#端口范围>端口范围</a></li></ol></li></ol></li><li><a href=#十二安全与审计>十二、安全与审计</a><ol><li><a href=#121-文件完整性>12.1 文件完整性</a><ol><li><a href=#md5sumsha256sum---校验和><code>md5sum</code>/<code>sha256sum</code> - 校验和</a></li><li><a href=#chattrlsattr---扩展属性><code>chattr</code>/<code>lsattr</code> - 扩展属性</a></li></ol></li><li><a href=#122-安全工具>12.2 安全工具</a><ol><li><a href=#iptables---防火墙传统><code>iptables</code> - 防火墙（传统）</a></li><li><a href=#firewalld---动态防火墙><code>firewalld</code> - 动态防火墙</a></li><li><a href=#ufw---ubuntu防火墙><code>ufw</code> - Ubuntu防火墙</a></li></ol></li><li><a href=#123-审计>12.3 审计</a><ol><li><a href=#lastlog---最后登录><code>lastlog</code> - 最后登录</a></li><li><a href=#lastb---失败登录><code>lastb</code> - 失败登录</a></li><li><a href=#ausearch---selinux审计><code>ausearch</code> - SELinux审计</a></li></ol></li></ol></li><li><a href=#十三自动化运维脚本模板>十三、自动化运维脚本模板</a><ol><li><a href=#131-系统巡检脚本>13.1 系统巡检脚本</a></li><li><a href=#132-日志分析脚本>13.2 日志分析脚本</a></li><li><a href=#133-自动扩容脚本>13.3 自动扩容脚本</a></li></ol></li><li><a href=#十四生产环境故障排查案例>十四、生产环境故障排查案例</a><ol><li><a href=#案例1cpu-100但找不到进程>案例1：CPU 100%但找不到进程</a></li><li><a href=#案例2内存泄漏排查>案例2：内存泄漏排查</a></li><li><a href=#案例3网络连接数暴增>案例3：网络连接数暴增</a></li><li><a href=#案例4磁盘空间异常>案例4：磁盘空间异常</a></li></ol></li><li><a href=#十五运维最佳实践总结>十五、运维最佳实践总结</a><ol><li><a href=#151-生产环境黄金法则>15.1 生产环境黄金法则</a></li><li><a href=#152-命令使用原则>15.2 命令使用原则</a></li><li><a href=#153-性能优化-checklist>15.3 性能优化 checklist</a></li><li><a href=#154-推荐工具组合>15.4 推荐工具组合</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/blockchain/linux-%E5%91%BD%E4%BB%A4/>Linux命令</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-11-08</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 25 分钟</time></div></footer></div></header><section class=article-content><h1 id=linux-命令>Linux 命令</h1><p>作为运维工程师，我为您深度挖掘全网权威资料，整理出这份<strong>涵盖基础到内核级调试</strong>的完整命令手册。每个命令都包含<strong>生产环境实战技巧</strong>和<strong>避坑指南</strong>。</p><hr><h2 id=一基础命令深度解析运维视角>一、基础命令深度解析（运维视角）</h2><h3 id=11-文件目录操作含性能优化>1.1 文件目录操作（含性能优化）</h3><h4 id=ls---目录列表><code>ls</code> - 目录列表</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 运维必用组合：按大小排序，显示隐藏文件，人性化单位</span>
</span></span><span class=line><span class=cl>ls -lhS --color<span class=o>=</span>auto  <span class=c1># 按大小排序，人类可读</span>
</span></span><span class=line><span class=cl>ls -lart              <span class=c1># 按修改时间倒序（最新在最后）</span>
</span></span><span class=line><span class=cl>ls -i                 <span class=c1># 显示inode号（排查硬链接问题）</span>
</span></span><span class=line><span class=cl>ls -Z                 <span class=c1># 显示SELinux上下文</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产环境技巧：快速找出大目录</span>
</span></span><span class=line><span class=cl>du -h --max-depth<span class=o>=</span><span class=m>1</span> /var <span class=p>|</span> sort -hr <span class=p>|</span> head -10
</span></span></code></pre></td></tr></table></div></div><h4 id=cd---切换目录><code>cd</code> - 切换目录</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> -                  <span class=c1># 快速返回上次目录（运维高频操作）</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ..                 <span class=c1># 返回上级</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~                  <span class=c1># 返回home目录</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /                  <span class=c1># 返回根目录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 高级技巧：自动纠正拼写错误</span>
</span></span><span class=line><span class=cl><span class=nb>shopt</span> -s cdspell      <span class=c1># 开启cd命令自动纠错</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pwd---显示当前路径><code>pwd</code> - 显示当前路径</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>pwd</span> -P                <span class=c1># 显示物理路径（解析符号链接）</span>
</span></span><span class=line><span class=cl><span class=nb>pwd</span> -L                <span class=c1># 显示逻辑路径（默认）</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mkdir---创建目录><code>mkdir</code> - 创建目录</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p /path/to/dir <span class=c1># 递归创建（-p = parents）</span>
</span></span><span class=line><span class=cl>mkdir -m <span class=m>755</span> /path    <span class=c1># 直接指定权限</span>
</span></span><span class=line><span class=cl>mkdir -v /path        <span class=c1># 显示创建过程</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=rm---删除文件目录高危命令><code>rm</code> - 删除文件/目录（⚠️高危命令）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 生产环境黄金法则：先ls确认，再rm删除</span>
</span></span><span class=line><span class=cl>ls /path/to/delete <span class=o>&amp;&amp;</span> rm -rf /path/to/delete
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安全删除：使用trash-cli替代rm</span>
</span></span><span class=line><span class=cl><span class=c1># rm -rf 的危险性：删除后无法恢复，操作前务必确认</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 运维技巧：限制rm别名防止误删</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>rm</span><span class=o>=</span><span class=s1>&#39;rm -i&#39;</span>      <span class=c1># 删除前提示确认</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>rm</span><span class=o>=</span><span class=s1>&#39;rm --preserve-root&#39;</span>  <span class=c1># 防止删除根目录</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cp---复制文件><code>cp</code> - 复制文件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp -a <span class=nb>source</span> dest     <span class=c1># -a = -dR --preserve=all，保留所有属性（备份首选）</span>
</span></span><span class=line><span class=cl>cp -r dir1 dir2       <span class=c1># 递归复制目录</span>
</span></span><span class=line><span class=cl>cp -u <span class=nb>source</span> dest     <span class=c1># 只复制更新的文件（update）</span>
</span></span><span class=line><span class=cl>cp -p <span class=nb>source</span> dest     <span class=c1># 保留文件属性（时间戳、权限等）</span>
</span></span><span class=line><span class=cl>cp --sparse<span class=o>=</span>always    <span class=c1># 优化稀疏文件复制（虚拟机镜像）</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mv---移动重命名文件><code>mv</code> - 移动/重命名文件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mv -i file1 file2     <span class=c1># 交互式，覆盖前提示</span>
</span></span><span class=line><span class=cl>mv -n file1 file2     <span class=c1># 不覆盖已存在文件</span>
</span></span><span class=line><span class=cl>mv -t target_dir source_files  <span class=c1># 指定目标目录</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=touch---修改时间戳><code>touch</code> - 修改时间戳</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>touch file            <span class=c1># 不存在则创建，存在则更新时间为当前</span>
</span></span><span class=line><span class=cl>touch -c file         <span class=c1># 不创建新文件</span>
</span></span><span class=line><span class=cl>touch -t <span class=m>202501011200</span> file  <span class=c1># 指定时间戳</span>
</span></span><span class=line><span class=cl>touch -r ref_file file  <span class=c1># 使用参考文件的时间</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=12-文件查看与编辑>1.2 文件查看与编辑</h3><h4 id=cat---连接文件并打印><code>cat</code> - 连接文件并打印</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat -n file           <span class=c1># 显示行号</span>
</span></span><span class=line><span class=cl>cat -A file           <span class=c1># 显示所有控制字符（包括换行符$）</span>
</span></span><span class=line><span class=cl>cat file1 file2 &gt; file3  <span class=c1># 合并文件</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=more---分页查看><code>more</code> - 分页查看</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>more +100 file        <span class=c1># 从第100行开始显示</span>
</span></span><span class=line><span class=cl>more -d file          <span class=c1># 显示帮助提示</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=less---增强分页查看运维首选><code>less</code> - 增强分页查看（运维首选）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>less -N file          <span class=c1># 显示行号</span>
</span></span><span class=line><span class=cl>less +F file          <span class=c1># 实时跟踪文件更新（类似tail -f）</span>
</span></span><span class=line><span class=cl>less -S file          <span class=c1># 不换行显示（查看宽日志）</span>
</span></span><span class=line><span class=cl><span class=c1># 内部命令：</span>
</span></span><span class=line><span class=cl><span class=c1># /pattern 搜索  n/N 下一个/上一个</span>
</span></span><span class=line><span class=cl><span class=c1># g 跳到行首  G 跳到行尾  q 退出</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=head---查看文件头部><code>head</code> - 查看文件头部</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>head -n <span class=m>20</span> file       <span class=c1># 显示前20行</span>
</span></span><span class=line><span class=cl>head -c <span class=m>100</span> file      <span class=c1># 显示前100字节</span>
</span></span><span class=line><span class=cl>head -n -5 file       <span class=c1># 显示除最后5行的所有内容</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=tail---查看文件尾部运维高频><code>tail</code> - 查看文件尾部（运维高频）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tail -f file          <span class=c1># 实时跟踪文件更新（日志监控）</span>
</span></span><span class=line><span class=cl>tail -F file          <span class=c1># 跟踪文件，即使文件被旋转也继续</span>
</span></span><span class=line><span class=cl>tail -n <span class=m>100</span> file      <span class=c1># 显示最后100行</span>
</span></span><span class=line><span class=cl>tail -c <span class=m>100</span> file      <span class=c1># 显示最后100字节</span>
</span></span><span class=line><span class=cl>tail -n +100 file     <span class=c1># 从第100行开始显示</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：同时查看多个日志</span>
</span></span><span class=line><span class=cl>tail -f /var/log/*.log
</span></span></code></pre></td></tr></table></div></div><h4 id=vim---文本编辑器运维必备><code>vim</code> - 文本编辑器（运维必备）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 常用操作</span>
</span></span><span class=line><span class=cl>vim +100 file         <span class=c1># 打开文件并定位到第100行</span>
</span></span><span class=line><span class=cl>vim -R file           <span class=c1># 只读模式打开</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 内部命令</span>
</span></span><span class=line><span class=cl><span class=c1># :set nu             显示行号</span>
</span></span><span class=line><span class=cl><span class=c1># :set nonu           取消行号</span>
</span></span><span class=line><span class=cl><span class=c1># /pattern            搜索</span>
</span></span><span class=line><span class=cl><span class=c1># n                   下一个匹配</span>
</span></span><span class=line><span class=cl><span class=c1># :%s/old/new/g       全局替换</span>
</span></span><span class=line><span class=cl><span class=c1># :wq                 保存退出</span>
</span></span><span class=line><span class=cl><span class=c1># :q!                 强制退出不保存</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=二系统监控与性能分析生产级>二、系统监控与性能分析（生产级）</h2><h3 id=21-cpu性能监控>2.1 CPU性能监控</h3><h4 id=top---实时监控系统><code>top</code> - 实时监控系统</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>top                   <span class=c1># 默认按CPU排序</span>
</span></span><span class=line><span class=cl>top -Hp &lt;PID&gt;         <span class=c1># 查看进程内所有线程（排查Java/Python多线程问题关键）</span>
</span></span><span class=line><span class=cl>top -p 1,2,3          <span class=c1># 只监控指定PID</span>
</span></span><span class=line><span class=cl>top -u username       <span class=c1># 只显示指定用户</span>
</span></span><span class=line><span class=cl>top -b -n <span class=m>1</span> &gt; top.log <span class=c1># 批处理模式，运行一次后退出</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 内部交互命令</span>
</span></span><span class=line><span class=cl><span class=c1># P - 按CPU排序  M - 按内存排序  T - 按时间排序</span>
</span></span><span class=line><span class=cl><span class=c1># k - 杀死进程  r - 修改nice值  H - 显示线程</span>
</span></span><span class=line><span class=cl><span class=c1># 1 - 显示各CPU核心详情</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：Java应用CPU飙高排查</span>
</span></span><span class=line><span class=cl><span class=c1># 1. top找到高CPU进程PID</span>
</span></span><span class=line><span class=cl><span class=c1># 2. top -Hp PID查看线程</span>
</span></span><span class=line><span class=cl><span class=c1># 3. printf &#34;%xn&#34; &lt;TID&gt; 转16进制</span>
</span></span><span class=line><span class=cl><span class=c1># 4. jstack PID | grep -A 20 &lt;hex_TID&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=htop---增强版top推荐><code>htop</code> - 增强版top（推荐）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>htop                  <span class=c1># 彩色显示，支持鼠标操作</span>
</span></span><span class=line><span class=cl>htop -d <span class=m>10</span>            <span class=c1># 刷新间隔10秒</span>
</span></span><span class=line><span class=cl>htop -u root          <span class=c1># 只显示root用户进程</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 优点：支持树状显示、直接kill、renice、搜索过滤</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=vmstat---系统资源综合监控><code>vmstat</code> - 系统资源综合监控</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vmstat <span class=m>2</span> <span class=m>10</span>           <span class=c1># 每2秒采样一次，共10次</span>
</span></span><span class=line><span class=cl>vmstat -s             <span class=c1># 显示内存统计摘要</span>
</span></span><span class=line><span class=cl>vmstat -d             <span class=c1># 显示磁盘统计</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出解读：</span>
</span></span><span class=line><span class=cl><span class=c1># procs: r(运行队列) b(不可中断睡眠进程)</span>
</span></span><span class=line><span class=cl><span class=c1># memory: swpd(交换内存) free(空闲) buff/cache(缓存)</span>
</span></span><span class=line><span class=cl><span class=c1># swap: si(换入) so(换出) - 这两个值应该为0</span>
</span></span><span class=line><span class=cl><span class=c1># io: bi(读块) bo(写块)</span>
</span></span><span class=line><span class=cl><span class=c1># cpu: us(用户) sy(系统) id(空闲) wa(IO等待)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 警戒线：wa持续&gt;20%说明IO瓶颈</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mpstat---多核cpu分析><code>mpstat</code> - 多核CPU分析</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mpstat -P ALL <span class=m>1</span> <span class=m>10</span>    <span class=c1># 显示每个CPU核心的使用情况</span>
</span></span><span class=line><span class=cl>mpstat <span class=m>1</span> <span class=m>10</span>           <span class=c1># 显示所有CPU平均情况</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出列：%usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pidstat---进程级资源监控sysstat工具><code>pidstat</code> - 进程级资源监控（sysstat工具）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pidstat -u <span class=m>1</span> <span class=m>10</span>       <span class=c1># 监控CPU使用</span>
</span></span><span class=line><span class=cl>pidstat -r <span class=m>1</span> <span class=m>10</span>       <span class=c1># 监控内存使用</span>
</span></span><span class=line><span class=cl>pidstat -d <span class=m>1</span> <span class=m>10</span>       <span class=c1># 监控磁盘IO</span>
</span></span><span class=line><span class=cl>pidstat -t -p &lt;PID&gt;   <span class=c1># 监控指定进程的线程</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：监控Java应用所有指标</span>
</span></span><span class=line><span class=cl>pidstat -u -r -d -t -p &lt;PID&gt; <span class=m>2</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=sar---系统活动报告历史数据><code>sar</code> - 系统活动报告（历史数据）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sar -u <span class=m>1</span> <span class=m>10</span>           <span class=c1># CPU使用情况</span>
</span></span><span class=line><span class=cl>sar -r <span class=m>1</span> <span class=m>10</span>           <span class=c1># 内存使用情况</span>
</span></span><span class=line><span class=cl>sar -b <span class=m>1</span> <span class=m>10</span>           <span class=c1># IO传输速率</span>
</span></span><span class=line><span class=cl>sar -n DEV <span class=m>1</span> <span class=m>10</span>       <span class=c1># 网络设备流量</span>
</span></span><span class=line><span class=cl>sar -q <span class=m>1</span> <span class=m>10</span>           <span class=c1># 负载队列</span>
</span></span><span class=line><span class=cl>sar -f /var/log/sa/saXX  <span class=c1># 查看历史数据</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安装：yum install sysstat / apt-get install sysstat</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=perf---性能分析利器内核级><code>perf</code> - 性能分析利器（内核级）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>perf top              <span class=c1># 实时分析系统性能热点</span>
</span></span><span class=line><span class=cl>perf stat -p &lt;PID&gt;    <span class=c1># 统计进程性能数据</span>
</span></span><span class=line><span class=cl>perf record -g -p &lt;PID&gt;  <span class=c1># 记录性能数据（用于火焰图）</span>
</span></span><span class=line><span class=cl>perf report           <span class=c1># 报告分析结果</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：分析CPU热点函数</span>
</span></span><span class=line><span class=cl>perf top -g -p &lt;PID&gt;
</span></span><span class=line><span class=cl><span class=c1># 定位到具体函数后，可结合jstack/gdb分析</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=strace---系统调用跟踪调试神器><code>strace</code> - 系统调用跟踪（调试神器）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>strace -p &lt;PID&gt;       <span class=c1># 跟踪指定进程</span>
</span></span><span class=line><span class=cl>strace -c -p &lt;PID&gt;    <span class=c1># 统计系统调用耗时</span>
</span></span><span class=line><span class=cl>strace -e <span class=nv>trace</span><span class=o>=</span>file -p &lt;PID&gt;  <span class=c1># 只跟踪文件操作</span>
</span></span><span class=line><span class=cl>strace -f -e <span class=nv>trace</span><span class=o>=</span>network -p &lt;PID&gt; <span class=c1># 跟踪子进程和网络调用</span>
</span></span><span class=line><span class=cl>strace -T -tt -p &lt;PID&gt; <span class=c1># 显示时间戳和耗时</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：进程卡住排查</span>
</span></span><span class=line><span class=cl>strace -p &lt;PID&gt; -e <span class=nv>trace</span><span class=o>=</span>futex
</span></span><span class=line><span class=cl><span class=c1># 发现卡在futex_wait，说明在等待锁</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=22-内存性能监控>2.2 内存性能监控</h3><h4 id=free---内存使用><code>free</code> - 内存使用</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>free -h               <span class=c1># 人类可读格式</span>
</span></span><span class=line><span class=cl>free -m               <span class=c1># MB单位</span>
</span></span><span class=line><span class=cl>free -w               <span class=c1># 显示 buff 和 cache 分开</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解读：</span>
</span></span><span class=line><span class=cl><span class=c1># available: 真正可用内存（最重要指标）</span>
</span></span><span class=line><span class=cl><span class=c1># free: 完全空闲内存</span>
</span></span><span class=line><span class=cl><span class=c1># buff/cache: 缓存（可被回收）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产误区：不要被free值迷惑，关键看available</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pmap---进程内存映射><code>pmap</code> - 进程内存映射</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pmap -x &lt;PID&gt;         <span class=c1># 详细内存映射</span>
</span></span><span class=line><span class=cl>pmap -x &lt;PID&gt; <span class=p>|</span> tail -5  <span class=c1># 只显示汇总</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 排查内存泄漏：持续观察RSS列</span>
</span></span><span class=line><span class=cl>watch -n <span class=m>5</span> <span class=s2>&#34;pmap -x &lt;PID&gt; | grep total&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=smem---内存统计工具><code>smem</code> - 内存统计工具</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>smem -rs swap -p      <span class=c1># 按swap使用排序（%）</span>
</span></span><span class=line><span class=cl>smem -rs rss -p       <span class=c1># 按物理内存排序</span>
</span></span><span class=line><span class=cl>smem -u               <span class=c1># 按用户汇总</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 优势：能准确反映PSS（比例集大小），比RSS更有意义</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=vmstat--s---内存统计><code>vmstat -s</code> - 内存统计</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vmstat -s             <span class=c1># 显示详细内存统计</span>
</span></span><span class=line><span class=cl><span class=c1># 重点看：swap pages in/out，应该为0</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=23-磁盘io性能监控>2.3 磁盘IO性能监控</h3><h4 id=iostat---io统计sysstat><code>iostat</code> - IO统计（sysstat）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>iostat -x <span class=m>1</span> <span class=m>10</span>        <span class=c1># 详细IO统计（-x显示扩展信息）</span>
</span></span><span class=line><span class=cl>iostat -dk <span class=m>1</span> <span class=m>10</span>       <span class=c1># 以KB/s显示</span>
</span></span><span class=line><span class=cl>iostat -p sda <span class=m>1</span> <span class=m>10</span>    <span class=c1># 显示分区详细</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 关键指标：</span>
</span></span><span class=line><span class=cl><span class=c1># %util: 设备利用率，&gt;80%说明瓶颈</span>
</span></span><span class=line><span class=cl><span class=c1># await: 平均IO响应时间，&gt;10ms需关注</span>
</span></span><span class=line><span class=cl><span class=c1># svctm: 平均服务时间</span>
</span></span><span class=line><span class=cl><span class=c1># r/s w/s: 读写IOPS</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=iotop---io实时监控><code>iotop</code> - IO实时监控</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>iotop                 <span class=c1># 需要root权限</span>
</span></span><span class=line><span class=cl>iotop -oP -d <span class=m>2</span>        <span class=c1># 只显示有IO的进程(-o)，只显示进程(-P)，2秒刷新</span>
</span></span><span class=line><span class=cl>iotop -a              <span class=c1># 显示累积IO量</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=df---磁盘空间><code>df</code> - 磁盘空间</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>df -h                 <span class=c1># 人类可读</span>
</span></span><span class=line><span class=cl>df -i                 <span class=c1># 显示inode使用情况（inode满导致无法写入）</span>
</span></span><span class=line><span class=cl>df -T                 <span class=c1># 显示文件系统类型</span>
</span></span><span class=line><span class=cl>df -h /path           <span class=c1># 只显示指定路径的挂载点</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产警戒线：使用率&gt;85%预警，&gt;95%紧急</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=du---目录大小统计><code>du</code> - 目录大小统计</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>du -h --max-depth<span class=o>=</span><span class=m>1</span> /path  <span class=c1># 统计一级子目录大小</span>
</span></span><span class=line><span class=cl>du -sh /path              <span class=c1># 只显示总大小(-s)</span>
</span></span><span class=line><span class=cl>du -ah /path <span class=p>|</span> sort -hr <span class=p>|</span> head -20  <span class=c1># 找出最大的20个文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：快速定位磁盘满的原因</span>
</span></span><span class=line><span class=cl>du -h --max-depth<span class=o>=</span><span class=m>1</span> / <span class=p>|</span> sort -hr <span class=p>|</span> head -10
</span></span></code></pre></td></tr></table></div></div><h4 id=lsof---查看打开的文件><code>lsof</code> - 查看打开的文件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsof                  <span class=c1># 列出所有打开的文件</span>
</span></span><span class=line><span class=cl>lsof -p &lt;PID&gt;         <span class=c1># 指定进程打开的文件</span>
</span></span><span class=line><span class=cl>lsof /path/to/file    <span class=c1># 查看文件被哪些进程使用</span>
</span></span><span class=line><span class=cl>lsof -i :8080         <span class=c1># 查看端口占用进程</span>
</span></span><span class=line><span class=cl>lsof -u username      <span class=c1># 指定用户</span>
</span></span><span class=line><span class=cl>lsof +D /path         <span class=c1># 递归目录（慢，用lsof | grep /path更快）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：删除文件后空间不释放</span>
</span></span><span class=line><span class=cl>lsof <span class=p>|</span> grep deleted   <span class=c1># 查找已删除但仍被进程占用的文件</span>
</span></span><span class=line><span class=cl><span class=c1># 解决：重启对应进程或&gt; /proc/&lt;PID&gt;/fd/&lt;FD&gt;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=24-网络性能监控>2.4 网络性能监控</h3><h4 id=ss---socket统计替代netstat><code>ss</code> - socket统计（替代netstat）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ss -tuln             <span class=c1># 显示所有监听端口（-t TCP, -u UDP, -l 监听, -n 数字）</span>
</span></span><span class=line><span class=cl>ss -tan              <span class=c1># 显示所有TCP连接</span>
</span></span><span class=line><span class=cl>ss -s                <span class=c1># 显示socket统计摘要</span>
</span></span><span class=line><span class=cl>ss -p                <span class=c1># 显示进程信息</span>
</span></span><span class=line><span class=cl>ss -o state established <span class=s1>&#39;( dport = :22 or sport = :22 )&#39;</span>  <span class=c1># 过滤特定端口</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 比netstat更快，适合高并发环境</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=netstat---网络连接传统工具><code>netstat</code> - 网络连接（传统工具）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>netstat -tuln        <span class=c1># 显示监听端口</span>
</span></span><span class=line><span class=cl>netstat -anp         <span class=c1># 显示所有连接和进程</span>
</span></span><span class=line><span class=cl>netstat -i           <span class=c1># 显示网络接口统计</span>
</span></span><span class=line><span class=cl>netstat -r           <span class=c1># 显示路由表</span>
</span></span><span class=line><span class=cl>netstat -s           <span class=c1># 显示协议统计</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=iftop---实时流量监控><code>iftop</code> - 实时流量监控</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>iftop -i eth0        <span class=c1># 监控指定网卡</span>
</span></span><span class=line><span class=cl>iftop -n             <span class=c1># 不解析主机名</span>
</span></span><span class=line><span class=cl>iftop -P             <span class=c1># 显示端口</span>
</span></span><span class=line><span class=cl>iftop -f <span class=s2>&#34;port 80&#34;</span>   <span class=c1># 过滤特定端口</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 需要root权限，适合排查带宽占用</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=tcpdump---抓包分析网络排障核心><code>tcpdump</code> - 抓包分析（网络排障核心）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tcpdump -i eth0 -nn -s0 -v port <span class=m>80</span>  <span class=c1># 抓HTTP流量</span>
</span></span><span class=line><span class=cl>tcpdump -i any -nn host 192.168.1.1  <span class=c1># 抓特定IP</span>
</span></span><span class=line><span class=cl>tcpdump -w capture.pcap              <span class=c1># 写入文件（wireshark分析）</span>
</span></span><span class=line><span class=cl>tcpdump -r capture.pcap              <span class=c1># 读取文件</span>
</span></span><span class=line><span class=cl>tcpdump -A -s0 port <span class=m>80</span>               <span class=c1># ASCII显示HTTP内容</span>
</span></span><span class=line><span class=cl>tcpdump -i eth0 -c <span class=m>1000</span>              <span class=c1># 只抓1000个包</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：排查MySQL慢查询网络原因</span>
</span></span><span class=line><span class=cl>tcpdump -i eth0 -s0 -nn -A dst port <span class=m>3306</span> <span class=p>|</span> grep -E <span class=s2>&#34;SELECT|INSERT&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=nethogs---按进程统计流量><code>nethogs</code> - 按进程统计流量</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nethogs              <span class=c1># 需要root，显示进程级流量</span>
</span></span><span class=line><span class=cl>nethogs eth0         <span class=c1># 指定网卡</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ping---测试连通性><code>ping</code> - 测试连通性</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -c <span class=m>4</span> -i 0.2 -W <span class=m>1</span> 8.8.8.8  <span class=c1># 发送4次，间隔0.2秒，超时1秒</span>
</span></span><span class=line><span class=cl>ping -f 8.8.8.8       <span class=c1># 洪水ping（需root，测试网络极限）</span>
</span></span><span class=line><span class=cl>ping -s <span class=m>1400</span> 8.8.8.8  <span class=c1># 指定包大小（测试MTU）</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=traceroute---路由追踪><code>traceroute</code> - 路由追踪</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>traceroute -n 8.8.8.8  <span class=c1># 不解析主机名（快）</span>
</span></span><span class=line><span class=cl>traceroute -T -p <span class=m>80</span> 8.8.8.8  <span class=c1># TCP SYN方式（绕过防火墙ICMP限制）</span>
</span></span><span class=line><span class=cl>traceroute -I 8.8.8.8  <span class=c1># ICMP方式</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mtr---综合网络诊断><code>mtr</code> - 综合网络诊断</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mtr -r -c <span class=m>10</span> 8.8.8.8  <span class=c1># 报告模式，发送10次</span>
</span></span><span class=line><span class=cl>mtr -w 8.8.8.8        <span class=c1># 宽格式（长主机名）</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=25-系统负载与运行时长>2.5 系统负载与运行时长</h3><h4 id=uptime---系统运行时间与负载><code>uptime</code> - 系统运行时间与负载</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>uptime               <span class=c1># 显示：时间、运行时长、用户数、负载</span>
</span></span><span class=line><span class=cl>uptime -p            <span class=c1># 只显示运行时长</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 负载解读：</span>
</span></span><span class=line><span class=cl><span class=c1># 1分钟、5分钟、15分钟平均负载</span>
</span></span><span class=line><span class=cl><span class=c1># 理想值：负载 &lt; CPU核心数</span>
</span></span><span class=line><span class=cl><span class=c1># 警戒线：负载 &gt; CPU核心数 * 0.7</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=who---查看登录用户><code>who</code> - 查看登录用户</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>who                  <span class=c1># 显示当前登录用户</span>
</span></span><span class=line><span class=cl>who -b               <span class=c1># 显示上次启动时间</span>
</span></span><span class=line><span class=cl>who -r               <span class=c1># 显示运行级别</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=last---查看登录历史><code>last</code> - 查看登录历史</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>last                 <span class=c1># 显示所有登录历史</span>
</span></span><span class=line><span class=cl>last root            <span class=c1># 只显示root登录历史</span>
</span></span><span class=line><span class=cl>last -n <span class=m>10</span>           <span class=c1># 只显示最近10条</span>
</span></span><span class=line><span class=cl>last -f /var/log/btmp  <span class=c1># 查看失败登录尝试</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=dmesg---内核日志><code>dmesg</code> - 内核日志</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dmesg                <span class=c1># 查看内核环形缓冲区</span>
</span></span><span class=line><span class=cl>dmesg -T             <span class=c1># 显示人类可读时间</span>
</span></span><span class=line><span class=cl>dmesg -c             <span class=c1># 读取后清除</span>
</span></span><span class=line><span class=cl>dmesg <span class=p>|</span> grep -i error  <span class=c1># 搜索错误</span>
</span></span><span class=line><span class=cl>dmesg <span class=p>|</span> grep -i oom    <span class=c1># 查找OOM killer记录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：排查硬件故障</span>
</span></span><span class=line><span class=cl>dmesg <span class=p>|</span> grep -E <span class=s2>&#34; Hardware|Error|Fail&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=三进程管理运维核心>三、进程管理（运维核心）</h2><h3 id=31-进程查看>3.1 进程查看</h3><h4 id=ps---进程快照><code>ps</code> - 进程快照</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ps aux               <span class=c1># BSD风格，显示所有进程（常用）</span>
</span></span><span class=line><span class=cl>ps -ef               <span class=c1># System V风格</span>
</span></span><span class=line><span class=cl>ps aux --sort<span class=o>=</span>-%cpu  <span class=c1># 按CPU排序（降序）</span>
</span></span><span class=line><span class=cl>ps aux --sort<span class=o>=</span>-%mem  <span class=c1># 按内存排序</span>
</span></span><span class=line><span class=cl>ps -o pid,ppid,cmd,%cpu,%mem -p &lt;PID&gt;  <span class=c1># 自定义输出列</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：查找僵尸进程</span>
</span></span><span class=line><span class=cl>ps aux <span class=p>|</span> awk <span class=s1>&#39;$8==&#34;Z&#34;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pgrep---按名称查找pid><code>pgrep</code> - 按名称查找PID</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pgrep nginx          <span class=c1># 查找nginx进程PID</span>
</span></span><span class=line><span class=cl>pgrep -f <span class=s2>&#34;python3 app.py&#34;</span>  <span class=c1># 匹配完整命令行</span>
</span></span><span class=line><span class=cl>pgrep -u root sshd   <span class=c1># 查找root用户的sshd进程</span>
</span></span><span class=line><span class=cl>pgrep -d, -f java    <span class=c1># 用逗号分隔输出（用于top -p）</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pidof---按名称查找pid><code>pidof</code> - 按名称查找PID</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pidof nginx          <span class=c1># 返回所有nginx worker PID</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pstree---进程树><code>pstree</code> - 进程树</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pstree               <span class=c1># 显示进程树</span>
</span></span><span class=line><span class=cl>pstree -p            <span class=c1># 显示PID</span>
</span></span><span class=line><span class=cl>pstree -u            <span class=c1># 显示用户</span>
</span></span><span class=line><span class=cl>pstree -a            <span class=c1># 显示完整命令</span>
</span></span><span class=line><span class=cl>pstree <span class=p>|</span> grep -A <span class=m>5</span> nginx  <span class=c1># 查找nginx相关进程树</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=32-进程控制>3.2 进程控制</h3><h4 id=kill---发送信号><code>kill</code> - 发送信号</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>kill</span> -l              <span class=c1># 列出所有信号</span>
</span></span><span class=line><span class=cl><span class=nb>kill</span> -15 &lt;PID&gt;       <span class=c1># 发送TERM信号（优雅终止）</span>
</span></span><span class=line><span class=cl><span class=nb>kill</span> -9 &lt;PID&gt;        <span class=c1># 发送KILL信号（强制终止，谨慎使用）</span>
</span></span><span class=line><span class=cl><span class=nb>kill</span> -2 &lt;PID&gt;        <span class=c1># 发送INT信号（类似Ctrl+C）</span>
</span></span><span class=line><span class=cl><span class=nb>kill</span> -1 &lt;PID&gt;        <span class=c1># 发送HUP信号（重载配置）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批量杀进程</span>
</span></span><span class=line><span class=cl>pkill -9 java        <span class=c1># 按名称杀进程</span>
</span></span><span class=line><span class=cl>killall -9 java      <span class=c1># 杀所有名为java的进程</span>
</span></span><span class=line><span class=cl><span class=nb>kill</span> -9 <span class=k>$(</span>pgrep -f <span class=s2>&#34;test.py&#34;</span><span class=k>)</span>  <span class=c1># 组合使用</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：优雅重启nginx</span>
</span></span><span class=line><span class=cl><span class=nb>kill</span> -USR1 <span class=k>$(</span>cat /var/run/nginx.pid<span class=k>)</span>  <span class=c1># 重新打开日志文件</span>
</span></span><span class=line><span class=cl><span class=nb>kill</span> -HUP <span class=k>$(</span>cat /var/run/nginx.pid<span class=k>)</span>   <span class=c1># 重载配置</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=killall---按名称杀进程><code>killall</code> - 按名称杀进程</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>killall -9 python3   <span class=c1># 杀所有python3进程</span>
</span></span><span class=line><span class=cl>killall -w process   <span class=c1># 等待进程终止</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pkill---按模式杀进程><code>pkill</code> - 按模式杀进程</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pkill -f <span class=s2>&#34;test.py&#34;</span>   <span class=c1># 匹配完整命令行</span>
</span></span><span class=line><span class=cl>pkill -u username    <span class=c1># 杀死某用户的所有进程</span>
</span></span><span class=line><span class=cl>pkill -t pts/0       <span class=c1># 杀死某个终端的所有进程</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=nicerenice---调整优先级><code>nice</code>/<code>renice</code> - 调整优先级</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nice -n <span class=m>19</span> <span class=nb>command</span>   <span class=c1># 以最低优先级运行（19最低，-20最高）</span>
</span></span><span class=line><span class=cl>renice -n <span class=m>10</span> -p &lt;PID&gt;  <span class=c1># 调整已运行进程优先级</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：降低备份任务优先级</span>
</span></span><span class=line><span class=cl>nice -n <span class=m>19</span> tar -czf backup.tar.gz /data
</span></span></code></pre></td></tr></table></div></div><h4 id=nohup---后台持久运行><code>nohup</code> - 后台持久运行</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nohup <span class=nb>command</span> <span class=p>&amp;</span>       <span class=c1># &amp;放入后台，nohup忽略挂起信号</span>
</span></span><span class=line><span class=cl>nohup java -jar app.jar &gt; app.log 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>&amp;</span>  <span class=c1># 标准推荐写法</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=disown---从shell移除作业><code>disown</code> - 从shell移除作业</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>disown</span> %1             <span class=c1># 移除作业1</span>
</span></span><span class=line><span class=cl><span class=nb>disown</span> -a             <span class=c1># 移除所有作业</span>
</span></span><span class=line><span class=cl><span class=nb>disown</span> -h %1          <span class=c1># 标记为不接收SIGHUP</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=33-作业控制>3.3 作业控制</h3><h4 id=---后台运行><code>&</code> - 后台运行</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>command</span> <span class=p>&amp;</span>            <span class=c1># 放入后台执行</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=jobs---查看后台作业><code>jobs</code> - 查看后台作业</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>jobs</span>                 <span class=c1># 查看当前shell的后台作业</span>
</span></span><span class=line><span class=cl><span class=nb>jobs</span> -l              <span class=c1># 显示PID</span>
</span></span><span class=line><span class=cl><span class=nb>jobs</span> -r              <span class=c1># 只显示运行中的作业</span>
</span></span><span class=line><span class=cl><span class=nb>jobs</span> -s              <span class=c1># 只显示停止的作业</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=fgbg---前台后台切换><code>fg</code>/<code>bg</code> - 前台/后台切换</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>fg</span> %1                <span class=c1># 将作业1调到前台</span>
</span></span><span class=line><span class=cl><span class=nb>bg</span> %1                <span class=c1># 将作业1在后台继续运行</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=wait---等待作业完成><code>wait</code> - 等待作业完成</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>wait</span> &lt;PID&gt;           <span class=c1># 等待指定PID进程结束</span>
</span></span><span class=line><span class=cl><span class=nb>wait</span>                 <span class=c1># 等待所有后台作业结束</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=34-高级进程调试>3.4 高级进程调试</h3><h4 id=strace---系统调用跟踪><code>strace</code> - 系统调用跟踪</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.1节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ltrace---库函数调用跟踪><code>ltrace</code> - 库函数调用跟踪</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ltrace -p &lt;PID&gt;      <span class=c1># 跟踪库函数调用</span>
</span></span><span class=line><span class=cl>ltrace -c -p &lt;PID&gt;   <span class=c1># 统计调用耗时</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=gdb---调试器><code>gdb</code> - 调试器</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gdb -p &lt;PID&gt;         <span class=c1># 附加到运行进程</span>
</span></span><span class=line><span class=cl>gdb /path/to/binary core  <span class=c1># 分析core dump</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：分析Java core文件</span>
</span></span><span class=line><span class=cl>gdb java core.12345
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> bt              <span class=c1># 查看堆栈</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> info threads    <span class=c1># 查看线程</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> thread apply all bt  <span class=c1># 查看所有线程堆栈</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=perf---性能分析><code>perf</code> - 性能分析</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.1节</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=四网络管理运维核心>四、网络管理（运维核心）</h2><h3 id=41-网络配置>4.1 网络配置</h3><h4 id=ip---现代网络配置推荐><code>ip</code> - 现代网络配置（推荐）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip addr               <span class=c1># 显示IP地址（替代ifconfig）</span>
</span></span><span class=line><span class=cl>ip addr add 192.168.1.100/24 dev eth0  <span class=c1># 添加IP</span>
</span></span><span class=line><span class=cl>ip addr del 192.168.1.100/24 dev eth0  <span class=c1># 删除IP</span>
</span></span><span class=line><span class=cl>ip link <span class=nb>set</span> eth0 up   <span class=c1># 启用网卡</span>
</span></span><span class=line><span class=cl>ip link <span class=nb>set</span> eth0 down <span class=c1># 禁用网卡</span>
</span></span><span class=line><span class=cl>ip route              <span class=c1># 显示路由表</span>
</span></span><span class=line><span class=cl>ip route add default via 192.168.1.1  <span class=c1># 添加默认网关</span>
</span></span><span class=line><span class=cl>ip neighbor           <span class=c1># 显示ARP表</span>
</span></span><span class=line><span class=cl>ip -s link            <span class=c1># 显示统计信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：快速查看IP</span>
</span></span><span class=line><span class=cl>ip -4 -o addr show scope global <span class=p>|</span> awk <span class=s1>&#39;{print $4}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ifconfig---传统网络配置><code>ifconfig</code> - 传统网络配置</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ifconfig              <span class=c1># 显示所有网卡</span>
</span></span><span class=line><span class=cl>ifconfig eth0         <span class=c1># 显示指定网卡</span>
</span></span><span class=line><span class=cl>ifconfig eth0 up/down <span class=c1># 启用/禁用</span>
</span></span><span class=line><span class=cl>ifconfig eth0 192.168.1.100 netmask 255.255.255.0  <span class=c1># 配置IP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 已废弃，推荐使用ip命令</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=route---路由管理><code>route</code> - 路由管理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>route -n              <span class=c1># 显示路由表</span>
</span></span><span class=line><span class=cl>route add default gw 192.168.1.1  <span class=c1># 添加默认网关</span>
</span></span><span class=line><span class=cl>route add -net 10.0.0.0/8 gw 10.0.0.1  <span class=c1># 添加静态路由</span>
</span></span><span class=line><span class=cl>route del -net 10.0.0.0/8  <span class=c1># 删除路由</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=nmcli---networkmanager命令行><code>nmcli</code> - NetworkManager命令行</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli device status   <span class=c1># 查看设备状态</span>
</span></span><span class=line><span class=cl>nmcli connection show <span class=c1># 查看连接</span>
</span></span><span class=line><span class=cl>nmcli connection up/down id <span class=s2>&#34;conn-name&#34;</span>  <span class=c1># 启用/禁用连接</span>
</span></span><span class=line><span class=cl>nmcli device wifi list  <span class=c1># 查看WiFi</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=42-网络诊断>4.2 网络诊断</h3><h4 id=ping---连通性测试><code>ping</code> - 连通性测试</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.4节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=traceroute---路由追踪-1><code>traceroute</code> - 路由追踪</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.4节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mtr---综合诊断><code>mtr</code> - 综合诊断</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.4节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=nslookupdig---dns查询><code>nslookup</code>/<code>dig</code> - DNS查询</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dig www.baidu.com     <span class=c1># 详细DNS查询</span>
</span></span><span class=line><span class=cl>dig +short www.baidu.com  <span class=c1># 简短输出</span>
</span></span><span class=line><span class=cl>dig @8.8.8.8 www.baidu.com  <span class=c1># 指定DNS服务器</span>
</span></span><span class=line><span class=cl>dig +trace www.baidu.com  <span class=c1># 追踪查询过程</span>
</span></span><span class=line><span class=cl>dig -x 8.8.8.8        <span class=c1># 反向解析</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nslookup www.baidu.com 8.8.8.8  <span class=c1># 指定DNS</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=host---简单dns查询><code>host</code> - 简单DNS查询</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>host www.baidu.com
</span></span><span class=line><span class=cl>host -t mx baidu.com  <span class=c1># 查询MX记录</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=telnet---测试端口连通性><code>telnet</code> - 测试端口连通性</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>telnet 192.168.1.1 <span class=m>22</span>  <span class=c1># 测试SSH端口</span>
</span></span><span class=line><span class=cl><span class=c1># Ctrl+] 然后输入quit退出</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=nc-netcat---网络瑞士军刀><code>nc</code> (netcat) - 网络瑞士军刀</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -zv 192.168.1.1 <span class=m>22</span>  <span class=c1># 测试端口（-z 零IO，-v 详细）</span>
</span></span><span class=line><span class=cl>nc -l <span class=m>8080</span>           <span class=c1># 监听8080端口</span>
</span></span><span class=line><span class=cl>nc 192.168.1.1 <span class=m>8080</span>  <span class=c1># 连接端口</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;test&#34;</span> <span class=p>|</span> nc 192.168.1.1 <span class=m>8080</span>  <span class=c1># 发送数据</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：快速传输文件</span>
</span></span><span class=line><span class=cl><span class=c1># 接收端：nc -l 8888 &gt; file</span>
</span></span><span class=line><span class=cl><span class=c1># 发送端：nc receiver_ip 8888 &lt; file</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=43-高级网络工具>4.3 高级网络工具</h3><h4 id=tcpdump---抓包分析><code>tcpdump</code> - 抓包分析</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.4节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=wireshark---图形化抓包><code>wireshark</code> - 图形化抓包</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wireshark            <span class=c1># 图形界面</span>
</span></span><span class=line><span class=cl>tshark -i eth0       <span class=c1># 命令行版wireshark</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ss---socket统计推荐><code>ss</code> - socket统计（推荐）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见4.1节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lsof---查看网络连接><code>lsof</code> - 查看网络连接</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsof -i :8080        <span class=c1># 查看8080端口占用</span>
</span></span><span class=line><span class=cl>lsof -i TCP          <span class=c1># 查看所有TCP连接</span>
</span></span><span class=line><span class=cl>lsof -i @192.168.1.1  <span class=c1># 查看连接到该IP的连接</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=五文本处理三剑客运维核心>五、文本处理三剑客（运维核心）</h2><h3 id=51-grep---文本搜索>5.1 <code>grep</code> - 文本搜索</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基本用法</span>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;error&#34;</span> file.log  <span class=c1># 搜索包含error的行</span>
</span></span><span class=line><span class=cl>grep -i <span class=s2>&#34;error&#34;</span> file   <span class=c1># 忽略大小写</span>
</span></span><span class=line><span class=cl>grep -v <span class=s2>&#34;error&#34;</span> file   <span class=c1># 反向匹配（不包含）</span>
</span></span><span class=line><span class=cl>grep -r <span class=s2>&#34;error&#34;</span> /path  <span class=c1># 递归目录搜索</span>
</span></span><span class=line><span class=cl>grep -E <span class=s2>&#34;error|warn&#34;</span> file  <span class=c1># 正则表达式（扩展）</span>
</span></span><span class=line><span class=cl>grep -A <span class=m>3</span> -B <span class=m>3</span> <span class=s2>&#34;error&#34;</span> file  <span class=c1># 显示前后3行</span>
</span></span><span class=line><span class=cl>grep -n <span class=s2>&#34;error&#34;</span> file   <span class=c1># 显示行号</span>
</span></span><span class=line><span class=cl>grep -c <span class=s2>&#34;error&#34;</span> file   <span class=c1># 统计匹配行数</span>
</span></span><span class=line><span class=cl>grep -o <span class=s2>&#34;error&#34;</span> file   <span class=c1># 只显示匹配部分</span>
</span></span><span class=line><span class=cl>grep -w <span class=s2>&#34;error&#34;</span> file   <span class=c1># 整词匹配</span>
</span></span><span class=line><span class=cl>grep -f patterns.txt file  <span class=c1># 从文件读取模式</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：分析Nginx访问日志</span>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;200&#34;</span> access.log <span class=p>|</span> wc -l  <span class=c1># 统计成功请求</span>
</span></span><span class=line><span class=cl>grep -E <span class=s2>&#34;5[0-9]{2}&#34;</span> access.log <span class=p>|</span> awk <span class=s1>&#39;{print $7}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head  <span class=c1># Top错误URL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 高级用法：排除多个模式</span>
</span></span><span class=line><span class=cl>grep -vE <span class=s2>&#34;(debug|info)&#34;</span> app.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查找IP地址</span>
</span></span><span class=line><span class=cl>grep -oE <span class=s2>&#34;([0-9]{1,3}\.){3}[0-9]{1,3}&#34;</span> access.log
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=52-sed---流编辑器>5.2 <code>sed</code> - 流编辑器</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基本语法：sed [选项] &#39;命令&#39; 文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 替换</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;s/old/new/&#39;</span> file  <span class=c1># 每行第一个匹配</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;s/old/new/g&#39;</span> file  <span class=c1># 全局替换</span>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/old/new/g&#39;</span> file  <span class=c1># 直接修改文件（-i危险，先备份）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 删除</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;/pattern/d&#39;</span> file  <span class=c1># 删除匹配行</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;1,10d&#39;</span> file       <span class=c1># 删除1-10行</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;$d&#39;</span> file          <span class=c1># 删除最后一行</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 插入</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;1i\insert&#39;</span> file   <span class=c1># 第1行前插入</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;$a\append&#39;</span> file   <span class=c1># 最后追加</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 打印</span>
</span></span><span class=line><span class=cl>sed -n <span class=s1>&#39;1,10p&#39;</span> file    <span class=c1># 打印1-10行</span>
</span></span><span class=line><span class=cl>sed -n <span class=s1>&#39;/pattern/p&#39;</span> file  <span class=c1># 打印匹配行</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：批量修改配置文件</span>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/Port 22/Port 2222/&#39;</span> /etc/ssh/sshd_config  <span class=c1># 修改SSH端口</span>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;/^#ServerActive/s/#//&#39;</span> /etc/zabbix/zabbix_agentd.conf  <span class=c1># 取消注释</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 提取特定行</span>
</span></span><span class=line><span class=cl>sed -n <span class=s1>&#39;/2024-01-01/,/2024-01-02/p&#39;</span> access.log  <span class=c1># 提取日期范围</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=53-awk---文本处理语言>5.3 <code>awk</code> - 文本处理语言</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基本语法：awk &#39;模式{动作}&#39; 文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 打印列</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $1}&#39;</span> file  <span class=c1># 打印第1列（默认空格分隔）</span>
</span></span><span class=line><span class=cl>awk -F: <span class=s1>&#39;{print $1}&#39;</span> /etc/passwd  <span class=c1># 指定分隔符:</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $NF}&#39;</span> file  <span class=c1># 打印最后一列</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 条件过滤</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;$3 &gt; 100&#39;</span> file    <span class=c1># 第3列大于100</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;/error/&#39;</span> file     <span class=c1># 匹配模式</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;$1 ~ /^192/ {print $2}&#39;</span> file  <span class=c1># 第1列匹配正则</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：分析Nginx日志</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $1}&#39;</span> access.log <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -20  <span class=c1># Top IP</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $7}&#39;</span> access.log <span class=p>|</span> grep -v <span class=s1>&#39;^$&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -20  <span class=c1># Top URL</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;$9 ~ /^5/ {print $7}&#39;</span> access.log <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr  <span class=c1># 500错误的URL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 统计</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{sum+=$1} END {print sum/NR}&#39;</span> file  <span class=c1># 求平均值</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{if($1&gt;max) max=$1} END {print max}&#39;</span> file  <span class=c1># 求最大值</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多分隔符</span>
</span></span><span class=line><span class=cl>awk -F<span class=s1>&#39;[: ]&#39;</span> <span class=s1>&#39;{print $1}&#39;</span> file  <span class=c1># 分隔符为冒号或空格</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 内置变量</span>
</span></span><span class=line><span class=cl><span class=c1># NR: 行号  NF: 列数  $0: 整行  FILENAME: 文件名</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=54-组合使用>5.4 组合使用</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 案例1：查找Top内存进程</span>
</span></span><span class=line><span class=cl>ps aux <span class=p>|</span> sort -nk4 -r <span class=p>|</span> head -10
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 案例2：日志分析完整流程</span>
</span></span><span class=line><span class=cl>cat access.log <span class=p>|</span> grep <span class=s2>&#34;200&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{print $7}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10 &gt; top_urls.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 案例3：多条件过滤</span>
</span></span><span class=line><span class=cl>cat app.log <span class=p>|</span> grep -v <span class=s2>&#34;DEBUG&#34;</span> <span class=p>|</span> grep -E <span class=s2>&#34;error|warn&#34;</span> <span class=p>|</span> awk -F<span class=s1>&#39;[&#39;</span> <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> awk -F<span class=s1>&#39;]&#39;</span> <span class=s1>&#39;{print $1}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 案例4：时间范围提取</span>
</span></span><span class=line><span class=cl>sed -n <span class=s1>&#39;/2024-01-01 10:00:00/,/2024-01-01 11:00:00/p&#39;</span> access.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 案例5：CSV处理</span>
</span></span><span class=line><span class=cl>awk -F<span class=s1>&#39;,&#39;</span> <span class=s1>&#39;{printf &#34;%-20s %-10s %5.2f\n&#34;, $1, $2, $3}&#39;</span> data.csv
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=六文件系统与存储管理>六、文件系统与存储管理</h2><h3 id=61-磁盘管理>6.1 磁盘管理</h3><h4 id=fdisk---分区管理><code>fdisk</code> - 分区管理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fdisk -l             <span class=c1># 列出所有磁盘</span>
</span></span><span class=line><span class=cl>fdisk /dev/sdb       <span class=c1># 进入交互模式</span>
</span></span><span class=line><span class=cl><span class=c1># 内部命令：m(帮助) n(新建) p(打印) w(写入) q(退出) d(删除)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=gdisk---gpt分区管理><code>gdisk</code> - GPT分区管理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gdisk -l /dev/sdb    <span class=c1># 查看GPT分区</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=parted---分区管理支持大磁盘><code>parted</code> - 分区管理（支持大磁盘）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>parted -l            <span class=c1># 列出所有磁盘</span>
</span></span><span class=line><span class=cl>parted /dev/sdb mklabel gpt  <span class=c1># 创建GPT标签</span>
</span></span><span class=line><span class=cl>parted /dev/sdb mkpart primary 0% 100%  <span class=c1># 创建分区</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mkfs---创建文件系统><code>mkfs</code> - 创建文件系统</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkfs.ext4 /dev/sdb1  <span class=c1># 创建ext4文件系统</span>
</span></span><span class=line><span class=cl>mkfs.xfs /dev/sdb1   <span class=c1># 创建xfs文件系统</span>
</span></span><span class=line><span class=cl>mkfs -t ext4 /dev/sdb1  <span class=c1># 通用格式</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=fsck---文件系统检查><code>fsck</code> - 文件系统检查</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fsck /dev/sda1       <span class=c1># 检查并修复（卸载后执行）</span>
</span></span><span class=line><span class=cl>fsck -y /dev/sda1    <span class=c1># 自动修复</span>
</span></span><span class=line><span class=cl>fsck -n /dev/sda1    <span class=c1># 只检查不修复</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产警告：不要在挂载的文件系统上运行！</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mountumount---挂载卸载><code>mount</code>/<code>umount</code> - 挂载/卸载</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mount                 <span class=c1># 显示挂载信息</span>
</span></span><span class=line><span class=cl>mount /dev/sdb1 /mnt  <span class=c1># 挂载</span>
</span></span><span class=line><span class=cl>mount -t nfs 192.168.1.1:/data /mnt  <span class=c1># 挂载NFS</span>
</span></span><span class=line><span class=cl>mount -o remount,rw /  <span class=c1># 重新挂载为读写（救援模式常用）</span>
</span></span><span class=line><span class=cl>umount /mnt           <span class=c1># 卸载</span>
</span></span><span class=line><span class=cl>umount -l /mnt        <span class=c1># 懒卸载（文件系统忙时使用）</span>
</span></span><span class=line><span class=cl>umount -f /mnt        <span class=c1># 强制卸载</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 开机挂载：编辑/etc/fstab</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=62-lvm管理>6.2 LVM管理</h3><h4 id=pvcreate---创建物理卷><code>pvcreate</code> - 创建物理卷</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pvcreate /dev/sdb1   <span class=c1># 将分区初始化为物理卷</span>
</span></span><span class=line><span class=cl>pvdisplay            <span class=c1># 显示物理卷信息</span>
</span></span><span class=line><span class=cl>pvs                  <span class=c1># 简要显示</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=vgcreate---创建卷组><code>vgcreate</code> - 创建卷组</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vgcreate vg_data /dev/sdb1 /dev/sdc1  <span class=c1># 创建卷组包含两个PV</span>
</span></span><span class=line><span class=cl>vgdisplay
</span></span><span class=line><span class=cl>vgs
</span></span><span class=line><span class=cl>vgextend vg_data /dev/sdd1  <span class=c1># 扩展卷组</span>
</span></span><span class=line><span class=cl>vgreduce vg_data /dev/sdd1  <span class=c1># 缩减卷组</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lvcreate---创建逻辑卷><code>lvcreate</code> - 创建逻辑卷</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lvcreate -L 100G -n lv_home vg_data  <span class=c1># 创建100G逻辑卷</span>
</span></span><span class=line><span class=cl>lvcreate -l 100%FREE -n lv_opt vg_data  <span class=c1># 使用所有剩余空间</span>
</span></span><span class=line><span class=cl>lvdisplay
</span></span><span class=line><span class=cl>lvs
</span></span><span class=line><span class=cl>lvextend -L +50G /dev/vg_data/lv_home  <span class=c1># 扩展逻辑卷</span>
</span></span><span class=line><span class=cl>lvreduce -L -50G /dev/vg_data/lv_home  <span class=c1># 缩减逻辑卷（危险）</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=resize2fsxfs_growfs---调整文件系统大小><code>resize2fs</code>/<code>xfs_growfs</code> - 调整文件系统大小</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>resize2fs /dev/vg_data/lv_home  <span class=c1># ext4在线扩容</span>
</span></span><span class=line><span class=cl>xfs_growfs /mnt/home            <span class=c1># xfs在线扩容</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=63-raid管理>6.3 RAID管理</h3><h4 id=mdadm---raid管理><code>mdadm</code> - RAID管理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mdadm --create /dev/md0 --level<span class=o>=</span><span class=m>1</span> --raid-devices<span class=o>=</span><span class=m>2</span> /dev/sdb1 /dev/sdc1  <span class=c1># 创建RAID1</span>
</span></span><span class=line><span class=cl>mdadm --detail /dev/md0  <span class=c1># 查看RAID详情</span>
</span></span><span class=line><span class=cl>mdadm --manage /dev/md0 --add /dev/sdd1  <span class=c1># 添加磁盘</span>
</span></span><span class=line><span class=cl>mdadm --manage /dev/md0 --fail /dev/sdb1 <span class=c1># 标记故障盘</span>
</span></span><span class=line><span class=cl>watch -n <span class=m>1</span> cat /proc/mdstat  <span class=c1># 监控RAID同步</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=七系统服务管理>七、系统服务管理</h2><h3 id=71-systemd现代系统>7.1 systemd（现代系统）</h3><h4 id=systemctl---服务控制><code>systemctl</code> - 服务控制</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl start nginx      <span class=c1># 启动服务</span>
</span></span><span class=line><span class=cl>systemctl stop nginx       <span class=c1># 停止服务</span>
</span></span><span class=line><span class=cl>systemctl restart nginx    <span class=c1># 重启服务</span>
</span></span><span class=line><span class=cl>systemctl reload nginx     <span class=c1># 重载配置</span>
</span></span><span class=line><span class=cl>systemctl status nginx     <span class=c1># 查看状态</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> nginx     <span class=c1># 开机自启</span>
</span></span><span class=line><span class=cl>systemctl disable nginx    <span class=c1># 取消开机自启</span>
</span></span><span class=line><span class=cl>systemctl is-active nginx  <span class=c1># 检查是否运行</span>
</span></span><span class=line><span class=cl>systemctl is-enabled nginx <span class=c1># 检查是否开机自启</span>
</span></span><span class=line><span class=cl>systemctl list-units --type<span class=o>=</span>service --state<span class=o>=</span>active  <span class=c1># 列出所有运行服务</span>
</span></span><span class=line><span class=cl>systemctl list-unit-files <span class=p>|</span> grep enabled  <span class=c1># 列出所有开机自启服务</span>
</span></span><span class=line><span class=cl>systemctl daemon-reload    <span class=c1># 重载配置（修改unit文件后）</span>
</span></span><span class=line><span class=cl>systemctl show nginx       <span class=c1># 显示详细属性</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：查看服务启动失败原因</span>
</span></span><span class=line><span class=cl>systemctl status nginx -l  <span class=c1># 显示完整日志</span>
</span></span><span class=line><span class=cl>journalctl -u nginx -f      <span class=c1># 实时跟踪服务日志</span>
</span></span><span class=line><span class=cl>journalctl -u nginx --since <span class=s2>&#34;10 minutes ago&#34;</span>  <span class=c1># 最近10分钟日志</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=journalctl---systemd日志><code>journalctl</code> - systemd日志</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>journalctl -f          <span class=c1># 实时跟踪</span>
</span></span><span class=line><span class=cl>journalctl -u nginx    <span class=c1># 指定服务</span>
</span></span><span class=line><span class=cl>journalctl -k          <span class=c1># 内核日志</span>
</span></span><span class=line><span class=cl>journalctl --since <span class=s2>&#34;2024-01-01&#34;</span> --until <span class=s2>&#34;2024-01-02&#34;</span>  <span class=c1># 时间范围</span>
</span></span><span class=line><span class=cl>journalctl -p err      <span class=c1># 只显示错误</span>
</span></span><span class=line><span class=cl>journalctl -n <span class=m>100</span>      <span class=c1># 最后100行</span>
</span></span><span class=line><span class=cl>journalctl --disk-usage  <span class=c1># 查看日志占用空间</span>
</span></span><span class=line><span class=cl>journalctl --vacuum-size<span class=o>=</span>100M  <span class=c1># 清理日志到100M</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=72-sysvinit传统系统>7.2 SysVinit（传统系统）</h3><h4 id=service---服务控制><code>service</code> - 服务控制</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>service nginx start
</span></span><span class=line><span class=cl>service nginx stop
</span></span><span class=line><span class=cl>service nginx restart
</span></span><span class=line><span class=cl>service nginx reload
</span></span><span class=line><span class=cl>service nginx status
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 已废弃，推荐systemctl</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=chkconfig---开机自启管理><code>chkconfig</code> - 开机自启管理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chkconfig --list     <span class=c1># 列出所有服务</span>
</span></span><span class=line><span class=cl>chkconfig nginx on   <span class=c1># 开机自启</span>
</span></span><span class=line><span class=cl>chkconfig nginx off  <span class=c1># 取消自启</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=73-定时任务>7.3 定时任务</h3><h4 id=crontab---计划任务><code>crontab</code> - 计划任务</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>crontab -e           <span class=c1># 编辑当前用户的crontab</span>
</span></span><span class=line><span class=cl>crontab -l           <span class=c1># 列出</span>
</span></span><span class=line><span class=cl>crontab -r           <span class=c1># 删除</span>
</span></span><span class=line><span class=cl>crontab -u user -e   <span class=c1># 编辑指定用户的</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 格式：分 时 日 月 周 命令</span>
</span></span><span class=line><span class=cl><span class=c1># */5 * * * * /path/to/script.sh  # 每5分钟</span>
</span></span><span class=line><span class=cl><span class=c1># 0 2 * * * /path/to/backup.sh     # 每天2点</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=at---一次性任务><code>at</code> - 一次性任务</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>at 14:00 tomorrow    <span class=c1># 明天14点执行</span>
</span></span><span class=line><span class=cl>at&gt; /path/to/command
</span></span><span class=line><span class=cl>at&gt; Ctrl+D
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>atq                  <span class=c1># 查看队列</span>
</span></span><span class=line><span class=cl>atrm <span class=m>1</span>               <span class=c1># 删除任务1</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=八用户与权限管理>八、用户与权限管理</h2><h3 id=81-用户管理>8.1 用户管理</h3><h4 id=useradd---添加用户><code>useradd</code> - 添加用户</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>useradd -m -s /bin/bash -g users -G wheel newuser  <span class=c1># 创建用户</span>
</span></span><span class=line><span class=cl><span class=c1># -m 创建home目录  -s 指定shell  -g 主组  -G 附加组</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：批量创建用户</span>
</span></span><span class=line><span class=cl><span class=k>for</span> i in <span class=o>{</span>1..10<span class=o>}</span><span class=p>;</span> <span class=k>do</span> useradd -m user<span class=nv>$i</span><span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;user</span><span class=nv>$i</span><span class=s2>:password&#34;</span> <span class=p>|</span> chpasswd<span class=p>;</span> <span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=usermod---修改用户><code>usermod</code> - 修改用户</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>usermod -aG wheel newuser  <span class=c1># 追加到wheel组</span>
</span></span><span class=line><span class=cl>usermod -s /bin/zsh newuser  <span class=c1># 修改shell</span>
</span></span><span class=line><span class=cl>usermod -L newuser     <span class=c1># 锁定用户</span>
</span></span><span class=line><span class=cl>usermod -U newuser     <span class=c1># 解锁用户</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=userdel---删除用户><code>userdel</code> - 删除用户</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>userdel newuser        <span class=c1># 删除用户</span>
</span></span><span class=line><span class=cl>userdel -r newuser     <span class=c1># 同时删除home目录和邮件</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=passwd---修改密码><code>passwd</code> - 修改密码</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>passwd                 <span class=c1># 修改当前用户密码</span>
</span></span><span class=line><span class=cl>passwd newuser         <span class=c1># 修改指定用户密码</span>
</span></span><span class=line><span class=cl>passwd -l newuser      <span class=c1># 锁定用户</span>
</span></span><span class=line><span class=cl>passwd -u newuser      <span class=c1># 解锁用户</span>
</span></span><span class=line><span class=cl>passwd -e newuser      <span class=c1># 强制下次登录修改密码</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=su---切换用户><code>su</code> - 切换用户</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>su - username          <span class=c1># 完全切换（推荐）</span>
</span></span><span class=line><span class=cl>su username            <span class=c1># 不切换环境变量</span>
</span></span><span class=line><span class=cl>su -c <span class=s2>&#34;command&#34;</span> username  <span class=c1># 以某用户执行命令</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=sudo---提权执行><code>sudo</code> - 提权执行</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo <span class=nb>command</span>           <span class=c1># 以root执行</span>
</span></span><span class=line><span class=cl>sudo -u user <span class=nb>command</span>   <span class=c1># 以指定用户执行</span>
</span></span><span class=line><span class=cl>sudo -i                <span class=c1># 切换到root shell</span>
</span></span><span class=line><span class=cl>sudo -l                <span class=c1># 列出当前用户可执行命令</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产配置：/etc/sudoers</span>
</span></span><span class=line><span class=cl><span class=c1># visudo 安全编辑</span>
</span></span><span class=line><span class=cl><span class=c1># user ALL=(ALL) NOPASSWD:ALL  # 免密码sudo（谨慎）</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=82-组管理>8.2 组管理</h3><h4 id=groupadd---添加组><code>groupadd</code> - 添加组</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groupadd developers    <span class=c1># 创建组</span>
</span></span><span class=line><span class=cl>groupadd -g <span class=m>1000</span> dev   <span class=c1># 指定GID</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=groupmod---修改组><code>groupmod</code> - 修改组</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groupmod -n newname oldname  <span class=c1># 重命名</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=groupdel---删除组><code>groupdel</code> - 删除组</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groupdel developers    <span class=c1># 删除组（不能有用户为主组）</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=83-权限管理>8.3 权限管理</h3><h4 id=chmod---修改权限><code>chmod</code> - 修改权限</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod <span class=m>755</span> file         <span class=c1># rwxr-xr-x</span>
</span></span><span class=line><span class=cl>chmod u+x file         <span class=c1># 用户添加执行权限</span>
</span></span><span class=line><span class=cl>chmod g-w file         <span class=c1># 组移除写权限</span>
</span></span><span class=line><span class=cl>chmod <span class=nv>o</span><span class=o>=</span>r-- file       <span class=c1># 其他用户只读</span>
</span></span><span class=line><span class=cl>chmod -R <span class=m>755</span> dir       <span class=c1># 递归修改</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数字权限：r=4 w=2 x=1</span>
</span></span><span class=line><span class=cl><span class=c1># 755 = 7(rwx) 5(r-x) 5(r-x)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=chown---修改所有者><code>chown</code> - 修改所有者</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chown user:group file  <span class=c1># 同时修改用户和组</span>
</span></span><span class=line><span class=cl>chown user file        <span class=c1># 只修改用户</span>
</span></span><span class=line><span class=cl>chown :group file      <span class=c1># 只修改组</span>
</span></span><span class=line><span class=cl>chown -R user:group dir  <span class=c1># 递归修改</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产技巧：批量修改</span>
</span></span><span class=line><span class=cl>chown -R www-data:www-data /var/www/html
</span></span></code></pre></td></tr></table></div></div><h4 id=chgrp---修改组><code>chgrp</code> - 修改组</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chgrp group file       <span class=c1># 修改文件组</span>
</span></span><span class=line><span class=cl>chgrp -R group dir     <span class=c1># 递归修改</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=umask---默认权限掩码><code>umask</code> - 默认权限掩码</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>umask</span>                  <span class=c1># 查看当前掩码</span>
</span></span><span class=line><span class=cl><span class=nb>umask</span> <span class=m>022</span>              <span class=c1># 设置掩码</span>
</span></span><span class=line><span class=cl><span class=c1># 默认文件权限：666-umask</span>
</span></span><span class=line><span class=cl><span class=c1># 默认目录权限：777-umask</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=84-高级权限>8.4 高级权限</h3><h4 id=setuidsetgidsticky-bit><code>setuid</code>/<code>setgid</code>/<code>sticky bit</code></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod u+s file         <span class=c1># setuid (4) 以文件所有者权限执行</span>
</span></span><span class=line><span class=cl>chmod g+s dir          <span class=c1># setgid (2) 新建文件继承目录组</span>
</span></span><span class=line><span class=cl>chmod +t dir           <span class=c1># sticky bit (1) 用户只能删除自己的文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数字表示：chmod 4755 file (setuid)</span>
</span></span><span class=line><span class=cl><span class=c1>#          chmod 2755 dir  (setgid)</span>
</span></span><span class=line><span class=cl><span class=c1>#          chmod 1777 dir  (sticky)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=acl---访问控制列表><code>ACL</code> - 访问控制列表</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>setfacl -m u:user:rwx file  <span class=c1># 给用户添加权限</span>
</span></span><span class=line><span class=cl>setfacl -m g:group:r-x file <span class=c1># 给组添加权限</span>
</span></span><span class=line><span class=cl>setfacl -x u:user file      <span class=c1># 删除用户ACL</span>
</span></span><span class=line><span class=cl>setfacl -b file             <span class=c1># 清除所有ACL</span>
</span></span><span class=line><span class=cl>getfacl file                <span class=c1># 查看ACL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产场景：多用户共享目录</span>
</span></span><span class=line><span class=cl>setfacl -R -m u:user1:rwx,u:user2:rwx /shared
</span></span><span class=line><span class=cl>setfacl -R -d -m u:user1:rwx,u:user2:rwx /shared  <span class=c1># 默认ACL</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=九压缩与备份>九、压缩与备份</h2><h3 id=91-压缩工具>9.1 压缩工具</h3><h4 id=tar---归档运维必备><code>tar</code> - 归档（运维必备）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tar -czf archive.tar.gz /path  <span class=c1># 压缩（c创建，z gzip，f文件）</span>
</span></span><span class=line><span class=cl>tar -xzf archive.tar.gz        <span class=c1># 解压（x解压）</span>
</span></span><span class=line><span class=cl>tar -tzf archive.tar.gz        <span class=c1># 查看内容（t列表）</span>
</span></span><span class=line><span class=cl>tar -czf - /path <span class=p>|</span> ssh user@host <span class=s2>&#34;tar -xzf - -C /dest&#34;</span>  <span class=c1># 远程压缩传输</span>
</span></span><span class=line><span class=cl>tar --exclude<span class=o>=</span><span class=s1>&#39;*.log&#39;</span> -czf archive.tar.gz /path  <span class=c1># 排除文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 参数：</span>
</span></span><span class=line><span class=cl><span class=c1># c: 创建  x: 解压  t: 查看</span>
</span></span><span class=line><span class=cl><span class=c1># z: gzip  j: bzip2  J: xz</span>
</span></span><span class=line><span class=cl><span class=c1># v: 显示过程  f: 指定文件</span>
</span></span><span class=line><span class=cl><span class=c1># C: 切换到目录</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=gzipgunzip><code>gzip</code>/<code>gunzip</code></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gzip file              <span class=c1># 压缩为file.gz</span>
</span></span><span class=line><span class=cl>gzip -9 file           <span class=c1># 最高压缩率（1-9）</span>
</span></span><span class=line><span class=cl>gzip -d file.gz        <span class=c1># 解压</span>
</span></span><span class=line><span class=cl>gunzip file.gz         <span class=c1># 解压</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=zipunzip><code>zip</code>/<code>unzip</code></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>zip -r archive.zip dir  <span class=c1># 压缩目录</span>
</span></span><span class=line><span class=cl>unzip archive.zip      <span class=c1># 解压</span>
</span></span><span class=line><span class=cl>unzip -l archive.zip   <span class=c1># 查看内容</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=rsync---同步与备份运维神器><code>rsync</code> - 同步与备份（运维神器）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rsync -avz /src/ /dst/  <span class=c1># 同步目录（a归档，v详细，z压缩）</span>
</span></span><span class=line><span class=cl>rsync -avz /src/ user@host:/dst/  <span class=c1># 远程同步</span>
</span></span><span class=line><span class=cl>rsync -avz --delete /src/ /dst/  <span class=c1># 删除目标端多余文件</span>
</span></span><span class=line><span class=cl>rsync -avz --exclude<span class=o>=</span><span class=s1>&#39;*.log&#39;</span> /src/ /dst/  <span class=c1># 排除</span>
</span></span><span class=line><span class=cl>rsync -avz --bwlimit<span class=o>=</span><span class=m>10240</span> /src/ /dst/  <span class=c1># 限速10MB/s</span>
</span></span><span class=line><span class=cl>rsync -avz --partial --progress /src/ /dst/  <span class=c1># 断点续传</span>
</span></span><span class=line><span class=cl>rsync -avzh --link-dest<span class=o>=</span>/latest /src/ /dst/<span class=sb>`</span>date +%Y%m%d<span class=sb>`</span>/  <span class=c1># 硬链接增量备份</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产案例：每日备份脚本</span>
</span></span><span class=line><span class=cl>rsync -avz --delete /data/ /backup/<span class=sb>`</span>date +%Y%m%d<span class=sb>`</span>/
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=92-备份策略>9.2 备份策略</h3><h4 id=dd---磁盘克隆><code>dd</code> - 磁盘克隆</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dd <span class=k>if</span><span class=o>=</span>/dev/sda <span class=nv>of</span><span class=o>=</span>/dev/sdb <span class=nv>bs</span><span class=o>=</span>4M  <span class=c1># 磁盘对拷</span>
</span></span><span class=line><span class=cl>dd <span class=k>if</span><span class=o>=</span>/dev/sda <span class=nv>of</span><span class=o>=</span>disk.img        <span class=c1># 创建镜像</span>
</span></span><span class=line><span class=cl>dd <span class=k>if</span><span class=o>=</span>disk.img <span class=nv>of</span><span class=o>=</span>/dev/sda        <span class=c1># 恢复镜像</span>
</span></span><span class=line><span class=cl>dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/swapfile <span class=nv>bs</span><span class=o>=</span>1M <span class=nv>count</span><span class=o>=</span><span class=m>4096</span>  <span class=c1># 创建swap文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产警告：dd是危险命令，if/of参数务必确认</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cpio---归档><code>cpio</code> - 归档</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>find /path <span class=p>|</span> cpio -o &gt; archive.cpio  <span class=c1># 创建</span>
</span></span><span class=line><span class=cl>cpio -i &lt; archive.cpio               <span class=c1># 解压</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十系统信息与管理>十、系统信息与管理</h2><h3 id=101-系统信息>10.1 系统信息</h3><h4 id=uname---内核信息><code>uname</code> - 内核信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>uname -a             <span class=c1># 显示所有信息</span>
</span></span><span class=line><span class=cl>uname -r             <span class=c1># 内核版本</span>
</span></span><span class=line><span class=cl>uname -m             <span class=c1># 架构</span>
</span></span><span class=line><span class=cl>uname -n             <span class=c1># 主机名</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=hostnamectl---主机名管理><code>hostnamectl</code> - 主机名管理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hostnamectl           <span class=c1># 显示主机信息</span>
</span></span><span class=line><span class=cl>hostnamectl set-hostname newname  <span class=c1># 修改主机名</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=uptime---运行时间与负载><code>uptime</code> - 运行时间与负载</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.5节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=whow---登录用户><code>who</code>/<code>w</code> - 登录用户</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>who                   <span class=c1># 显示登录用户</span>
</span></span><span class=line><span class=cl>w                     <span class=c1># 显示登录用户及正在执行的命令</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=last---登录历史><code>last</code> - 登录历史</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.5节</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=102-硬件信息>10.2 硬件信息</h3><h4 id=lspci---pci设备><code>lspci</code> - PCI设备</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lspci                 <span class=c1># 显示所有PCI设备</span>
</span></span><span class=line><span class=cl>lspci -v              <span class=c1># 详细信息</span>
</span></span><span class=line><span class=cl>lspci <span class=p>|</span> grep -i vga   <span class=c1># 查找显卡</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lsusb---usb设备><code>lsusb</code> - USB设备</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsusb                 <span class=c1># 显示USB设备</span>
</span></span><span class=line><span class=cl>lsusb -t              <span class=c1># 树状显示</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lscpu---cpu信息><code>lscpu</code> - CPU信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lscpu                 <span class=c1># 显示CPU架构信息</span>
</span></span><span class=line><span class=cl>lscpu <span class=p>|</span> grep <span class=s2>&#34;CPU(s)&#34;</span> <span class=c1># 核心数</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=dmidecode---硬件dmi信息><code>dmidecode</code> - 硬件DMI信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dmidecode             <span class=c1># 显示所有硬件信息</span>
</span></span><span class=line><span class=cl>dmidecode -t memory   <span class=c1># 显示内存信息</span>
</span></span><span class=line><span class=cl>dmidecode -t system   <span class=c1># 显示系统信息</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=hdparm---磁盘信息><code>hdparm</code> - 磁盘信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hdparm -I /dev/sda    <span class=c1># 显示磁盘详细信息</span>
</span></span><span class=line><span class=cl>hdparm -tT /dev/sda   <span class=c1># 测试磁盘性能</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=103-内核与模块>10.3 内核与模块</h3><h4 id=lsmod---加载的模块><code>lsmod</code> - 加载的模块</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsmod                 <span class=c1># 显示已加载内核模块</span>
</span></span><span class=line><span class=cl>lsmod <span class=p>|</span> grep kvm      <span class=c1># 查找特定模块</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=modinfo---模块信息><code>modinfo</code> - 模块信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>modinfo kvm            <span class=c1># 显示模块详细信息</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=modprobe---加载卸载模块><code>modprobe</code> - 加载/卸载模块</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>modprobe kvm           <span class=c1># 加载模块</span>
</span></span><span class=line><span class=cl>modprobe -r kvm        <span class=c1># 卸载模块</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=insmodrmmod---加载卸载模块><code>insmod</code>/<code>rmmod</code> - 加载/卸载模块</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>insmod /path/to/module.ko
</span></span><span class=line><span class=cl>rmmod kvm
</span></span></code></pre></td></tr></table></div></div><h4 id=sysctl---内核参数><code>sysctl</code> - 内核参数</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sysctl -a              <span class=c1># 显示所有参数</span>
</span></span><span class=line><span class=cl>sysctl -p              <span class=c1># 加载/etc/sysctl.conf</span>
</span></span><span class=line><span class=cl>sysctl -w vm.swappiness<span class=o>=</span><span class=m>10</span>  <span class=c1># 临时修改</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;vm.swappiness=10&#34;</span> &gt;&gt; /etc/sysctl.conf <span class=o>&amp;&amp;</span> sysctl -p  <span class=c1># 永久修改</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十一性能调优专家级>十一、性能调优（专家级）</h2><h3 id=111-cpu调优>11.1 CPU调优</h3><h4 id=cpu亲和性>CPU亲和性</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见10.1节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=中断均衡>中断均衡</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /proc/interrupts   <span class=c1># 查看中断分布</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>2</span> &gt; /proc/irq/24/smp_affinity  <span class=c1># 将中断绑定到CPU2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自动均衡：irqbalance服务</span>
</span></span><span class=line><span class=cl>systemctl status irqbalance
</span></span></code></pre></td></tr></table></div></div><h4 id=调节器>调节器</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor  <span class=c1># 查看当前调节器</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> performance &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor  <span class=c1># 性能模式</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> powersave &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor   <span class=c1># 节能模式</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 可用调节器：performance powersave ondemand conservative</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=112-内存调优>11.2 内存调优</h3><h4 id=swappiness>swappiness</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见2.2节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=透明大页>透明大页</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /sys/kernel/mm/transparent_hugepage/enabled  <span class=c1># 查看状态</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled  <span class=c1># 禁用（数据库推荐）</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=内存压缩>内存压缩</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /proc/sys/vm/drop_caches  <span class=c1># 释放缓存</span>
</span></span><span class=line><span class=cl><span class=c1># echo 1 &gt; /proc/sys/vm/drop_caches  # 释放pagecache</span>
</span></span><span class=line><span class=cl><span class=c1># echo 2 &gt; /proc/sys/vm/drop_caches  # 释放dentries和inodes</span>
</span></span><span class=line><span class=cl><span class=c1># echo 3 &gt; /proc/sys/vm/drop_caches  # 释放所有缓存（生产环境慎用）</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=113-磁盘调优>11.3 磁盘调优</h3><h4 id=io调度器>IO调度器</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /sys/block/sda/queue/scheduler  <span class=c1># 查看当前调度器</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> deadline &gt; /sys/block/sda/queue/scheduler  <span class=c1># 修改为deadline</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 调度器选择：</span>
</span></span><span class=line><span class=cl><span class=c1># noop: SSD/闪存</span>
</span></span><span class=line><span class=cl><span class=c1># deadline: 数据库（保证延迟）</span>
</span></span><span class=line><span class=cl><span class=c1># cfq: 桌面/通用</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=文件系统调优>文件系统调优</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ext4挂载选项</span>
</span></span><span class=line><span class=cl>/dev/sdb1 /data ext4 defaults,noatime,nodiratime <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># XFS调优</span>
</span></span><span class=line><span class=cl>xfs_info /dev/sda1   <span class=c1># 查看XFS信息</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=114-网络调优>11.4 网络调优</h3><h4 id=tcp参数>TCP参数</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详见10.1节</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=文件描述符限制>文件描述符限制</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>ulimit</span> -n            <span class=c1># 查看当前限制</span>
</span></span><span class=line><span class=cl><span class=nb>ulimit</span> -n <span class=m>65535</span>      <span class=c1># 临时修改</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 永久修改：/etc/security/limits.conf</span>
</span></span><span class=line><span class=cl>* soft nofile <span class=m>65535</span>
</span></span><span class=line><span class=cl>* hard nofile <span class=m>65535</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=端口范围>端口范围</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /proc/sys/net/ipv4/ip_local_port_range  <span class=c1># 查看端口范围</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;1024 65535&#34;</span> &gt; /proc/sys/net/ipv4/ip_local_port_range  <span class=c1># 扩大范围</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十二安全与审计>十二、安全与审计</h2><h3 id=121-文件完整性>12.1 文件完整性</h3><h4 id=md5sumsha256sum---校验和><code>md5sum</code>/<code>sha256sum</code> - 校验和</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>md5sum file          <span class=c1># 计算MD5</span>
</span></span><span class=line><span class=cl>sha256sum file       <span class=c1># 计算SHA256</span>
</span></span><span class=line><span class=cl>md5sum -c file.md5   <span class=c1># 校验文件</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=chattrlsattr---扩展属性><code>chattr</code>/<code>lsattr</code> - 扩展属性</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chattr +i file       <span class=c1># 设置不可变（无法修改删除）</span>
</span></span><span class=line><span class=cl>chattr -i file       <span class=c1># 取消不可变</span>
</span></span><span class=line><span class=cl>chattr +a file       <span class=c1># 只允许追加</span>
</span></span><span class=line><span class=cl>lsattr file          <span class=c1># 查看扩展属性</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产应用：保护关键配置文件</span>
</span></span><span class=line><span class=cl>chattr +i /etc/passwd /etc/shadow
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=122-安全工具>12.2 安全工具</h3><h4 id=iptables---防火墙传统><code>iptables</code> - 防火墙（传统）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>iptables -L -n       <span class=c1># 查看规则</span>
</span></span><span class=line><span class=cl>iptables -A INPUT -p tcp --dport <span class=m>22</span> -j ACCEPT  <span class=c1># 放行SSH</span>
</span></span><span class=line><span class=cl>iptables -A INPUT -p tcp --dport <span class=m>80</span> -j ACCEPT  <span class=c1># 放行HTTP</span>
</span></span><span class=line><span class=cl>iptables -A INPUT -j DROP  <span class=c1># 默认拒绝（注意顺序）</span>
</span></span><span class=line><span class=cl>service iptables save  <span class=c1># 保存规则</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生产脚本：配置基础防火墙</span>
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>iptables -F
</span></span><span class=line><span class=cl>iptables -A INPUT -i lo -j ACCEPT
</span></span><span class=line><span class=cl>iptables -A INPUT -p tcp --dport <span class=m>22</span> -j ACCEPT
</span></span><span class=line><span class=cl>iptables -A INPUT -p tcp --dport <span class=m>80</span> -j ACCEPT
</span></span><span class=line><span class=cl>iptables -A INPUT -p tcp --dport <span class=m>443</span> -j ACCEPT
</span></span><span class=line><span class=cl>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
</span></span><span class=line><span class=cl>iptables -P INPUT DROP
</span></span></code></pre></td></tr></table></div></div><h4 id=firewalld---动态防火墙><code>firewalld</code> - 动态防火墙</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --state   <span class=c1># 查看状态</span>
</span></span><span class=line><span class=cl>firewall-cmd --list-all  <span class=c1># 查看所有规则</span>
</span></span><span class=line><span class=cl>firewall-cmd --add-port<span class=o>=</span>8080/tcp --permanent  <span class=c1># 永久添加端口</span>
</span></span><span class=line><span class=cl>firewall-cmd --reload  <span class=c1># 重载规则</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ufw---ubuntu防火墙><code>ufw</code> - Ubuntu防火墙</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ufw status           <span class=c1># 查看状态</span>
</span></span><span class=line><span class=cl>ufw allow 22/tcp     <span class=c1># 放行SSH</span>
</span></span><span class=line><span class=cl>ufw <span class=nb>enable</span>           <span class=c1># 启用防火墙</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=123-审计>12.3 审计</h3><h4 id=lastlog---最后登录><code>lastlog</code> - 最后登录</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lastlog               <span class=c1># 显示所有用户最后登录</span>
</span></span><span class=line><span class=cl>lastlog -u username   <span class=c1># 指定用户</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lastb---失败登录><code>lastb</code> - 失败登录</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lastb                 <span class=c1># 查看失败登录尝试</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ausearch---selinux审计><code>ausearch</code> - SELinux审计</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ausearch -m avc -ts today  <span class=c1># 查看今天SELinux拒绝</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十三自动化运维脚本模板>十三、自动化运维脚本模板</h2><h3 id=131-系统巡检脚本>13.1 系统巡检脚本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># 系统健康检查脚本</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LOGFILE</span><span class=o>=</span><span class=s2>&#34;/var/log/system_check_</span><span class=k>$(</span>date +%Y%m%d<span class=k>)</span><span class=s2>.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span> &gt; <span class=nv>$LOGFILE</span> 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;===== System Check </span><span class=k>$(</span>date<span class=k>)</span><span class=s2> =====&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CPU检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- CPU Check ---&#34;</span>
</span></span><span class=line><span class=cl>top -bn1 <span class=p>|</span> grep <span class=s2>&#34;Cpu(s)&#34;</span>
</span></span><span class=line><span class=cl>mpstat -P ALL <span class=m>1</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 内存检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Memory Check ---&#34;</span>
</span></span><span class=line><span class=cl>free -h
</span></span><span class=line><span class=cl>vmstat -s <span class=p>|</span> grep -E <span class=s2>&#34;swapped|used memory&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 磁盘检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Disk Check ---&#34;</span>
</span></span><span class=line><span class=cl>df -h
</span></span><span class=line><span class=cl>df -i
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IO检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- IO Check ---&#34;</span>
</span></span><span class=line><span class=cl>iostat -x <span class=m>1</span> <span class=m>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 网络检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Network Check ---&#34;</span>
</span></span><span class=line><span class=cl>ss -s
</span></span><span class=line><span class=cl>netstat -i
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 负载检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Load Check ---&#34;</span>
</span></span><span class=line><span class=cl>uptime
</span></span><span class=line><span class=cl>cat /proc/loadavg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 服务检查</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;--- Service Check ---&#34;</span>
</span></span><span class=line><span class=cl>systemctl list-units --type<span class=o>=</span>service --state<span class=o>=</span>failed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;===== Check Complete </span><span class=k>$(</span>date<span class=k>)</span><span class=s2> =====&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=132-日志分析脚本>13.2 日志分析脚本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># Nginx日志分析脚本</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LOGFILE</span><span class=o>=</span><span class=s2>&#34;/var/log/nginx/access.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>REPORT</span><span class=o>=</span><span class=s2>&#34;/tmp/nginx_report_</span><span class=k>$(</span>date +%Y%m%d<span class=k>)</span><span class=s2>.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Top 10 IP</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Top 10 IP:&#34;</span> &gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $1}&#39;</span> <span class=nv>$LOGFILE</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10 &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Top 10 URL</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\nTop 10 URL:&#34;</span> &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $7}&#39;</span> <span class=nv>$LOGFILE</span> <span class=p>|</span> grep -v <span class=s1>&#39;^$&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -10 &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 状态码统计</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\nStatus Code:&#34;</span> &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $9}&#39;</span> <span class=nv>$LOGFILE</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 响应时间分析（假设日志格式包含$request_time）</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\nResponse Time:&#34;</span> &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>awk <span class=s1>&#39;{print $NF}&#39;</span> <span class=nv>$LOGFILE</span> <span class=p>|</span> awk <span class=s1>&#39;{sum+=$1; count++} END {print &#34;Avg: &#34; sum/count}&#39;</span> &gt;&gt; <span class=nv>$REPORT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mail -s <span class=s2>&#34;Nginx Daily Report&#34;</span> admin@example.com &lt; <span class=nv>$REPORT</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=133-自动扩容脚本>13.3 自动扩容脚本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># 磁盘空间监控与扩容（LVM）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>THRESHOLD</span><span class=o>=</span><span class=m>85</span>
</span></span><span class=line><span class=cl><span class=nv>VG_NAME</span><span class=o>=</span><span class=s2>&#34;vg_data&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LV_NAME</span><span class=o>=</span><span class=s2>&#34;lv_home&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>MOUNT_POINT</span><span class=o>=</span><span class=s2>&#34;/home&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>CURRENT</span><span class=o>=</span><span class=k>$(</span>df -h <span class=nv>$MOUNT_POINT</span> <span class=p>|</span> awk <span class=s1>&#39;NR==2 {print $5}&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/%//&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$CURRENT</span> -gt <span class=nv>$THRESHOLD</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=c1># 检查是否有可用空间</span>
</span></span><span class=line><span class=cl>    <span class=nv>FREE</span><span class=o>=</span><span class=k>$(</span>vgs --noheadings -o vg_free <span class=nv>$VG_NAME</span> <span class=p>|</span> sed <span class=s1>&#39;s/ //g&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$FREE</span><span class=s2>&#34;</span> !<span class=o>=</span> <span class=s2>&#34;0&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=c1># 扩展逻辑卷（增加10G）</span>
</span></span><span class=line><span class=cl>        lvextend -L +10G /dev/<span class=nv>$VG_NAME</span>/<span class=nv>$LV_NAME</span>
</span></span><span class=line><span class=cl>        <span class=c1># 扩展文件系统</span>
</span></span><span class=line><span class=cl>        resize2fs /dev/<span class=nv>$VG_NAME</span>/<span class=nv>$LV_NAME</span>  <span class=c1># ext4</span>
</span></span><span class=line><span class=cl>        <span class=c1># xfs_growfs $MOUNT_POINT  # xfs</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Expanded </span><span class=nv>$LV_NAME</span><span class=s2> by 10G&#34;</span> <span class=p>|</span> mail -s <span class=s2>&#34;Disk Alert&#34;</span> admin@example.com
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;No free space in VG&#34;</span> <span class=p>|</span> mail -s <span class=s2>&#34;URGENT Disk Alert&#34;</span> admin@example.com
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十四生产环境故障排查案例>十四、生产环境故障排查案例</h2><h3 id=案例1cpu-100但找不到进程>案例1：CPU 100%但找不到进程</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 检查系统负载</span>
</span></span><span class=line><span class=cl>uptime
</span></span><span class=line><span class=cl><span class=c1># 2. 查看CPU等待IO情况</span>
</span></span><span class=line><span class=cl>top
</span></span><span class=line><span class=cl><span class=c1># 发现wa很高（94%）</span>
</span></span><span class=line><span class=cl><span class=c1># 3. 定位IO瓶颈进程</span>
</span></span><span class=line><span class=cl>iotop -oP
</span></span><span class=line><span class=cl><span class=c1># 发现是rsync备份进程</span>
</span></span><span class=line><span class=cl><span class=c1># 4. 限制带宽</span>
</span></span><span class=line><span class=cl>killall rsync
</span></span><span class=line><span class=cl>nohup rsync -avz --bwlimit<span class=o>=</span><span class=m>10240</span> /src/ /dst/ <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解决：将备份任务调整到凌晨2点执行</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=案例2内存泄漏排查>案例2：内存泄漏排查</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># 内存泄漏检测脚本</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>PID</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nv>INTERVAL</span><span class=o>=</span><span class=m>60</span>
</span></span><span class=line><span class=cl><span class=nv>LOG</span><span class=o>=</span><span class=s2>&#34;mem_leak_</span><span class=si>${</span><span class=nv>PID</span><span class=si>}</span><span class=s2>.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Monitoring PID </span><span class=nv>$PID</span><span class=s2> every </span><span class=nv>$INTERVAL</span><span class=s2> seconds...&#34;</span> &gt; <span class=nv>$LOG</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;=== </span><span class=k>$(</span>date<span class=k>)</span><span class=s2> ===&#34;</span> &gt;&gt; <span class=nv>$LOG</span>
</span></span><span class=line><span class=cl>    pmap -x <span class=nv>$PID</span> <span class=p>|</span> tail -1 &gt;&gt; <span class=nv>$LOG</span>
</span></span><span class=line><span class=cl>    ps -p <span class=nv>$PID</span> -o pid,rss,vsz,cmd &gt;&gt; <span class=nv>$LOG</span>
</span></span><span class=line><span class=cl>    sleep <span class=nv>$INTERVAL</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析：观察RSS列是否持续增长</span>
</span></span><span class=line><span class=cl><span class=c1># 配合jmap分析Java堆：jmap -histo:live &lt;PID&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=案例3网络连接数暴增>案例3：网络连接数暴增</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 查看连接数</span>
</span></span><span class=line><span class=cl>ss -s
</span></span><span class=line><span class=cl><span class=c1># 2. 查看TIME_WAIT</span>
</span></span><span class=line><span class=cl>ss -tan <span class=p>|</span> grep TIME_WAIT <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl><span class=c1># 3. 查看ESTABLISHED</span>
</span></span><span class=line><span class=cl>ss -tan <span class=p>|</span> grep ESTABLISHED <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl><span class=c1># 4. 查找异常IP</span>
</span></span><span class=line><span class=cl>netstat -anp <span class=p>|</span> grep ESTABLISHED <span class=p>|</span> awk <span class=s1>&#39;{print $5}&#39;</span> <span class=p>|</span> cut -d: -f1 <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解决：调整TCP参数</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;net.ipv4.tcp_tw_reuse = 1&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;net.ipv4.tcp_max_tw_buckets = 5000&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl>sysctl -p
</span></span></code></pre></td></tr></table></div></div><h3 id=案例4磁盘空间异常>案例4：磁盘空间异常</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 查看磁盘使用</span>
</span></span><span class=line><span class=cl>df -h
</span></span><span class=line><span class=cl><span class=c1># 发现/分区100%</span>
</span></span><span class=line><span class=cl><span class=c1># 2. 查找大文件</span>
</span></span><span class=line><span class=cl>du -h --max-depth<span class=o>=</span><span class=m>1</span> / <span class=p>|</span> sort -hr <span class=p>|</span> head -10
</span></span><span class=line><span class=cl><span class=c1># 3. 检查已删除但仍在占用的文件</span>
</span></span><span class=line><span class=cl>lsof <span class=p>|</span> grep deleted
</span></span><span class=line><span class=cl><span class=c1># 发现日志文件被删除但进程未释放</span>
</span></span><span class=line><span class=cl><span class=c1># 4. 释放空间</span>
</span></span><span class=line><span class=cl>&gt; /proc/&lt;PID&gt;/fd/&lt;FD&gt;
</span></span><span class=line><span class=cl><span class=c1># 或者重启进程</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=十五运维最佳实践总结>十五、运维最佳实践总结</h2><h3 id=151-生产环境黄金法则>15.1 生产环境黄金法则</h3><ol><li><strong>备份先行</strong>：任何操作前备份配置文件和数据</li><li><strong>测试验证</strong>：先在测试环境验证，再应用到生产</li><li><strong>灰度发布</strong>：分批重启服务，避免全量操作</li><li><strong>监控告警</strong>：所有操作都要监控，设置告警</li><li><strong>文档记录</strong>：所有变更必须记录</li></ol><h3 id=152-命令使用原则>15.2 命令使用原则</h3><ol><li><strong>rm</strong>：使用<code>rm -i</code>别名，高危操作先<code>ls</code>确认</li><li><strong>dd</strong>：操作磁盘前再三确认<code>if=</code>和<code>of=</code></li><li><strong>vim</strong>：编辑配置文件前先备份</li><li><strong>systemctl</strong>：重启服务前检查配置语法</li><li><strong>iptables</strong>：修改防火墙前保存当前规则</li></ol><h3 id=153-性能优化-checklist>15.3 性能优化 checklist</h3><ul><li><input disabled type=checkbox> CPU：检查亲和性、中断均衡、调度器</li><li><input disabled type=checkbox> 内存：检查swappiness、泄漏、缓存</li><li><input disabled type=checkbox> 磁盘：检查IO调度器、使用率、inode</li><li><input disabled type=checkbox> 网络：检查连接数、TCP参数、带宽</li><li><input disabled type=checkbox> 服务：检查资源限制、日志级别、健康检查</li></ul><h3 id=154-推荐工具组合>15.4 推荐工具组合</h3><ul><li><strong>监控</strong>：Prometheus + Grafana + Alertmanager</li><li><strong>日志</strong>：ELK (Elasticsearch + Logstash + Kibana)</li><li><strong>自动化</strong>：Ansible + Jenkins/GitLab CI</li><li><strong>追踪</strong>：SkyWalking / Jaeger</li><li><strong>CMDB</strong>：NetBox / CMDBuild</li></ul><hr></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/blockchain/kali/><div class=article-details><h2 class=article-title>Kali</h2></div></a></article><article><a href=/k8s/kubernetes-k8s-/><div class=article-details><h2 class=article-title>Kubernetes</h2></div></a></article><article><a href=/k8s/kubernetes%E7%94%9F%E4%BA%A7%E7%BA%A7%E5%AE%8C%E6%95%B4%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/><div class=article-details><h2 class=article-title>Kubernetes 生产级完整实战指南</h2></div></a></article><article><a href=/k8s/pod%E6%8E%92%E6%9F%A5%E6%89%8B%E5%86%8C/><div class=article-details><h2 class=article-title>Kubernetes Pod</h2></div></a></article><article><a href=/blockchain/linux%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/><div class=article-details><h2 class=article-title>linux日志分析</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>