<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="ARP欺骗原理：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ARP 地址解析协议，的作用是将IP地址解析为物理硬件地址（MAC地址） 在局域网中，设备之间通信依赖的是MAC地址。ARP协议色痕迹之初出于对局域网内设备的完全信任，存在两个巨大的安全隐患，这也是ARP欺骗的根源： 1、无状态性：设备收到ARP应答（Reply)时，不会验证自己是否发送过ARP请求（Request) 2、后到优先：设备会接受最新的ARP应答，并覆盖ARP缓存表中旧的记录 统计流程解析： 假如网络环境如下： ·网关（Gateway):IP:192.168.200.1 , MAC AA:AA:AA:AA:AA:AA ·受害者（Victim):IP 192.168.200.2 , MAC BB:BB:BB:BB:BB:BB ·攻击者（You/Kali）：IP 192.168.200.4，MAC CC:CC:CC:CC:CC:CC 攻击者如何欺骗网关？攻击者会不断向网关发送伪造的ARP应答包，内容宣称：“我是受害者IP192.168.200.2，我的MAC地址是CC:CC:CC:CC:CC:CC （攻击者MAC）” 网关收到后，会更新自己的ARP缓存表，当网关要想把数据包发给受害者（192.168.200.2）时，他查看缓存ibao，发现对应的MAC时攻击者的MAC，于是它会将数据包封装并发给攻击者 双向欺骗：为了实现完整的中间人攻击，攻击者通常会同时欺骗两边： 1、告诉网关：我是受害者 2、告诉受害者：我是网关 这样，双方通信流量都会将过攻击者的网卡 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 NAT模式：相当于在中间加了一个路由器，你发出的ARP广播包根本出不去，被挡在了虚拟网络里，所以你看不到外面的设备 NAT隔离：相当于你现在被关在“虚拟的小房间”里，而受害者在“房间外面的大厅”里 解决方案：必须切换到“桥接模式” (Bridged) 想要攻击手机热点下的其他设备，你必须让 Kali “走出小房间，直接连到热点上”。 操作步骤： #修改虚拟机设置： 在 VMware 菜单栏点击 虚拟机 (Virtual Machine) -> 设置 (Settings)。 点击左侧的 网络适配器 (Network Adapter)。 在右侧选择 桥接模式 (Bridged)。 关键一步：勾选“复制物理网络连接状态”（Replicate physical network connection state）。 点击确定。 #打开虚拟网络编辑器 (Virtual Network Editor) 在 Windows 下（不是 Kali 里），点击 VMware 软件左上角的 编辑 (Edit) -> 虚拟网络编辑器 (Virtual Network Editor)。 点击右下角的 更改设置 (Change Settings)（需要管理员权限）。 在列表中找到 VMnet0（它的类型应该是“桥接模式”）。 如果没有 VMnet0，就点击“添加网络”添加一个。 在下方的 已桥接至 (Bridged to) 下拉菜单中： 千万不要选“自动”！ 必须选择你截图里那个 Wi-Fi 网卡的名字：Qualcomm WCN685x Wi-Fi 6E...。 点击 确定 保存。 sudo systemctl restart NetworkManager 重启网络管理器服务 什么你觉得没变？ 因为你的网卡现在同时拥有两个 IP： 172.24.198.118（旧的，错误的） 172.20.10.5（新的，正确的） 这种情况会让网络工具“精神分裂”，它可能会继续默认使用上面那个错误的 IP 发包。我们需要手动帮它“清理门户”。 第一步：清理掉错误的 IP 为了防止干扰，我们手动把那个错误的 IP 删掉，只保留正确的。 在终端输入： sudo ip addr del 172.24.198.118/20 dev eth0 输完之后，再输入 ip a 确认一下，应该只剩下 172.20.10.5 了。 第二步：扫描受害者（关键时刻） 既然你现在的 IP 是 172.20.10.5，说明你已经成功混入了手机热点的网络。 注意：你的子网掩码是 /28（这是 iPhone 热点的特性，意味着它只允许 14 台设备连接，IP 范围很小）。 请运行这个精准的扫描命令： sudo netdiscover -r 172.20.10.0/24 (用 /24 也没关系，扫得更宽一点) 预期结果： 172.20.10.1：这是网关（你的手机）。 172.20.10.3：这是你截图里显示的受害者（如果它还连着的话）。 172.20.10.x：其他设备。 第三步：开始攻击演示 一旦扫描确认了受害者在线（比如看到了 172.20.10.3），就可以进行 ARP 欺骗了。 开启转发（别忘了）： echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 双向欺骗（两个窗口）： # 窗口 1：告诉受害者(.3) 我是网关(.1) arpspoof -i eth0 -t 172.20.10.3 172.20.10.1 # 窗口 2：告诉网关(.1) 我是受害者(.3) arpspoof -i eth0 -t 172.20.10.1 172.20.10.3 开始 ARP 欺骗 假设我们要攻击那台 Intel 的电脑 (172.20.10.4)，请按以下步骤操作。 第一步：开启路由转发（必做，否则对方会断网） 在 Kali 终端执行： echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 第二步：发动攻击（双向欺骗） 你需要打开两个终端窗口，分别执行以下命令： 窗口 1：欺骗受害者（告诉 .4 我是网关） sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 窗口 2：欺骗网关（告诉 .1 我是受害者） sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 (如果你想攻击自己的主机 .3，就把上面的 172.20.10.4 换成 172.20.10.3 即可) 第三步：验证效果 攻击开始后，你可以用 Wireshark 抓包，或者使用 driftnet 查看受害者正在浏览的图片： sudo driftnet -i eth0 #需要先让 Kali “认识”一下受害者，然后再攻击。 第一步：停止当前的攻击 在两个 arpspoof 的终端窗口中，都按 Ctrl + C 停止运行。 第二步：手动“激活”目标（关键） 在终端里输入以下命令，强行让 Kali 去寻找受害者： ping -c 4 172.20.10.4 确保你能看到 64 bytes from ... 的回显。这不仅证明它是通的，更重要的是，这会把受害者的 MAC 地址写入 Kali 的 ARP 缓存表。 第三步：检查 ARP 缓存 输入以下命令确认 Kali 已经获取到了 MAC： arp -a 你应该能看到类似 (172.20.10.4) at 08:b4:d2:55:49:89 ... 的记录。只要不是 (incomplete) 或者没有记录，就可以继续。 第四步：重新开始欺骗 现在重新运行那两条攻击命令： # 窗口 1 sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 # 窗口 2 sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 👀 观察变化： 这次再看 arpspoof 的输出，中间那个 MAC 地址应该变成真实的 08:b4:d2...，而不是 0:0:0:0:0:0 了。 第五步：验证 Wireshark 回到 Wireshark： 重新开始抓包。 让受害者随便打开一个网页（比如百度）。 你应该能看到 TCP 和 TLS 的数据包开始刷屏。这就说明你成功截获流量了！ 不需要纠结 Ping 不通的问题，直接开始攻击。因为 Kali 现在已经知道对方的 MAC 地址了，之前那个 0:0:0:0:0:0 的错误不会再出现了。 立刻运行攻击命令（两个窗口）： 窗口 1： sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 窗口 2： sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 这次你会发现，终端里刷出的日志里，MAC 地址会是正确的 08:b4:d2...，这就说明攻击已经生效了！ 💡 额外验证（如果你非要 Ping 通）： 如果你能操作那台受害者电脑（172.20.10.4），去把它的 Windows 防火墙 暂时关掉，或者在防火墙设置里允许 ICMP 回显，Ping 马上就通了。但这不影响你进行 ARP 欺骗实验 #使用 Wireshark（最专业，看所有流量） 如果你想看受害者具体在干什么（不仅仅是看图片），Wireshark 是最强大的工具，而且 Kali 默认自带。 在 Kali 左上角菜单搜索 Wireshark 并打开（或者终端输入 sudo wireshark）。 在欢迎界面双击 eth0 开始抓包。 现在你的屏幕上会疯狂跳动数据包。 如何过滤只看受害者？ 在顶部的过滤栏（Filter）输入：ip.addr == 172.20.10.4 回车。现在你看到的就是全都是受害者的流量了。 你可以尝试输入 http 来只看网页浏览记录。 #driftnet 显示黑屏（或者一直捕获不到图片）的核心原因只有一个：HTTPS 加密。 1. 核心原因：HTTP vs HTTPS Driftnet 的原理：它只能从流量中提取 HTTP（未加密） 协议传输的图片。 现在的互联网：99% 的网站（百度、B站、淘宝、Google、所有银行）都强制使用了 HTTPS（加密传输）。 结果：当受害者访问 HTTPS 网站时，所有图片数据在传输过程中都是乱码（加密的）。Driftnet 看不懂这些乱码，所以提取不出图片，窗口就是黑的。 2. 如何验证你的攻击是否成功？ 为了证明你的中间人攻击其实是成功的，你需要让受害者访问一个非加密的 HTTP 网站。 🧪 测试步骤： 保持攻击：不要关闭 arpspoof 和 driftnet 的窗口。 受害者操作：用受害者的电脑（或手机）打开浏览器，访问下面这些纯 HTTP 网站（不要用搜索引擎搜，直接在地址栏输入）： http://www.vulnweb.com/ (一个专门用于测试的靶场网站) http://example.com/ 观察 Driftnet： 一旦受害者加载了 www.vulnweb.com 里的图片，你的 driftnet 小黑窗里瞬间就会浮现出图片。 3. 如果连 HTTP 网站都抓不到... 如果受害者访问了 HTTP 网站，但你还是黑屏，那可能有以下两个问题： 问题 A：IP 转发没开（导致受害者断网） 如果受害者那边网页根本打不开（一直在转圈），说明你的 Kali 截获了数据包但没发出去。 检查命令： cat /proc/sys/net/ipv4/ip_forward 如果是 0，请再次执行：echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 问题 B：Driftnet 监听错网卡了 虽然你用了 -i eth0，但建议确认一下流量是否真的在走。 改用 Wireshark 验证： 打开 Wireshark，选 eth0。 输入过滤条件：ip.addr == 172.20.10.4 (受害者IP)。 看有没有数据包在跳动。如果有，说明攻击成功了，只是 Driftnet 解析不了 HTTPS 而已。 总结 你现在的状态就像是**“戴着普通眼镜试图看红外线”**。 攻击是成功的（你截获了数据）。 但是数据是加密的（HTTPS），所以 Driftnet 这个老旧的工具（只懂 HTTP）变成了“瞎子”。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 这是一张非常典型的**攻击失败**截图，原因非常简单，但也很容易被忽略。 请仔细看你截图左边那个终端窗口里的一排排数字： `0:c:29:78:c:c 0:0:0:0:0:0 0806 42: arp reply ...` **🔴 核心问题：`0:0:0:0:0:0`** 中间这一串 **全 0 的 MAC 地址** 就是问题的根源。 这代表 `arpspoof` 工具**丢失了目标的物理地址**。它想欺骗受害者，但它不知道受害者的网卡地址是多少，所以它把攻击包发往了一个“空地址”。受害者根本收不到这些包，所以你的攻击无效，`driftnet` 当然也是黑屏。 ### 为什么会这样？ 虽然你刚才用 `arp -a` 看到了地址，但因为受害者开启了防火墙（Ping 不通），Kali 的系统可能会认为“这个设备不在线”，过一会就把它的 ARP 记录**清理掉（过期）了**。 ### ✅ 解决办法（只需 3 步） 我们需要在攻击运行的前一秒，强行刷新一次记录。 #### 第一步：全部停止 在两个运行 `arpspoof` 的黑色窗口中，都按 **`Ctrl + C`** 彻底关掉它们。 #### 第二步：手动“激活”ARP 缓存（关键） 不管 Ping 通不通，我们要利用 Ping 命令触发底层的 ARP 请求。请**快速**依次执行以下命令： \u200b```bash # 1. 激活网关记录 ping -c 2 172.20.10.1 # 2. 激活受害者记录 ping -c 2 172.20.10.4 # 3. 立即确认（必须要看到两台设备都有 MAC 地址才行） arp -a *如果你看到 `(incomplete)`，就多 Ping 几次，直到出现 MAC 地址（如 `08:b4:d2...`）为止。* #### 第三步：趁热打铁，立刻攻击 一旦 `arp -a` 里有了记录，**不要犹豫，马上运行攻击命令**： # 窗口 1 sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 # 窗口 2 sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 **👀 这次注意观察：** 运行后，盯着屏幕看，确保中间那串地址**不再是 `0:0:0:0:0:0`**，而是变成了具体的字母数字组合（如 `08:b4...`）。只要地址对了，流量自然就来了。 "><title>ARP欺骗原理</title><link rel=canonical href=http://localhost:1313/kali/arp%E6%AC%BA%E9%AA%97%E5%8E%9F%E7%90%86/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="ARP欺骗原理"><meta property='og:description' content="ARP欺骗原理：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ARP 地址解析协议，的作用是将IP地址解析为物理硬件地址（MAC地址） 在局域网中，设备之间通信依赖的是MAC地址。ARP协议色痕迹之初出于对局域网内设备的完全信任，存在两个巨大的安全隐患，这也是ARP欺骗的根源： 1、无状态性：设备收到ARP应答（Reply)时，不会验证自己是否发送过ARP请求（Request) 2、后到优先：设备会接受最新的ARP应答，并覆盖ARP缓存表中旧的记录 统计流程解析： 假如网络环境如下： ·网关（Gateway):IP:192.168.200.1 , MAC AA:AA:AA:AA:AA:AA ·受害者（Victim):IP 192.168.200.2 , MAC BB:BB:BB:BB:BB:BB ·攻击者（You/Kali）：IP 192.168.200.4，MAC CC:CC:CC:CC:CC:CC 攻击者如何欺骗网关？攻击者会不断向网关发送伪造的ARP应答包，内容宣称：“我是受害者IP192.168.200.2，我的MAC地址是CC:CC:CC:CC:CC:CC （攻击者MAC）” 网关收到后，会更新自己的ARP缓存表，当网关要想把数据包发给受害者（192.168.200.2）时，他查看缓存ibao，发现对应的MAC时攻击者的MAC，于是它会将数据包封装并发给攻击者 双向欺骗：为了实现完整的中间人攻击，攻击者通常会同时欺骗两边： 1、告诉网关：我是受害者 2、告诉受害者：我是网关 这样，双方通信流量都会将过攻击者的网卡 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 NAT模式：相当于在中间加了一个路由器，你发出的ARP广播包根本出不去，被挡在了虚拟网络里，所以你看不到外面的设备 NAT隔离：相当于你现在被关在“虚拟的小房间”里，而受害者在“房间外面的大厅”里 解决方案：必须切换到“桥接模式” (Bridged) 想要攻击手机热点下的其他设备，你必须让 Kali “走出小房间，直接连到热点上”。 操作步骤： #修改虚拟机设置： 在 VMware 菜单栏点击 虚拟机 (Virtual Machine) -> 设置 (Settings)。 点击左侧的 网络适配器 (Network Adapter)。 在右侧选择 桥接模式 (Bridged)。 关键一步：勾选“复制物理网络连接状态”（Replicate physical network connection state）。 点击确定。 #打开虚拟网络编辑器 (Virtual Network Editor) 在 Windows 下（不是 Kali 里），点击 VMware 软件左上角的 编辑 (Edit) -> 虚拟网络编辑器 (Virtual Network Editor)。 点击右下角的 更改设置 (Change Settings)（需要管理员权限）。 在列表中找到 VMnet0（它的类型应该是“桥接模式”）。 如果没有 VMnet0，就点击“添加网络”添加一个。 在下方的 已桥接至 (Bridged to) 下拉菜单中： 千万不要选“自动”！ 必须选择你截图里那个 Wi-Fi 网卡的名字：Qualcomm WCN685x Wi-Fi 6E...。 点击 确定 保存。 sudo systemctl restart NetworkManager 重启网络管理器服务 什么你觉得没变？ 因为你的网卡现在同时拥有两个 IP： 172.24.198.118（旧的，错误的） 172.20.10.5（新的，正确的） 这种情况会让网络工具“精神分裂”，它可能会继续默认使用上面那个错误的 IP 发包。我们需要手动帮它“清理门户”。 第一步：清理掉错误的 IP 为了防止干扰，我们手动把那个错误的 IP 删掉，只保留正确的。 在终端输入： sudo ip addr del 172.24.198.118/20 dev eth0 输完之后，再输入 ip a 确认一下，应该只剩下 172.20.10.5 了。 第二步：扫描受害者（关键时刻） 既然你现在的 IP 是 172.20.10.5，说明你已经成功混入了手机热点的网络。 注意：你的子网掩码是 /28（这是 iPhone 热点的特性，意味着它只允许 14 台设备连接，IP 范围很小）。 请运行这个精准的扫描命令： sudo netdiscover -r 172.20.10.0/24 (用 /24 也没关系，扫得更宽一点) 预期结果： 172.20.10.1：这是网关（你的手机）。 172.20.10.3：这是你截图里显示的受害者（如果它还连着的话）。 172.20.10.x：其他设备。 第三步：开始攻击演示 一旦扫描确认了受害者在线（比如看到了 172.20.10.3），就可以进行 ARP 欺骗了。 开启转发（别忘了）： echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 双向欺骗（两个窗口）： # 窗口 1：告诉受害者(.3) 我是网关(.1) arpspoof -i eth0 -t 172.20.10.3 172.20.10.1 # 窗口 2：告诉网关(.1) 我是受害者(.3) arpspoof -i eth0 -t 172.20.10.1 172.20.10.3 开始 ARP 欺骗 假设我们要攻击那台 Intel 的电脑 (172.20.10.4)，请按以下步骤操作。 第一步：开启路由转发（必做，否则对方会断网） 在 Kali 终端执行： echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 第二步：发动攻击（双向欺骗） 你需要打开两个终端窗口，分别执行以下命令： 窗口 1：欺骗受害者（告诉 .4 我是网关） sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 窗口 2：欺骗网关（告诉 .1 我是受害者） sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 (如果你想攻击自己的主机 .3，就把上面的 172.20.10.4 换成 172.20.10.3 即可) 第三步：验证效果 攻击开始后，你可以用 Wireshark 抓包，或者使用 driftnet 查看受害者正在浏览的图片： sudo driftnet -i eth0 #需要先让 Kali “认识”一下受害者，然后再攻击。 第一步：停止当前的攻击 在两个 arpspoof 的终端窗口中，都按 Ctrl + C 停止运行。 第二步：手动“激活”目标（关键） 在终端里输入以下命令，强行让 Kali 去寻找受害者： ping -c 4 172.20.10.4 确保你能看到 64 bytes from ... 的回显。这不仅证明它是通的，更重要的是，这会把受害者的 MAC 地址写入 Kali 的 ARP 缓存表。 第三步：检查 ARP 缓存 输入以下命令确认 Kali 已经获取到了 MAC： arp -a 你应该能看到类似 (172.20.10.4) at 08:b4:d2:55:49:89 ... 的记录。只要不是 (incomplete) 或者没有记录，就可以继续。 第四步：重新开始欺骗 现在重新运行那两条攻击命令： # 窗口 1 sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 # 窗口 2 sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 👀 观察变化： 这次再看 arpspoof 的输出，中间那个 MAC 地址应该变成真实的 08:b4:d2...，而不是 0:0:0:0:0:0 了。 第五步：验证 Wireshark 回到 Wireshark： 重新开始抓包。 让受害者随便打开一个网页（比如百度）。 你应该能看到 TCP 和 TLS 的数据包开始刷屏。这就说明你成功截获流量了！ 不需要纠结 Ping 不通的问题，直接开始攻击。因为 Kali 现在已经知道对方的 MAC 地址了，之前那个 0:0:0:0:0:0 的错误不会再出现了。 立刻运行攻击命令（两个窗口）： 窗口 1： sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 窗口 2： sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 这次你会发现，终端里刷出的日志里，MAC 地址会是正确的 08:b4:d2...，这就说明攻击已经生效了！ 💡 额外验证（如果你非要 Ping 通）： 如果你能操作那台受害者电脑（172.20.10.4），去把它的 Windows 防火墙 暂时关掉，或者在防火墙设置里允许 ICMP 回显，Ping 马上就通了。但这不影响你进行 ARP 欺骗实验 #使用 Wireshark（最专业，看所有流量） 如果你想看受害者具体在干什么（不仅仅是看图片），Wireshark 是最强大的工具，而且 Kali 默认自带。 在 Kali 左上角菜单搜索 Wireshark 并打开（或者终端输入 sudo wireshark）。 在欢迎界面双击 eth0 开始抓包。 现在你的屏幕上会疯狂跳动数据包。 如何过滤只看受害者？ 在顶部的过滤栏（Filter）输入：ip.addr == 172.20.10.4 回车。现在你看到的就是全都是受害者的流量了。 你可以尝试输入 http 来只看网页浏览记录。 #driftnet 显示黑屏（或者一直捕获不到图片）的核心原因只有一个：HTTPS 加密。 1. 核心原因：HTTP vs HTTPS Driftnet 的原理：它只能从流量中提取 HTTP（未加密） 协议传输的图片。 现在的互联网：99% 的网站（百度、B站、淘宝、Google、所有银行）都强制使用了 HTTPS（加密传输）。 结果：当受害者访问 HTTPS 网站时，所有图片数据在传输过程中都是乱码（加密的）。Driftnet 看不懂这些乱码，所以提取不出图片，窗口就是黑的。 2. 如何验证你的攻击是否成功？ 为了证明你的中间人攻击其实是成功的，你需要让受害者访问一个非加密的 HTTP 网站。 🧪 测试步骤： 保持攻击：不要关闭 arpspoof 和 driftnet 的窗口。 受害者操作：用受害者的电脑（或手机）打开浏览器，访问下面这些纯 HTTP 网站（不要用搜索引擎搜，直接在地址栏输入）： http://www.vulnweb.com/ (一个专门用于测试的靶场网站) http://example.com/ 观察 Driftnet： 一旦受害者加载了 www.vulnweb.com 里的图片，你的 driftnet 小黑窗里瞬间就会浮现出图片。 3. 如果连 HTTP 网站都抓不到... 如果受害者访问了 HTTP 网站，但你还是黑屏，那可能有以下两个问题： 问题 A：IP 转发没开（导致受害者断网） 如果受害者那边网页根本打不开（一直在转圈），说明你的 Kali 截获了数据包但没发出去。 检查命令： cat /proc/sys/net/ipv4/ip_forward 如果是 0，请再次执行：echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 问题 B：Driftnet 监听错网卡了 虽然你用了 -i eth0，但建议确认一下流量是否真的在走。 改用 Wireshark 验证： 打开 Wireshark，选 eth0。 输入过滤条件：ip.addr == 172.20.10.4 (受害者IP)。 看有没有数据包在跳动。如果有，说明攻击成功了，只是 Driftnet 解析不了 HTTPS 而已。 总结 你现在的状态就像是**“戴着普通眼镜试图看红外线”**。 攻击是成功的（你截获了数据）。 但是数据是加密的（HTTPS），所以 Driftnet 这个老旧的工具（只懂 HTTP）变成了“瞎子”。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 这是一张非常典型的**攻击失败**截图，原因非常简单，但也很容易被忽略。 请仔细看你截图左边那个终端窗口里的一排排数字： `0:c:29:78:c:c 0:0:0:0:0:0 0806 42: arp reply ...` **🔴 核心问题：`0:0:0:0:0:0`** 中间这一串 **全 0 的 MAC 地址** 就是问题的根源。 这代表 `arpspoof` 工具**丢失了目标的物理地址**。它想欺骗受害者，但它不知道受害者的网卡地址是多少，所以它把攻击包发往了一个“空地址”。受害者根本收不到这些包，所以你的攻击无效，`driftnet` 当然也是黑屏。 ### 为什么会这样？ 虽然你刚才用 `arp -a` 看到了地址，但因为受害者开启了防火墙（Ping 不通），Kali 的系统可能会认为“这个设备不在线”，过一会就把它的 ARP 记录**清理掉（过期）了**。 ### ✅ 解决办法（只需 3 步） 我们需要在攻击运行的前一秒，强行刷新一次记录。 #### 第一步：全部停止 在两个运行 `arpspoof` 的黑色窗口中，都按 **`Ctrl + C`** 彻底关掉它们。 #### 第二步：手动“激活”ARP 缓存（关键） 不管 Ping 通不通，我们要利用 Ping 命令触发底层的 ARP 请求。请**快速**依次执行以下命令： \u200b```bash # 1. 激活网关记录 ping -c 2 172.20.10.1 # 2. 激活受害者记录 ping -c 2 172.20.10.4 # 3. 立即确认（必须要看到两台设备都有 MAC 地址才行） arp -a *如果你看到 `(incomplete)`，就多 Ping 几次，直到出现 MAC 地址（如 `08:b4:d2...`）为止。* #### 第三步：趁热打铁，立刻攻击 一旦 `arp -a` 里有了记录，**不要犹豫，马上运行攻击命令**： # 窗口 1 sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 # 窗口 2 sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 **👀 这次注意观察：** 运行后，盯着屏幕看，确保中间那串地址**不再是 `0:0:0:0:0:0`**，而是变成了具体的字母数字组合（如 `08:b4...`）。只要地址对了，流量自然就来了。 "><meta property='og:url' content='http://localhost:1313/kali/arp%E6%AC%BA%E9%AA%97%E5%8E%9F%E7%90%86/'><meta property='og:site_name' content='JustWin'><meta property='og:type' content='article'><meta property='article:section' content='Kali'><meta property='article:published_time' content='2025-12-13T00:00:00+00:00'><meta property='article:modified_time' content='2025-12-13T00:00:00+00:00'><meta property='og:image' content='http://localhost:1313/'><meta name=twitter:title content="ARP欺骗原理"><meta name=twitter:description content="ARP欺骗原理：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ARP 地址解析协议，的作用是将IP地址解析为物理硬件地址（MAC地址） 在局域网中，设备之间通信依赖的是MAC地址。ARP协议色痕迹之初出于对局域网内设备的完全信任，存在两个巨大的安全隐患，这也是ARP欺骗的根源： 1、无状态性：设备收到ARP应答（Reply)时，不会验证自己是否发送过ARP请求（Request) 2、后到优先：设备会接受最新的ARP应答，并覆盖ARP缓存表中旧的记录 统计流程解析： 假如网络环境如下： ·网关（Gateway):IP:192.168.200.1 , MAC AA:AA:AA:AA:AA:AA ·受害者（Victim):IP 192.168.200.2 , MAC BB:BB:BB:BB:BB:BB ·攻击者（You/Kali）：IP 192.168.200.4，MAC CC:CC:CC:CC:CC:CC 攻击者如何欺骗网关？攻击者会不断向网关发送伪造的ARP应答包，内容宣称：“我是受害者IP192.168.200.2，我的MAC地址是CC:CC:CC:CC:CC:CC （攻击者MAC）” 网关收到后，会更新自己的ARP缓存表，当网关要想把数据包发给受害者（192.168.200.2）时，他查看缓存ibao，发现对应的MAC时攻击者的MAC，于是它会将数据包封装并发给攻击者 双向欺骗：为了实现完整的中间人攻击，攻击者通常会同时欺骗两边： 1、告诉网关：我是受害者 2、告诉受害者：我是网关 这样，双方通信流量都会将过攻击者的网卡 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 NAT模式：相当于在中间加了一个路由器，你发出的ARP广播包根本出不去，被挡在了虚拟网络里，所以你看不到外面的设备 NAT隔离：相当于你现在被关在“虚拟的小房间”里，而受害者在“房间外面的大厅”里 解决方案：必须切换到“桥接模式” (Bridged) 想要攻击手机热点下的其他设备，你必须让 Kali “走出小房间，直接连到热点上”。 操作步骤： #修改虚拟机设置： 在 VMware 菜单栏点击 虚拟机 (Virtual Machine) -> 设置 (Settings)。 点击左侧的 网络适配器 (Network Adapter)。 在右侧选择 桥接模式 (Bridged)。 关键一步：勾选“复制物理网络连接状态”（Replicate physical network connection state）。 点击确定。 #打开虚拟网络编辑器 (Virtual Network Editor) 在 Windows 下（不是 Kali 里），点击 VMware 软件左上角的 编辑 (Edit) -> 虚拟网络编辑器 (Virtual Network Editor)。 点击右下角的 更改设置 (Change Settings)（需要管理员权限）。 在列表中找到 VMnet0（它的类型应该是“桥接模式”）。 如果没有 VMnet0，就点击“添加网络”添加一个。 在下方的 已桥接至 (Bridged to) 下拉菜单中： 千万不要选“自动”！ 必须选择你截图里那个 Wi-Fi 网卡的名字：Qualcomm WCN685x Wi-Fi 6E...。 点击 确定 保存。 sudo systemctl restart NetworkManager 重启网络管理器服务 什么你觉得没变？ 因为你的网卡现在同时拥有两个 IP： 172.24.198.118（旧的，错误的） 172.20.10.5（新的，正确的） 这种情况会让网络工具“精神分裂”，它可能会继续默认使用上面那个错误的 IP 发包。我们需要手动帮它“清理门户”。 第一步：清理掉错误的 IP 为了防止干扰，我们手动把那个错误的 IP 删掉，只保留正确的。 在终端输入： sudo ip addr del 172.24.198.118/20 dev eth0 输完之后，再输入 ip a 确认一下，应该只剩下 172.20.10.5 了。 第二步：扫描受害者（关键时刻） 既然你现在的 IP 是 172.20.10.5，说明你已经成功混入了手机热点的网络。 注意：你的子网掩码是 /28（这是 iPhone 热点的特性，意味着它只允许 14 台设备连接，IP 范围很小）。 请运行这个精准的扫描命令： sudo netdiscover -r 172.20.10.0/24 (用 /24 也没关系，扫得更宽一点) 预期结果： 172.20.10.1：这是网关（你的手机）。 172.20.10.3：这是你截图里显示的受害者（如果它还连着的话）。 172.20.10.x：其他设备。 第三步：开始攻击演示 一旦扫描确认了受害者在线（比如看到了 172.20.10.3），就可以进行 ARP 欺骗了。 开启转发（别忘了）： echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 双向欺骗（两个窗口）： # 窗口 1：告诉受害者(.3) 我是网关(.1) arpspoof -i eth0 -t 172.20.10.3 172.20.10.1 # 窗口 2：告诉网关(.1) 我是受害者(.3) arpspoof -i eth0 -t 172.20.10.1 172.20.10.3 开始 ARP 欺骗 假设我们要攻击那台 Intel 的电脑 (172.20.10.4)，请按以下步骤操作。 第一步：开启路由转发（必做，否则对方会断网） 在 Kali 终端执行： echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 第二步：发动攻击（双向欺骗） 你需要打开两个终端窗口，分别执行以下命令： 窗口 1：欺骗受害者（告诉 .4 我是网关） sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 窗口 2：欺骗网关（告诉 .1 我是受害者） sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 (如果你想攻击自己的主机 .3，就把上面的 172.20.10.4 换成 172.20.10.3 即可) 第三步：验证效果 攻击开始后，你可以用 Wireshark 抓包，或者使用 driftnet 查看受害者正在浏览的图片： sudo driftnet -i eth0 #需要先让 Kali “认识”一下受害者，然后再攻击。 第一步：停止当前的攻击 在两个 arpspoof 的终端窗口中，都按 Ctrl + C 停止运行。 第二步：手动“激活”目标（关键） 在终端里输入以下命令，强行让 Kali 去寻找受害者： ping -c 4 172.20.10.4 确保你能看到 64 bytes from ... 的回显。这不仅证明它是通的，更重要的是，这会把受害者的 MAC 地址写入 Kali 的 ARP 缓存表。 第三步：检查 ARP 缓存 输入以下命令确认 Kali 已经获取到了 MAC： arp -a 你应该能看到类似 (172.20.10.4) at 08:b4:d2:55:49:89 ... 的记录。只要不是 (incomplete) 或者没有记录，就可以继续。 第四步：重新开始欺骗 现在重新运行那两条攻击命令： # 窗口 1 sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 # 窗口 2 sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 👀 观察变化： 这次再看 arpspoof 的输出，中间那个 MAC 地址应该变成真实的 08:b4:d2...，而不是 0:0:0:0:0:0 了。 第五步：验证 Wireshark 回到 Wireshark： 重新开始抓包。 让受害者随便打开一个网页（比如百度）。 你应该能看到 TCP 和 TLS 的数据包开始刷屏。这就说明你成功截获流量了！ 不需要纠结 Ping 不通的问题，直接开始攻击。因为 Kali 现在已经知道对方的 MAC 地址了，之前那个 0:0:0:0:0:0 的错误不会再出现了。 立刻运行攻击命令（两个窗口）： 窗口 1： sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 窗口 2： sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 这次你会发现，终端里刷出的日志里，MAC 地址会是正确的 08:b4:d2...，这就说明攻击已经生效了！ 💡 额外验证（如果你非要 Ping 通）： 如果你能操作那台受害者电脑（172.20.10.4），去把它的 Windows 防火墙 暂时关掉，或者在防火墙设置里允许 ICMP 回显，Ping 马上就通了。但这不影响你进行 ARP 欺骗实验 #使用 Wireshark（最专业，看所有流量） 如果你想看受害者具体在干什么（不仅仅是看图片），Wireshark 是最强大的工具，而且 Kali 默认自带。 在 Kali 左上角菜单搜索 Wireshark 并打开（或者终端输入 sudo wireshark）。 在欢迎界面双击 eth0 开始抓包。 现在你的屏幕上会疯狂跳动数据包。 如何过滤只看受害者？ 在顶部的过滤栏（Filter）输入：ip.addr == 172.20.10.4 回车。现在你看到的就是全都是受害者的流量了。 你可以尝试输入 http 来只看网页浏览记录。 #driftnet 显示黑屏（或者一直捕获不到图片）的核心原因只有一个：HTTPS 加密。 1. 核心原因：HTTP vs HTTPS Driftnet 的原理：它只能从流量中提取 HTTP（未加密） 协议传输的图片。 现在的互联网：99% 的网站（百度、B站、淘宝、Google、所有银行）都强制使用了 HTTPS（加密传输）。 结果：当受害者访问 HTTPS 网站时，所有图片数据在传输过程中都是乱码（加密的）。Driftnet 看不懂这些乱码，所以提取不出图片，窗口就是黑的。 2. 如何验证你的攻击是否成功？ 为了证明你的中间人攻击其实是成功的，你需要让受害者访问一个非加密的 HTTP 网站。 🧪 测试步骤： 保持攻击：不要关闭 arpspoof 和 driftnet 的窗口。 受害者操作：用受害者的电脑（或手机）打开浏览器，访问下面这些纯 HTTP 网站（不要用搜索引擎搜，直接在地址栏输入）： http://www.vulnweb.com/ (一个专门用于测试的靶场网站) http://example.com/ 观察 Driftnet： 一旦受害者加载了 www.vulnweb.com 里的图片，你的 driftnet 小黑窗里瞬间就会浮现出图片。 3. 如果连 HTTP 网站都抓不到... 如果受害者访问了 HTTP 网站，但你还是黑屏，那可能有以下两个问题： 问题 A：IP 转发没开（导致受害者断网） 如果受害者那边网页根本打不开（一直在转圈），说明你的 Kali 截获了数据包但没发出去。 检查命令： cat /proc/sys/net/ipv4/ip_forward 如果是 0，请再次执行：echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 问题 B：Driftnet 监听错网卡了 虽然你用了 -i eth0，但建议确认一下流量是否真的在走。 改用 Wireshark 验证： 打开 Wireshark，选 eth0。 输入过滤条件：ip.addr == 172.20.10.4 (受害者IP)。 看有没有数据包在跳动。如果有，说明攻击成功了，只是 Driftnet 解析不了 HTTPS 而已。 总结 你现在的状态就像是**“戴着普通眼镜试图看红外线”**。 攻击是成功的（你截获了数据）。 但是数据是加密的（HTTPS），所以 Driftnet 这个老旧的工具（只懂 HTTP）变成了“瞎子”。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 这是一张非常典型的**攻击失败**截图，原因非常简单，但也很容易被忽略。 请仔细看你截图左边那个终端窗口里的一排排数字： `0:c:29:78:c:c 0:0:0:0:0:0 0806 42: arp reply ...` **🔴 核心问题：`0:0:0:0:0:0`** 中间这一串 **全 0 的 MAC 地址** 就是问题的根源。 这代表 `arpspoof` 工具**丢失了目标的物理地址**。它想欺骗受害者，但它不知道受害者的网卡地址是多少，所以它把攻击包发往了一个“空地址”。受害者根本收不到这些包，所以你的攻击无效，`driftnet` 当然也是黑屏。 ### 为什么会这样？ 虽然你刚才用 `arp -a` 看到了地址，但因为受害者开启了防火墙（Ping 不通），Kali 的系统可能会认为“这个设备不在线”，过一会就把它的 ARP 记录**清理掉（过期）了**。 ### ✅ 解决办法（只需 3 步） 我们需要在攻击运行的前一秒，强行刷新一次记录。 #### 第一步：全部停止 在两个运行 `arpspoof` 的黑色窗口中，都按 **`Ctrl + C`** 彻底关掉它们。 #### 第二步：手动“激活”ARP 缓存（关键） 不管 Ping 通不通，我们要利用 Ping 命令触发底层的 ARP 请求。请**快速**依次执行以下命令： \u200b```bash # 1. 激活网关记录 ping -c 2 172.20.10.1 # 2. 激活受害者记录 ping -c 2 172.20.10.4 # 3. 立即确认（必须要看到两台设备都有 MAC 地址才行） arp -a *如果你看到 `(incomplete)`，就多 Ping 几次，直到出现 MAC 地址（如 `08:b4:d2...`）为止。* #### 第三步：趁热打铁，立刻攻击 一旦 `arp -a` 里有了记录，**不要犹豫，马上运行攻击命令**： # 窗口 1 sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1 # 窗口 2 sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4 **👀 这次注意观察：** 运行后，盯着屏幕看，确保中间那串地址**不再是 `0:0:0:0:0:0`**，而是变成了具体的字母数字组合（如 `08:b4...`）。只要地址对了，流量自然就来了。 "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='http://localhost:1313/'><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar_hu_89ca753ea8ea85c7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>✍️</span></figure><div class=site-meta><h1 class=site-name><a href=/>JustWin</a></h1><h2 class=site-description>分享技术与生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/passion-win target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></li><li><a href=https://t.me/+TFjBeZzowwU1YTY1 target=_blank title=telegram rel=me><svg viewBox="0 0 640 640"><path d="M320 72C183 72 72 183 72 320S183 568 320 568 568 457 568 320 457 72 320 72zM435 240.7C431.3 279.9 415.1 375.1 406.9 419c-3.5 18.6-10.3 24.8-16.9 25.4C375.6 445.7 364.7 434.9 350.7 425.7c-21.8-14.3-34.2-23.2-55.3-37.2C270.9 372.4 286.8 363.5 300.7 349 304.4 345.2 367.8 287.5 369 282.3 369.2 281.6 369.3 279.2 367.8 277.9 366.3 276.6 364.2 277.1 362.7 277.4 360.5 277.9 325.6 300.9 258.1 346.5 248.2 353.3 239.2 356.6 231.2 356.4 222.3 356.2 205.3 351.4 192.6 347.3 177.1 342.3 164.7 339.6 165.8 331 166.4 326.5 172.5 322 184.2 317.3 256.5 285.8 304.7 265 328.8 255c68.9-28.6 83.2-33.6 92.5-33.8C423.4 221.2 427.9 221.7 430.9 224.1 432.9 225.8 434.1 228.2 434.4 230.8 434.9 234 435 237.3 434.8 240.6z"/></svg></a></li><li><a href=https://twitter.com/@win1688888888 target=_blank title=twitter rel=me><svg width="800" height="800" viewBox="0 -2 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>twitter [#154]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-60.000000, -7521.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M10.29 7377C17.837 7377 21.965 7370.84365 21.965 7365.50546 21.965 7365.33021 21.965 7365.15595 21.953 7364.98267 22.756 7364.41163 23.449 7363.70276 24 7362.8915 23.252 7363.21837 22.457 7363.433 21.644 7363.52751 22.5 7363.02244 23.141 7362.2289 23.448 7361.2926 22.642 7361.76321 21.761 7362.095 20.842 7362.27321 19.288 7360.64674 16.689 7360.56798 15.036 7362.09796 13.971 7363.08447 13.518 7364.55538 13.849 7365.95835 10.55 7365.79492 7.476 7364.261 5.392 7361.73762 4.303 7363.58363 4.86 7365.94457 6.663 7367.12996 6.01 7367.11125 5.371 7366.93797 4.8 7366.62489V7366.67608C4.801 7368.5989 6.178 7370.2549 8.092 7370.63591 7.488 7370.79836 6.854 7370.82199 6.24 7370.70483 6.777 7372.35099 8.318 7373.47829 10.073 7373.51078 8.62 7374.63513 6.825 7375.24554 4.977 7375.24358 4.651 7375.24259 4.325 7375.22388 4 7375.18549 5.877 7376.37088 8.06 7377 10.29 7376.99705" id="twitter-[#154]"/></g></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><span>首页</span></a></li><li><a href=/links/><span>网站</span></a></li><li><a href=/linux/><span>Linux</span></a></li><li><a href=/docker/><span>docker</span></a></li><li><a href=/k8s/><span>k8s</span></a></li><li><a href=/mysql/><span>mysql</span></a></li><li><a href=/project/><span>项目</span></a></li><li><a href=/kali/><span>kali</span></a></li><li><a href=/ubuntu/><span>ubuntu</span></a></li><li><a href=/utility/><span>Utility</span></a></li><li><a href=/about/><span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://localhost:1313/ selected>中文</option><option value=http://localhost:1313/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><div class=article-title-wrapper><h2 class=article-title><a href=/kali/arp%E6%AC%BA%E9%AA%97%E5%8E%9F%E7%90%86/>ARP欺骗原理</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-12-13</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 9 分钟</time></div></footer></div></header><section class=article-content><p>ARP欺骗原理：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ARP 地址解析协议，的作用是将IP地址解析为物理硬件地址（MAC地址）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>在局域网中，设备之间通信依赖的是MAC地址。ARP协议色痕迹之初出于对局域网内设备的完全信任，存在两个巨大的安全隐患，这也是ARP欺骗的根源：
</span></span><span class=line><span class=cl>1、无状态性：设备收到ARP应答（Reply<span class=o>)</span>时，不会验证自己是否发送过ARP请求（Request<span class=o>)</span>
</span></span><span class=line><span class=cl>2、后到优先：设备会接受最新的ARP应答，并覆盖ARP缓存表中旧的记录
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>统计流程解析：
</span></span><span class=line><span class=cl>假如网络环境如下：
</span></span><span class=line><span class=cl>·网关（Gateway<span class=o>)</span>:IP:192.168.200.1 , MAC AA:AA:AA:AA:AA:AA
</span></span><span class=line><span class=cl>·受害者（Victim<span class=o>)</span>:IP 192.168.200.2 , MAC BB:BB:BB:BB:BB:BB
</span></span><span class=line><span class=cl>·攻击者（You/Kali）：IP 192.168.200.4，MAC CC:CC:CC:CC:CC:CC
</span></span><span class=line><span class=cl>攻击者如何欺骗网关？攻击者会不断向网关发送伪造的ARP应答包，内容宣称：“我是受害者IP192.168.200.2，我的MAC地址是CC:CC:CC:CC:CC:CC （攻击者MAC）”
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>网关收到后，会更新自己的ARP缓存表，当网关要想把数据包发给受害者（192.168.200.2）时，他查看缓存ibao，发现对应的MAC时攻击者的MAC，于是它会将数据包封装并发给攻击者
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>双向欺骗：为了实现完整的中间人攻击，攻击者通常会同时欺骗两边：
</span></span><span class=line><span class=cl>1、告诉网关：我是受害者
</span></span><span class=line><span class=cl>2、告诉受害者：我是网关
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>这样，双方通信流量都会将过攻击者的网卡
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAT模式：相当于在中间加了一个路由器，你发出的ARP广播包根本出不去，被挡在了虚拟网络里，所以你看不到外面的设备
</span></span><span class=line><span class=cl>NAT隔离：相当于你现在被关在“虚拟的小房间”里，而受害者在“房间外面的大厅”里
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>解决方案：必须切换到“桥接模式” <span class=o>(</span>Bridged<span class=o>)</span>
</span></span><span class=line><span class=cl>想要攻击手机热点下的其他设备，你必须让 Kali “走出小房间，直接连到热点上”。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>操作步骤：
</span></span><span class=line><span class=cl><span class=c1>#修改虚拟机设置：</span>
</span></span><span class=line><span class=cl>在 VMware 菜单栏点击 虚拟机 <span class=o>(</span>Virtual Machine<span class=o>)</span> -&gt; 设置 <span class=o>(</span>Settings<span class=o>)</span>。
</span></span><span class=line><span class=cl>点击左侧的 网络适配器 <span class=o>(</span>Network Adapter<span class=o>)</span>。
</span></span><span class=line><span class=cl>在右侧选择 桥接模式 <span class=o>(</span>Bridged<span class=o>)</span>。
</span></span><span class=line><span class=cl>关键一步：勾选“复制物理网络连接状态”（Replicate physical network connection state）。
</span></span><span class=line><span class=cl>点击确定。
</span></span><span class=line><span class=cl><span class=c1>#打开虚拟网络编辑器 (Virtual Network Editor)</span>
</span></span><span class=line><span class=cl>在 Windows 下（不是 Kali 里），点击 VMware 软件左上角的 编辑 <span class=o>(</span>Edit<span class=o>)</span> -&gt; 虚拟网络编辑器 <span class=o>(</span>Virtual Network Editor<span class=o>)</span>。
</span></span><span class=line><span class=cl>点击右下角的 更改设置 <span class=o>(</span>Change Settings<span class=o>)</span>（需要管理员权限）。
</span></span><span class=line><span class=cl>在列表中找到 VMnet0（它的类型应该是“桥接模式”）。
</span></span><span class=line><span class=cl>如果没有 VMnet0，就点击“添加网络”添加一个。
</span></span><span class=line><span class=cl>在下方的 已桥接至 <span class=o>(</span>Bridged to<span class=o>)</span> 下拉菜单中：
</span></span><span class=line><span class=cl>千万不要选“自动”！
</span></span><span class=line><span class=cl>必须选择你截图里那个 Wi-Fi 网卡的名字：Qualcomm WCN685x Wi-Fi 6E...。
</span></span><span class=line><span class=cl>点击 确定 保存。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo systemctl restart NetworkManager           重启网络管理器服务
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>什么你觉得没变？
</span></span><span class=line><span class=cl>因为你的网卡现在同时拥有两个 IP：
</span></span><span class=line><span class=cl>172.24.198.118（旧的，错误的）
</span></span><span class=line><span class=cl>172.20.10.5（新的，正确的）
</span></span><span class=line><span class=cl>这种情况会让网络工具“精神分裂”，它可能会继续默认使用上面那个错误的 IP 发包。我们需要手动帮它“清理门户”。
</span></span><span class=line><span class=cl>第一步：清理掉错误的 IP
</span></span><span class=line><span class=cl>为了防止干扰，我们手动把那个错误的 IP 删掉，只保留正确的。
</span></span><span class=line><span class=cl>在终端输入：
</span></span><span class=line><span class=cl>sudo ip addr del 172.24.198.118/20 dev eth0
</span></span><span class=line><span class=cl>输完之后，再输入 ip a 确认一下，应该只剩下 172.20.10.5 了。
</span></span><span class=line><span class=cl>第二步：扫描受害者（关键时刻）
</span></span><span class=line><span class=cl>既然你现在的 IP 是 172.20.10.5，说明你已经成功混入了手机热点的网络。
</span></span><span class=line><span class=cl>注意：你的子网掩码是 /28（这是 iPhone 热点的特性，意味着它只允许 <span class=m>14</span> 台设备连接，IP 范围很小）。
</span></span><span class=line><span class=cl>请运行这个精准的扫描命令：
</span></span><span class=line><span class=cl>sudo netdiscover -r 172.20.10.0/24
</span></span><span class=line><span class=cl><span class=o>(</span>用 /24 也没关系，扫得更宽一点<span class=o>)</span>
</span></span><span class=line><span class=cl>预期结果：
</span></span><span class=line><span class=cl>172.20.10.1：这是网关（你的手机）。
</span></span><span class=line><span class=cl>172.20.10.3：这是你截图里显示的受害者（如果它还连着的话）。
</span></span><span class=line><span class=cl>172.20.10.x：其他设备。
</span></span><span class=line><span class=cl>第三步：开始攻击演示
</span></span><span class=line><span class=cl>一旦扫描确认了受害者在线（比如看到了 172.20.10.3），就可以进行 ARP 欺骗了。
</span></span><span class=line><span class=cl>开启转发（别忘了）：
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> <span class=p>|</span> sudo tee /proc/sys/net/ipv4/ip_forward
</span></span><span class=line><span class=cl>双向欺骗（两个窗口）：
</span></span><span class=line><span class=cl><span class=c1># 窗口 1：告诉受害者(.3) 我是网关(.1)</span>
</span></span><span class=line><span class=cl>arpspoof -i eth0 -t 172.20.10.3 172.20.10.1
</span></span><span class=line><span class=cl><span class=c1># 窗口 2：告诉网关(.1) 我是受害者(.3)</span>
</span></span><span class=line><span class=cl>arpspoof -i eth0 -t 172.20.10.1 172.20.10.3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>开始 ARP 欺骗
</span></span><span class=line><span class=cl>假设我们要攻击那台 Intel 的电脑 <span class=o>(</span>172.20.10.4<span class=o>)</span>，请按以下步骤操作。
</span></span><span class=line><span class=cl>第一步：开启路由转发（必做，否则对方会断网）
</span></span><span class=line><span class=cl>在 Kali 终端执行：
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> <span class=p>|</span> sudo tee /proc/sys/net/ipv4/ip_forward
</span></span><span class=line><span class=cl>第二步：发动攻击（双向欺骗）
</span></span><span class=line><span class=cl>你需要打开两个终端窗口，分别执行以下命令：
</span></span><span class=line><span class=cl>窗口 1：欺骗受害者（告诉 .4 我是网关）
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1
</span></span><span class=line><span class=cl>窗口 2：欺骗网关（告诉 .1 我是受害者）
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4
</span></span><span class=line><span class=cl><span class=o>(</span>如果你想攻击自己的主机 .3，就把上面的 172.20.10.4 换成 172.20.10.3 即可<span class=o>)</span>
</span></span><span class=line><span class=cl>第三步：验证效果
</span></span><span class=line><span class=cl>攻击开始后，你可以用 Wireshark 抓包，或者使用 driftnet 查看受害者正在浏览的图片：
</span></span><span class=line><span class=cl>sudo driftnet -i eth0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#需要先让 Kali “认识”一下受害者，然后再攻击。</span>
</span></span><span class=line><span class=cl>第一步：停止当前的攻击
</span></span><span class=line><span class=cl>在两个 arpspoof 的终端窗口中，都按 Ctrl + C 停止运行。
</span></span><span class=line><span class=cl>第二步：手动“激活”目标（关键）
</span></span><span class=line><span class=cl>在终端里输入以下命令，强行让 Kali 去寻找受害者：
</span></span><span class=line><span class=cl>ping -c <span class=m>4</span> 172.20.10.4
</span></span><span class=line><span class=cl>确保你能看到 <span class=m>64</span> bytes from ... 的回显。这不仅证明它是通的，更重要的是，这会把受害者的 MAC 地址写入 Kali 的 ARP 缓存表。
</span></span><span class=line><span class=cl>第三步：检查 ARP 缓存
</span></span><span class=line><span class=cl>输入以下命令确认 Kali 已经获取到了 MAC：
</span></span><span class=line><span class=cl>arp -a
</span></span><span class=line><span class=cl>你应该能看到类似 <span class=o>(</span>172.20.10.4<span class=o>)</span> at 08:b4:d2:55:49:89 ... 的记录。只要不是 <span class=o>(</span>incomplete<span class=o>)</span> 或者没有记录，就可以继续。
</span></span><span class=line><span class=cl>第四步：重新开始欺骗
</span></span><span class=line><span class=cl>现在重新运行那两条攻击命令：
</span></span><span class=line><span class=cl><span class=c1># 窗口 1</span>
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1
</span></span><span class=line><span class=cl><span class=c1># 窗口 2</span>
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4
</span></span><span class=line><span class=cl>👀 观察变化： 这次再看 arpspoof 的输出，中间那个 MAC 地址应该变成真实的 08:b4:d2...，而不是 0:0:0:0:0:0 了。
</span></span><span class=line><span class=cl>第五步：验证 Wireshark
</span></span><span class=line><span class=cl>回到 Wireshark：
</span></span><span class=line><span class=cl>重新开始抓包。
</span></span><span class=line><span class=cl>让受害者随便打开一个网页（比如百度）。
</span></span><span class=line><span class=cl>你应该能看到 TCP 和 TLS 的数据包开始刷屏。这就说明你成功截获流量了！
</span></span><span class=line><span class=cl>不需要纠结 Ping 不通的问题，直接开始攻击。因为 Kali 现在已经知道对方的 MAC 地址了，之前那个 0:0:0:0:0:0 的错误不会再出现了。
</span></span><span class=line><span class=cl>立刻运行攻击命令（两个窗口）：
</span></span><span class=line><span class=cl>窗口 1：
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1
</span></span><span class=line><span class=cl>窗口 2：
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4
</span></span><span class=line><span class=cl>这次你会发现，终端里刷出的日志里，MAC 地址会是正确的 08:b4:d2...，这就说明攻击已经生效了！
</span></span><span class=line><span class=cl>💡 额外验证（如果你非要 Ping 通）： 如果你能操作那台受害者电脑（172.20.10.4），去把它的 Windows 防火墙 暂时关掉，或者在防火墙设置里允许 ICMP 回显，Ping 马上就通了。但这不影响你进行 ARP 欺骗实验
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#使用 Wireshark（最专业，看所有流量）</span>
</span></span><span class=line><span class=cl>如果你想看受害者具体在干什么（不仅仅是看图片），Wireshark 是最强大的工具，而且 Kali 默认自带。
</span></span><span class=line><span class=cl>在 Kali 左上角菜单搜索 Wireshark 并打开（或者终端输入 sudo wireshark）。
</span></span><span class=line><span class=cl>在欢迎界面双击 eth0 开始抓包。
</span></span><span class=line><span class=cl>现在你的屏幕上会疯狂跳动数据包。
</span></span><span class=line><span class=cl>如何过滤只看受害者？
</span></span><span class=line><span class=cl>在顶部的过滤栏（Filter）输入：ip.addr <span class=o>==</span> 172.20.10.4
</span></span><span class=line><span class=cl>回车。现在你看到的就是全都是受害者的流量了。
</span></span><span class=line><span class=cl>你可以尝试输入 http 来只看网页浏览记录。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#driftnet 显示黑屏（或者一直捕获不到图片）的核心原因只有一个：HTTPS 加密。</span>
</span></span><span class=line><span class=cl>1. 核心原因：HTTP vs HTTPS
</span></span><span class=line><span class=cl>Driftnet 的原理：它只能从流量中提取 HTTP（未加密） 协议传输的图片。
</span></span><span class=line><span class=cl>现在的互联网：99% 的网站（百度、B站、淘宝、Google、所有银行）都强制使用了 HTTPS（加密传输）。
</span></span><span class=line><span class=cl>结果：当受害者访问 HTTPS 网站时，所有图片数据在传输过程中都是乱码（加密的）。Driftnet 看不懂这些乱码，所以提取不出图片，窗口就是黑的。
</span></span><span class=line><span class=cl>2. 如何验证你的攻击是否成功？
</span></span><span class=line><span class=cl>为了证明你的中间人攻击其实是成功的，你需要让受害者访问一个非加密的 HTTP 网站。
</span></span><span class=line><span class=cl>🧪 测试步骤：
</span></span><span class=line><span class=cl>保持攻击：不要关闭 arpspoof 和 driftnet 的窗口。
</span></span><span class=line><span class=cl>受害者操作：用受害者的电脑（或手机）打开浏览器，访问下面这些纯 HTTP 网站（不要用搜索引擎搜，直接在地址栏输入）：
</span></span><span class=line><span class=cl>http://www.vulnweb.com/ <span class=o>(</span>一个专门用于测试的靶场网站<span class=o>)</span>
</span></span><span class=line><span class=cl>http://example.com/
</span></span><span class=line><span class=cl>观察 Driftnet：
</span></span><span class=line><span class=cl>一旦受害者加载了 www.vulnweb.com 里的图片，你的 driftnet 小黑窗里瞬间就会浮现出图片。
</span></span><span class=line><span class=cl>3. 如果连 HTTP 网站都抓不到...
</span></span><span class=line><span class=cl>如果受害者访问了 HTTP 网站，但你还是黑屏，那可能有以下两个问题：
</span></span><span class=line><span class=cl>问题 A：IP 转发没开（导致受害者断网） 如果受害者那边网页根本打不开（一直在转圈），说明你的 Kali 截获了数据包但没发出去。
</span></span><span class=line><span class=cl>检查命令：
</span></span><span class=line><span class=cl>cat /proc/sys/net/ipv4/ip_forward
</span></span><span class=line><span class=cl>如果是 0，请再次执行：echo <span class=m>1</span> <span class=p>|</span> sudo tee /proc/sys/net/ipv4/ip_forward
</span></span><span class=line><span class=cl>问题 B：Driftnet 监听错网卡了 虽然你用了 -i eth0，但建议确认一下流量是否真的在走。
</span></span><span class=line><span class=cl>改用 Wireshark 验证：
</span></span><span class=line><span class=cl>打开 Wireshark，选 eth0。
</span></span><span class=line><span class=cl>输入过滤条件：ip.addr <span class=o>==</span> 172.20.10.4 <span class=o>(</span>受害者IP<span class=o>)</span>。
</span></span><span class=line><span class=cl>看有没有数据包在跳动。如果有，说明攻击成功了，只是 Driftnet 解析不了 HTTPS 而已。
</span></span><span class=line><span class=cl>总结
</span></span><span class=line><span class=cl>你现在的状态就像是**“戴着普通眼镜试图看红外线”**。
</span></span><span class=line><span class=cl>攻击是成功的（你截获了数据）。
</span></span><span class=line><span class=cl>但是数据是加密的（HTTPS），所以 Driftnet 这个老旧的工具（只懂 HTTP）变成了“瞎子”。
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>这是一张非常典型的**攻击失败**截图，原因非常简单，但也很容易被忽略。
</span></span><span class=line><span class=cl>请仔细看你截图左边那个终端窗口里的一排排数字：
</span></span><span class=line><span class=cl><span class=sb>`</span>0:c:29:78:c:c 0:0:0:0:0:0 <span class=m>0806</span> 42: arp reply ...<span class=sb>`</span>
</span></span><span class=line><span class=cl>**🔴 核心问题：<span class=sb>`</span>0:0:0:0:0:0<span class=sb>`</span>**
</span></span><span class=line><span class=cl>中间这一串 **全 <span class=m>0</span> 的 MAC 地址** 就是问题的根源。
</span></span><span class=line><span class=cl>这代表 <span class=sb>`</span>arpspoof<span class=sb>`</span> 工具**丢失了目标的物理地址**。它想欺骗受害者，但它不知道受害者的网卡地址是多少，所以它把攻击包发往了一个“空地址”。受害者根本收不到这些包，所以你的攻击无效，<span class=sb>`</span>driftnet<span class=sb>`</span> 当然也是黑屏。
</span></span><span class=line><span class=cl><span class=c1>### 为什么会这样？</span>
</span></span><span class=line><span class=cl>虽然你刚才用 <span class=sb>`</span>arp -a<span class=sb>`</span> 看到了地址，但因为受害者开启了防火墙（Ping 不通），Kali 的系统可能会认为“这个设备不在线”，过一会就把它的 ARP 记录**清理掉（过期）了**。
</span></span><span class=line><span class=cl><span class=c1>### ✅ 解决办法（只需 3 步）</span>
</span></span><span class=line><span class=cl>我们需要在攻击运行的前一秒，强行刷新一次记录。
</span></span><span class=line><span class=cl><span class=c1>#### 第一步：全部停止</span>
</span></span><span class=line><span class=cl>在两个运行 <span class=sb>`</span>arpspoof<span class=sb>`</span> 的黑色窗口中，都按 **<span class=sb>`</span>Ctrl + C<span class=sb>`</span>** 彻底关掉它们。
</span></span><span class=line><span class=cl><span class=c1>#### 第二步：手动“激活”ARP 缓存（关键）</span>
</span></span><span class=line><span class=cl>不管 Ping 通不通，我们要利用 Ping 命令触发底层的 ARP 请求。请**快速**依次执行以下命令：
</span></span><span class=line><span class=cl>​<span class=sb>```</span>bash
</span></span><span class=line><span class=cl><span class=c1># 1. 激活网关记录</span>
</span></span><span class=line><span class=cl>ping -c <span class=m>2</span> 172.20.10.1
</span></span><span class=line><span class=cl><span class=c1># 2. 激活受害者记录</span>
</span></span><span class=line><span class=cl>ping -c <span class=m>2</span> 172.20.10.4
</span></span><span class=line><span class=cl><span class=c1># 3. 立即确认（必须要看到两台设备都有 MAC 地址才行）</span>
</span></span><span class=line><span class=cl>arp -a
</span></span><span class=line><span class=cl>*如果你看到 <span class=sb>`</span><span class=o>(</span>incomplete<span class=o>)</span><span class=sb>`</span>，就多 Ping 几次，直到出现 MAC 地址（如 <span class=sb>`</span>08:b4:d2...<span class=sb>`</span>）为止。*
</span></span><span class=line><span class=cl><span class=c1>#### 第三步：趁热打铁，立刻攻击</span>
</span></span><span class=line><span class=cl>一旦 <span class=sb>`</span>arp -a<span class=sb>`</span> 里有了记录，**不要犹豫，马上运行攻击命令**：
</span></span><span class=line><span class=cl><span class=c1># 窗口 1</span>
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.4 172.20.10.1
</span></span><span class=line><span class=cl><span class=c1># 窗口 2</span>
</span></span><span class=line><span class=cl>sudo arpspoof -i eth0 -t 172.20.10.1 172.20.10.4
</span></span><span class=line><span class=cl>**👀 这次注意观察：**
</span></span><span class=line><span class=cl>运行后，盯着屏幕看，确保中间那串地址**不再是 <span class=sb>`</span>0:0:0:0:0:0<span class=sb>`</span>**，而是变成了具体的字母数字组合（如 <span class=sb>`</span>08:b4...<span class=sb>`</span>）。只要地址对了，流量自然就来了。
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>本文采用 CC BY-NC-SA 4.0 许可协议</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/utility/ansible/><div class=article-details><h2 class=article-title>Ansible</h2></div></a></article><article><a href=/utility/jenkins/><div class=article-details><h2 class=article-title>Jenkins</h2></div></a></article><article><a href=/utility/nfs/><div class=article-details><h2 class=article-title>NFS</h2></div></a></article><article><a href=/utility/prometheus-/><div class=article-details><h2 class=article-title>Prometheus</h2></div></a></article><article><a href=/utility/tomcat/><div class=article-details><h2 class=article-title>Tomcat</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2025 © 2025 win. 保留所有权利.</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>